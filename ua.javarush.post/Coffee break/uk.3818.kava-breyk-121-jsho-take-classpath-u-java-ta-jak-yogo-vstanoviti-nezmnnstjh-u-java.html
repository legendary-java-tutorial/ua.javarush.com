Кава-брейк #121. Що таке Classpath у Java та як його встановити? Незмінність у Java
<p>----------------------------------------</p>
Джерело: Знання основ програмування та потоку виконання програмних файлів допомагає нам зрозуміти мову. Знання параметра - одне з основних понять, яким повинен мати кожен Java-розробник. Сьогодні ми обговоримо, що таке шлях до класів ( ), я
<p>----------------------------------------</p>
<h2>Що таке Classpath у Java та як його встановити?</h2>Джерело: <a href="https://medium.com/javarevisited/do-you-know-classpath-in-java-3edd297907e5" rel="nofollow" target="_blank">Medium</a> Знання основ програмування та потоку виконання програмних файлів допомагає нам зрозуміти мову. Знання параметра <span class="code">Classpath</span> - одне з основних понять, яким повинен мати кожен Java-розробник. Сьогодні ми обговоримо, що таке шлях до класів ( <span class="code">Classpath</span> ), як його встановити та як він допомагає JVM виконувати файли класів. <img data-max-width="800" data-id="1bae37cd-589f-4c8b-8e52-5cf7df498bfa" alt="Кава-брейк #121.  Що таке Classpath у Java та як його встановити?  Незмінність у Java - 1" src="https://cdn.javarush.com/images/article/1bae37cd-589f-4c8b-8e52-5cf7df498bfa/800.jpeg" style="width: 800px;">
<h3>Що таке Classpath?</h3><span class="code">Classpath</span> є одним з основних параметрів Java, однак новачки в програмуванні часто розуміють його неправильно. Якщо спростити, то <span class="code">Classpath</span> - це просто <span class="text-bold">набір шляхів</span> , якими компілятор Java і JVM повинні знаходити необхідні класи для компіляції або виконання інших класів. 
<h3>Як Classpath допомагає JVM у виконанні файлів класів</h3>Почнемо з прикладу. Припустимо, що ми маємо файл <span class="code">Main.java</span> , який знаходиться в папці <em>/Users/vikram/Documents/test-java/src/com/programming/v1/Main.java</em> . 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>programming<span class="token punctuation">.</span>v1</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello classpath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Допустимо, ми знаходимося в <em>/Users/vikram/Documents</em> і хочемо скомпілювати цей клас: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">javac test<span class="token operator">-</span>java<span class="token operator">/</span>src<span class="token operator">/</span>com<span class="token operator">/</span>programming<span class="token operator">/</span>v1<span class="token operator">/</span><span class="token class-name">Main</span><span class="token punctuation">.</span>java</code></pre> Тепер, щоб виконати цей файл класу, нам потрібно повідомити віртуальну машину Java, де шукати файл <span class="code">.class</span> , використовуючи <span class="code">classpath</span> або прапор <span class="code">cp</span> у команді <span class="code">java</span> . 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java">vg<span class="token annotation punctuation">@lp1</span> <span class="token class-name">Documents</span> <span class="token operator">%</span> java <span class="token operator">-</span>cp <span class="token string">"test-java/src"</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>programming<span class="token punctuation">.</span>v1<span class="token punctuation">.</span></span>Main</span>
<span class="token class-name">Hello</span> classpath
vg<span class="token annotation punctuation">@lp1</span> <span class="token class-name">Documents</span> <span class="token operator">%</span> java <span class="token operator">-</span>classpath <span class="token string">"test-java/src"</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>programming<span class="token punctuation">.</span>v1<span class="token punctuation">.</span></span>Main</span>
<span class="token class-name">Hello</span> classpath</code></pre> Перший параметр – це коренева папка, до якої записується пакет. Другий параметр – це ім'я пакета з ім'ям класу. Коли Java виконується, віртуальна машина Java переглядає папку <em>test-java/src</em> , а потім завантажує основний клас для її виконання. 
<h3>Як встановити змінний Classpath</h3>Змінний параметр <span class="code">Classpath</span> може бути встановлений, як показано нижче, на комп'ютерах під керуванням Linux: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">export CLASSPATH<span class="token operator">=</span><span class="token string">"test-java/src"</span></code></pre><em>Classpath на комп'ютері з Windows можна додати/оновити за допомогою змінного середовища. </em> Після того, як змінне середовище встановлено, команду <span class="code">java</span> можна виконати, як показано нижче: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java">vg<span class="token annotation punctuation">@lp1</span> <span class="token class-name">Documents</span> <span class="token operator">%</span> java <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>programming<span class="token punctuation">.</span>v1<span class="token punctuation">.</span></span>Main</span>
<span class="token class-name">Hello</span> classpath</code></pre> Ось і все, що потрібно знати про <span class="code">Classpath</span> . Дякую за читання! 
<h2>Незмінність у Java</h2>Джерело: <a href="https://medium.com/@vivekts90/immutability-in-java-321835f1b4d" rel="nofollow" target="_blank">Medium</a> Змінні в Java бувають двох типів: примітивні та посилальні. Все Java передається за значенням, але у випадку посилальних типів вихідні дані можуть оновлюватися з використанням переданої адресаи пам'яті. <img data-max-width="800" data-id="80e209e7-a34c-4125-ba4f-e2dc759963f7" alt="Кава-брейк #121.  Що таке Classpath у Java та як його встановити?  Незмінність Java - 2" src="https://cdn.javarush.com/images/article/80e209e7-a34c-4125-ba4f-e2dc759963f7/800.jpeg" style="width: 800px;">Ключове слово <span class="code">final</span> використовується у тому, щоб змінна діяла як константа, тобто уникала перепризначення. Це добре працює для примітивів, у яких немає пам'яті в купі, тоді як для типів посилань обмежене тільки перепризначення, а внутрішній стан може бути змінено. Це може призвести до багатьох проблем з паралелізмом та умовами гонки (race conditions). Таким чином включення незмінних характеристик у звичайний тип Java дає багато переваг. 
<h3>Переваги незмінності Java</h3>
<h4>1. Безпека потоків</h4>Незмінні типи несприйнятливі до умов гонки у багатопотоковій середовищі, оскільки об'єкт залишиться узгодженим після створення. Декілька потоків не можуть змінити свій внутрішній стан, тому синхронізація не потрібна. 
<h4>2. Основний тип</h4><span class="code">String</span> у стандартній бібліотеці Java – гарний приклад базового класу. Це дуже простий і незмінний клас, який можна використовувати для створення доменів бізнес-логіки поверх нього. Точно так само незмінний тип може виступати як відмінний базовий тип, на основі якого можна будувати. 
<h3>Характеристики</h3>
<h4>1. Поля Private та Final</h4>Поля, що містять стан об'єкта, це <span class="code">private</span> і <span class="code">final</span> . Приватна ( <span class="code">private</span> ) видимість забороняє прямий доступ до поля, а остаточна ( <span class="code">final</span> ) гарантує, що поле призначається лише один раз. 
<h4>2. Жодних методів-модифікаторів</h4>До поля <span class="code">private</span> не можна отримати доступ за межами класу. Зазвичай для читання та запису в поля передбачені методи доступу (гетери) та методи-модифікатори (сеттери) відповідно. Для забезпечення незмінності модифікатори не допускаються. 
<h4>3. Клас Final</h4>Надання можливості успадкування класу може порушити незмінність. Підклас, що розширює незмінний клас, може вплинути стан об'єкта. Отже, клас є остаточним ( <span class="code">final</span> ). 
<h4>4. Захисні копії (Defensive Copies)</h4>Під час створення об'єкта замість того, щоб призначати аргументи з конструктора безпосередньо закритим полям, створення глибокої копії (або незмінної копії) аргументів забезпечить зовнішню зміну. Якщо один з аргументів є типом посилання, ним можна легко маніпулювати на зухвалій стороні. Створення захисних копій дозволяє уникнути цієї маніпуляції. Так само для засобів доступу (гетерів) замість прямого посилання на внутрішнє поле можна вільно ділитися його копією. 
<h3>Реалізація</h3>
<h4>Employee</h4>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">.</span>copyOf<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span>
                    <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                    <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">,</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>joinDate <span class="token operator">=</span> joinDate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>achievements <span class="token operator">=</span> <span class="token function">copyOf</span><span class="token punctuation">(</span>achievements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">LocalDate</span> <span class="token function">getJoinDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> joinDate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAchievements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> achievements<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
 <li>
  <p>Не всі поля мають захисні копії у конструкторі. Це з тим, що <span class="code">id</span> є примітивним, а поля <span class="code">name</span> і <span class="code">joinDate</span> є незмінними типами. Вони не можуть бути змінені стороною, що викликає, і залишаться незмінними, в той час як поле <span class="code">achievements</span> вимагає копії аргументу, зробленого за допомогою методу <span class="code">List.copyOf</span> . Це пояснюється тим, що <span class="code">copyOf</span> повертає незмінний <span class="code">List</span> .</p></li>
 <li>
  <p>Так само методи доступу повертають поля безпосередньо, а не захисні копії, тому що всі типи полів є незмінними (включаючи <span class="code">achievements</span> ) і, отже, не можуть бути змінені поза класом.</p></li>
</ul>
<h3>Поліпшення</h3>
<h4>До Java 16</h4>Реалізація <span class="code">Employee</span> може бути покращена за допомогою таких бібліотек, як <a href="https://projectlombok.org/" rel="nofollow" target="_blank">Lombok</a> . Це зменшує багатослівність у коді та допомагає йому виглядати чистішим. Бібліотека постачається з інструкціями для скорочення стандартного коду. <span class="code">@Value</span> (анотація) може використовуватися для створення гетерів та конструктора всіх аргументів. Це також створює клас <span class="code">final</span> та поля <span class="code">private</span> та <span class="code">final</span> . Як примітка, він також генерує методи <span class="code">toString</span> , <span class="code">equals</span> і <span class="code">hashCode</span> . Реалізація <span class="code">Employee</span> може бути переписана за допомогою <span class="code">@Value</span> , як показано нижче: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">.</span>copyOf<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Value</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

    <span class="token keyword">long</span> id<span class="token punctuation">;</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span>
                    <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                    <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">,</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>joinDate <span class="token operator">=</span> joinDate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>achievements <span class="token operator">=</span> <span class="token function">copyOf</span><span class="token punctuation">(</span>achievements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3>Java 16 і пізніші версії</h3>У релізі Java 16 з'явилася нова функція <span class="code">Record</span> . Вона (як стверджує JEP) є класами, які діють як прозорі носії незмінних даних, і можуть розглядатися як номінальні кортежі (tuples). Клас <span class="code">Employee</span> можна повторно реалізувати як <span class="code">record Employee</span> , що показано нижче. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">.</span>copyOf<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span>
                       <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                       <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">,</span>
                       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">,</span>
                    <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                    <span class="token class-name">LocalDate</span> joinDate<span class="token punctuation">,</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> achievements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>joinDate <span class="token operator">=</span> joinDate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>achievements <span class="token operator">=</span> <span class="token function">copyOf</span><span class="token punctuation">(</span>achievements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3>Недоліки</h3>Єдина проблема з незмінністю - додаткова пам'ять та обробка, які потрібні навіть для невеликої модифікації. Щоразу необхідно створювати новий об'єкт, що може бути дуже дорогим. Щоб обійти цей недолік, можна реалізувати такі механізми, як кешування та збереження результатів.