Кава-брейк #71. Рекомендації щодо аналізу Java-коду
<p>----------------------------------------</p>
Джерело: Наявність ще однієї пари очей для перевірки коду завжди корисна. Вам не потрібно бути експертом, щоб проаналізувати код. Рев'ю коду можна проводити навіть із невеликим досвідом роботи. Потрібно лише знати, як і що ви хочете перевір
<p>----------------------------------------</p>
Джерело: <a href="https://deepsource.io/blog/java-code-review-guidelines/?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=contentdistribution&amp;utm_term=javacodereview" rel="nofollow" target="_blank">DeepSource</a> Наявність ще однієї пари очей для перевірки коду завжди корисна. Вам не потрібно бути експертом, щоб проаналізувати код. Рев'ю коду можна проводити навіть із невеликим досвідом роботи. Потрібно лише знати, як і що ви хочете перевірити.<img data-max-width="800" data-id="1fb605a1-eb49-47a6-a741-d94c5f59d721" alt="Кава-брейк #71.  Рекомендації з аналізу Java-коду - 1" src="https://cdn.javarush.com/images/article/1fb605a1-eb49-47a6-a741-d94c5f59d721/800.jpeg" style="width: 800px;">
<h2>1. Дотримуйтесь угоди щодо оформлення коду Java</h2>Дотримання Java code conventions допомагає швидко переглянути код та зрозуміти його. Наприклад, всі імена пакетів у Java пишуться малими літерами, константи - тільки великими, імена змінних - в CamelCase і т. д. Повний список угод можна знайти <a href="https://www.oracle.com/technetwork/java/codeconventions-150003.pdf" rel="nofollow" target="_blank">тут</a> . Деякі команди розробляють власні угоди про стиль, тому врахуйте це!
<h2>2. Замініть імперативний код лямбдами та потоками</h2>Якщо ви використовуєте Java 8+, заміна циклів і надто докладних методів потоками та лямбда-виразами зробить код чистішим. Лямбди та потоки дозволяють писати функціональний код на Java. Наступний фрагмент коду фільтрує непарні числа традиційним імперативним способом: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> oddNumbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> number <span class="token operator">:</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  oddNumbers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> А це функціональний спосіб фільтрації непарних чисел: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> oddNumbers <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>number <span class="token operator">-&gt;</span> number <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>3. Остерігайтесь NullPointerException</h2>При написанні нових методів намагайтеся уникати повернення значень null. Це може призвести до появи null pointer exception. У наведеному нижче фрагменті зовнішній метод повертає значення null, якщо списку немає цілих чисел. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">class</span> <span class="token class-name">Items</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">Items</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">highest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	  <span class="token class-name">Integer</span> highest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      <span class="token keyword">if</span> <span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> highest <span class="token operator">=</span> item<span class="token punctuation">;</span>
	      <span class="token keyword">else</span> highest <span class="token operator">=</span> highest <span class="token operator">&gt;</span> item <span class="token operator">?</span> highest <span class="token operator">:</span> item<span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	  <span class="token keyword">return</span> highest<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Перед прямим викликом об'єкта я рекомендую перевірити наявність null, як показано нижче. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">Items</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Items</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> item <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">highest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isEven <span class="token operator">=</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// throws NullPointerException ❌</span>
<span class="token keyword">boolean</span> isEven <span class="token operator">=</span> item <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token comment">// ✅</span></code></pre> Однак мати всюди перевірки на null може бути досить обтяжливо. Якщо ви використовуєте версію Java 8 або вище, розгляньте можливість використання класу <span class="code">Optional</span> для надання значень без дійсних станів (valid states). Він дозволяє легко визначати альтернативну поведінку та корисний для зв'язування методів. У наведеному нижче фрагменті ми використовуємо Java Stream API, щоб знайти найбільше за допомогою методу, що повертає <span class="code">Optional</span> . Зверніть увагу, що ми використовуємо <span class="code">Stream.reduce</span> , який повертає значення <span class="code">Optional</span> . 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">highest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> items
            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>integer<span class="token punctuation">,</span> integer2<span class="token punctuation">)</span> <span class="token operator">&gt;</span>
							integer <span class="token operator">&gt;</span> integer2 <span class="token operator">?</span> integer <span class="token operator">:</span> integer2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Items</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Items</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
items<span class="token punctuation">.</span><span class="token function">highest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>integer <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>             <span class="token comment">// ✅</span>
    <span class="token keyword">boolean</span> isEven <span class="token operator">=</span> integer <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> В якості альтернативи ви також можете використовувати анотації, такі як <span class="code">@Nullable</span> або <span class="code">@NonNull</span> , які попередять вас, якщо під час створення коду виникне конфлікт null. Наприклад, передача аргументу <span class="code">@Nullable</span> методу, який приймає параметри <span class="code">@NonNull</span> .
<h2>4. Пряме присвоєння поля посилань з коду клієнта</h2>Посилання, надані кодом клієнта, можна змінювати, навіть якщо поле є остаточним. Давайте краще розберемося в цьому прикладі. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">Items</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> У наведеному вище фрагменті ми безпосередньо призначаємо поле посилання з коду клієнта. Клієнт може легко змінювати вміст списку та керувати нашим кодом, як показано нижче. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> numbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Items</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Items</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This will change how items behaves as well</span></code></pre> Натомість розгляньте можливість клонування посилання або створення нового посилання, а потім призначення його полю, як показано нижче: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">Items</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Те саме правило застосовується при поверненні посилань. Ви повинні бути обережні, щоб не розкрити внутрішній стан, що змінюється.
<h2>5. Обережно звертайтеся до винятків</h2>При перехопленні винятків, якщо у вас є кілька блоків перехоплення, переконайтеся, що послідовність блоків перехоплення — від конкретніших до менших. У наведеному нижче фрагменті виняток ніколи не буде перехоплений у другому блоці, оскільки клас <span class="code">Exception</span> – головний. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
	stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle exception</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">StackEmptyException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle exception</span>
<span class="token punctuation">}</span></code></pre> Якщо ситуація виправна і може бути оброблена клієнтом (користувачем вашої бібліотеки або коду), тоді краще використати перевірені винятки. Наприклад <span class="code">IOException</span> . Воно змушує клієнта обробляти сценарій, і якщо клієнт вирішує повторно викинути виняток, це має бути свідомий заклик ігнорувати виняток.
<h2>6. Обміркуйте вибір структур даних</h2>У Java колекції входять <span class="code">ArrayList</span> , <span class="code">LinkedList</span> , <span class="code">Vector</span> , <span class="code">Stack</span> , <span class="code">HashSet</span> , <span class="code">HashMap</span> , <span class="code">Hashtable</span> . Важливо розуміти плюси та мінуси кожного з них, щоб використовувати їх у правильному контексті. Декілька порад, які допоможуть зробити правильний вибір:
<ul>
 <li><span class="code">Map</span> : Корисний, якщо у вас є невпорядковані елементи, ключі, пари значень і потрібні ефективні операції вилучення, вставки та видалення. <span class="code">HashMap</span> , <span class="code">Hashtable</span> , <span class="code">LinkedHashMap</span> - це варіанти реалізації інтерфейсу Map.</li>
 <li><span class="code">List</span> : Дуже часто використовується для створення впорядкованого списку елементів. Цей список може містити дублікати. <span class="code">ArrayList</span> - це реалізація інтерфейсу <span class="code">List</span> . Список можна зробити безпечним, використовуючи <span class="code">Collections.synchronizedList</span> . Таким чином, відпадає необхідність використання <span class="code">Vector</span> . Ось ще <a href="https://javaconceptoftheday.com/not-use-vector-class-code/" rel="nofollow" target="_blank">трохи інформації</a> про те, чому <span class="code">Vector</span> насправді застарів.</li>
 <li><span class="code">Set</span> : Аналогічний <span class="code">List</span> , але не допускає дублікатів. Реалізує <span class="code">HashSet</span> в інтерфейсі <span class="code">Set</span> .</li>
</ul>
<h2>7. Подумайте двічі перед “розкриттям”</h2>У Java є кілька модифікаторів доступу - <span class="code">public</span> , <span class="code">protected</span> , <span class="code">private</span> . Якщо ви не бажаєте надавати метод клієнтському коду, можете залишити все <span class="code">private</span> за замовчуванням. Після того, як ви відкриєте API, назад дороги вже не буде. Наприклад, у вас є клас <span class="code">Library</span> , у якому є метод перевірки book by name: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">String</span> bookName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token function">searchByTitle</span><span class="token punctuation">(</span>availableBooks<span class="token punctuation">,</span> bookName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  availableBooks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
  checkedOutBooks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token function">searchByTitle</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> availableBooks<span class="token punctuation">,</span> <span class="token class-name">String</span> bookName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre> Якщо ви не збережете метод <span class="code">searchByTitle</span> за умовчанням як <span class="code">private</span> , то в кінцевому підсумку він стане доступним, і інші класи можуть почати використовувати його та будувати на його основі логіку, яку ви, можливо, хотіли б зробити частиною класу <span class="code">Library</span> . Це може порушити інкапсуляцію класу <span class="code">Library</span> і унеможливить відкат / зміну без порушення чужого коду.
<h2>8. Код для інтерфейсів</h2>Якщо у вас є конкретні реалізації певних інтерфейсів (наприклад, <span class="code">ArrayList</span> або <span class="code">LinkedList</span> ), і якщо ви використовуєте їх у своєму коді, це може призвести до посилення зв'язку (high coupling). Використовуючи інтерфейс <span class="code">List</span> , ви можете переключитися на реалізацію будь-якої миті в майбутньому, не порушуючи код. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token class-name">Bill</span><span class="token punctuation">(</span><span class="token class-name">Printer</span> printer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>printer <span class="token operator">=</span> printer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Bill</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConsolePrinter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Bill</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HTMLPrinter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> У наведеному вище фрагменті використання інтерфейсу <span class="code">Printer</span> дозволяє розробнику перейти до іншого конкретного класу <span class="code">HTML Printer</span> .
<h2>9. Не "насаджуйте" інтерфейси</h2>Погляньте на наступний інтерфейс: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">interface</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token function">fetchBooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">saveBooks</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">order</span><span class="token punctuation">(</span><span class="token class-name">OrderDetails</span> orderDetails<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BookNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">BookUnavailableException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre> Чи є користь від створення такого інтерфейсу? Чи є можливість реалізації цього інтерфейсу у вигляді іншого класу? Чи достатньо універсальний цей інтерфейс для реалізації іншим класом? Якщо відповідь на всі ці питання негативна, то я рекомендую уникати цього непотрібного інтерфейсу, який вам доведеться підтримувати в майбутньому. Мартін Фаулер дуже добре пояснює це <a href="https://martinfowler.com/bliki/InterfaceImplementationPair.html" rel="nofollow" target="_blank">у своєму блозі</a> . Що ж, тоді як успішно використовувати інтерфейси? Припустимо, у нас є клас <span class="code">Rectangle</span> і клас <span class="code">Circle</span> , які мають поведінку для обчислення периметра. Якщо є вимога, що периметр усіх форм — це варіант використання поліморфізму, наявність інтерфейсу матиме більше сенсу: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
		<span class="token class-name">Double</span> <span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token comment">//data members and constructors</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>breadth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token comment">//data members and constructors</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Double</span> <span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token class-name">Math</span><span class="token punctuation">.</span>PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">totalPerimeter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Shape</span><span class="token punctuation">&gt;</span></span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> shapes<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Shape</span><span class="token operator">::</span><span class="token function">perimeter</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2>10. Замініть hashCode під час перевизначення Equals</h2>Об'єкти, які дорівнюють своїм значенням, називаються об'єктами значень (value objects): наприклад, гроші, час. Такі класи повинні перевизначатися методом <span class="code">equals</span> щоб повертати true, якщо значення збігаються. Метод <span class="code">яких</span> зазвичай використовується іншими бібліотеками для порівняння та перевірки рівності; отже, перевизначення <span class="code">equals</span> необхідно. Кожен об'єкт Java також має значення хеш-коду, який відрізняє його від іншого об'єкта. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">class</span> <span class="token class-name">Coin</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>

    <span class="token class-name">Coin</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Coin</span> coin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Coin</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
        <span class="token keyword">return</span> value <span class="token operator">==</span> coin<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> У наведеному вище прикладі ми перевизначабо метод <span class="code">equals</span> для <span class="code">Object</span> . 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coin</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> coinCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coin</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>
  <span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Coin</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Coin</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//update count for 1 rupee coin</span>
coinCount<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Coin</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

coinCount<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3 🤯 why?</span></code></pre> Ми очікуємо <span class="code">coinCount</span> , щоб оновити кількість монет по одній рупії до семи, оскільки ми перевизначаємо рівність. Але <span class="code">HashMap</span> внутрішньо перевіряє, чи дорівнює хеш-код для двох об'єктів, і лише потім переходить до перевірки рівності за допомогою методу <span class="code">equals</span> . Два різні об'єкти можуть мати або не мати той самий хеш-код, але два рівних об'єкти завжди повинні мати той самий хеш-код, як визначено в контракті методу <span class="code">hashCode</span> . Таким чином, перевірка хеш-коду в першу чергу є ранньою умовою виходу. Це означає, що, як і <span class="code">equals</span> , методи <span class="code">hashCode</span> повинні бути перевизначені, щоб виразити рівність.