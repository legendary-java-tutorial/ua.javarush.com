Розрахована на багато користувачів консольна гра на java
<p>----------------------------------------</p>
Всім привіт, давно вже дописав гру, все ніяк не доходили руки до написання статті, вона є логічним продовженням цієї Якщо ви поки що не пробували робити щось крім завдань JavaRush, то знайомство з грою буде саме тим, з чого потрібно буде по
<p>----------------------------------------</p>
Всім привіт, давно вже дописав гру, все ніяк не доходабо руки до написання статті, вона є логічним продовженням цієї<a href="https://codegym.cc/groups/posts/1222-igra-na-java-dlja-nachinajujshikh" target="_blank"> писуліни</a> Якщо ви поки що не пробували робити щось крім завдань CodeGym, то знайомство з грою буде саме тим, з чого потрібно буде почати підготовку до тестових завдань реального проекту, в якому я рекомендую взяти участь кожному. Та й взагалі час вже перестати бути сферичним програмістом у вакуумі і почати вивчати щось за межами java-core. Для того, щоб просто подивитися гру, у вас має бути встановлений MySQL, якщо ви поки що таким не користувалися, не соромтеся – ставте, це одна з тих баз даних, які ви будете використовувати у своїй роботі та особистих проектах! Я не наводитиму опис установки та роботи з базою, в інтернеті навалом туторіалів та відео, рекомендую розібратися з цим питанням самостійно, це теж один з найважливіших скілів програміста – розбиратися самостійно.<a href="https://codegym.cc/groups/posts/520-vashe-pervoe-prilozhenie-na-hibernate" target="_blank">hibernate</a> , spring, spring data, можливо, список можна продовжити, але мої знання на цьому закінчуються. А тепер відкладіть читання цієї статті та розберіться з MySQL, це насправді зовсім не складно, вам потрібно поставити сам сервер, з налаштувань там лише логін та пароль. потім почитайте про те які команди застосовуються при роботі. <strong>Команди для роботи із сервером:</strong> <code class=" language-none">create</code> , <code class=" language-none">show</code>, <code class=" language-none">use</code>, та інші, команда <code class=" language-none">help</code>– дасть повний перелік команд. <strong>Запити до роботи з конкретною таблицею:</strong> <code class=" language-none">select</code> , <code class=" language-none">insert</code>,<code class=" language-none">delete</code>та інші. особливо сильно не заглиблюйтесь, є ймовірність, що від простого читання команд запам'ятається лише мала частина. ви все вивчите з часом. Можете пограти в терміналі MySQL, створіть базу даних, створіть таблички, заповніть їх, зробіть запит на виведення даних, додайте критерії запитів. Швидше за все, у вас на цій піде не більше 2-3 годин, якщо довше - не засмучуйтеся, з досвідом ви освоюватимете новий матеріал швидше. Якщо з базами у вас проблем немає, то можна приступати до розробки гри, за основу взято гру, про яку я вже писав <a href="https://codegym.cc/groups/posts/1222-igra-na-java-dlja-nachinajujshikh" target="_blank">хрестики-нуліки</a>. Я дуже довго не міг розібратися з тим, як реалізувати мультиплеєр, вихід я знайшов у використанні БД. Процес гри передбачає, що гравці ходять по черзі, всі зміни в грі фіксуються в базі даних. вже виходячи з цього ми розуміємо, що у нас є гравець і є ігрове поле, яке містить посилання на гравців, саме в ігровому полі має бути зав'язана логіка, в якій один гравець перебуває в очікуванні ходу другого гравця і після чого їх ролі змінюються і вже перший гравець робить хід, а другий чекає. Оскільки всі зміни повинні дублюватися в БД, то після кожного ходу нам потрібно зберігати поле. Отже ми дійшли першого висновку, в Базі даних має бути ігрове поле і якщо ми говоримо про мультиплеєрі, то потрібно туди додати і гравців. Створимо таблиці в MySQL, я зробив це нативно, через вікно терміналу mysql. <strong>Гравці у нас мають:</strong>
<ul>
 <li><code class=" language-none">id</code>- Порядковий номер, ми його робимо первинним ключем;</li>
 <li><code class=" language-none">name</code>- Звичайне ім'я, рядок;</li>
 <li><code class=" language-none">wins</code>– кількість перемог;</li>
 <li><code class=" language-none">loses</code>– кількість поразок;</li>
 <li><code class=" language-none">games</code>- Загальна кількість проведених ігор.</li>
</ul><strong>Таблиця з іграми:</strong>
<ul>
 <li><code class=" language-none">id</code>- Порядковий номер, ми його робимо первинним ключем;</li>
 <li><code class=" language-none">x</code>– id гравця граючого <code class=" language-none">х</code>– вторинний ключ;</li>
 <li><code class=" language-none">o</code>– id гравця граючого <code class=" language-none">o</code>– вторинний ключ;</li>
 <li><code class=" language-none">field</code>- саме поле, про його формат буде написано нижче;</li>
 <li><code class=" language-none">status</code>- Це потрібно для коректної роботи мультиплеєра, статус характеризує стан гри: <br>
   створена, граємо, гра закінчена
  <p></p></li>
 <li><code class=" language-none">current</code>- теж для мультиплеєра, саме під час гри це поле управляє тим чий зараз хід, <br>
   а після її закінчення воно оголошує переможця або нічию
  <p></p></li>
</ul>З таблицями розібралися, тепер потрібно створити Java-класи з відповідними полями – <code class=" language-none">Game</code>та <code class=" language-none">User</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Game</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> x<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> y<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> field<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> status<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> current<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">User</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> wins<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> loses<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> games<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Boolean</span></span> busy<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Додамо порожній конструктор без параметрів – для роботи з БД та ще один конструктор, яким ми створюватимемо об'єкти. додамо сеттери та гетери для всіх полів. Тепер розберемося з hibernate :) час від часу не легше. Тут трохи складніше, ніж з MySQL, я швидко пройдуся за загальною структурою. Знову ж таки не все так складно, основи можна засвоїти через будь-який туторіал за пару-трійку годин, а поглиблено вже краще вивчати в процесі написання своїх проектиків. Робота з БД з JAVA має на увазі використання JDBC, почитайте про нього у <a href="https://ru.wikipedia.org/wiki/Java_Database_Connectivity" rel="nofollow" target="_blank">вікі</a> . Але якщо користуватися ним у написанні коду, то це принесе <s>дуже багато болю в задньому проході</s> деяку складність у написанні класів DAO ( <a href="https://ru.wikipedia.org/wiki/Data_Access_Object" rel="nofollow" target="_blank">теж вікі</a>), hibernate трохи покращить ситуацію, з ним у вас буде набагато менше повторюваного (шаблонного) коду. Для того, щоб працювати hibernate, до проекту необхідно підключити бібліотеку, робиться це дуже просто: Ctrl+Alt+Shift+S(File-Project Structure), заходимо у вкладку Libraries, натискаємо "+" і додаємо попередньо завантажену бібліотеку (як варіант <a href="http://hibernate.org/orm/downloads/" rel="nofollow" target="_blank">, звідси</a> ). Для того, щоб зв'язати класи <code class=" language-none">User</code>і <code class=" language-none">Game</code>вам потрібно використовувати інструкції – вони дуже прості у використанні, з ними код виглядає так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"games"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Game</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> x<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"x"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getX</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> x<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут все просто, 
<ul>
 <li><code class=" language-none">@Entity</code>- Каже, про те що клас є "сутністю", простими словами, вона прив'язана до таблиці в БД.</li>
 <li><code class=" language-none">@Table(name="games")</code>– говорить від того до якої саме таблиці, <code class=" language-none">games</code>– назва таблиці у БД</li>
 <li><code class=" language-none">@Id</code>, <code class=" language-none">@GeneratedValue</code>, <code class=" language-none">@Column(name = "id")</code>– цими трьома анотаціями позначаємо, що це поле є ідентифікаційним, що генерується автоматично, а стовпець у БД називається id.</li>
 <li><code class=" language-none">@Column(name = "x")</code>- Ім'я стовпця в БД.</li>
</ul>Далі необхідно побудувати рівні – рівень DAO та рівень обслуговування. Якщо спростити все до умов вакууму, то робота з даними йде через сервісний рівень, це один із рівнів абстракції, він дозволяє зробити роботу програми більш незалежною, щоб розробник логіки гри не вдавався в подробиці налаштування доступу до БД, або наприклад, якщо раптом ми замість простого hibernate вирішабо використати spring, зміни не підуть далі сервісного шару, без якого довелося б переписувати половину програми! це є одним із патернів проектування. Починаємо писати рівень DAO. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">UserDAO</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">addUser</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">User</span></span> user<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Session</span></span> session <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">try</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            session <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">HibernateUtil</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSessionFactory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">openSession</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            session<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">beginTransaction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            session<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            session<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getTransaction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">commit</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Exception</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">finally</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>session <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">&amp;&amp;</span></span> session<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isOpen</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                session<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Так виглядає операція додавання нового користувача в бд, зверніть увагу, що метод передається тільки об'єкт класу-сутності, ніякої додаткової інформації тут не потрібно. це забезпечується тим, що ми отримуємо вже готову сесію зв'язку з БД із класу HibernateUtil. Розглянемо його. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HibernateUtil</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">SessionFactory</span></span> sessionFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">static</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

            sessionFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Configuration</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">configure</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">buildSessionFactory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Exception</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">SessionFactory</span></span> <span class="token function"><span class="token function">getSessionFactory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> sessionFactory<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як ви бачите тут теж все дуже просто, <code class=" language-none">SessionFactory</code>це інтерфейс з бібліотеки hibernate, яку ми підключабо до нашого проекту. Для коректної роботи залишається лише заповнити конфігураційний файл hibernate.cfg.xml 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">!</span></span>DOCTYPE hibernate<span class="token operator"><span class="token operator">-</span></span>configuration PUBLIC
        <span class="token string"><span class="token string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span>
        <span class="token string"><span class="token string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span>hibernate<span class="token operator"><span class="token operator">-</span></span>configuration<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token operator"><span class="token operator">&lt;</span></span>session<span class="token operator"><span class="token operator">-</span></span>factory<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"connection.driver_class"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>mysql<span class="token punctuation"><span class="token punctuation">.</span></span>jdbc<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>Driver</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"connection.url"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>jdbc<span class="token operator"><span class="token operator">:</span></span>mysql<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>localhost<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">3306</span></span><span class="token operator"><span class="token operator">/</span></span>tictactoe<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"connection.username"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>root<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"connection.password"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>root<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"connection.pool_size"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token number"><span class="token number">100</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"dialect"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>hibernate<span class="token punctuation"><span class="token punctuation">.</span></span>dialect<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>MySQL5InnoDBDialect</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"show_sql"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"hbm2ddl.auto"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>update<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"hibernate.connection.autocommit"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"current_session_context_class"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>thread<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>property name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"hibernate.enable_lazy_load_no_trans"</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>property<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>mapping <span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"entity.User"</span></span> <span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span>mapping <span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"entity.Game"</span></span> <span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>session<span class="token operator"><span class="token operator">-</span></span>factory<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>hibernate<span class="token operator"><span class="token operator">-</span></span>configuration<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Якщо пробігти очима по тегах, стає ясно, що і як ми тут налаштовуємо. Ще одна особливість hibernate, якщо ми раптом вирішимо змінити ДБ з MySQL, на якусь іншу, нам потрібно буде лише змінити драйвер усередині тега <code class=" language-none">property name="connection.driver_class"</code> Шар DAO готовий, робимо сервісний шар. щоб не створювати об'єктів DAO в сервісному шарі застосуємо патерн фабрика. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Factory</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">UserDAO</span></span> userDAO <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">Factory</span></span> instance <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Factory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">synchronized</span></span> <span class="token class-name"><span class="token class-name">Factory</span></span> <span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>instance <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            instance <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Factory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> instance<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">UserDAO</span></span> <span class="token function"><span class="token function">getUserDAO</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>userDAO <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            userDAO <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">UserDAO</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> userDAO<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> А ось один із методів сервісного рівня 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">UserService</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setUserBusy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">User</span></span> user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setBusy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//делаем его занятым</span></span>
        <span class="token comment"><span class="token comment">//и обновляем его в БД</span></span>
        <span class="token class-name"><span class="token class-name">Factory</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getUserDAO</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">updateUser</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Код для роботи з БД завершено, переписуємо ігрову логіку з урахуванням змін. спочатку виділимо метод, що запускає маїн в окремий клас <code class=" language-none">Main</code>, він буде тільки керуючим класом - ігровим меню в якому можна буде запустити гру або подивитися статистику. Створимо клас <code class=" language-none">GameLogic</code>, в ньому буде описана вся логіка гри та перевірки ігрового поля. Збереження всіх змін на ігровому полі та статистики гравців після гри він віддаватиме на відкуп сервісному шару. Є цікава особливість, ігрове поле у ​​нас міститься у вигляді масивів, в базу даних їх можна зберігати, але я вирішив на цьому етапі винайти велосипед і в базі даних поле у ​​мене міститься як int, а саме 9-тизначне число, парсинг якого проводиться двома методами класу<code class=" language-none">GameLogic</code>, Так робити не рекомендую, в наступних релізах гри я виправлятимуся :) Всім удачі у вивченні JAVA! Завантажити проект можна <a href="https://github.com/timurnav/Tic-tac-toe/archive/master.zip" rel="nofollow" target="_blank">тут</a> .