Double brace ініціалізація
<p>----------------------------------------</p>
Ініціалізація з використанням подвійних фігурних дужок ( ) - Java засіб для створення колекцій таких як list, set і map одночасно з їх оголошенням. Якщо вам необхідні списки з фіксованими елементами, такі як перелік підтримуваних продуктів 
<p>----------------------------------------</p>
<h2>1. Double brace ініціалізація</h2>Ініціалізація з використанням подвійних фігурних дужок ( <em>далі - Double brace ініціалізація</em> ) - Java засіб для створення колекцій таких як list, set і map одночасно з їх оголошенням. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="27a6a1f0-1475-48f0-89cd-ae168f77ac56" data-max-width="710" alt="Double brace ініціалізація - 1" src="https://cdn.javarush.com/images/article/27a6a1f0-1475-48f0-89cd-ae168f77ac56/512.jpeg" style="width: 710px;">
 </div>
</div>Якщо вам необхідні списки з фіксованими елементами, такі як перелік підтримуваних продуктів або грошових одиниць, оголошення списку одночасно з його ініціалізацією покращує читабельність коду. Саме тому Double brace ініціалізація набирає популярності, оскільки інших стандартних способів створення з одночасною ініціалізацією в коді для колекцій немає. На жаль, на відміну від інших мов програмування, Java не підтримує колекції літералів. Відповідно до даного обмеження, створення незмінного списку ( <a href="http://javarevisited.blogspot.sg/2012/07/create-read-only-list-map-set-example-java.html" rel="nofollow">unmodifiableList</a> ) навіть з невеликою кількістю елементів змушує нас писати багато рядків коду у вигляді повторюваних викликів <code class=" language-none">add()</code>для додавання потрібних елементів із завершальним обгортанням (wrapping): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> list <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">5</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> unmodifiableList <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">unmodifiableList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>list<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Це надмірно надлишковий опис, який можна спростити. Заповнимо статичні списки зручним для нас способом, а саме безпосередньо в статичних блоках при ініціалізації, в чому нам і допоможе <code class=" language-none">Double brace</code>ініціалізація, що дозволяє нам записати все в один рядок: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> list <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">unmodifiableList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">5</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Аналогічно <code class=" language-none">Double brace</code>ініціалізація допоможе нам заповнити значеннями та <code class=" language-none">HashMap</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Map</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> intToString <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HashMap</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
         <span class="token function"><span class="token function">put</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"one"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
         <span class="token function"><span class="token function">put</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"two"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
         <span class="token function"><span class="token function">put</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"three"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Все це так елегантно виглядає, проте має свої недоліки, які й роблять Double brace ініціалізацію антишаблоном. Розглянемо їх далі у наступному розділі. 
<h2>Плюси та мінуси Double brace ініціалізації.</h2><code class=" language-none">Double</code>brace ініціалізація використовує створення внутрішнього анонімного класу ( <a href="https://en.wikipedia.org/wiki/Inner_class" rel="nofollow">anonymous inner</a> class ). Що спочатку зовні приховано, проте <code class=" language-none">Double brace</code>ініціалізація створює клас з подальшою ініціалізацією його екземпляра, щоразу, як ви застосовуєте її. Крім цього використовується приховане посилання на цей закритий клас, що може призвести до можливих витоків пам'яті. Ви також не зможете використовувати оператор привиду для generic-ів (diamond operator &lt; &gt;), оскільки ми не можемо звернутися всередину анонімного класу. 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>(Від перекладача: Ще раз детальніше: <br>
      після першої <code class=" language-none">{</code>створюється внутрішній анонімний клас, після другої <code class=" language-none">{</code>відбувається ініціалізація при створенні екземпляра класу при якій ми маємо доступ до полів та методів зовнішнього (по відношенню до анонімного) класу.)</td>
   </tr>
  </tbody>
 </table>
</div><strong>Плюси:</strong>
<ol>
 <li>Зменшення рядків у коді</li>
 <li>Створення та ініціалізація в одному виразі.</li>
</ol><strong>Мінуси:</strong>
<ol>
 <li>Приховане від вас створення анонімного класу.</li>
 <li>Що коштує нам додаткових витрат для його екземпляра щоразу при використанні.</li>
 <li>Щоразу створюється приховане посилання на нього, яке, можливо, призведе до витоків пам'яті.</li>
</ol><strong>Вердикт:</strong> через вищезгадані мінуси та існування альтернатив Double brace ініціалізація розглядається як анти-шаблон у світі Java. <img data-id="44c8ddba-f5c5-4c7f-8d0d-37e41d6740dd" data-max-width="600" alt="Врятуйте кошеня" src="https://cdn.javarush.com/images/article/44c8ddba-f5c5-4c7f-8d0d-37e41d6740dd/512.jpeg" style="width: 600px;">
<h2>Альтернативи Double brace ініціалізації у Java</h2>Хороша новина полягає в тому, що є інші способи досягнення тих же цілей в Java. Ми можемо реалізувати в одному рядку коду створення та ініціалізацію значеннями ArrayList використовуючи Copy constructor з Collection класу як показано нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> list <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">unmodifiableList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">5</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><code class=" language-none">Arrays.asList()</code>поверне нам список фіксованої довжини переданий у <code class=" language-none">ArrayList</code>copy constructor. Пам'ятайте про різницю між списками фіксованої довжини, що повертаються з <code class=" language-none">Arrays.asList()</code>і <code class=" language-none">Collections.unmodifiableList()</code>: ви не можете додавати або видаляти елементи <code class=" language-none">ArrayList</code>-а, однак ви можете змінити елемент за індексом з використанням <code class=" language-none">set()</code>, чого вам не вдасться зробити зі списком, повернутим <code class=" language-none">Collections.unmodifiableList()</code>. Якщо ви хочете отримати невеликий список – це найкращий спосіб, хоча він буде менш прозорим для <code class=" language-none">Set</code>інших колекцій, так доведеться створити <code class=" language-none">List</code>перед створенням<code class=" language-none">Set</code>-А. Але це все ж таки краще, ніж Double brace ініціалізація, тому що в даному випадку не створюється зайвий внутрішній анонімний клас при кожному подібному використанні. Якщо ви працюєте під Java 8, у вас є ще один альтернативний спосіб. JDK 8 Stream API допоможе вам створювати невеликі колекції комбінуючи висновок <code class=" language-none">Stream Factory</code>методи в колекцію <code class=" language-none">List</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> list <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">unmodifiableList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Stream</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">of</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"abc"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"bcd"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"cde"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">collect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">toList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Для <code class=" language-none">Set</code>ви можете використовувати <code class=" language-none">Collectors.toSet()</code>метод замість <code class=" language-none">Collectors.toList()</code>, як показано нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Set</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> set <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">unmodifiableSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Stream</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">of</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"abc"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"bcd"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"cde"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">collect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">toSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> До речі, <code class=" language-none">Stream collect</code>методи не гарантують, що згенеровані ними колекції захищені від змін. У Java 8 колекції, які вони повернули (такі як - <code class=" language-none">ArrayList</code>, <code class=" language-none">HashSet</code>, and <code class=" language-none">HashMap</code>), цілком собі звичайні ( ми можемо міняти їх), але цей факт можливо буде виправлений у майбутніх релізах JDK. Це все зараз про <code class=" language-none">Double brace</code>ініціалізацію в Java. Цей шаблон є прийнятним для тестів і демонстрацій, але не досить хороший для використання в промисловій експлуатації (production). Через властиві йому мінуси, Double brace ініціалізація став анти-шаблоном у наші дні, особливо враховуючи доступні альтернативи. Сам я все ще використовую цю конструкцію для ініціалізації static map-ів та все. Для <code class=" language-none">List</code>я волію створювати <code class=" language-none">Collections</code>комбінуючи зі створенням<code class=" language-none">Array.asList</code>у його конструкторі. А якщо використовую Java 8 – конструкцію з використанням Stream API та <code class=" language-none">collect()</code>. <strong>Статті по темі:</strong> якщо вам сподобався даний навчальний матеріал і ви хочете дізнатися більше про патерни, принципи і кращі прийоми програмування на Java, можливо ви також ознайомитеся з іншими статтями на нашому <a href="https://javarevisited.blogspot.com/" rel="nofollow">сайті</a> . <strong>Рекомендована література:</strong> якщо ви хочете більше дізнатися про шаблони і кращі практики ви повинні прочитати книгу <a href="https://www.amazon.com/Effective-Java-Edition-Joshua-Bloch/dp/0321356683" rel="nofollow">«Ефективне програмування» Джошуа Блоха</a> , жодна книга не може зайняти її місце. А якщо ви вже наторкалися в Java та шукаєте книгу за шаблонами проектування, гуморний стиль викладу якої цікаво та легко читати – зверніть увагу на <a href="https://www.ozon.ru/context/detail/id/144233005/" rel="nofollow">«Нед First. Шаблони проектування»</a>. 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Від перекладача: Я навмисне привів посилання на оригінальну книгу Блоха, тому що переклад її на російську невдалий (наприклад, Builder = конструктор).</td>
   </tr>
  </tbody>
 </table>
</div><em><a href="http://javarevisited.blogspot.sg/2015/10/what-is-double-brace-initialization-in-java-example-anti-pattern.html" rel="nofollow">What is Double Brace Initialization in Java</a> ? <a href="http://javarevisited.blogspot.sg/2015/10/what-is-double-brace-initialization-in-java-example-anti-pattern.html" rel="nofollow">Anti Pattern Example</a> (опублікованій у жовтні 2015 року).</em>