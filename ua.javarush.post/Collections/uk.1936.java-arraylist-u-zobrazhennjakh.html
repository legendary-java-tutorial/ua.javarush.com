Java ArrayList у зображеннях
<p>----------------------------------------</p>
Вітання! Сьогоднішня лекція буде з одного боку простішою, а з іншого — складнішою, ніж попередні. Складніше, тому що сьогодні ми заглянемо під капот 'a і вивчатимемо, що ж з ним відбувається під час операцій. З іншого боку, у цій лекції май
<p>----------------------------------------</p>
Вітання! Сьогоднішня лекція <code class=" language-none">ArrayList</code>буде з одного боку простішою, а з іншого — складнішою, ніж попередні. <img data-max-width="800" data-id="e5b7b68d-eaa2-4335-aae5-b0b8994b8f75" class="img-fluid" alt="Робота ArrayList в картинках - 1" src="https://cdn.javarush.com/images/article/e5b7b68d-eaa2-4335-aae5-b0b8994b8f75/800.jpeg" style="width: 800px;">Складніше, тому що сьогодні ми заглянемо під капот <code class=" language-none">ArrayList</code>'a і вивчатимемо, що ж з ним відбувається під час операцій. З іншого боку, у цій лекції майже не буде коду — переважно картинки та пояснення. Отже, поїхали :) Як ти вже знаєш, всередині <code class=" language-none">ArrayList</code>знаходиться звичайний масив, який і виступає сховищем даних. Найчастіше ми не вказуємо точний розмір списку. Але ж внутрішній масив повинен мати якийсь розмір! Так і є. <span class="text-bold">Його розмір за умовчанням - [10]</span> . 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> cars <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><img data-id="4fd1f54f-2017-42da-ac64-ce6810bffe44" data-max-width="850" alt="Робота ArrayList в картинках - 2" src="https://cdn.javarush.com/images/article/4fd1f54f-2017-42da-ac64-ce6810bffe44/800.jpeg" style="width: 850px;">Спочатку подивимося, як виглядає додавання нового елемента. Насамперед проводиться перевірка — <span class="text-bold">чи достатньо у внутрішньому масиві місця</span> та чи влізе ще один елемент. Якщо місце є, новий елемент додається до кінця списку. Коли ми говоримо "в кінець" - мається на увазі не останній осередок масиву (це було б дивно). Мається на увазі осередок, що йде за останнім поточним елементом. Її індекс дорівнюватиме <code class=" language-none">cars.size()</code>. Наш список зараз порожній ( <code class=" language-none">cars.size() = 0</code>). Відповідно, новий елемент буде доданий у комірку з індексом <code class=" language-none">0</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> cars <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Car</span></span> ferrari <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ferrari 360 Spider"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
cars<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrari<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><img data-id="d5072edc-9aa4-4cf0-b865-31bcaa77d873" data-max-width="850" alt="Робота ArrayList в картинках - 3" src="https://cdn.javarush.com/images/article/d5072edc-9aa4-4cf0-b865-31bcaa77d873/800.jpeg" style="width: 850px;">Тут усе зрозуміло. Що буде, якщо вставка буде здійснюватися в середину, тобто між кількома елементами? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> cars <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Car</span></span> ferrari <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ferrari 360 Spider"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Car</span></span> bugatti <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Bugatti Veyron"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Car</span></span> lambo <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Lamborghini Diablo"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Car</span></span> ford <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ford Modneo"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   cars<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrari<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   cars<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bugatti<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   cars<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>lambo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   cars<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> ford<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token comment"><span class="token comment">//добавляем ford в ячейку 1, которая уже занята</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Знову ж таки, спочатку перевіряється, чи достатньо місця в масиві. Якщо місця достатньо, відбувається <span class="text-bold">зсув елементів праворуч</span> починаючи з того осередку, куди ми вставляємо новий елемент. Ми вставляємо в комірку з індексом 1. Тобто елемент з комірки 3 копіюється в комірку 4, елемент 2 в комірку 3, елемент 1 в комірку 2. Після цього <img data-id="c5087e13-195d-4e92-876c-79ce39e1b854" data-max-width="850" alt="Робота ArrayList в картинках - 4" src="https://cdn.javarush.com/images/article/c5087e13-195d-4e92-876c-79ce39e1b854/800.jpeg" style="width: 850px;">наш новий елемент вставляється на своє місце. Попередній елемент ( <code class=" language-none">bugatti</code>) вже скопіювався звідти на нове місце. <img data-id="bafcc808-886b-40c2-979e-d711e0f85628" data-max-width="850" alt="Робота ArrayList в картинках - 5" src="https://cdn.javarush.com/images/article/bafcc808-886b-40c2-979e-d711e0f85628/800.jpeg" style="width: 850px;">Тепер давай розберемося, як відбувався цей процес, якби місця для вставки в масиві не було. <img data-id="e2d01f2e-5399-459b-b397-1a2ae3cab42a" data-max-width="850" alt="Робота ArrayList в картинках - 6" src="https://cdn.javarush.com/images/article/e2d01f2e-5399-459b-b397-1a2ae3cab42a/800.jpeg" style="width: 850px;">Спочатку, звичайно, здійснюється перевірка, чи достатньо місця. Якщо з'ясовується, що місця не вистачає, усередині<code class=" language-none">ArrayList</code>'a створюється новий масив розміром (розмір Старого Масиву * 1.5) + 1 У нашому випадку новий масив матиме розмір 16 осередків. Туди відразу будуть скопійовані всі поточні елементи. <img data-id="57fe0027-630c-422b-9bb7-01007c46ab3a" data-max-width="850" alt="Робота ArrayList в картинках - 7" src="https://cdn.javarush.com/images/article/57fe0027-630c-422b-9bb7-01007c46ab3a/800.jpeg" style="width: 850px;">Старий масив буде видалено збирачем сміття, і залишиться лише новий, розширений. Тепер є вільне місце для нового елемента. Ми вставляємо його в комірку 3, яка зайнята. Тепер починається вже знайома тобі процедура. Всі елементи, починаючи з індексу 3, зсуваються на одну комірку праворуч, і новий елемент спокійно додається. <img data-id="6e1b2e29-68c1-4a1c-b768-3efe82d05bce" data-max-width="850" alt="Робота ArrayList в картинках - 8" src="https://cdn.javarush.com/images/article/6e1b2e29-68c1-4a1c-b768-3efe82d05bce/800.jpeg" style="width: 850px;">І тепер вставка пройшла вдало! Зі вставкою розібралися. Тепер поговоримо про <span class="text-bold">видалення елементів</span> . Як ти пам'ятаєш, при роботі з масивами ми зіткнулися з проблемою: при видаленні в ньому залишалися дірки. Єдиним виходом було <span class="text-bold">зрушувати елементи вліво</span>щоразу при видаленні, причому писати код для зсуву доводилося самостійно. <span class="text-bold"><code class=" language-none">ArrayList</code>працює за тим самим принципом, але в ньому цей механізм уже реалізовано автоматично. </span> <img data-id="49ca56a1-5b88-4e66-ae1e-a713cf24bb18" data-max-width="850" alt="Робота ArrayList в картинках - 9" src="https://cdn.javarush.com/images/article/49ca56a1-5b88-4e66-ae1e-a713cf24bb18/800.jpeg" style="width: 850px;">Ось як це виглядає: <img data-id="f27da1f8-e1ba-4848-8261-9014f23e74be" data-max-width="850" alt="Робота ArrayList в картинках - 10" src="https://cdn.javarush.com/images/article/f27da1f8-e1ba-4848-8261-9014f23e74be/800.jpeg" style="width: 850px;">І в результаті ми отримуємо потрібний результат: <img data-id="804aa243-0faf-44af-a5d1-3153b4b874f8" data-max-width="850" alt="Робота ArrayList в картинках - 11" src="https://cdn.javarush.com/images/article/804aa243-0faf-44af-a5d1-3153b4b874f8/800.jpeg" style="width: 850px;">Елемент <code class=" language-none">lambo</code>успішно видалено. Тут ми робабо вилучення із середини. Зрозуміло, що видалення з кінця списку буде швидше, оскільки потрібний елемент забирається без зсуву всіх інших. Давай ще раз пройдемося за розмірами внутрішнього масиву та його зберігання у пам'яті. <span class="text-bold">Розширення масиву - процес, що займає певну кількість ресурсів. </span> Тому не варто створювати<code class=" language-none">ArrayList</code>з розміром за промовчанням, якщо ти точно знаєш, що в ньому буде не менше 100 елементів. Поки ти дійдете до вставки 100-го елемента, внутрішній масив розшириться <span class="text-bold">6 разів</span> , щоразу з перенесенням всіх елементів. 
<ul>
 <li>з 10 елементів до 16</li>
 <li>з 16 елементів до 25</li>
 <li>з 25 до 38</li>
 <li>з 38 до 58</li>
 <li>з 58 до 88</li>
 <li>з 88 до 133 (за формулою (розмір Старого Масиву * 1.5) +1)</li>
</ul>Звісно, ​​це щодо ресурсів досить затратно. <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="6c429541-6122-43ff-9bdb-f2642fc073d3" class="img-fluid" alt="Робота ArrayList в картинках - 12" src="https://cdn.javarush.com/images/article/6c429541-6122-43ff-9bdb-f2642fc073d3/1024.jpeg" style="width: 1024px;"></a>Тому, якщо вже ти знаєш якусь (хоч приблизну) кількість елементів, що зберігаються, краще відразу створити список з масивом певного розміру: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> cars <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тепер у пам'яті буде одразу виділено масив на 100 елементів, більш ефективний, тому що не витрачатимуться ресурси на розширення. Є й зворотний бік медалі. <span class="text-bold">При видаленні об'єктів <code class=" language-none">ArrayList</code>розмір внутрішнього масиву не зменшується автоматично. </span> Наприклад, у нас є <code class=" language-none">ArrayList</code>з внутрішнім масивом 88 елементів, який повністю заповнений: <img data-id="d8379a63-8e10-4f25-8612-01d56bc08a7b" data-max-width="850" alt="Робота ArrayList в картинках - 13" src="https://cdn.javarush.com/images/article/d8379a63-8e10-4f25-8612-01d56bc08a7b/800.jpeg" style="width: 850px;">У процесі роботи програми ми видаляємо з нього 77 елементів, і в ньому залишається всього 11: <img data-id="7e91b172-90f9-48b4-92a5-662609eb8f06" data-max-width="850" alt="Робота ArrayList в картинках - 14" src="https://cdn.javarush.com/images/article/7e91b172-90f9-48b4-92a5-662609eb8f06/800.jpeg" style="width: 850px;">Вже здогадався, в чому проблема? Звісно, ​​у неефективному використанні пам'яті! Ми використовуємо всього 11 осередків, при цьому у нас виділено пам'ять на 88 елементів – це у 8 разів більше, ніж потрібно! Для проведення оптимізації в даному випадку можна використовувати спеціальний метод <code class=" language-none">ArrayList</code>класу<span class="text-bold"><code class=" language-none">trimToSize()</code></span>. Він "обрізає" довжину внутрішнього масиву до кількості елементів, що зберігаються в ньому на поточний момент. <img data-id="fafe80bc-38bf-4df1-bba9-e34c446f0bb3" data-max-width="850" alt="Робота ArrayList в картинках - 15" src="https://cdn.javarush.com/images/article/fafe80bc-38bf-4df1-bba9-e34c446f0bb3/800.jpeg" style="width: 850px;">Тепер пам'яті виділяється стільки, скільки потрібно! :)