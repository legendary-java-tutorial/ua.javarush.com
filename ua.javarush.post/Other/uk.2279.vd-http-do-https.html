Від HTTP до HTTPS
<p>----------------------------------------</p>
Зміст: У світі без веб-додатків ніяк. І почнемо ми з невеликого експерименту. У дитинстві я пам'ятаю, як у всіх кіосках продавалася така газета, як "Аргументи та факти". Згадав я про них тому, що на моє особисте сприйняття з дитинства, ці г
<p>----------------------------------------</p>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="195" alt="Від HTTP до HTTPS - 1" src="https://cdn.javarush.com/images/article/a831a2da-db36-40e9-a196-5ef38d4455b7/original.jpeg">
 </div>
</div>Зміст: 
<ul>
 <li><a href="https://codegym.cc/groups/posts/2279#%D0%92%D1%81%D1%82%D1%83%D0%BF%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5">Вступ</a></li>
 <li><a href="https://codegym.cc/groups/posts/2279#%D0%92%D0%B5%D0%B1_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B0_Java">Веб-додаток на Java</a></li>
 <li><a href="https://codegym.cc/groups/posts/2279#%D0%A2%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BB%D1%8F_HTTPS">Вимоги до HTTPS</a><a></a></li><a> </a>
 <li><a></a><a href="https://codegym.cc/groups/posts/2279#KeyManager">KeyManager</a></li>
 <li><a href="https://codegym.cc/groups/posts/2279#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%B0%D0%BC%D0%B8">Управління сертифікатами</a></li>
 <li><a href="https://codegym.cc/groups/posts/2279#%D0%98%D1%82%D0%BE%D0%B3">Підсумок</a></li>
</ul>
<h2 id="Вступление">Вступ</h2>У світі без веб-додатків ніяк. І почнемо ми з невеликого експерименту. У дитинстві я пам'ятаю, як у всіх кіосках продавалася така газета, як "Аргументи та факти". Згадав я про них тому, що на моє особисте сприйняття з дитинства, ці газети виглядали завжди дивно. І вирішив, а чи не зайти нам на їхній сайт: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="bd7eb251-25ba-48ea-9c73-c72a49b07b22" data-max-width="545" alt="Від HTTP до HTTPS - 2" src="https://cdn.javarush.com/images/article/bd7eb251-25ba-48ea-9c73-c72a49b07b22/512.jpeg" style="width: 545px;">
 </div>
</div>Якщо перейти до довідки Google Chrome, ми прочитаємо, що цей сайт не використовує захищене з'єднання та інформація, якою ви обмінюєтеся з сайтом, може бути доступна стороннім. Давайте перевіримо якісь інші новини, наприклад новини Санкт-Петербурга від "Фонтанки", електронного ЗМІ: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="d4359457-b58b-433d-9175-78eae5bdc969" data-max-width="543" alt="Від HTTP до HTTPS - 3" src="https://cdn.javarush.com/images/article/d4359457-b58b-433d-9175-78eae5bdc969/512.jpeg" style="width: 543px;">
 </div>
</div>Як видно, сайт Фонтанки з безпекою за цими даними проблем немає. Виходить, що веб-ресурси можуть бути безпечними, а можуть не бути. Також бачимо, що звернення до не захищених ресурсів відбувається за протоколом HTTP. А якщо ресурс захищений, обмін даними здійснюється за протоколом HTTPS, де S на кінці позначає "Secure". Протокол HTTPS описаний у специфікації rfc2818: " <a href="https://tools.ietf.org/html/rfc2818" target="_blank" rel="nofollow">HTTP Over TLS</a> ". Спробуємо створити свій веб-додаток і самі побачити, як це працює. І попутно будемо розбираючись у термінах. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="5b572e3c-c58f-4eaf-9376-b051922e72da" data-max-width="310" alt="Від HTTP до HTTPS - 4" src="https://cdn.javarush.com/images/article/5b572e3c-c58f-4eaf-9376-b051922e72da/256.jpeg" style="width: 310px;">
 </div>
</div>
<h2 id="Веб_приложение_на_Java">Веб-додаток на Java</h2>Отже, нам потрібно створити найпростіший веб-додаток на Java. Для початку, нам потрібна сама програма на Java. Для цього скористаємося системою автоматичного збирання проекту Gradle. Це нам дозволить не створювати вручну потрібну структуру каталогів + Gradle за нас керуватиме всіма необхідними для проекту бібліотеками та забезпечуватиме, щоб вони були доступні під час виконання коду. Детальніше про Gradle можна прочитати в невеликому огляді: " <a href="https://codegym.cc/groups/posts/2126-kratkoe-znakomstvo-s-gradle" target="_blank" rel="nofollow">Коротке знайомство з Gradle</a> ". Скористайтеся <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html#sec:build_init_types" target="_blank" rel="nofollow">Gradle Init Plugin'ом</a> і виконаємо команду: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">gradle init <span class="token operator"><span class="token operator">--</span></span>type java<span class="token operator"><span class="token operator">-</span></span>application</code></pre> Після цього відкриємо білд-скрипт <code class=" language-none">build.gradle</code>, в якому описано, з яких бібліотек складається наш проект, які Gradle нам надасть. Додамо туди залежність від веб-сервера, на якому ми експериментуватимемо: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token comment"><span class="token comment">// Web server</span></span>
    implementation <span class="token string"><span class="token string">'io.undertow:undertow-core:2.0.20.Final'</span></span>
     <span class="token comment"><span class="token comment">// Use JUnit test framework</span></span>
     testImplementation <span class="token string"><span class="token string">'junit:junit:4.12'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Щоб веб-програма працювала, нам обов'язково потрібен веб-сервер, де буде розміщено нашу програму. Веб серверів існує безліч, але основні це: Tomcat, Jetty, Undertow. Ми з Вами виберемо зараз Undertow. Щоб зрозуміти, як нам працювати з цим нашим веб-сервером, перейдемо на офіційний сайт <a href="http://undertow.io/" target="_blank" rel="nofollow">Undertow</a> і перейдемо в розділ <a href="http://undertow.io/undertow-docs/undertow-docs-2.0.0/index.html" target="_blank" rel="nofollow">документації</a> . Ми з Вами підключабо залежність від Undertow Core, тому нам цікавить розділ про цей <a href="http://undertow.io/undertow-docs/undertow-docs-2.0.0/index.html#undertow-core" target="_blank" rel="nofollow">Core</a> , тобто ядро, основу веб-сервера. Найпростішим способом є використання Builder API для Undertow: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Undertow</span></span> server <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Undertow</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addHttpListener</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">8080</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"localhost"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HttpHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
                <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">handleRequest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">HttpServerExchange</span></span> exchange<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                    exchange<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResponseHeaders</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">put</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Headers</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>CONTENT_TYPE<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"text/plain"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                    exchange<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResponseSender</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello World"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                <span class="token punctuation"><span class="token punctuation">}</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    server<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Якщо ми виконаємо код, ми зможемо перейти на наступний веб-ресурс: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b3612df6-b29a-4758-9194-00efa443e4e7" data-max-width="434" alt="Від HTTP до HTTPS - 5" src="https://cdn.javarush.com/images/article/b3612df6-b29a-4758-9194-00efa443e4e7/256.jpeg" style="width: 434px;">
 </div>
</div>Працює просто. Завдяки Undertow Builder API ми додаємо HTTP слухача на адресау localhost та порт 8080. Цей слухач отримує запити від веб-браузера та повертає у відповідь рядок "Hello World". Відмінний веб-додаток. Але як бачимо, ми використовуємо протокол HTTP, тобто. такий обмін даними небезпечний. Давайте розбиратися, як здійснюють обмін по протоколу HTTPS. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="244" alt="Від HTTP до HTTPS - 6" src="https://cdn.javarush.com/images/article/08661338-06ff-4535-9ca3-163fbc06a5a3/original.jpeg">
 </div>
</div>
<h2 id="Требования_для_HTTPS">Вимоги до HTTPS</h2>Щоб зрозуміти, як підключити HTTPS, повернемося до специфікації HTTPS: " <a href="https://tools.ietf.org/html/rfc2818" target="_blank" rel="nofollow">RFC-2818: HTTP Over TLS</a> ". Згідно зі специфікацією, дані у протоколі HTTPS передаються поверх криптографічних протоколів SSL або TLS. Часто людей вводить в оману, що є SSL та TLS. Насправді SSL розвивався і змінював свої версії. Пізніше черговим витком у розвитку протоколу SSL став TLS. Тобто TLS це просто нова версія SSL. У специфікації і сказано: " SSL, and its successor TLS " . Отже, ми довідалися, що є криптографічні протоколи SSL/TLS. <strong>SSL</strong>- Це скорочення від Secure Sockets Layer і перекладається як "рівень захищених cокетів". Сокет (Socket) у перекладі з англійської - роз'єм. Учасники передачі даних по мережі використовують сокети як програмний інтерфейс (тобто API) для спілкування один з одним по мережі. Браузер постає як клієнт і використовує клієнтський сокет, а сервер приймає запит і видає відповідь використовує серверний сокет. І саме між цими сокетами відбувається обмін даними. Тому спочатку протокол і названо SSL. Але час минав і протокол розвивався. І одного разу протокол SSL став протоколом TLS. TLS – це скорочення від Transport Layer Security. TLS-протокол у свою чергу базується на специфікації протоколу SSL версії 3.0. Протокол TLS – це тема окремих статей та оглядів, тому я просто вкажу матеріали, які вважаю цікавими: 
<ul>
 <li><a href="https://mnorin.com/tls-ssl-neobhodimy-j-minimum-znanij.html" target="_blank" rel="nofollow">TLS та SSL: Необхідний мінімум</a></li>
 <li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc784149(v%3dws.10)" target="_blank" rel="nofollow">TLS/SSL Technical Reference</a></li>
 <li><a href="https://habr.com/ru/post/258285/" target="_blank" rel="nofollow">Що таке TLS</a></li>
 <li><a href="https://tls.dxdt.ru/tls.html" target="_blank" rel="nofollow">Ключі, шифри, повідомлення: як працює TLS</a></li>
</ul>Якщо дуже коротко, то основа HTTPS - це TLS handshake та перевірка "Server Identity" (тобто ідентифікація сервера) за його цифровим сертифікатом. Це важливо. Запам'ятаймо це, т.к. Пізніше ми повернемося до цього факту. Отже, раніше ми використовували HttpListener, щоб розповісти серверу, як працювати за протоколом HTTP. Якщо в прикладі вище ми додали HttpListener для роботи з HTTP, то для роботи з HTTPS нам потрібно додати HttpsListener: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="8495b5d6-34c4-4080-9835-2fd98a7d6882" data-max-width="607" alt="Від HTTP до HTTPS - 7" src="https://cdn.javarush.com/images/article/8495b5d6-34c4-4080-9835-2fd98a7d6882/512.jpeg" style="width: 607px;">
 </div>
</div>Але щоб його додати нам потрібний SSLContext. Цікаво, що SSLContext - це клас не з Undertow, а <code class=" language-none">javax.net.ssl.SSLContext</code>. Клас SSLContext входить у так званий " <strong>Java Secure Socket Extension</strong> " (JSSE) - розширення Java для забезпечення безпеки інтернет з'єднання. Дане розширення описано в документі " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html" target="_blank" rel="nofollow">Java Secure Socket Extension (JSSE) Reference Guide</a> ". Як видно з вступної частини документації, JSSE надає фреймворк та Java реалізацію протоколів SSL та TLS. Як нам отримати SSLContext? Відкриваємо JavaDoc SSLContext і знаходимо метод <a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/SSLContext.html#getInstance-java.lang.String-" target="_blank" rel="nofollow">getInstance</a> . Як видно, для отримання SSLContext нам потрібно вказати назву Secure Socket Protocol. В описі параметрів зазначено, що ці назви можна подивитися в "<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext" target="_blank" rel="nofollow">Java Cryptography Architecture Standard Algorithm Name Documentation</a> ". Тому, слідуємо вказівкам і йдемо в документацію. І бачимо, що ми можемо вибрати між SSL і TLS: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="86b3f6fe-8a7c-4c42-9d38-39ed433a0c80" data-max-width="377" alt="Від HTTP до HTTPS - 8" src="https://cdn.javarush.com/images/article/86b3f6fe-8a7c-4c42-9d38-39ed433a0c80/256.jpeg" style="width: 377px;">
 </div>
</div>Тепер нам зрозуміло, що SSLContext нам треба створити так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">SSLContext</span></span> <span class="token function"><span class="token function">getSSLContext</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token comment"><span class="token comment">// 1. Получаем контекст, в рамках которого будем работать по TLS протоколу</span></span>
	<span class="token class-name"><span class="token class-name">SSLContext</span></span> context <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		context <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">SSLContext</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"TLS"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">NoSuchAlgorithmException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> context<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Створивши новий контекст згадуємо, що SSLContext описувався в " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#SSLContext" target="_blank" rel="nofollow">Java Secure Socket Extension (JSSE) Reference Guide</a> ". Читаємо й бачимо, що "A newly created SSLContext should be initialized by calling the init method". Тобто створити контекст – мало. Його треба ініціалізувати. І це логічно, т.к. про безпеку ми розповіли лише те, що ми хочемо використовувати протокол TLS. Щоб ініціалізувати SSLContext, нам потрібно надати три речі: KeyManager, TrustManager, SecureRandom. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="3739a6ef-3ef6-49f3-b47c-6a1907ae2832" data-max-width="347" alt="Від HTTP до HTTPS - 9" src="https://cdn.javarush.com/images/article/3739a6ef-3ef6-49f3-b47c-6a1907ae2832/256.jpeg" style="width: 347px;">
 </div>
</div>
<h2 id="KeyManager">KeyManager</h2><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#KeyManager" target="_blank" rel="nofollow">KeyManager</a> – це менеджер ключів. Він відповідає за те, який "authentication credential" надати тому, хто до нас звернутися. Credential можна перекласти як посвідчення. Посвідчення потрібно, щоб клієнт був упевнений, що сервер той, за кого себе видає і йому можна довіряти. Що буде використано як посвідчення? Як ми пам'ятаємо, Server Identity перевіряється за цифровим сертифікатом сервера. Цей процес можна представити так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f6632a0b-3665-4e1c-8741-09fb1152d99b" data-max-width="707" alt="Від HTTP до HTTPS - 10" src="https://cdn.javarush.com/images/article/f6632a0b-3665-4e1c-8741-09fb1152d99b/512.jpeg" style="width: 707px;">
 </div>
</div>Крім того, в " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#HowSSLWorks" target="_blank" rel="nofollow">JSSE Reference Guide: How SSL Works</a> " сказано, що SSL використовує "asymmetric cryptography", а це означає, що нам потрібна пара ключів: public key і private key. Оскільки мова зайшла про криптографію, то справа вступає "Java Cryptography Architecture" (JCA). Oracle з цієї архітектури надає чудовий документ: " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#Introduction" target="_blank" rel="nofollow">Java Cryptography Architecture (JCA) Reference Guide</a> ". Крім цього, можна прочитати короткий огляд JCA на CodeGym: <a href="https://codegym.cc/groups/posts/2277-java-cryptography-architecture--pervoe-znakomstvo" target="_blank" rel="nofollow">Java Cryptography Architecture.</a>Отже, для ініціалізації KeyManager нам потрібен KeyStore, в якому буде зберігатися сертифікат нашого сервера. Найпоширенішим способом створення сховища ключів і сертифікатів є утиліта keytool, яка входить до складу JDK. Приклад можна побачити в документації JSSE: Creating a Keystore to <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#CreateKeystore" target="_blank" rel="nofollow">Use with JSSE</a> ". Отже, нам потрібно за допомогою утиліти KeyTool створити сховище ключів і записати туди сертифікат. Цікаво, що раніше генерація ключа задавалася за допомогою -genkey, а тепер рекомендується використовувати -genkeypair. Нам потрібно буде визначити такі речі: 
<ul>
 <li><strong>alias</strong> : Псевдонім або просто ім'я, під яким буде збережено запис у Keystore</li><il>
  <strong>keyalg</strong> : Алгоритм шифрування ключів. Виберемо алгоритм RSA, який є, по суті, стандартним рішенням для нашої мети. 
  <li><strong>keysize</strong> : Розмір ключа (у бітах). Мінімальний розмір 2048, т.к. розмір менший уже зламувався. Докладніше можна прочитати тут: " <a href="https://www.wowza.com/community/questions/1296/how-to-create-a-ssl-certificate-in-2048-bit-key-le.html" target="_blank" rel="nofollow">a ssl certificate in 2048 bit</a> ".</li>
  <li><strong>dname</strong> : Distinguished Name, відмінне ім'я.</li>
 </il>
</ul>Важливо розуміти, що запитуваний ресурс (наприклад, https://localhost) порівнюватиметься за ним. Це називається "subject cn matching". 
<ul>
 <li><strong>validity</strong> : Тривалість у днях, протягом яких генерований сертифікат валіден, тобто. дійсний.</li>
 <li><strong>ext</strong> : Certificate Extension, зазначені в " <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html#CHDGDJDA" target="_blank" rel="nofollow">Named Extensions</a> ".</li>
</ul>Для Self-signed Certificates (тобто для сертифікатів, створених самостійно) необхідно вказати такі розширення: 
<ul>
 <li>-ext san:critical=dns:localhost,ip:127.0.0.1 &gt; для виконання subject matching по SubjectAlternativeName</li>
 <li>-ext bc=ca:false &gt; щоб вказати, що цей сертифікат не використовується для підпису інших сертифікатів</li>
</ul>Виконаємо команду (приклад для Windows): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">keytool <span class="token operator"><span class="token operator">-</span></span>genkeypair <span class="token operator"><span class="token operator">-</span></span>alias ssl <span class="token operator"><span class="token operator">-</span></span>keyalg RSA <span class="token operator"><span class="token operator">-</span></span>keysize <span class="token number"><span class="token number">2048</span></span> <span class="token operator"><span class="token operator">-</span></span>dname <span class="token string"><span class="token string">"CN=localhost,OU=IT,O=Javarush,L=SaintPetersburg,C=RU,email=contact@email.com"</span></span> <span class="token operator"><span class="token operator">-</span></span>validity <span class="token number"><span class="token number">90</span></span> <span class="token operator"><span class="token operator">-</span></span>keystore <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>keystore<span class="token punctuation"><span class="token punctuation">.</span></span>jks <span class="token operator"><span class="token operator">-</span></span>storepass passw0rd <span class="token operator"><span class="token operator">-</span></span>keypass passw0rd <span class="token operator"><span class="token operator">-</span></span>ext san<span class="token operator"><span class="token operator">:</span></span>critical<span class="token operator"><span class="token operator">=</span></span>dns<span class="token operator"><span class="token operator">:</span></span>localhost<span class="token punctuation"><span class="token punctuation">,</span></span>ip<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">127.0</span></span><span class="token number"><span class="token number">.0</span></span><span class="token number"><span class="token number">.1</span></span> <span class="token operator"><span class="token operator">-</span></span>ext bc<span class="token operator"><span class="token operator">=</span></span>ca<span class="token operator"><span class="token operator">:</span></span><span class="token boolean"><span class="token boolean">false</span></span></code></pre> Т.к. буде створено файл, переконайтеся, що у Вас є всі права на створення файлу. Крім того, швидше за все, Ви побачите пораду на кшталт цього: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1a8ad239-4bb6-4a60-8aee-a18b40c91a7f" data-max-width="663" alt="Від HTTP до HTTPS - 11" src="https://cdn.javarush.com/images/article/1a8ad239-4bb6-4a60-8aee-a18b40c91a7f/512.jpeg" style="width: 663px;">
 </div>
</div>Тут нам кажуть, що JKS – пропрієтарний формат. Пропрієтарний - значить є приватною власністю авторів і призначений для використання лише у Java. При роботі зі сторонніми утилітами може виникнути конфлікт, тому нас попереджають. Крім того, ми можемо отримати помилку: <code class=" language-none">The destination pkcs12 keystore has different storepass and keypass</code>. Ця помилка виникає через те, що використовуються різні паролі від запису в Keystore і від keystore. Як сказано в документації до <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html#keytool_option_importkeystore" target="_blank" rel="nofollow">keytool</a> , "For example, most third-party tools require storepass and keypass in PKCS #12 keystore to be the same". Ми можемо вказати ключ (наприклад, -destkeypass entrypassw). Але краще не порушувати вимог та задати однаковий пароль. Отже, імпорт може виглядати так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">keytool <span class="token operator"><span class="token operator">-</span></span>importkeystore <span class="token operator"><span class="token operator">-</span></span>srckeystore <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>keystore<span class="token punctuation"><span class="token punctuation">.</span></span>jks <span class="token operator"><span class="token operator">-</span></span>destkeystore <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>keystore<span class="token punctuation"><span class="token punctuation">.</span></span>jks <span class="token operator"><span class="token operator">-</span></span>deststoretype pkcs12</code></pre> Приклад успішного виконання: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b906cda8-438e-430c-9f93-2d836e532ffa" data-max-width="673" alt="Від HTTP до HTTPS - 12" src="https://cdn.javarush.com/images/article/b906cda8-438e-430c-9f93-2d836e532ffa/512.jpeg" style="width: 673px;">
 </div>
</div>Для експорту сертифіката у файл можна виконати: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">keytool <span class="token operator"><span class="token operator">-</span></span>export <span class="token operator"><span class="token operator">-</span></span>alias ssl <span class="token operator"><span class="token operator">-</span></span>storepass passw0rd <span class="token operator"><span class="token operator">-</span></span>file <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>server<span class="token punctuation"><span class="token punctuation">.</span></span>cer <span class="token operator"><span class="token operator">-</span></span>keystore <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>keystore<span class="token punctuation"><span class="token punctuation">.</span></span>jks</code></pre> Крім того, ми можемо отримати вміст Keystore таким чином: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">keytool <span class="token operator"><span class="token operator">-</span></span>list <span class="token operator"><span class="token operator">-</span></span>v <span class="token operator"><span class="token operator">-</span></span>keystore <span class="token class-name"><span class="token class-name">C</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span>keystore<span class="token punctuation"><span class="token punctuation">.</span></span>jks <span class="token operator"><span class="token operator">-</span></span>storepass passw0rd</code></pre> Відмінно, тепер ми маємо keystore, в якому є сертифікат. Тепер його можна отримувати з коду: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">KeyStore</span></span> <span class="token function"><span class="token function">getKeyStore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token comment"><span class="token comment">// Согласно https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#KeyStore</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">FileInputStream</span></span> fis <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"C:/keystore.jks"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">KeyStore</span></span> keyStore <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyStore</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"pkcs12"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">load</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fis<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"passw0rd"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">return</span></span> keyStore<span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> ioe<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ioe<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">KeyStoreException</span></span> <span class="token operator"><span class="token operator">|</span></span> <span class="token class-name"><span class="token class-name">NoSuchAlgorithmException</span></span> <span class="token operator"><span class="token operator">|</span></span> <span class="token class-name"><span class="token class-name">CertificateException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Якщо є KeyStore, то можемо ініціалізувати і KeyManager: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">KeyManager</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token function"><span class="token function">getKeyManagers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">KeyStore</span></span> keyStore<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> keyManagerAlgo <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyManagerFactory</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDefaultAlgorithm</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">KeyManagerFactory</span></span> keyManagerFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		keyManagerFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyManagerFactory</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyManagerAlgo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		keyManagerFactory<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyStore<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"passw0rd"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">return</span></span> keyManagerFactory<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKeyManagers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">NoSuchAlgorithmException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">UnrecoverableKeyException</span></span> <span class="token operator"><span class="token operator">|</span></span> <span class="token class-name"><span class="token class-name">KeyStoreException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Наша перша мета досягнута. Залишилося розібратися, що таке TrustManager. TrustManager описаний у документації JSSE у розділі " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#TrustManager" target="_blank" rel="nofollow">The TrustManager Interface</a> ". Він дуже схожий на KeyManager, але його ціль перевірити, чи можна довіряти тому, хто запитує з'єднання. Якщо зовсім грубо, то це KeyManager навпаки =) У нас немає необхідності в TrustManager'і, тому передамо null. Тоді буде створено TrustManager за умовчанням, який не перевіряє кінцевого користувача, який виконує запити на наш сервер. У документації так і сказано: "default implementation will be used". Аналогічно із SecureRandom. Якщо ми вкажемо null, буде використана реалізація за замовчуванням. Згадаймо тільки, що SecureRandom - це клас, що відноситься до JCA та описаний у документації JCA у розділі "<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#SecureRandom" target="_blank" rel="nofollow"></a>". Отже, підготовка з урахуванням всіх вищеописаних методів може бути таким: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token comment"><span class="token comment">// 1. Подготавливаем приложение к работе по HTTPS</span></span>
	<span class="token class-name"><span class="token class-name">App</span></span> app <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">App</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">SSLContext</span></span> sslContext <span class="token operator"><span class="token operator">=</span></span> app<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSSLContext</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">KeyStore</span></span> keyStore <span class="token operator"><span class="token operator">=</span></span> app<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKeyStore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">KeyManager</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> keyManagers <span class="token operator"><span class="token operator">=</span></span> app<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKeyManagers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyStore<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		sslContext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyManagers<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">KeyManagementException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Далі залишається лише запустити сервер: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// 2. Поднимаем сервер</span></span>
 	<span class="token keyword"><span class="token keyword">int</span></span> httpsPort <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">443</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">Undertow</span></span> server <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Undertow</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addHttpsListener</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>httpsPort<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"localhost"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> sslContext<span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HttpHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
                <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">handleRequest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">HttpServerExchange</span></span> exchange<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                    exchange<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResponseHeaders</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">put</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Headers</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>CONTENT_TYPE<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"text/plain"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                    exchange<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResponseSender</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello World"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                <span class="token punctuation"><span class="token punctuation">}</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	server<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Цього разу наш сервер буде доступний за адресаою <code class=" language-none">https://localhost:443</code> Проте, ми як і раніше отримаємо помилку, що не можна довіряти цьому ресурсу: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c4d4a7ed-72bc-4d3a-8eeb-aa6087b6f6db" data-max-width="321" alt="Від HTTP до HTTPS - 13" src="https://cdn.javarush.com/images/article/c4d4a7ed-72bc-4d3a-8eeb-aa6087b6f6db/256.jpeg" style="width: 321px;">
 </div>
</div>Давайте розбиратися, що не так із сертифікатом і що з цим робити. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="254" alt="Від HTTP до HTTPS - 14" src="https://cdn.javarush.com/images/article/132f6ae1-52f4-4eef-ba86-efdc85f9cbdf/original.jpeg">
 </div>
</div>
<h2 id="Управление_сертификатами">Управління сертифікатами</h2>Отже, наш сервер вже готовий працювати за HTTPS, але клієнт йому не довіряє. Чому? Давайте подивимося: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="5f249a3f-a036-43c9-8214-e24752963be2" data-max-width="412" alt="Від HTTP до HTTPS - 15" src="https://cdn.javarush.com/images/article/5f249a3f-a036-43c9-8214-e24752963be2/256.jpeg" style="width: 412px;">
 </div>
</div>Причина в тому, що сертифікат є самопідписаним (Self-signed Certificate). Під самопідписаним SSL сертифікатом розуміють сертифікат відкритого ключа, виданий та підписаний тією самою особою, яку він ідентифікує. Тобто його не видавав шановний центр сертифікації (CA, він же Certificate Authority). Центр сертифікації (Certificate Authority) виступає як довірена особа і схожий на нотаріуса у звичайному житті. Він запевняє, що видані сертифікати надійні. Послуга видачі сертифікатів такими CA є платною, тому втрата довіри та репутаційні ризики нікому не потрібні. За промовчанням є кілька центрів сертифікації, яким довіряють. Цей список доступний для редагування. І управління списком центрів сертифікації у кожній операційній системі своє. Наприклад, керування цим списком у Windows можна прочитати тут:<a href="https://www.thewindowsclub.com/manage-trusted-root-certificates-windows" target="_blank" rel="nofollow">Manage Trusted Root Certificates in Windows</a> . Давайте додамо сертифікат у довірені, як зазначено в повідомленні про помилку. Для цього, спочатку, скачаємо сертифікат: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2505c749-9db6-4b44-822b-1b999ac0a5a2" data-max-width="412" alt="Від HTTP до HTTPS - 16" src="https://cdn.javarush.com/images/article/2505c749-9db6-4b44-822b-1b999ac0a5a2/256.jpeg" style="width: 412px;">
 </div>
</div>У OS Windows натиснемо Win+R і здійснимо <code class=" language-none">mmc</code>для виклику консолі управління. Далі натиснемо Ctrl+M для додавання розділу "Сертифікати" до поточної консолі. Далі в підрозділі "Довірені кореневі центри сертифікації" виконаємо <code class=" language-none">Действия / Все задачи / Импорт</code>. Виконаємо імпорт файлу, завантаженого раніше у файл. Браузер міг запам'ятати минуле стан довіри сертифікату. Тому перед відкриттям сторінки потрібно виконати рестарт браузера. Наприклад, у Google Chrome в адресаному рядку потрібно виконати <code class=" language-none">chrome://restart</code>. У OS Windows для перегляду сертифікатів також можна скористатися утилітою <code class=" language-none">certmgr.msc</code>: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="a66b207e-9fbc-4a18-8d56-42dd2e2df5bf" data-max-width="638" alt="Від HTTP до HTTPS - 17" src="https://cdn.javarush.com/images/article/a66b207e-9fbc-4a18-8d56-42dd2e2df5bf/512.jpeg" style="width: 638px;">
 </div>
</div>Якщо ми все зробабо правильно, то побачимо успішне звернення до нашого HTTPS сервера: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ddc53d3b-c602-41c3-9b8c-15e5d6a9214c" data-max-width="433" alt="Від HTTP до HTTPS - 18" src="https://cdn.javarush.com/images/article/ddc53d3b-c602-41c3-9b8c-15e5d6a9214c/256.jpeg" style="width: 433px;">
 </div>
</div>Як бачимо, сертифікат тепер вважається дійсним, ресурс доступний, помилок немає. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="6db94e81-51d5-46af-af34-e6425d60936f" data-max-width="286" alt="Від HTTP до HTTPS - 19" src="https://cdn.javarush.com/images/article/6db94e81-51d5-46af-af34-e6425d60936f/256.jpeg" style="width: 286px;">
 </div>
</div>
<h2 id="Итог">Підсумок</h2>Ось ми з Вами і розібрали, як виглядає схема включення протоколу HTTPS на веб-сервері і що для цього потрібно. Сподіваюся, на цьому етапі стало зрозуміло, що підтримка забезпечена взаємодією Java Cryptography Architecture (JCA), що відповідає за криптографію, та Java Secure Socket Extension (JSSE), що забезпечує реалізацію TLS на стороні Java. Ми побачабо, як використовується утиліта keytool, що входить до складу JDK, для роботи зі сховищем ключів і сертифікатів KeyStore. Крім того, ми зрозуміли, що HTTPS використовує протоколи SSL/TLS для безпеки. Для закріплення раджу прочитати чудові статті на цю тему: 
<ul>
 <li><a href="https://mnorin.com/tls-ssl-neobhodimy-j-minimum-znanij.html" target="_blank" rel="nofollow">TLS та SSL: Необхідний мінімум знань</a></li>
 <li><a href="https://tls.dxdt.ru/tls.html" target="_blank" rel="nofollow">Ключі, шифри, повідомлення: як працює TLS</a></li>
 <li><a href="https://www.youtube.com/watch?v=Cr4f6Cwjugs" target="_blank" rel="nofollow">Асиметричне шифрування. Як це працює?</a></li>
</ul>Сподіваюся, після цього невеликого огляду HTTPS стане трохи прозорішим. А у разі потреби включення HTTPS Ви зможете легко розуміти терміни з документації ваших серверів додатків та фреймворків. #Viacheslav