Машинне навчання для Java-розробників, частина 2
<p>----------------------------------------</p>
Нагадаємо, цільова функція , вона ж – функція передбачень, є результатом процесу підготовки чи тренування. Математично складність полягає в тому, щоб знайти функцію, яка отримує на вхід змінну та повертає передбачене значення . У машинному 
<p>----------------------------------------</p>
<a href="https://codegym.cc/groups/posts/469-mashinnoe-obuchenie-dlja-java-razrabotchikov-ch1" target="_blank">Машинне навчання для Java-розробників, частина 1</a>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="243c544a-dd04-406b-8d81-abf900557ec6" data-max-width="710" alt="Машинне навчання для Java-розробників, частина 2 - 1" src="https://cdn.javarush.com/images/article/243c544a-dd04-406b-8d81-abf900557ec6/512.jpeg" style="width: 710px;">
 </div>
</div>
<h3>Оцінка цільової функції</h3>Нагадаємо, цільова функція <code class=" language-none">hθ</code>, вона ж – функція передбачень, є результатом процесу підготовки чи тренування. Математично складність полягає в тому, щоб знайти функцію, яка отримує на вхід змінну <code class=" language-none">х</code>та повертає передбачене значення <code class=" language-none">у</code>. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="149" alt="Машинне навчання для Java-розробників, частина 2 - 2" src="https://cdn.javarush.com/images/article/c47983fb-a5ff-4ca5-8915-d9fd54e0f1ed/original.jpeg">
 </div>
</div> У машинному навчанні функція вартості <code class=" language-none">(J(θ))</code>використовується для обчислення помилки значення або вартості заданої цільової функції. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="db420e54-8288-4a1d-b22a-a2322692eed0" data-max-width="298" alt="Машинне навчання для Java-розробників, частина 2 - 3" src="https://cdn.javarush.com/images/article/db420e54-8288-4a1d-b22a-a2322692eed0/256.jpeg" style="width: 298px;">
 </div>
</div> Функція вартості показує, наскільки точно модель відповідає тренувальним даним. Для визначення вартості цільової функції, наведеної вище, необхідно розрахувати квадратичну помилку кожного прикладу будинку <code class=" language-none">(i)</code>. Помилка – відстань між розрахунковим значенням <code class=" language-none">у</code>і реальним значенням <code class=" language-none">y</code>будинку з прикладу <code class=" language-none">i</code>. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c3bd243a-8295-41a1-8b98-812214cae227" data-max-width="700" alt="Машинне навчання для Java-розробників, частина 2 - 4" src="https://cdn.javarush.com/images/article/c3bd243a-8295-41a1-8b98-812214cae227/512.jpeg" style="width: 700px;">
 </div>
</div> Наприклад, реальна ціна будинку площею <strong>1330 = 6,500,000 €</strong> . А відмінність передбаченої ціни будинку навченою цільовою функцією становить <strong>7,032,478 €</strong> : різниця (або помилка) дорівнює <strong>532,478 €</strong> . Ви також можете побачити цю різницю на графіці вище. Різниця (або помилка) показана у вигляді вертикальних пунктирних червоних ліній для кожної тренувальної пари ціна – площа. Вирахувавши вартість навченої цільової функції, потрібно підсумувати квадрати помилки для кожного будинку в прикладі і розрахувати основне значення. Чим менше значення ціни <code class=" language-none">(J(θ))</code>, тим точніше будуть передбачення нашої цільової функції. У <strong>лістингу-3</strong>, наведена проста реалізація Java функції вартості, що приймає на вхід цільову функцію, список тренувальних даних, і мітки пов'язані з ними. Значення передбачень обчислюватимуться в циклі, і помилка обчислюватиметься відніманням реального значення ціни (взятого з мітки). Пізніше квадрат помилок буде підсумовано і значення помилки буде розраховано. Вартість буде повернена як значення типу <code class=" language-none">double</code>: 
<h4>Лістинг-3</h4>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">double</span></span> <span class="token function"><span class="token function">cost</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Function</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token operator"><span class="token operator">&gt;</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">,</span></span>
 <span class="token class-name"><span class="token class-name">List</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">&gt;</span></span> dataset<span class="token punctuation"><span class="token punctuation">,</span></span>
 <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> labels<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token keyword"><span class="token keyword">int</span></span> m <span class="token operator"><span class="token operator">=</span></span> dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> sumSquaredErrors <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

 <span class="token comment"><span class="token comment">// рассчет квадрата ошибки («разницы») для каждого тренировочного примера и //добавление его к сумме</span></span>
 <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> m<span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token comment"><span class="token comment">// получаем вектор признаков из текущего примера</span></span>
 <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> featureVector <span class="token operator"><span class="token operator">=</span></span> dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token comment"><span class="token comment">// предсказываем значення и вычисляем ошибку базируясь на реальном</span></span>
 <span class="token comment"><span class="token comment">//значении (метка)</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> predicted <span class="token operator"><span class="token operator">=</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">apply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>featureVector<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> label <span class="token operator"><span class="token operator">=</span></span> labels<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> gap <span class="token operator"><span class="token operator">=</span></span> predicted <span class="token operator"><span class="token operator">-</span></span> label<span class="token punctuation"><span class="token punctuation">;</span></span>
 sumSquaredErrors <span class="token operator"><span class="token operator">+=</span></span> <span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">pow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>gap<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>

 <span class="token comment"><span class="token comment">// Вычисляем и возращаем значення ошибки (чем меньше тем лучше)</span></span>
 <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1.0</span></span> <span class="token operator"><span class="token operator">/</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span> <span class="token operator"><span class="token operator">*</span></span> m<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">*</span></span> sumSquaredErrors<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Цікаво читати про Java? Вступайте до групи <a href="https://codegym.cc/groups/java-developer" target="_blank">Java Developer</a> !</td>
   </tr>
  </tbody>
 </table>
</div>
<h3>Навчання цільової функції</h3>Незважаючи на те, що функція вартості допомагає оцінити якість цільової функції і тета-параметрів, ви все ж таки треба знайти найвідповідніші параметри тета. Ви можете використовувати алгоритм градієнтного спуску. 
<h3>Градієнтний спуск</h3>Градієнтний спуск мінімізує функцію вартості. Це означає, що він використовується для пошуку параметрів тіта, які мають мінімальну вартість <code class=" language-none">(J(θ))</code>на основі тренувальних даних. Ось спрощений алгоритм обчислення нових, більш відповідних значень: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="cb3c860a-7ba8-470d-a27d-8b9b8bcf90c1" data-max-width="300" alt="Машинне навчання для Java-розробників, частина 2 - 5" src="https://cdn.javarush.com/images/article/cb3c860a-7ba8-470d-a27d-8b9b8bcf90c1/256.jpeg" style="width: 300px;">
 </div>
</div> Так ось, параметри вектора тіта покращуватимуться з кожною ітерацією алгоритму. Коефіцієнт навчання задає кількість обчислень на кожній ітерації. Ці обчислення можна проводити, доки знайдено «хороші» значення тета. Наприклад, функція лінійної регресії нижче має три параметри тета: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="0512fa78-728e-4402-8c53-2957f7efe15c" data-max-width="300" alt="Машинне навчання для Java-розробників, частина 2 - 6" src="https://cdn.javarush.com/images/article/0512fa78-728e-4402-8c53-2957f7efe15c/256.jpeg" style="width: 300px;">
 </div>
</div> На кожній ітерації буде обчислено нове значення для кожного з параметрів: , , і . Після кожної ітерації, можна створити нову, більш відповідну реалізацію використовуючи новий вектор вектор <span>{θ </span><span><sub>0</sub></span><span> , θ </span><span><sub>1</sub></span><span> , θ </span><span><sub>2</sub></span><span> }</span> . У <strong>лістингу-4</strong> наведено Java-код алгоритму градієнтного спаду. Тета для функції регресії буде навчено з використанням тренувальних даних, даних маркерів, коефіцієнта навчання . Результатом буде покращена цільова функція, яка використовує параметри тіта. Метод<code class=" language-none">θ<sub>0</sub></code><code class=" language-none">θ<sub>1</sub></code><code class=" language-none">θ<sub>2</sub></code><code class=" language-none">LinearRegressionFunction</code><span><sub></sub><sub></sub><sub></sub></span><strong></strong><code class=" language-none">(α)</code><code class=" language-none">train()</code>буде викликатись знову і знову, і передавати нову цільову функцію та нові параметри тіта з попередніх обчислень. І ці виклики повторюватимуться, поки налаштована цільова функція не досягне плато мінімуму: 
<h4>Лістинг-4</h4>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">LinearRegressionFunction</span></span> <span class="token function"><span class="token function">train</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">LinearRegressionFunction</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">,</span></span>
 <span class="token class-name"><span class="token class-name">List</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">&gt;</span></span> dataset<span class="token punctuation"><span class="token punctuation">,</span></span>
 <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> labels<span class="token punctuation"><span class="token punctuation">,</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> alpha<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token keyword"><span class="token keyword">int</span></span> m <span class="token operator"><span class="token operator">=</span></span> dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> thetaVector <span class="token operator"><span class="token operator">=</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getThetas</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> newThetaVector <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span>thetaVector<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

 <span class="token comment"><span class="token comment">// вычисление нового значения тета для каждого елемента тета массива</span></span>
 <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> j <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> j <span class="token operator"><span class="token operator">&lt;</span></span> thetaVector<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">;</span></span> j<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token comment"><span class="token comment">// сумируем разницу ошибки * признак</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> sumErrors <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> m<span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> featureVector <span class="token operator"><span class="token operator">=</span></span> dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> error <span class="token operator"><span class="token operator">=</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">apply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>featureVector<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-</span></span> labels<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 sumErrors <span class="token operator"><span class="token operator">+=</span></span> error <span class="token operator"><span class="token operator">*</span></span> featureVector<span class="token punctuation"><span class="token punctuation">[</span></span>j<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>

 <span class="token comment"><span class="token comment">//вычисляем новые значения тета</span></span>
 <span class="token keyword"><span class="token keyword">double</span></span> gradient <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1.0</span></span> <span class="token operator"><span class="token operator">/</span></span> m<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">*</span></span> sumErrors<span class="token punctuation"><span class="token punctuation">;</span></span>
 newThetaVector<span class="token punctuation"><span class="token punctuation">[</span></span>j<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">=</span></span> thetaVector<span class="token punctuation"><span class="token punctuation">[</span></span>j<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">-</span></span> alpha <span class="token operator"><span class="token operator">*</span></span> gradient<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>

 <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LinearRegressionFunction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>newThetaVector<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Щоб переконатися, що вартість постійно зменшується, можна запускати функцію вартості <code class=" language-none">J(θ)</code>виконання після кожного кроку навчання. Після кожної ітерації вартість має зменшуватися. Якщо цього немає, це означає, що значення коефіцієнта навчання занадто велике і алгоритм просто проскочив мінімальне значення. У такому разі алгоритм градієнтного спаду зазнає невдачі. Графіки нижче демонструють цільову функцію, що використовує нові, обчислені, тета-параметри, що починаються зі стартового вектора<code class=" language-none">{1.0, 1.0}</code>. Ліва колонка показує графік функції пророкування після 50 повторень; середня колонка після 200 повторень; та права колонка після 1000 повторень. З них видно, що ціна зменшується після кожної ітерації, і нова цільова функція відповідає дедалі краще. Після 500-600 повторень тета-параметри більше не змінюються, і ціна досягає стабільного «плато». Після цього точність цільової функції поліпшити в такий спосіб не вдасться. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="6475eb9a-6a79-46ba-93e6-8b4e25a3e8fc" data-max-width="699" alt="Машинне навчання для Java-розробників, частина 2 - 7" src="https://cdn.javarush.com/images/article/6475eb9a-6a79-46ba-93e6-8b4e25a3e8fc/512.jpeg" style="width: 699px;">
 </div>
</div> У такому випадку, незважаючи на те, що вартість значно не зменшується після 500-600 ітерацій, цільова функція все ще не оптимальна. Це свідчить про <strong>невідповідність</strong>. У машинному навчанні термін "невідповідність" використовується для позначення того, що алгоритм навчання не знаходить основні тенденції даних. Якщо звернутися до реального досвіду, можна очікувати зменшення ціни за квадратний метр для більших володінь. Звідси ми можемо зробити висновок, що модель, використана для навчання цільової функції, не відповідає даним достатньою мірою. Невідповідність часто пов'язана із надмірним спрощенням моделі. Так сталося і в нашому випадку, цільова функція надто проста, і для аналізу використовує єдиний параметр – площу будинку. Тільки цієї інформації недостатньо для точного передбачення ціни будинку. 
<h3>Додавання ознак та їх масштабування</h3>Якщо ви виявабо, що ваша цільова функція не відповідає проблемі, яку ви намагаєтеся вирішити, її потрібно підкоригувати. Поширений спосіб коригування невідповідності - додавання додаткових ознак вектор ознак. У прикладі з ціною будинку можна додати такі характеристики, як кількість кімнат або вік будинку. Тобто замість використання вектора з одним значенням ознаки <code class=" language-none">{size}</code>для опису будинку можна використовувати вектор з кількома значеннями, наприклад,<code class=" language-none">{size, number-of-rooms, age}.</code> У деяких випадках кількості ознак доступних тренувальних даних не вистачає. Тоді варто спробувати застосувати поліноміальні ознаки, які обчислюються за допомогою існуючих. Наприклад, ви маєте можливість розширити цільову функцію визначення ціни будинку таким чином, щоб вона включала обчислювану ознаку квадратних метрів (x2): 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="95283dfb-2cd8-4e0e-88d9-778accda05f7" data-max-width="300" alt="Машинне навчання для Java-розробників, частина 2 - 8" src="https://cdn.javarush.com/images/article/95283dfb-2cd8-4e0e-88d9-778accda05f7/256.jpeg" style="width: 300px;">
 </div>
</div> Використання кількох ознак вимагає <strong>масштабування ознак</strong> , яке використовується для стандартизації діапазону різних ознак. Так, діапазон значень ознаки <span>size <sup>2</sup></span> значно більше від діапазону значень ознаки size. Без масштабування ознак, <span>size <sup>2</sup></span> надмірно впливатиме на функцію вартості. Помилка, що вноситься ознакою <span>size <sup>2</sup></span> буде значно більше помилки, що вноситься ознакою size. Простий алгоритм масштабування ознак наведено нижче: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="149" alt="Машинне навчання для Java-розробників, частина 2 - 9" src="https://cdn.javarush.com/images/article/1f753ea9-58d8-4d43-b5be-cfb3c980820f/original.jpeg">
 </div>
</div> Цей алгоритм реалізований у класі <code class=" language-none">FeaturesScaling</code>у коді прикладу нижче. Клас <code class=" language-none">FeaturesScaling</code>представляє промисловий метод для створення функції масштабування, що підлаштовується на тренувальних даних. Усередині екземпляри тренувальних даних використовуються для обчислення середнього, мінімального та максимального значень. Результуюча функція використовує вектор ознак та виробляє новий з відмасштабованими ознаками. Масштабування ознак необхідне як процесу навчання, так процесу передбачення, як показано ниже: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// создание массива данных</span></span>
<span class="token class-name"><span class="token class-name">List</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">&gt;</span></span> dataset <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">90.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">8100.0</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// feature vector of house#1</span></span>
dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">101.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">10201.0</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// feature vector of house#2</span></span>
dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">103.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">10609.0</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// ...</span></span>
<span class="token comment"><span class="token comment">//...</span></span>

<span class="token comment"><span class="token comment">// создание меток</span></span>
<span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> labels <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
labels<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">249.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// price label of house#1</span></span>
labels<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">338.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// price label of house#2</span></span>
labels<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">304.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// ...</span></span>
<span class="token comment"><span class="token comment">//...</span></span>

<span class="token comment"><span class="token comment">// создание расширенного списка признаков</span></span>
<span class="token class-name"><span class="token class-name">Function</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">&gt;</span></span> scalingFunc <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">FeaturesScaling</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createFunction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>dataset<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">List</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">&gt;</span></span> scaledDataset <span class="token operator"><span class="token operator">=</span></span> dataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">stream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">map</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>scalingFunc<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">collect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Collectors</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">// создаем функцию которая инициализирует теты и осуществляет обучение //используя коэффициент обучения 0.1</span></span>

<span class="token class-name"><span class="token class-name">LinearRegressionFunction</span></span> targetFunction <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LinearRegressionFunction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1.0</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">10000</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 targetFunction <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Learner</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">train</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>targetFunction<span class="token punctuation"><span class="token punctuation">,</span></span> scaledDataset<span class="token punctuation"><span class="token punctuation">,</span></span> labels<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0.1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token comment"><span class="token comment">// делаем предсказание стоимости дома с площадью 600 m2</span></span>
<span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> scaledFeatureVector <span class="token operator"><span class="token operator">=</span></span> scalingFunc<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">apply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Double</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token number"><span class="token number">1.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">600.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">360000.0</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">double</span></span> predictedPrice <span class="token operator"><span class="token operator">=</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">apply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>scaledFeatureVector<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> З додаванням все більшої кількості ознак, стає помітним зростання відповідності цільової функції, проте будьте обережні. Якщо ви зайдете надто далеко і додаєте надто багато ознак, ви можете в результаті повчити цільову функцію, яка надто відповідає. 
<h3>Надвідповідність та перехресні перевірки</h3>Надвідповідність виникає тоді, коли цільова функція або модель відповідає тренувальним даним занадто добре, настільки, що захоплює шум або випадкові відхилення в тренувальних даних. Приклад надвідповідності наведено на крайньому з права графіку нижче: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="efd79ce0-a0b8-44b5-8bee-0ac6b4621a7f" data-max-width="700" alt="Машинне навчання для Java-розробників, частина 2 - 10" src="https://cdn.javarush.com/images/article/efd79ce0-a0b8-44b5-8bee-0ac6b4621a7f/512.jpeg" style="width: 700px;">
 </div>
</div> Як би там не було, надвідповідна модель дуже добре показує себе на тренувальних даних, але при цьому показуватиме погані результати на реальних невідомих даних. Існує кілька шляхів уникнути надвідповідності. 
<ul>
 <li>Використовуйте більший масив даних для тренування.</li>
 <li>Використовувати менше ознак, як показано на графіках вище.</li>
 <li>Використовувати покращений алгоритм машинного навчання, що бере до уваги регуляризацію.</li>
</ul> Якщо алгоритм передбачення надвідповідає тренувальним даним, необхідно виключити ознаки, які приносять користі щодо його точності. Складність становить пошук ознак, які суттєвіше за інших впливають на точність передбачення. Як показано на графіках, надвідповідність можна визначити візуально за допомогою графіків. Це добре працює для графіків з 2 або 3 координатами, стає важко побудувати та оцінити графік якщо ви використовуєте більше ніж 2 ознаки. У перехресній перевірці ви перевіряєте ще раз моделі після навчання з використанням даних не відомих алгоритму після закінчення процесу навчання. Доступні марковані дані мають бути розбиті на 3 набори: 
<ul>
 <li>тренувальні дані;</li>
 <li>перевірочні дані;</li>
 <li>тестові дані.</li>
</ul> У такому разі 60 відсотків промаркованих записів, що характеризують будинки, мають бути використані у процесі навчання варіантів цільового алгоритму. Після процесу навчання, половину даних, що залишабося (не використаних раніше), потрібно використовувати для перевірки того факту, що навчений цільовий алгоритм працює добре з невідомими даними. Як правило, алгоритм, який показує найкращі результати в порівнянні з іншими, і вибирається для використання. Дані використовуються для обчислення величини помилки для остаточно обраної моделі. Існують інші техніки перехресної перевірки, наприклад, як <strong>k-fold</strong> . Однак у цій статті я не описуватиму їх. 
<h3>Інструменти машинного навчання та фреймворк Weka</h3>Більшість фреймворків і бібліотек є великою колекцією алгоритмів машинного навчання. Крім цього вони надають зручний високорівневий інтерфейс для навчання, перевірки та обробки моделей даних. Weka один із найпопулярніших фреймворків для JVM. Weka – це Java-бібліотека для практичного застосування, що містить графічні тести для перевірки моделей. У прикладі нижче бібліотека Weka використовується для створення набору тренувальних даних, що містить ознаки та мітки. Метод <code class=" language-none">setClassIndex()</code>– для маркування. У Weka мітка визначена як клас: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// определяем атрибуты для признаков и меток</span></span>
<span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Attribute</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> attributes <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Attribute</span></span> sizeAttribute <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Attribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sizeFeature"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
attributes<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sizeAttribute<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Attribute</span></span> squaredSizeAttribute <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Attribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"squaredSizeFeature"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
attributes<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>squaredSizeAttribute<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Attribute</span></span> priceAttribute <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Attribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"priceLabel"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
attributes<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>priceAttribute<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>


<span class="token comment"><span class="token comment">// создаем и заполняем список признаков 5000 примеров</span></span>
<span class="token class-name"><span class="token class-name">Instances</span></span> trainingDataset <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Instances</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"trainData"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> attributes<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">5000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
trainingDataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setClassIndex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>trainingSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">numAttributes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Instance</span></span> instance <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">DenseInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

instance<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sizeAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">90.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
instance<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>squaredSizeAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">pow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">90.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
instance<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>priceAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">249.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
trainingDataset<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>instance<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Instance</span></span> instance <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">DenseInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
instance<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sizeAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">101.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span></code></pre> Набір даних та Зразок об'єкта може бути збережений та завантажений із файлу. Weka використовує <strong>ARFF</strong> (Attribute Relation File Format), який підтримується графічними тестами Weka. Цей набір даних використовується для тренування цільової функції, відомої як класифікатор Weka. Перш за все, ви повинні визначити цільову функцію. У коді нижче екземпляр класифікатора <code class=" language-none">LinearRegression</code>буде створено. Цей класифікатор буде навчений за допомогою дзвінка <code class=" language-none">buildClassifier()</code>. Метод <code class=" language-none">buildClassifier()</code>підбирає тіта параметри базуючись на тренувальних даних у пошуках найкращої цільової моделі. Використовуючи Weka, вам не доведеться хвилюватися про встановлення коефіцієнта навчання чи кількість ітерацій. Також Weka виконує масштабування ознак самостійно. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Classifier</span></span> targetFunction <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LinearRegression</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">buildClassifier</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>trainingDataset<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Після того, як ці установки виконані, цільова функція може бути використана для передбачення ціни будинку, як показано нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Instances</span></span> unlabeledInstances <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Instances</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"predictionset"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> attributes<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
unlabeledInstances<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setClassIndex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>trainingSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">numAttributes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Instance</span></span> unlabeled <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">DenseInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
unlabeled<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sizeAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1330.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
unlabeled<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>squaredSizeAttribute<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">pow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1330.0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
unlabeledInstances<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>unlabeled<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">double</span></span> prediction <span class="token operator"><span class="token operator">=</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">classifyInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>unlabeledInstances<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Weka надає клас <code class=" language-none">Evaluation</code>клас для перевірки навченого класифікатора чи моделі. У коді нижче вибраний масив перевірочних даних використовується, щоб уникнути помилкових результатів. Результати вимірювань (ціна помилки) виводитимуться на консоль. Як правило, результати оцінки використовуються для порівняння моделей, які були навчені з використанням різних алгоритмів машинного навчання, або таких варіацій: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Evaluation</span></span> evaluation <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Evaluation</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>trainingDataset<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
evaluation<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">evaluateModel</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>targetFunction<span class="token punctuation"><span class="token punctuation">,</span></span> validationDataset<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>evaluation<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toSummaryString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Results"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Приклад вище використовує лінійну регресію, яка передбачає чисельні значення, такі як ціна будинку, базуючись на вхідних значеннях. Лінійна регресія підтримує передбачення безперервних числових значень. Для передбачення бінарних значень (Так і Ні) потрібно використовувати інші алгоритми машинного навчання. Наприклад, дерево рішень, нейронні мережі чи логістичну регресію. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// использование логистической регрессии</span></span>
<span class="token class-name"><span class="token class-name">Classifier</span></span> targetFunction <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Logistic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">buildClassifier</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>trainingSet<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Ви можете використовувати один з цих алгоритмів, наприклад, для передбачення того, чи є поштове повідомлення спамом, або прогноз погоди, або передбачення чи добре буде продаватися будинок. Якщо ви хочете навчити ваш алгоритм передбачати погоду або наскільки швидко буде продано будинок вам потрібен інший набір даних, наприклад<code class=" language-none">topseller:</code>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// использование атрибута маркера topseller замість атрибута маркера цена</span></span>
<span class="token class-name"><span class="token class-name">ArrayList</span></span><string> classVal <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
classVal<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"true"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
classVal<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"false"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token class-name"><span class="token class-name">Attribute</span></span> topsellerAttribute <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Attribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"topsellerLabel"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> classVal<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
attributes<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>topsellerAttribute<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
</string></code></pre> Цей набір даних буде використано для тренування нового класифікатора <code class=" language-none">topseller</code>. Після того, як він буде навчений, виклик передбачення повинен повертати індекс класу маркера, який можна використовувати для отримання передбаченого значення. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> idx <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> targetFunction<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">classifyInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>unlabeledInstances<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> prediction <span class="token operator"><span class="token operator">=</span></span> classVal<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>idx<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><big><small>
  <h2>Висновок</h2></small></big>Хоча машинне навчання тісно пов'язане зі статистикою та використовує багато математичних концепцій, інструментарій машинного навчання дозволяє почати інтеграцію машинного навчання у ваші програми без глибоких знань математики. Тим не менш, чим краще ви зрозумієте основні алгоритми машинного навчання такі як, наприклад, алгоритм лінійної регресії, який ми досліджували в цій статті, тим більше можливостей вибрати правильний алгоритм і налаштувати його на оптимальну продуктивність. <em><a href="https://www.javaworld.com/article/3224505/application-development/machine-learning-for-java-developers.html" target="_blank" rel="nofollow">Переклад</a> з англійської. Автор - Грегор Рот (Gregor Roth), Software Architect, JavaWorld.</em>
<table>
 <tbody>
  <tr>
   <th>Що ще почитати:</th>
  </tr>
  <tr>
   <td>
    <p><a href="https://codegym.cc/groups/posts/463-5-tekhnologicheskikh-tendenciy-dlja-postroenija-uspeshnoy-karjherih-v-2018" target="_blank">5 технологічних тенденцій для побудови успішної кар'єри у 2018</a></p>
    <p><a href="https://codegym.cc/groups/posts/469-mashinnoe-obuchenie-dlja-java-razrabotchikov-ch1" target="_blank">Машинне навчання для Java-розробників, частина 1</a></p>
    <p><a href="https://codegym.cc/groups/posts/159-5-vihzovov-dlja-razvitija-iskusstvennogo-intellekta" target="_blank">5 викликів для розвитку штучного інтелекту</a></p></td>
  </tr>
 </tbody>
</table>