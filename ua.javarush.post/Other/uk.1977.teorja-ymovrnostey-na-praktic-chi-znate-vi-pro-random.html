Теорія ймовірностей на практиці чи знаєте ви про Random
<p>----------------------------------------</p>
У світі є чимало наук, які вивчають теорію ймовірності. І науки складаються з різних розділів. Наприклад, у математиці є окремий розділ, присвячений дослідженню випадкових подій, величин тощо. Адже науки беруться не просто так. В даному вип
<p>----------------------------------------</p>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1b1a43d3-0de0-469f-828b-d0baf2dc2da8" data-max-width="710" alt="Теорія ймовірностей на практиці чи знаєте ви про Random - 1" src="https://cdn.javarush.com/images/article/1b1a43d3-0de0-469f-828b-d0baf2dc2da8/512.jpeg" style="width: 710px;">
 </div>
</div>
<h2>Вступ</h2>У світі є чимало наук, які вивчають теорію ймовірності. І науки складаються з різних розділів. Наприклад, у математиці є окремий розділ, присвячений дослідженню випадкових подій, величин тощо. Адже науки беруться не просто так. В даному випадку теорія ймовірності почала формуватися, коли люди намагалися зрозуміти, які закономірності є в киданні кубика при грі в азартні ігри. Якщо придивитися, довкола нас є безліч на перший погляд випадкових речей. Але все випадкове не зовсім випадкове. Але про це трохи згодом. У мові програмування Java теж є підтримка випадкових чисел, починаючи з першої версії JDK. Випадкові числа Java можна використовувати за допомогою класу <strong><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html" target="_blank" rel="nofollow">java.util.Random</a></strong> . Для випробувань нам підійде <a href="https://www.tutorialspoint.com/compile_java_online.php" target="_blank" rel="nofollow">tutorialspoint java online compiler</a>. Ось примітивний приклад використання <em>Random</em> для емулювання кидання кісток, або російською кубика: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorld</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Random</span></span> rnd <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">int</span></span> number <span class="token operator"><span class="token operator">=</span></span> rnd<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Random number: "</span></span> <span class="token operator"><span class="token operator">+</span></span> number<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Здавалося б, на цьому можна закінчити опис <em>Random</em> , але не так просто. Відкриємо ми опис класу <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html" target="_blank" rel="nofollow">java.util.Random</a> в Java API. І тут бачимо цікаві речі. Клас <strong>Random</strong> використовує псевдовипадкові числа. Як так? Виходить, чи випадкові числа не такі випадкові? 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="77ed16d9-4036-4d43-948e-ef24370fdc3c" data-max-width="338" alt="Теорія ймовірностей на практиці чи знаєте ви про Random - 2" src="https://cdn.javarush.com/images/article/77ed16d9-4036-4d43-948e-ef24370fdc3c/256.jpeg" style="width: 338px;">
 </div>
</div>
<h2>Псевдовипадковість java.util.Random</h2>Документація класу <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html" target="_blank" rel="nofollow">java.util.Random</a> каже, що якщо екземпляри <em><strong>Random</strong></em> створені з однаковим параметром <strong>seed</strong> та з екземплярами виконані однакові послідовності дій, вони повертають ідентичні послідовності чисел. І якщо ми придивимося, то побачимо, що у <em>Random</em> дійсно є <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html#Random-long-" target="_blank" rel="nofollow">конструктор</a> , який приймає деяке <em>long</em> значення як <em>seed:</em>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Random</span></span> rnd1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Random</span></span> rnd2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">boolean</span></span> test <span class="token operator"><span class="token operator">=</span></span> rnd1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">==</span></span> rnd2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Test: "</span></span> <span class="token operator"><span class="token operator">+</span></span> test<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Цей приклад поверне <em>true</em> , т.к. <em>seed</em> обох екземплярів однаковий. Що ж робити? Частково проблему вирішує конструктор за умовчанням. Нижче наведено приклад вмісту конструктора <em>Random</em> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">seedUniquifier</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">^</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nanoTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Конструктор за замовчуванням використовує операцію побитового <em>OR,</em> що виключає . І використовує для цього <em>long</em> представляючий поточний час та деякий <em>seed</em> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">long</span></span> <span class="token function"><span class="token function">seedUniquifier</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">long</span></span> current <span class="token operator"><span class="token operator">=</span></span> seedUniquifier<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">long</span></span> next <span class="token operator"><span class="token operator">=</span></span> current <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">181783497276652981L</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>seedUniquifier<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">compareAndSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>current<span class="token punctuation"><span class="token punctuation">,</span></span> next<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
			<span class="token keyword"><span class="token keyword">return</span></span> next<span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут цікаво ще й те, що кожен виклик методу отримання <em>seedUniquifier</em> змінює значення <em>seedUniquifier</em> . Тобто, клас спроектований так, щоб максимально ефективно підбирати випадкові числа. Однак, як і сказано в документації, вони " <strong>не є криптографічно надійними</strong> ". Тобто для якихось цілей використання криптографічних цілей (генерація паролів і т.п.) не годиться, т.к. послідовність при належному підході передбачається. На цю тему є в інтернеті приклади, наприклад: " <a href="https://franklinta.com/2014/08/31/predicting-the-next-math-random-in-java/" target="_blank" rel="nofollow">Predicting the next Math.random() in Java</a> ". Або наприклад вихідний код тут: " <a href="https://gist.github.com/DinisCruz/828a23e607c1eab6b66c866e7f3a37c9" target="_blank" rel="nofollow">Vulnerability Weak Crypto</a> ". У <strong>java.util.Random</strong>(генератора випадкових чисел) є якийсь "шорткат", тобто укорочена версія виклику, яка виконується через Math.random: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> random_number <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Value: "</span></span> <span class="token operator"><span class="token operator">+</span></span> random_number<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Але якщо подивитися уважно, всередині сидить той самий Random: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">double</span></span> <span class="token function"><span class="token function">random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">RandomNumberGeneratorHolder</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>randomNumberGenerator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextDouble</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">RandomNumberGeneratorHolder</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Random</span></span> randomNumberGenerator <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У JavaDoc радять використовувати клас <strong>SecureRandom</strong> для " <strong>cryptographically secure pseudo-random number generator</strong> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ecc1d67f-7960-4bec-970e-ad1942fd3568" data-max-width="331" alt="Теорія ймовірностей на практиці чи знаєте ви про Random - 3" src="https://cdn.javarush.com/images/article/ecc1d67f-7960-4bec-970e-ad1942fd3568/256.jpeg" style="width: 331px;">
 </div>
</div>
<h2>Безпечний Random Java</h2>Клас <em>SecureRandom</em> є спадкоємцем <strong>java.util.Random</strong> і розташований у пакеті <strong>java.security</strong> . Порівняння цих двох класів можна прочитати у статті " <a href="http://www.techiedelight.com/difference-java-util-random-java-security-securerandom/" target="_blank" rel="nofollow">Difference between java.util.Random and java.security.SecureRandom</a> ". Чим же такий гарний цей SecureRandom? Справа в тому, що для нього джерелом випадкових чисел є така магічна штука, що звучить як "пул ентропії ядра". Це водночас і плюс, і мінус. Про мінус цього можна прочитати у статті: <a href="http://www.mattnworb.com/post/the-dangers-of-java-security-securerandom/" target="_blank" rel="nofollow">The dangers of java.security.SecureRandom</a>Якщо коротко, в Linux є генератор випадкових чисел ядра (RNG). RNG генерує випадкові числа на основі даних з пулу ентропії (entropy pool), який наповнюється на основі випадкових подій в системі, таких як таймінги клавіатури і дисків, руху миші, переривання (interrupts), мережевий трафік Докладніше про пул ентропії викладено в матеріалі " <a href="https://ivirt-it.ru/linux-kernel-rng/" target="_blank" rel="nofollow">Випадкові числа в Linux(RNG) або як "наповнити" /dev/random та /dev/urandom</a> ". На Windows системах використовується SHA1PRNG, реалізована в sun.security .provider.SecureRandom З розвитком Java змінювався і SecureRandom, про що для повної картини варто прочитати в огляді " <a href="https://www.synopsys.com/blogs/software-security/proper-use-of-javas-securerandom/" target="_blank" rel="nofollow">Java SecureRandom updates as of April 2016</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2fa1064c-3d62-432c-a3b4-c226577c3a3d" data-max-width="271" alt="Теорія ймовірностей на практиці чи знаєте ви про Random - 4" src="https://cdn.javarush.com/images/article/2fa1064c-3d62-432c-a3b4-c226577c3a3d/256.jpeg" style="width: 271px;">
 </div>
</div>
<h2>Багатопотоковість або будь як Цезар</h2>Якщо дивитися код класу <strong><em>Random</em></strong> , то начебто ніщо не віщує біди. Методи не позначені як <em>synchronized</em> . Але є одне АЛЕ: при створенні <em>Random</em> конструктором за замовчуванням в кількох потоках ми будемо між ними ділити один і той же <em>instance seed</em> , за яким створюватиметься <em>Random</em> . А також при отриманні нового випадкового числа у <em>instance</em> так само змінюється внутрішній <em>Atomic Long</em> . З одного боку, у цьому нічого страшного з логічного погляду, т.к. використовується <em>AtomicLong</em> . З іншого боку, за все треба платити, зокрема продуктивністю. І за це також. Тому навіть в офіційній документації до<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html" target="_blank" rel="nofollow">java.util.Random</a> сказано: " <strong>Instances of java.util.Random are threadsafe. However, current use of the same java.util</strong> . . Тобто в багатопотокових додатках при активному використанні <em>Random</em> з кількох потоків краще використовувати клас <em>ThreadLocalRandom</em> . Його використання трохи відрізняється від звичайного <em>Random</em> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> rand <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">ThreadLocalRandom</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">current</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Value: "</span></span> <span class="token operator"><span class="token operator">+</span></span> rand<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачимо, для нього ми не вказуємо <em>seed</em> . Даний приклад описаний в офіційному tutorial від Oracle: <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/threadlocalrandom.html" target="_blank" rel="nofollow">Concurrent Random Numbers</a> . Докладніше про цей клас можна прочитати в огляді: " <a href="https://www.baeldung.com/java-thread-local-random" target="_blank" rel="nofollow">Guide to ThreadLocalRandom in Java</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="cbb9cd7c-bda0-403c-a71f-d62559df6f8e" data-max-width="315" alt="Теорія ймовірностей на практиці чи знаєте ви про Random - 5" src="https://cdn.javarush.com/images/article/cbb9cd7c-bda0-403c-a71f-d62559df6f8e/256.jpeg" style="width: 315px;">
 </div>
</div>
<h2>StreamAPI та Random</h2>Завдяки виходу Java 8, у нас з'явилося багато нових можливостей. У тому числі й Stream API. І зміни торкнулися і генерації значень <em>Random</em> . Наприклад, у класі <em>Random</em> з'явабося нові методи, які дозволяють отримати <em>Stream</em> із випадковими значеннями типу <code class=" language-none">int</code>, <code class=" language-none">double</code>або <code class=" language-none">long</code>. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorld</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">ints</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>n <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>n<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Також з'явився новий клас <strong><em>SplittableRandom</em></strong> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">SplittableRandom</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorld</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SplittableRandom</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">ints</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>n <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>n<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Докладніше про відмінність <em>SplittableRandom</em> від інших класів можна прочитати тут: " <a href="https://www.logicbig.com/how-to/java-random/different-random-classes.html" target="_blank" rel="nofollow">Different ways to create Random numbers in Java</a> ". 
<h2>Висновок</h2>Думаю, варто зробити висновок. Потрібно уважно читати JavaDoc до використовуваних класів. За такий простий на перший погляд річчю як Random стоять нюанси, які можуть зіграти злий жарт. #Viacheslav