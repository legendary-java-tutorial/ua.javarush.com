Побайтова робота з файлами
<p>----------------------------------------</p>
Special for
<p>----------------------------------------</p>
Special for<ls user="Spiker">
 <h2>Почнемо'c</h2>У 18 рівні розпочалися перші завдання побайтного читання файлів: прочитати файл, далі знайти мінімальні/максимальні байти або вивести упорядкованому вигляді тощо. 
 <div class="row justify-content-center jr-image-wrap">
  <div class="col-12 col-sm-10 col-md-8">
   <img data-id="578d642c-8711-4a30-ba6d-1aede13540eb" data-max-width="710" alt="Побайтова робота з файлуми - 1" src="https://cdn.javarush.com/images/article/578d642c-8711-4a30-ba6d-1aede13540eb/512.jpeg" style="width: 710px;">
  </div>
 </div>Народ тут дуже вульгарний. Знають про колекції та про те, що вони можуть сортувати, вставляти. Колекції – потужний механізм. І багато хто не застосовував їх взагалі до CodeGym-а. Воно, звичайно, схвально вивчати їх і намагатися приткнути куди не потрапивши. І так. Візьмемо завдання, якого немає в завданнях (щоб не було спойлерів при вирішенні), але є дуже схожі: 
 <ul>
  <li>Ввести з консолі ім'я файлу</li>
  <li>Вважати всі байти з файлу.</li>
  <li>Не враховуючи повторень - відсортувати їх за байт-кодом у спадному порядку.</li>
  <li>Вивести на екран</li>
  <li>Закрити потік введення-виводу</li>
 </ul> Приклад байт вхідного файлу 
 <em>44 83 44</em> Приклад виводу 
 <em>83 44</em> Ми додатково завели змінні 
 <code class=" language-none">startTime</code>і 
 <code class=" language-none">finishTime</code>щоб засікти час виконання програми. Для обчислення використовував 
 <u>i3-3GHz/8Gb RAM/HDD WD Blue-1Tb/Win7-64/jdk-8u73-windows-x64</u> (приклади програм у варіантах 1-2 взяті з форуму порядку - тобто вони РЕАЛЬНІ!!) 
 <h2>Вирішуємо в лоб:</h2>
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Вариант 1. Загоняем в коллекцию и сортируем используя ее метод Collections.sort</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Solution</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">FileInputStream</span></span> inputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BufferedReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InputStreamReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readLine</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> startTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> listData <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> listData<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> result <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HashSet</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span>listData<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sort</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">!</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEmpty</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" "</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>

        <span class="token keyword"><span class="token keyword">long</span></span> finishTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"\nвремя работы="</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>finishTime<span class="token operator"><span class="token operator">-</span></span>startTime<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Вирішує все чудово! Тест (якби був - пройшовся б на ура). Але в житті мало файлів, що містять лише рядок "Мама мила раму". Давайте згодуємо нашій програмі файл в 46Мб (за нинішніми мірками начебто і не дуже багато). Що таке програма виконується 220 секунд. Спроба згодувати з вечора 1Gb файл (розмір MPEG4 фільму не в найкращій якості) не мала успіху. Програма вранці досі читала – а мені йти на роботу вже. В чому проблема? Напевно, у використанні 
 <code class=" language-none">ArrayList&lt;Integer&gt;</code>у якого всередині 1 мільярд елементів. Кожен елемент займає 16 байт мінімум (Заголовок: 8 байт + Поле int: 4 байта + Вирівнювання для кратності 8: 4 байта). Разом ми добровільно заганяємо на згадку 16 Gb даних при розмірі оперативи в 8. Будемо робити краще. Нирнемо в колекції глибше. І ура знайшлося те, що нам потрібно. 
 <h2>Зустрічаємо TreeSet</h2>Це безліч: 
 <ul>
  <li>не допускає зберігання двох однакових елементів (а значить ми зберігатимемо в пам'яті всі 255 елементів, замість мільярда!)</li>
  <li>при маніпуляціях зі своїми елементами автоматично впорядковує (саме сортує – ось він, верх досконалості!)</li>
 </ul> Отримуємо: 
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Вариант 2. Загоняем в ТreeSet который сам сортирует (лютый win!)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Solution</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">FileInputStream</span></span> inputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BufferedReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InputStreamReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readLine</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> arrBytes <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> startTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token class-name"><span class="token class-name">SortedSet</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> list <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">TreeSet</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">while</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">&gt;</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">!</span></span>list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEmpty</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>        <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">last</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" "</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>list<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">last</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>

		<span class="token keyword"><span class="token keyword">long</span></span> finishTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"\nвремя работы="</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>finishTime<span class="token operator"><span class="token operator">-</span></span>startTime<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
 <strong>Маємо на виході: <em>46Мб файл 176 секунд. 1Gb файл – 3 години 5 хвабон. </em></strong> Прогрес в наявності. Ми змогли "дочекатися" результатів, та й 46Мб файл помітно швидше обробляється. Йдемо далі. Давайте спробуємо 
 <strong>відмовитися</strong> від колекцій (це буде для деяких боляче). Використовуватимемо прості масиви (це так примітивно). Зауважимо одну 
 <strong>важливу річ</strong> . Кількість байт, що зустрічаються, можна загнати в масив довжиною 256. Так просто будемо збільшувати на одиницю відповідний ліченому байту елемент масиву. 
 <h2>Масив - побайтно</h2>
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Вариант 3. Считываем массив побайтно.</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Solution</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">FileInputStream</span></span> inputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BufferedReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InputStreamReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readLine</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> arrBytes <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> startTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> arrBytes<span class="token punctuation"><span class="token punctuation">[</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

		inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token comment"><span class="token comment">// Выводим отсортированный по байт-коду в обратном порядке</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">long</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">255</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&gt;=</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">--</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>arrBytes<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> i<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" "</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

			<span class="token keyword"><span class="token keyword">long</span></span> finishTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"\nвремя работы="</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>finishTime<span class="token operator"><span class="token operator">-</span></span>startTime<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
 <strong>Маємо на виході: <em>46Мб файл 158 секунд. 1Gb файл – 2 години 55 хвабон. </em></strong> Знову покращення, але невелике. І ми зробабо все найпростішими інструментами. 
 <strong>Не використовували мікроскоп для забивання цвяхів</strong> . 
 <em>Тепер ліричний відступ. </em> Згадаймо пристрій комп'ютера. 
 <strong><em>Пам'ять ОЗУ (DRAM)</em></strong> , де зазвичай виконується програма і зберігаються змінні має високу швидкість доступу, але невеликий розмір. 
 <strong><em>Пам'ять на жорсткому/flash диску</em></strong>(HDD або Flash-накопичувачі) де зазвичай зберігаються файли, навпаки, має низьку швидкість доступу, але великий розмір. Так що коли ми побайтно читаємо 1Gb файл (тобто мільярд разів звертаємося до HDD) - ми витрачаємо багато часу на роботу з низькошвидкісним пристроєм (пісочком перекладаємо пісок з кузова КамАЗа в пісочницю). Спробуймо ще покращити. 
 <h2>Вивалимо відразу ВЕСЬ КАМАЗ із піском за один раз!</h2>
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Вариант 4. Считываем массив сразу целиком за раз в память.</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Solution</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">FileInputStream</span></span> inputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BufferedReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InputStreamReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readLine</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> arrBytes <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> startTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">byte</span></span> fileImage<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token operator"><span class="token operator">=</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> fileSize<span class="token operator"><span class="token operator">=</span></span>fileImage<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">;</span></span>
        inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileImage<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator"></span></span><filesize ;="" i++)="" arrbytes[fileimage[i]="" &="" 0b11111111]++;="" inputstream.close();="" выводим="" отсортированный="" по="" байт-коду="" в="" обратном="" порядке="" for="" (long="" i="255;"><span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">--</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>arrBytes<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> i<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" "</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

		<span class="token keyword"><span class="token keyword">long</span></span> finishTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"\nвремя работы="</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>finishTime<span class="token operator"><span class="token operator">-</span></span>startTime<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
</filesize></code></pre>
 <em>невеликий, але знову ж таки <strong>важливий відступ </strong></em>
 <em><strong>.</strong></em>
 <ol>
  <li>індекс у arrBytes визначений у межах 0..255,</li>
  <li>fileImage - масив байт, елементи якого мають значення -128..127</li>
 </ol> Тому для підрахунку байт будемо використовувати конструкцію 
 <code class=" language-none">arrBytes[fileImage[i] &amp; 0b11111111]++;</code> яка банально скине біт знака і поверне нам значення в діапазоні 0..255. 
 <strong>Отже, результати: <em>46Мб файл 0.13 секунд (менше секунди). 1Gb файл – 9 секунд.</em></strong> Ми зробабо це! Ми неймовірно круті! Прискорабося з 3 години до 9 секунд. Все, можна відкинутися у кріслі та попити чайку. А тепер ще один експеримент – спробуємо файл у 32 Gb (наприклад, HD фільм). Отримаємо в результаті тріск працюючого HDD із вивалюванням програми у Windows. КамАЗ виваливши кузов із піском зламав пісочницю! Що будемо робити? Згадаймо ще один факт. Файли в ОС зазвичай зберігаються порціями (кластерами) по 2-64Кб (залежить від типу файлової системи, налаштувань і т.п.). Зчитуватимемо порціями, наприклад у 64000 байт. Спробуємо розвантажити КамАЗ екскаватором чималими порціями: 
 <h2>Використовуємо буфер</h2>
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Вариант 5. Считываем массив кусками.</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Solution</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">FileInputStream</span></span> inputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BufferedReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InputStreamReader</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readLine</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> arrBytes <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">long</span></span> startTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">int</span></span>  bufferSize <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">64000</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">byte</span></span> buffer<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>   <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">64000</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">64000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> bufferSize <span class="token operator"><span class="token operator">=</span></span> inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">available</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            inputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>buffer<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> bufferSize <span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator"></span></span><buffersize ;="" i++)="" arrbytes[="" buffer[i]="" &="" 0b11111111="" ]++;="" }="" inputstream.close();="" выводим="" отсортированный="" по="" байт-коду="" в="" обратном="" порядке="" for="" (long="" i="255;"><span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">--</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>arrBytes<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> i<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">&gt;</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" "</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

		<span class="token keyword"><span class="token keyword">long</span></span> finishTime <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"\nвремя работы="</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>finishTime<span class="token operator"><span class="token operator">-</span></span>startTime<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
</buffersize></code></pre>
 <strong>У результаті отримали: <em>46Мб файл 0.08 секунди (менше секунди). 1Gb файл - 0.9 секунд (менше секунди). 32Gb файл – 31 секунда. </em></strong> Зауважимо для 1 Gb файлу ми покращабо продуктивність з кількох 
 <strong>годин</strong> до 
 <strong>часток секунд</strong>!!! На цьому скромному факті закінчимо експеримент та покращення початкового коду. Ми досягли прогресу багато в чому – нас тішать нові показники витрати пам'яті та часу роботи. Також ми не підтягуємо в цьому випадку непотрібні колекції зі стандартної бібліотеки. PS Хтось скаже приклад надуманий тощо. Але схожих завдань — проаналізувати величезний обсяг елементів, що мають кінцеву кількість станів. Наприклад зображення (RGB - зазвичай зберігаються у 24 байтах, у разі long[] arrRGB = new long[256*256*256] зайняв би у пам'яті всього 64Мб), музика (амплітуда зазвичай оцифровується в 16 чи 24 біта) чи дискретні показники датчиків тощо.
</ls>