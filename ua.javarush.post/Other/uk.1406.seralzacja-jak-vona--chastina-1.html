Серіалізація як вона є. Частина 1
<p>----------------------------------------</p>
На перший погляд серіалізація видається тривіальним процесом. Справді, що може бути простішим? Оголосив клас, що реалізує інтерфейс – і всі справи. Можна серіалізувати клас без проблем. Теоретично це справді так. Практично ж є дуже багато т
<p>----------------------------------------</p>
На перший погляд серіалізація видається тривіальним процесом. Справді, що може бути простішим? Оголосив клас, що реалізує інтерфейс <code class=" language-none">java.io.Serializable</code>– і всі справи. Можна серіалізувати клас без проблем. <img data-id="1d335648-7d53-43f4-a338-8f180565c58b" data-max-width="850" alt="Серіалізація як вона є.  Частина 1 - 1" src="https://cdn.javarush.com/images/article/1d335648-7d53-43f4-a338-8f180565c58b/800.jpeg" style="width: 850px;">Теоретично це справді так. Практично ж є дуже багато тонкощів. Вони пов'язані з продуктивністю, десеріалізацією, з безпекою класу. І ще з багатьма аспектами. Про такі тонкощі й йтиметься розмова. Цю статтю можна розділити на такі частини: 
<ul>
 <li>Тонкощі механізмів</li>
 <li>Навіщо потрібен<code class=" language-none">Externalizable</code></li>
 <li>Продуктивність</li>
 <li>Зворотній бік медалі</li>
 <li>Безпека даних</li>
 <li>Серіалізація об'єктів<code class=" language-none">Singleton</code></li>
</ul>Приступимо до першої частини - 
<h2>Тонкощі механізмів</h2>Насамперед, питання на засипку. А скільки існує способів зробити об'єкт, що серіалізується? Практика показує, що понад 90% розробників відповідають це питання приблизно однаково (з точністю до формулювання) – такий спосіб один. Тим часом їх два. Про другий згадують далеко не всі, не кажучи вже про те, щоб сказати щось виразне про його особливості. Отже, які ж ці методи? Про перший пам'ятають усі. Це вже згадана реалізація <code class=" language-none">java.io.Serializable</code>, яка не потребує жодних зусиль. Другий метод - це також реалізація інтерфейсу, але вже іншого: <code class=" language-none">java.io.Externalizable</code>. На відміну від <code class=" language-none">java.io.Serializable</code>, він містить два методи, які необхідно реалізувати - <code class=" language-none">writeExternal(ObjectOutput)</code>і <code class=" language-none">readExternal(ObjectInput)</code>. У цих методах якраз і є логіка серіалізації/десеріалізації. <mark>Зауваження.</mark>Надалі серіалізацію з реалізацією <code class=" language-none">Serializable</code>я іноді називатиму стандартною, а реалізацію <code class=" language-none">Externalizable</code>– розширеною. Ще одне<mark>зауваження</mark>. Я навмисно не торкаюся нині такі повноваження управління стандартної серіалізацією, як визначення <code class=" language-none">readObject</code>і <code class=" language-none">writeObject</code>, т.к. вважаю ці методи до певної міри некоректними. Ці методи не визначені в інтерфейсі <code class=" language-none">Serializable</code>і є фактично підпірками для обходу обмежень і надання стандартної серіалізації гнучкості. Натомість <code class=" language-none">Externalizable</code>методи, що забезпечують гнучкість, закладені спочатку. Задамося ще одним питанням. А як, власне, працює стандартна серіалізація з використанням<code class=" language-none">java.io.Serializable</code>? А працює вона через Reflection API. Тобто. клас розбирається як набір полів, кожне з яких пишеться у вихідний потік. Думаю, зрозуміло, що ця операція неоптимальна за продуктивністю. Наскільки саме – з'ясуємо пізніше. Між цими двома способами серіалізації існує ще одна серйозна відмінність. А саме – у механізмі десеріалізації. При використанні <code class=" language-none">Serializable</code>десеріалізації відбувається так: під об'єкт виділяється пам'ять, після чого його поля заповнюються значеннями потоку. Конструктор об'єкта у своїй не викликається. Тут треба ще окремо розглянути таку ситуацію. Добре, наш клас серіалізується. А його батько? Абсолютно необов'язково! Більше того, якщо успадкувати клас від <code class=" language-none">Object</code>- батько вже точно несеріалізується. І хай про поля<code class=" language-none">Object</code>ми нічого не знаємо, але у наших власних батьківських класах вони можуть бути. Що буде із ними? У потік серіалізації вони не потраплять. Які значення вони набудуть при десеріалізації? Подивимося цей приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">package</span></span> <span class="token namespace"><span class="token namespace">ru<span class="token punctuation"><span class="token punctuation">.</span></span>skipy<span class="token punctuation"><span class="token punctuation">.</span></span>tests<span class="token punctuation"><span class="token punctuation">.</span></span>io</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">/**
 * ParentDeserializationTest
 *
 * @author Eugene Matyushkin aka Skipy
 * @since 05.08.2010
 */</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">ParentDeserializationTest</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Creating..."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">Child</span></span> c <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Child</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span> baos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span> oos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            c<span class="token punctuation"><span class="token punctuation">.</span></span>field <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Serializing..."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">flush</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            baos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">flush</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            baos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">ByteArrayInputStream</span></span> bais <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toByteArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span> ois <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bais<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Deserializing..."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">Child</span></span> c1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Child</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1.i="</span></span><span class="token operator"><span class="token operator">+</span></span>c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getI</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1.field="</span></span><span class="token operator"><span class="token operator">+</span></span>c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getField</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> ex<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            ex<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> ex<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            ex<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Parent</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">int</span></span> field<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token class-name"><span class="token class-name">Parent</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            field <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">5</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Parent::Constructor"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">getField</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> field<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Child</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">Parent</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">int</span></span> i<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Child</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>i <span class="token operator"><span class="token operator">=</span></span> i<span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Child::Constructor"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">getI</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> i<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Він прозорий – у нас є несеріалізований батьківський клас та серіалізований дочірній. І ось що виходить: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Creating</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
<span class="token class-name"><span class="token class-name">Parent</span></span><span class="token operator"><span class="token operator">::</span></span><span class="token class-name"><span class="token class-name">Constructor</span></span>
<span class="token class-name"><span class="token class-name">Child</span></span><span class="token operator"><span class="token operator">::</span></span><span class="token class-name"><span class="token class-name">Constructor</span></span>
<span class="token class-name"><span class="token class-name">Serializing</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
<span class="token class-name"><span class="token class-name">Deserializing</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
<span class="token class-name"><span class="token class-name">Parent</span></span><span class="token operator"><span class="token operator">::</span></span><span class="token class-name"><span class="token class-name">Constructor</span></span>
c1<span class="token punctuation"><span class="token punctuation">.</span></span>i<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">1</span></span>
c1<span class="token punctuation"><span class="token punctuation">.</span></span>field<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">5</span></span></code></pre> Тобто при <strong>десеріалізації викликається конструктор без параметрів батьківського класу, що не серіалізується</strong> . І якщо такого конструктора не буде – при десеріалізації виникне помилка. Конструктор же дочірнього об'єкта, того, який ми десеріалізуємо, не викликається, як було сказано вище. Так поводяться стандартні механізми при використанні <code class=" language-none">Serializable</code>. При використанні <code class=" language-none">Externalizable</code>ситуація інша. Спочатку викликається конструктор без параметрів, а потім вже на створеному об'єкті викликається метод readExternal, який і вичитує, власне, всі свої дані. Тому - кожен реалізуючий інтерфейс Externalizable клас повинен мати громадський архітектор без властивостей! Більше того, оскільки всі спадкоємці такого класу теж будуть вважатися такими, що реалізують інтерфейс<code class=" language-none">Externalizable</code>, у них теж має бути конструктор без параметрів! Ходімо далі. Існує такий модифікатор поля, як <code class=" language-none">transient</code>. Він означає, що це поле не повинно бути серіалізованим. Однак, як ви самі розумієте, це вказує лише на стандартний механізм серіалізації. При використанні <code class=" language-none">Externalizable</code>ніхто не заважає серіалізувати це поле, так само як і віднімати його. Якщо поле оголошено transient, то при десеріалізації об'єкта воно набуває значення за замовчуванням. Ще один досить тонкий момент. При стандартній серіалізації поля, що мають модифікатор <code class=" language-none">static</code>, не серіалізуються. Відповідно, після десеріалізації це поле значення не змінює. Зрозуміло, при реалізації<code class=" language-none">Externalizable</code>серіалізувати та десеріалізувати це поле ніхто не заважає, проте я вкрай не рекомендую цього робити, тому що це не так. це може призвести до важких помилок. Поля з модифікатором <code class=" language-none">final</code>серіалізуються, як і звичайні. За одним винятком їх неможливо десеріалізувати при використанні Externalizable. Бо <code class=" language-none">final-поля</code>повинні бути ініціалізовані в конструкторі, а після цього в readExternal змінити значення цього поля буде неможливо. Відповідно – якщо вам необхідно серіалізувати об'єкт, що має<code class=" language-none">final</code>-поле, вам доведеться використовувати лише стандартну серіалізацію. Ще один момент, який багато хто не знає. При стандартній серіалізації враховується порядок оголошення полів у класі. У всякому разі, так було в ранніх версіях, в JVM версії 1.6 реалізації Oracle вже порядок неважливий, важливий тип та ім'я поля. Склад методів з дуже великою ймовірністю вплине на стандартний механізм, при тому, що поля можуть взагалі залишитися тими ж. Щоб уникнути цього, є наступний механізм. У кожен клас, що реалізує інтерфейс <code class=" language-none">Serializable</code>, на стадії компіляції додається ще одне поле -<code class=" language-none">private static final long serialVersionUID</code>. Це поле містить унікальну ідентифікатор версії серіалізованого класу. Воно обчислюється за вмістом класу – полям, їх порядку оголошення, методам, порядку оголошення. Відповідно, за будь-якої зміни в класі це поле змінить своє значення. Це поле записується в потік серіалізації класу. До речі, це, мабуть, єдиний відомий мені випадок, коли <code class=" language-none">static</code>поле серіалізується. При десеріалізації значення цього поля порівнюється з наявним у класу у віртуальній машині. Якщо значення не збігаються – ініціюється виняток на кшталт цього: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>InvalidClassException</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">test<span class="token punctuation"><span class="token punctuation">.</span></span>ser2<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>ChildExt</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    local <span class="token keyword"><span class="token keyword">class</span></span> incompatible<span class="token operator"><span class="token operator">:</span></span> stream classdesc serialVersionUID <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">8218484765288926197</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
                                   local <span class="token keyword"><span class="token keyword">class</span></span> serialVersionUID <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1465687698753363969</span></span></code></pre> Є, однак, спосіб цю перевірку якщо не охвабони, то обдурити. Це може бути корисним, якщо набір полів класу та його порядок вже визначено, а методи класу можуть змінюватися. У цьому випадку серіалізації нічого не загрожує, проте стандартний механізм не дасть десеріалізувати дані з використанням байткоду зміненого класу. Але, як я вже сказав, його можна обдурити. А саме – вручну у класі визначити поле<code class=" language-none">private static final long serialVersionUID</code>. У принципі значення цього поля може бути абсолютно будь-яким. Деякі вважають за краще ставити його рівним даті модифікації коду. Деякі взагалі використовують 1L. Для отримання стандартного значення (того, яке обчислюється внутрішнім механізмом) можна використовувати утиліту serialver, що входить до постачання SDK. Після такого визначення значення поля буде фіксовано, отже десеріалізація завжди буде дозволена. Більше того, у версії 5.0 у документації з'явилося приблизно таке: вкрай рекомендується всім серіалізованим класам декларувати це поле в явному вигляді, бо обчислення за умовчанням дуже чутливе до деталей структури класу, які можуть відрізнятися в залежності від реалізації компілятора, і викликати таким чином несподівані <code class=" language-none">InvalidClassException</code>при десеріалізації. Оголошувати це поле краще як<code class=" language-none">private</code>, т.к. воно відноситься виключно до класу, в якому оголошується. Хоча у специфікації модифікатора не обумовлено. Розглянемо тепер ось який аспект. Нехай у нас є така структура класів: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">A</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> iPublic<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">int</span></span> iProtected<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">int</span></span> iPackage<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> iPrivate<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">B</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">A</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Інакше кажучи, ми маємо клас, успадкований від несеріалізованого батька. Чи можна серіалізувати цей клас і що для цього треба? Що буде зі змінними батьківського класу? Відповідь така. Так, серіалізувати екземпляр класу <code class=" language-none">B</code>можна. Що для цього потрібно? А потрібно, щоб клас <code class=" language-none">A</code>був конструктор без параметрів, <code class=" language-none">public</code>або <code class=" language-none">protected</code>. Тоді при десеріалізації всі змінні класи <code class=" language-none">A</code>будуть ініціалізовані за допомогою конструктора. Змінні класи <code class=" language-none">B</code>будуть ініціалізовані значеннями потоку серіалізованих даних. Теоретично можна в класі <code class=" language-none">B</code>визначити методи, про які я говорив на початку – <code class=" language-none">readObject</code>і <code class=" language-none">writeObject</code>, – на початку яких проводити (де-)серіалізацію змінних класу <code class=" language-none">B</code>через<code class=" language-none">in.defaultReadObject/out.defaultWriteObject</code>, а потім – (де-)серіалізацію доступних змінних з класу <code class=" language-none">A</code>(у нашому випадку це <code class=" language-none">iPublic</code>, <code class=" language-none">iProtected</code>і <code class=" language-none">iPackage</code>якщо <code class=" language-none">B</code>знаходиться з тим же пакеті, що і <code class=" language-none">A</code>). Однак, на мій погляд, для цього краще використати розширену серіалізацію. Наступний момент, який я хотів би торкнутися – серіалізація кількох об'єктів. Нехай у нас є така структура класів: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">A</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">C</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">B</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span> c<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>c <span class="token operator"><span class="token operator">=</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">B</span></span> b<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>b <span class="token operator"><span class="token operator">=</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">C</span></span> <span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">return</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">B</span></span> <span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">return</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">B</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">C</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span> c<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>c <span class="token operator"><span class="token operator">=</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">C</span></span> <span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">return</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">C</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">A</span></span> a<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">B</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setA</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">A</span></span> a<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>a <span class="token operator"><span class="token operator">=</span></span> a<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">B</span></span> b<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>b <span class="token operator"><span class="token operator">=</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">B</span></span> <span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">return</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">A</span></span> <span class="token function"><span class="token function">getA</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token keyword"><span class="token keyword">return</span></span> a<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><img data-id="dbeed1cf-205a-4c73-873b-edba6db8aecf" data-max-width="350" alt="Серіалізація як вона є.  Частина 1 - 2" src="https://cdn.javarush.com/images/article/dbeed1cf-205a-4c73-873b-edba6db8aecf/256.jpeg" style="width: 350px;">Що станеться, якщо серіалізувати екземпляр класу <code class=" language-none">A</code>? Він потягне за собою екземпляр класу <code class=" language-none">B</code>, який, у свою чергу, потягне екземпляр <code class=" language-none">C</code>, який має посилання на екземпляр <code class=" language-none">A</code>, той самий, з якого все починалося. Замкнене коло та нескінченна рекурсія? На щастя ні. Подивимося на наступний тестовий код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// initiaizing</span></span>
<span class="token class-name"><span class="token class-name">A</span></span> a <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">A</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">B</span></span> b <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">B</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// setting references</span></span>
a<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
a<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
b<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
c<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setA</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>a<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
c<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// serializing</span></span>
<span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span> baos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span> oos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>a<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">flush</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// deserializing</span></span>
<span class="token class-name"><span class="token class-name">ObjectInputStream</span></span> ois <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toByteArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">A</span></span> a1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">A</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">B</span></span> b1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">B</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// testing</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"a==a1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>a<span class="token operator"><span class="token operator">==</span></span>a1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"b==b1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b<span class="token operator"><span class="token operator">==</span></span>b1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c==c1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token operator"><span class="token operator">==</span></span>c1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"a1.getB()==b1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>a1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>b1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"a1.getC()==c1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>a1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"b1.getC()==c1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1.getA()==a1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getA</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>a1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1.getB()==b1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>b1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Що ми робимо? Ми створюємо за екземпляром класів <code class=" language-none">A</code>, <code class=" language-none">B</code>і <code class=" language-none">C</code>, ставимо їм посилання один на одного, після чого серіалізуємо кожен з них. Потім ми десеріалізуємо їх і проводимо серію перевірок. Що вийде в результаті: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">a<span class="token operator"><span class="token operator">==</span></span>a1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span>
b<span class="token operator"><span class="token operator">==</span></span>b1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span>
c<span class="token operator"><span class="token operator">==</span></span>c1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span>
a1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>b1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
a1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
b1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getA</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>a1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
c1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getB</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>b1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span></code></pre> Отже, що можна отримати з цього тесту. Перше. Посилання на об'єкти після десеріалізації відрізняються від посилань до неї. Інакше висловлюючись, при серіалізації/десеріалізації об'єкт було скопійовано. Цей метод іноді використовується для клонування об'єктів. Другий висновок, більш істотний. При серіалізації/десеріалізації кількох об'єктів, що мають перехресні посилання, ці посилання залишаються дійсними після десеріалізації. Інакше кажучи, якщо до серіалізації вони вказували на один об'єкт, то після десеріалізації вони також вказуватимуть на один об'єкт. Ще один невеликий тест на підтвердження цього: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">B</span></span> b <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">B</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
b<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span> baos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span> oos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">flush</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
oos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">ObjectInputStream</span></span> ois <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>baos<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toByteArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">B</span></span> b1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">B</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c1 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c2 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">C</span></span> c3 <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">C</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>ois<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"b1.getC()==c1: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>b1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1==c2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c1<span class="token operator"><span class="token operator">==</span></span>c2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"c1==c3: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>c1<span class="token operator"><span class="token operator">==</span></span>c3<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Об'єкт класу <code class=" language-none">B</code>має посилання об'єкт класу <code class=" language-none">C</code>. При серіалізації <code class=" language-none">b</code>серіалізується разом з екземпляром класу <code class=" language-none">С</code>, після чого той самий екземпляр з серіалізується тричі. Що виходить після десеріалізації? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java">b1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getC</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>c1<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
c1<span class="token operator"><span class="token operator">==</span></span>c2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
c1<span class="token operator"><span class="token operator">==</span></span>c3<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span></code></pre> Як бачимо, всі чотири десеріалізовані об'єкти насправді є одним об'єктом – посилання на нього рівні. Як і було до серіалізації. Ще один цікавий момент – що буде, якщо одночасно реалізувати у класу <code class=" language-none">Externalizable</code>та <code class=" language-none">Serializable</code>? Як у тому питанні – слон проти кита – хто кого поборе? Поборе <code class=" language-none">Externalizable</code>. Механізм серіалізації спочатку перевіряє його наявність, а потім – наявність <code class=" language-none">Serializable</code>Так що якщо клас B, що реалізує <code class=" language-none">Serializable</code>, успадковується від класу A, що реалізує <code class=" language-none">Externalizable</code>, поля класу B серіалізовані не будуть. Останній момент – успадкування. При успадкування від класу, що реалізує <code class=" language-none">Serializable</code>, ніяких додаткових дій робити не треба. Серіалізація буде поширюватись і на дочірній клас. При наслідуванні від класу, що реалізує<code class=" language-none">Externalizable</code>Необхідно перевизначити методи батьківського класу readExternal і writeExternal. Інакше поля дочірнього класу не будуть серіалізовані. В цьому випадку треба б не забути викликати батьківські методи, інакше не будуть серіалізовані вже батьківські поля. * * * З деталями, мабуть, закінчабо. Однак є одне питання, яке ми не торкнулися, глобального характеру. А саме - 
<h2>Навіщо потрібний Externalizable</h2>Навіщо взагалі потрібна розширена серіалізація? Відповідь проста. По-перше, вона дає набагато більшу гнучкість. По-друге, найчастіше вона може дати чималий виграш за обсягом серіалізованих даних. По-третє, існує такий аспект як продуктивність, про який ми <a href="http://www.skipy.ru/technics/serialization.html#performance" rel="nofollow" target="_blank">поговоримо нижче</a> . З гнучкістю начебто зрозуміло все. Дійсно, ми можемо керувати процесами серіалізації та десеріалізації як хочемо, що робить нас незалежними від будь-яких змін у класі (як я говорив трохи вище, зміни у класі здатні сильно вплинути на десеріалізацію). Тому хочу сказати кілька слів про виграш за обсягом. Допустимо, у нас є наступний клас: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">DateAndTime</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>

  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">short</span></span> year<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">byte</span></span> month<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">byte</span></span> day<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">byte</span></span> hours<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">byte</span></span> minutes<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">byte</span></span> seconds<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Решта несуттєва. Поля можна було б зробити типу int, але це лише посаболо ефект прикладу. Хоча насправді поля можуть бути типу<code class=" language-none">int</code>з міркувань продуктивності. У будь-якому випадку суть зрозуміла. Клас являє собою дату та час. Нам він цікавий насамперед із погляду серіалізації. Можливо, найпростіше було б зберігати найпростіший часповітря. Він має тип long, тобто. при серіалізації він би зайняв 8 байт. З іншого боку, цей підхід вимагає методів перетворення компонент одне значення і назад, тобто. - Втрата у продуктивності. Плюс такого підходу – абсолютно божевільна дата, яка може поміститися у 64 біти. Це величезний запас міцності, найчастіше насправді не потрібний. Клас, наведений вище, займе 2 + 5 * 1 = 7 байт. Плюс службові витрати на клас та 6 полів. Чи можна якось утиснути ці дані? Напевно. Секунди та хвабони лежать в інтервалі 0-59, тобто. для їх подання достатньо 6 біт замість 8. Годинник – 0-23 (5 біт), дні – 0-30 (5 біт), місяці – 0-11 (4 біти). Усього, без урахування року – 26 біт. До розміру int залишається 6 біт. Теоретично, у деяких випадках цього може вистачити протягом року. Якщо ні – додавання ще одного байта збільшує обсяг поля даних до 14 біт, що дає проміжок 0-16383. Цього цілком достатньо в реальних додатках. Разом – ми зменшабо обсяг даних, необхідні зберігання необхідної інформації, до 5 байт. Якщо не до 4. Нестача та сама, що й у попередньому випадку – якщо зберігати дату упакованої, то потрібні методи перетворення. А хочеться так зберігати в окремих полях, а серіалізувати в упакованому вигляді. Ось тут доцільно використовувати Якщо ні – додавання ще одного байта збільшує обсяг поля даних до 14 біт, що дає проміжок 0-16383. Цього цілком достатньо в реальних додатках. Разом – ми зменшабо обсяг даних, необхідні зберігання необхідної інформації, до 5 байт. Якщо не до 4. Нестача та сама, що й у попередньому випадку – якщо зберігати дату упакованої, то потрібні методи перетворення. А хочеться так зберігати в окремих полях, а серіалізувати в упакованому вигляді. Ось тут доцільно використовувати Якщо ні – додавання ще одного байта збільшує обсяг поля даних до 14 біт, що дає проміжок 0-16383. Цього цілком достатньо в реальних додатках. Разом – ми зменшабо обсяг даних, необхідні зберігання необхідної інформації, до 5 байт. Якщо не до 4. Нестача та сама, що й у попередньому випадку – якщо зберігати дату упакованої, то потрібні методи перетворення. А хочеться так зберігати в окремих полях, а серіалізувати в упакованому вигляді. Ось тут доцільно використовувати а серіалізувати в упакованому вигляді. Ось тут доцільно використовувати а серіалізувати в упакованому вигляді. Ось тут доцільно використовувати<code class=" language-none">Externalizable</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// data is packed into 5 bytes:</span></span>
<span class="token comment"><span class="token comment">//  3         2         1</span></span>
<span class="token comment"><span class="token comment">// 10987654321098765432109876543210</span></span>
<span class="token comment"><span class="token comment">// hhhhhmmmmmmssssssdddddMMMMyyyyyy yyyyyyyy</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">writeExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectOutput</span></span> out<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">int</span></span> packed <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>hours<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">27</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>minutes<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">21</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>seconds<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">15</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>day<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>month<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    packed <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>year<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x3F</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>packed<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeByte</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>year<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">readExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectInput</span></span> in<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">int</span></span> packed <span class="token operator"><span class="token operator">=</span></span> in<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    year <span class="token operator"><span class="token operator">=</span></span> in<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readByte</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0xFF</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    year <span class="token operator"><span class="token operator">+=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x3F</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;&lt;</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    month <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x0F</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    day <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x1F</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    seconds <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">15</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x3F</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    minutes <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">21</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&amp;</span></span> <span class="token number"><span class="token number">0x3F</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    hours <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>packed <span class="token operator"><span class="token operator">&gt;&gt;</span></span> <span class="token number"><span class="token number">27</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Власне, це все. Після серіалізації ми отримуємо службові витрати на клас, два поля (замість 6) та 5 байт даних. Що вже значно краще. Подальшу упаковку можна залишити спеціалізованим бібліотекам. Наведений приклад дуже простий. Його основне призначення – показати як можна застосовувати розширену серіалізацію. Хоча можливий виграш в обсязі серіалізованих даних – далеко не основна перевага, як на мене. Основна ж перевага, крім гнучкості... (плавно переходимо до наступного розділу...) Посилання на першоджерело: <a href="http://www.skipy.ru/technics/serialization.html" rel="nofollow" target="_blank">Серіалізація як вона є</a>