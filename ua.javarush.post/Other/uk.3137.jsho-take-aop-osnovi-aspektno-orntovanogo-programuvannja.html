Що таке АОП? Основи аспектно-орієнтованого програмування
<p>----------------------------------------</p>
Hello, guys! Без розуміння основних концепцій досить складно вникнути у фреймворки та підходи до побудови функціоналу. Тому сьогодні поговоримо про одну з таких концепцій — АОП, або . Ця тема не з легких і нечасто застосовується безпосередн
<p>----------------------------------------</p>
Hello, guys! Без розуміння основних концепцій досить складно вникнути у фреймворки та підходи до побудови функціоналу. Тому сьогодні поговоримо про одну з таких концепцій — АОП, або <span class="text-bold">аспектно-орієнтоване програмування</span> . <img data-max-width="800" data-id="b8aa17e1-5346-43bc-a2ca-5ce20e153a23" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування." src="https://cdn.javarush.com/images/article/b8aa17e1-5346-43bc-a2ca-5ce20e153a23/800.jpeg" style="width: 800px;">Ця тема не з легких і нечасто застосовується безпосередньо, але у багатьох фреймворках та технологіях вона використовується під капотом. Ну і звичайно, іноді на співбесідах вас можуть попросити розповісти загалом, що це за звір такий і де його можна застосувати. Тому давайте розглянемо основні концепції та кілька нескладних прикладів <span class="text-bold">AOП на Java</span> . <img data-max-width="512" data-id="6d50d823-a86b-4220-893b-892974ad6eaa" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 2" src="https://cdn.javarush.com/images/article/6d50d823-a86b-4220-893b-892974ad6eaa/512.jpeg" style="width: 512px;">Отже, <span class="text-bold">АОП</span> - <span class="text-bold">аспектно-орієнтоване програмування</span>— це парадигма, спрямовану підвищення модульності різних частин програми з допомогою поділу наскрізних завдань. Для цього до вже існуючого коду додається додаткова поведінка, без змін у початковому коді. Іншими словами, ми ніби навішуємо зверху на методи і класи додаткову функціональність, не вносячи поправки в код, що модифікується. Навіщо це потрібно? Рано чи пізно ми приходимо до того, що звичайний об'єктно-орієнтований підхід не завжди може ефективно вирішити ті чи інші завдання. У такий момент на допомогу приходить <span class="text-bold">АОП</span> і дає нам додаткові інструменти для створення програми. А додаткові інструменти - це збільшення гнучкості при розробці, завдяки якій з'являється більше варіантів вирішення того чи іншого завдання.
<h2>Застосування АОП</h2>Аспектно-орієнтоване програмування призначене для вирішення наскрізних завдань, які можуть являти собою будь-який код, що багаторазово повторюється різними методами, який не можна повністю структурувати в окремий модуль. Відповідно, за допомогою <span class="text-bold">АОП</span> ми можемо залишити це за межами основного коду та визначити його по вертикалі. Як приклад можна навести застосування політики безпеки в будь-якій програмі. Як правило, безпека проходить крізь багато елементів програми. Тим більше, політика безпеки програми повинна застосовуватись однаково до всіх існуючих та нових частин програми. При цьому політика безпеки може й сама розвиватися. Ось тут нам відмінно може стати в нагоді використання <span class="text-bold">АОП</span>. Також як ще один приклад можна навести <a href="https://codegym.cc/groups/posts/2200-logirovanie-razmotatjh-klubok-stektreysa" target="_blank">логування</a> . Використання <span class="text-bold">АОП</span> підходу до логування має кілька переваг у порівнянні з ручною вставкою логування:
<ol>
 <li>Код для логування легко впроваджувати і видаляти: всього потрібно додати або видалити пару конфігурацій деякого аспекту.</li>
 <li>Весь вихідний код для логування зберігається в одному місці і не потрібно знаходити всі місця використання вручну.</li>
 <li>Код, призначений для логування, можна додати в будь-яке місце, будь то вже написані методи і класи або новий функціонал. Це зменшує кількість помилок розробника. <br>
   Також при видаленні аспекту конфігурації конструкції можна бути абсолютно впевненим, що весь код трасування видалений і нічого не пропущено.</li>
 <li>Аспекти - це винесений окремо код, який можна багаторазово перевикористовувати та покращувати.</li>
</ol><img data-max-width="512" data-id="e64da72b-9239-4681-9f8c-50a75d3b0302" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 3" src="https://cdn.javarush.com/images/article/e64da72b-9239-4681-9f8c-50a75d3b0302/512.jpeg" style="width: 512px;">Також АОП використовується для обробки винятків, кешування, винесення деякого функціоналу, щоб зробити його перевикористовуваним.
<h2>Основні поняття АОП</h2>Щоб просунутися далі у розборі теми, спочатку познайомимося з головними поняттями АОП. <span class="text-bold">Порада (advice)</span> – це додаткова логіка, код, який викликається з точки з'єднання. Порада може бути виконана до, після або замість точки з'єднання (про них нижче). Можливі <span class="text-bold">види порад</span> :
<ol>
 <li><span class="text-bold">Перед (Before)</span> - поради цього запускаються перед виконанням цільових методів - точок з'єднання. При використанні аспектів у вигляді класів ми беремо <span class="code">@Before</span> анотацію, щоб помітити тип поради як перед. При використанні аспектів як файлів <span class="text-bold">.aj</span> це буде метод <span class="code">before()</span> .</li>
 <li><span class="text-bold">Після (After)</span> — поради, які виконуються після завершення виконання методів — точок з'єднання як у звичайних випадках, так і при киданні виключення. <br>
   При використанні аспектів у вигляді класів ми можемо використовувати анотацію <span class="code">@After</span> для вказівки, що це порада, що йде після. <br>
   При використанні аспектів як файлів <span class="text-bold">.aj</span> це буде метод <span class="code">after()</span> .</li>
 <li><span class="text-bold">Після повернення (After Returning)</span> дані поради виконуються тільки в тому випадку, коли цільовий метод відпрацьовує нормально, без помилок. <br>
   Коли аспекти представлені у вигляді класів, ми можемо використовувати анотацію <span class="code">@AfterReturning</span> , щоб помітити пораду як після успішного завершення. <br>
   При використанні аспектів як файлів <span class="text-bold">.aj це буде метод <span class="code">after() returning (Object obj)</span> .</span></li>
 <li><span class="text-bold">Після кидання (After Throwing)</span> - даний вид порад призначений для тих випадків, коли метод, тобто точка з'єднання видає виняток. Ми можемо використовувати цю пораду для обробки невдалого виконання (наприклад, для відкату всієї транзакції або логування з необхідним рівнем трасування). <br>
   Для аспектів-класів анотація <span class="code">@AfterThrowing</span> використовується, щоб вказати, що ця порада використовується після кидка виключення. <br>
   При використанні аспектів як файлів <span class="text-bold">.aj</span> це буде метод — <span class="code">after() throwing (Exception e)</span> .</li>
 <li><span class="text-bold">Навколо (Around)</span> — мабуть, один із найважливіших видів порад, що оточує метод, тобто точку з'єднання, за допомогою якого ми можемо, наприклад, вибрати, виконувати даний метод точки з'єднання чи ні. <br>
   Можна написати код поради, який виконуватиметься до та після виконання методу точки з'єднання. <br>
   До обов'язків <span class="text-bold">around advice</span> входить виклик методу точки з'єднання та повернення значень, якщо метод щось повертає. Тобто в цій раді можна просто зімітувати роботу цільового методу, не викликаючи його, і як результат повернути щось своє. <br>
   При аспектах у вигляді класів використовуємо анотацію <span class="code">@Around</span> для створення порад, що обертають точку з'єднання. При використанні аспектів у вигляді файлів <span class="text-bold">.aj</span>це буде метод <span class="code">around()</span> .</li>
</ol><span class="text-bold">Точка з'єднання (join point)</span> — точка у програмі, що виконується (виклик методу, створення об'єкта, звернення до змінної), де слід застосувати пораду. Інакше висловлюючись, це деяке регулярне вираз, з допомогою якого й перебувають місця застосування коду (місця до застосування порад). <span class="text-bold">Зріз (pointcut)</span> - набір <span class="text-bold">точок з'єднання</span> . Зріз визначає, чи підходить ця точка з'єднання до цієї поради. <span class="text-bold">Аспект (aspect)</span> - модуль або клас, що реалізує наскрізну функціональність. Аспект змінює поведінку решти коду, застосовуючи <span class="text-bold">пораду</span> в <span class="text-bold">точках з'єднання</span> , визначених деяким <span class="text-bold">зрізом</span> . Іншими словами, це комбінація порад та точок з'єднання. <span class="text-bold">Впровадження (introduction)</span> — зміна структури класу та/або зміна ієрархії успадкування для додавання функціональності аспекту стороннього коду. <span class="text-bold">Мета (target)</span> - об'єкт, до якого застосовуватимуться поради. <span class="text-bold">Плетіння (weaving)</span> - це процес зв'язування аспектів з іншими об'єктами для створення проксі-об'єктів, що рекомендуються. Це можна зробити під час компіляції, завантаження або виконання. Є три види плетіння:
<ul>
 <li><span class="text-bold">плетіння під час компіляції</span> - якщо у вас є вихідний код аспекту та код, в якому ви використовуєте аспекти, ви можете скомпілювати вихідний код та аспект безпосередньо за допомогою компілятора AspectJ;</li>
 <li><span class="text-bold">посткомпіляційне плетіння</span> (бінарне плетіння) — якщо ви не можете або не хочете використати перетворення вихідного коду для вплетення аспектів у код, ви можете взяти вже скомпіловані класи або jar-файли та впровадити аспекти;</li>
 <li><span class="text-bold">Плетіння під час завантаження</span> - це просто бінарне плетіння, відкладене до моменту, коли завантажувач класів завантажить файл класу та визначить клас для JVM. <br>
   Для підтримки цього потрібно один або кілька «завантажувачів класів плетіння». Вони або явно надаються середовищем виконання, або активуються за допомогою агента плетіння.</li>
</ul><span class="text-bold">AspectJ</span> - конкретна реалізація парадигм <span class="text-bold">АОП</span> , що реалізує можливості вирішення наскрізних завдань. Документацію можна знайти ось <a href="https://www.eclipse.org/aspectj/doc/released/runtime-api/index.html" rel="nofollow" target="_blank">тут</a> .
<h2>Приклади в Java</h2>Для більшого розуміння <span class="text-bold">АОП</span> ми розглянемо невеликі приклади рівня Hello World. <img data-max-width="512" data-id="2c7885ae-f82c-4088-b1af-9ee6fe1329b8" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 4" src="https://cdn.javarush.com/images/article/2c7885ae-f82c-4088-b1af-9ee6fe1329b8/512.jpeg" style="width: 512px;">Відразу зазначу, що в наших прикладах використовуватимемо <span class="text-bold">плетіння під час компіляції</span> . Спершу нам потрібно прописати наступну залежність у нашому <span class="text-bold">pom.xml</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>aspectj<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>aspectjrt<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.9</span><span class="token number">.5</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span></code></pre> Як правило для використання аспектів застосовують спеціальний компілятор <span class="text-bold">Ajs</span> . У <span class="text-bold">IntelliJ IDEA</span> за замовчуванням його немає, тому при виборі його як компілятора програми потрібно вказати шлях дистрибутиву <span class="text-bold">AspectJ</span> . Докладніше про спосіб вибору <span class="text-bold">Ajs</span> як компілятора можна почитати на цій сторінці. Це був перший спосіб, а другий (яким і скористався) — прописати наступний плагін в <span class="text-bold">pom.xml</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
     <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>codehaus<span class="token punctuation">.</span>mojo<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>aspectj<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.7</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
           <span class="token generics"><span class="token punctuation">&lt;</span>complianceLevel<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>complianceLevel<span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">1.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span>showWeaveInfo<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>showWeaveInfo<span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span>verbose<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>verbose<span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xlint</span><span class="token punctuation">&gt;</span></span>ignore<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name">Xlint</span><span class="token operator">&gt;</span>
           <span class="token generics"><span class="token punctuation">&lt;</span>encoding<span class="token punctuation">&gt;</span></span>UTF<span class="token operator">-</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>encoding<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>executions<span class="token punctuation">&gt;</span></span>
           <span class="token generics"><span class="token punctuation">&lt;</span>execution<span class="token punctuation">&gt;</span></span>
              <span class="token generics"><span class="token punctuation">&lt;</span>goals<span class="token punctuation">&gt;</span></span>
                 <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>compile<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
                 <span class="token generics"><span class="token punctuation">&lt;</span>goal<span class="token punctuation">&gt;</span></span>test<span class="token operator">-</span>compile<span class="token operator">&lt;</span><span class="token operator">/</span>goal<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>goals<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span><span class="token operator">/</span>execution<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>executions<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span></code></pre> Після цього бажано зробити реімпорт у <a href="https://codegym.cc/groups/posts/2523-chastjh-4osnovih-maven" target="_blank">Мавена</a> та запустити <span class="text-bold">mvn clean compile</span> . А тепер перейдемо безпосередньо до прикладів.
<h3>Приклад №1</h3>Давайте створимо клас <span class="code">Main</span> . У ньому ми матимемо точку запуску та метод, який друкує в консолі передані йому імена: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printName</span><span class="token punctuation">(</span><span class="token string">"Толя"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printName</span><span class="token punctuation">(</span><span class="token string">"Вова"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printName</span><span class="token punctuation">(</span><span class="token string">"Саша"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Нічого складного: передали ім'я, вивели його в консолі. Якщо ми зараз запустимо, у консолі буде виведено: 
<div class="terminal">
 Толя Вова Саша
</div> Що ж, настав час скористатися можливостями АОП. Зараз нам потрібно створити файл - <span class="text-bold">аспект</span> . Вони бувають двох видів: перший - файл з розширенням <span class="text-bold">.aj</span> , другий - звичайний клас, який реалізує можливості <span class="text-bold">АОП</span> за допомогою анотацій. Давайте спершу розглянемо файл із розширенням <span class="text-bold">.aj</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> aspect <span class="token class-name">GreetingAspect</span> <span class="token punctuation">{</span>

  pointcut <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">execution</span><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Привет "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Цей файл чимось схожий на клас. Розберемося, що відбувається: <span class="code">pointcut</span> — зріз чи набір точок з'єднання; <span class="code">greeting()</span> - назва даного зрізу; <span class="code">: execution</span> - під час виконання <span class="code">*</span> - всіх, виклик - <span class="code">Main.printName(..)</span> - даного методу. Далі йде конкретна порада - <span class="code">before()</span> - який виконується до виклику цільового методу <span class="code">: greeting()</span> - зріз, на який ця порада реагує, ну а нижче ми бачимо саме тіло методу, яке написане зрозумілою нам мовою Java. При запуску <span class="code">main</span> з наявністю даного аспекту ми отримаємо висновок у консоль: 
<div class="terminal">
 Привіт Толя Привіт Вова Привіт Саша
</div> p align="justify"&gt; Ми бачимо, що кожен виклик методу <span class="code">printName</span> був модифікований за допомогою аспекту. А тепер давайте поглянемо, як виглядатиме аспект, але вже як клас Java з анотаціями: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetingAspect</span><span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* Main.printName(String))"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"greeting()"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Привет "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Після файлу аспекту <span class="text-bold">.aj</span> тут все очевидніше:
<ul>
 <li><span class="code">@Aspect</span> означає, що цей клас є аспектом;</li><span class="code">@Pointcut("execution(* Main.printName(String))")</span> — точка зрізу, яка спрацьовує на всі виклики <span class="code">Main.printName</span> з вхідним аргументом типу <span class="code">String</span> ; 
 <li><span class="code">@Before("greeting()")</span> — порада, яка застосовується до виклику коду, описаного в точці зрізу <span class="code">greeting()</span> .</li>
</ul>При запуску <span class="code">main</span> з цим аспектом виведення в консолі не зміниться: 
<div class="terminal">
 Привіт Толя Привіт Вова Привіт Саша
</div>
<h3>Приклад №2</h3>Припустимо, у нас є деякий метод, який здійснює деякі операції для клієнтів і виклик цього методу з <span class="code">main</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">makeSomeOperation</span><span class="token punctuation">(</span><span class="token string">"Толя"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">makeSomeOperation</span><span class="token punctuation">(</span><span class="token class-name">String</span> clientName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Выполнение некоторых операций для клиента - "</span> <span class="token operator">+</span> clientName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> За допомогою анотації <span class="code">@Around</span> зробимо щось на кшталт “псевдотранзакції”: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionAspect</span><span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* Main.makeSomeOperation(String))"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"executeOperation()"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeAdvice</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Открытие транзакции..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
        joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Закрытие транзакции...."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Операция не удалась, откат транзакции..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre> За допомогою методу <span class="code">proceed</span> об'єкта <span class="code">ProceedingJoinPoint</span> ми викликаємо метод, що обертається, щоб визначити його місце в раді і, відповідно, код у методі, який вище <span class="code">joinPoint.proceed(); </span>- це <span class="text-bold">Before</span> , який нижче - <span class="text-bold">After</span> . Якщо ми запустимо <span class="code">main</span> , в консолі ми отримаємо: 
<div class="terminal">
 Відкриття транзакції... Виконання деяких операцій для клієнта - Толя Закриття транзакції.
</div> Якщо ж ми додамо кидок виключення наш метод (раптом виконання операції дало збій): 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">makeSomeOperation</span><span class="token punctuation">(</span><span class="token class-name">String</span> clientName<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Выполнение некоторых операций для клиента - "</span> <span class="token operator">+</span> clientName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> То ми отримаємо висновок у консолі: 
<div class="terminal">
 Відкриття транзакції... Виконання деяких операцій для клієнта - Толя Операція не вдалася, відкат транзакції...
</div> Вийшла така собі псевдообробка невдачі.
<h3>Приклад №3</h3>Як наступний приклад зробимо щось типу логування в консолі. Для початку подивимося в <span class="code">Main</span> , де у нас відбувається псевдо бізнес-логіка: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> value<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
     <span class="token class-name">Main</span> main <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     main<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"&lt;некоторое значення&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">String</span> valueForCheck <span class="token operator">=</span> main<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     main<span class="token punctuation">.</span><span class="token function">checkValue</span><span class="token punctuation">(</span>valueForCheck<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> У <span class="code">main</span> за допомогою <span class="code">setValue</span> ми задамо значення внутрішньої змінної - <span class="code">value</span> , далі за допомогою <span class="code">getValue</span> візьмемо це значення і в <span class="code">checkValue</span> перевіримо, чи довше це значення 10 символів. Якщо так, буде кинуто виняток. Тепер подивимося на аспект, за допомогою якого ми логуватимемо роботу методів: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspect</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* *(..))"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodExecuting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"methodExecuting()"</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">"returningValue"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordSuccessfulExecution</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Object</span> returningValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>returningValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Успешно выполнен метод - %s, класса- %s, с результатом выполнения - %s\n"</span><span class="token punctuation">,</span>
              joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              joinPoint<span class="token punctuation">.</span><span class="token function">getSourceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWithinType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              returningValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Успешно выполнен метод - %s, класса- %s\n"</span><span class="token punctuation">,</span>
              joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              joinPoint<span class="token punctuation">.</span><span class="token function">getSourceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWithinType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"methodExecuting()"</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">"exception"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordFailedExecution</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Метод - %s, класса- %s, был аварийно завершен с исключением - %s\n"</span><span class="token punctuation">,</span>
           joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           joinPoint<span class="token punctuation">.</span><span class="token function">getSourceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWithinType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Що тут відбувається? <span class="code">@Pointcut("execution(* *(..))")</span> - буде з'єднуватися з усіма викликами всіх методів; <span class="code">@AfterReturning(value = "methodExecuting()", returning = "returningValue")</span> - порада, яка буде виконана після успішного виконання цільового методу. У нас тут є два випадки:
<ol>
 <li>Коли метод має повертається значення <span class="code">if (returningValue != null) {</span></li>
 <li>Коли значення, що повертається, немає <span class="code">else {</span></li>
</ol><span class="code">@AfterThrowing(value = "methodExecuting()", throwing = "exception")</span> - порада, яка спрацьовуватиме при помилці, тобто при падінні виключення з методу. І відповідно, запустивши <span class="code">main</span> , ми отримаємо своєрідне логування в консолі: 
<div class="terminal">
 Успішно виконаний метод - setValue, класу- Main Успішно виконаний метод - getValue, класу- Main, з результатом виконання - &lt; деяке значення&gt; Метод - checkValue, класу- Main, був аварійно завершений з винятком - java.lang.Exception Метод - main, класу- Main, був аварійно завершений з винятком - java.lang.Exception
</div> Ну і так як ми не обробабо винятки, ще отримаємо його стектрейс: <img data-max-width="512" data-id="91749db7-6e5f-4d97-860f-6fcdd46568ee" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 5" src="https://cdn.javarush.com/images/article/91749db7-6e5f-4d97-860f-6fcdd46568ee/512.jpeg" style="width: 512px;">Почитати про винятки та їх обробку можна в цих статтях: <a href="https://codegym.cc/groups/posts/2433-iskljuchenija-v-java" target="_blank">Винятки в Java</a> та <a href="https://codegym.cc/groups/posts/1401-iskljuchenija-i-ikh-obrabotka" target="_blank">Винятки та їх обробка</a> . На цьому сьогодні маю все. Сьогодні ми познайомабося з <span class="text-bold">АОП</span> , і ви змогли побачити, що цей звір не такий страшний, як його малюють. <span class="text-bold">Goodbye everyone!<span><img data-max-width="512" data-id="ca7a4493-3dfa-4416-ab61-a5edc3c96e6d" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 6" src="https://cdn.javarush.com/images/article/ca7a4493-3dfa-4416-ab61-a5edc3c96e6d/512.jpeg" style="width: 512px;"><a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="Що таке АОП?  Основи аспектно-орієнтованого програмування - 7" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a></span></span>