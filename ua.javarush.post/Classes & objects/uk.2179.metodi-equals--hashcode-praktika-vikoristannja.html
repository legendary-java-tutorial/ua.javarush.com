Методи equals & hashCode: практика використання
<p>----------------------------------------</p>
Вітання! Сьогодні ми поговоримо про два важливі методи Java - і . Ми зустрічаємося з ними не вперше: на початку курсу JavaRush була невелика про - прочитай її, якщо призабув або не зустрічав раніше. На сьогоднішньому ж занятті поговоримо пр
<p>----------------------------------------</p>
Вітання! Сьогодні ми поговоримо про два важливі методи Java - <code class=" language-none">equals()</code>і <code class=" language-none">hashCode()</code>. Ми зустрічаємося з ними не вперше: на початку курсу CodeGym була невелика <a href="https://codegym.cc/groups/posts/1923-equals-i-sravnenie-strok-" target="_blank">лекція</a> про <code class=" language-none">equals()</code>- прочитай її, якщо призабув або не зустрічав раніше. <img data-max-width="800" data-id="9613b68a-c1eb-4280-a5b7-d27d0ec1c64c" class="img-fluid" alt="Методи equals &amp;  hashCode: практика використання - 1" src="https://cdn.javarush.com/images/article/9613b68a-c1eb-4280-a5b7-d27d0ec1c64c/800.jpeg" style="width: 800px;">На сьогоднішньому ж занятті поговоримо про ці поняття докладно - повір, поговорити є про що! І перед тим, як переходити до нового, давай освіжити в пам'яті те, що вже проходабо :) Як ти пам'ятаєш, звичайне порівняння двох об'єктів через оператор ” – погана ідея, бо ” <code class=" language-none">==</code>порівнює <code class=" language-none">==</code>посилання. Ось наш приклад із машинами з нещодавньої лекції: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Car</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">int</span></span> maxSpeed<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">Car</span></span> car1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       car1<span class="token punctuation"><span class="token punctuation">.</span></span>model <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Ferrari"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       car1<span class="token punctuation"><span class="token punctuation">.</span></span>maxSpeed <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">300</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">Car</span></span> car2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       car2<span class="token punctuation"><span class="token punctuation">.</span></span>model <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Ferrari"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       car2<span class="token punctuation"><span class="token punctuation">.</span></span>maxSpeed <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">300</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>car1 <span class="token operator"><span class="token operator">==</span></span> car2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Виведення в консоль: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
false</code></pre> Здавалося б, ми створабо два ідентичні об'єкти класу <code class=" language-none">Car</code>: всі поля у двох машин однакові, але результат порівняння все одно false. Причина нам вже відома: посилання <code class=" language-none">car1</code>і <code class=" language-none">car2</code>вказують на різні адресаи в пам'яті, тому вони не є рівними. Ми ж хочемо порівняти два об'єкти, а не два посилання. Найкраще рішення для порівняння об'єктів - метод <code class=" language-none">equals()</code>. 
<h2>Метод equals()</h2>Можливо, ти пам'ятаєш, що цей метод ми не створюємо з нуля, а перевизначаємо — адже метод <code class=" language-none">equals()</code>визначено у класі <code class=" language-none">Object</code>. Однак у звичайному вигляді користі від нього мало: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> obj<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ось так метод <code class=" language-none">equals()</code>визначений у класі <code class=" language-none">Object</code>. Те саме порівняння посилань. Для чого його зробабо таким? Ну а звідки творцям мови знати, які об'єкти у твоїй програмі вважати рівними, а які ні? :) У цьому полягає основна ідея методу <code class=" language-none">equals()</code>- творець класу сам визначає характеристики, за якими перевіряється рівність об'єктів цього класу. Зробивши це, ти перевизначаєш метод <code class=" language-none">equals()</code>у своєму класі. Якщо тобі не зовсім зрозумілий сенс сам визначаєш характеристики, давай розглянемо приклад. Ось простий клас людини <code class=" language-none">Man</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Man</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> noseSize<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> eyesColor<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> haircut<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> scars<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> noseSize<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> eyesColor<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> haircut<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> scars<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> dnaCode<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>noseSize <span class="token operator"><span class="token operator">=</span></span> noseSize<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>eyesColor <span class="token operator"><span class="token operator">=</span></span> eyesColor<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>haircut <span class="token operator"><span class="token operator">=</span></span> haircut<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>scars <span class="token operator"><span class="token operator">=</span></span> scars<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>dnaCode <span class="token operator"><span class="token operator">=</span></span> dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token comment"><span class="token comment">//Геттери, сетери і т.д.</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Припустимо, ми пишемо програму, яка має визначати, чи є дві людини родичами-близнюками, чи це просто двійники. У нас є п'ять характеристик: розмір носа, колір очей, зачіска, наявність шрамів та результати біологічного тесту ДНК (для простоти у вигляді кодового числа). Як ти вважаєш, які з цих характеристик дозволять нашій програмі визначити родичів-близнюків? <img data-max-width="800" data-id="916b3fd9-cb03-4589-884d-34a5ac179d60" class="img-fluid" alt="Методи equals &amp;  hashCode: практика використання - 2" src="https://cdn.javarush.com/images/article/916b3fd9-cb03-4589-884d-34a5ac179d60/800.jpeg" style="width: 800px;">Зрозуміло, гарантію може дати лише біологічний тест. У двох людей може бути однаковий колір очей, зачіска, ніс, і навіть шрами — людей у ​​світі багато, і уникнути збігів неможливо. Нам же потрібний надійний механізм: лише результат ДНК-тесту дозволяє зробити точний висновок. Що ж це означає для нашого методу <code class=" language-none">equals()</code>? Нам потрібно його перевизначити у класі<code class=" language-none">Man</code>з урахуванням вимог нашої програми. Метод повинен порівнювати поле <code class=" language-none">int dnaCode</code>двох об'єктів, і якщо вони рівні, то й об'єкти рівні. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">Man</span></span> man <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dnaCode <span class="token operator"><span class="token operator">==</span></span> man<span class="token punctuation"><span class="token punctuation">.</span></span>dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Невже так просто? Не зовсім. Ми пропустабо дещо. В даному випадку для наших об'єктів ми визначабо лише одне «значуще» поле, за яким встановлюється їхня рівність — <code class=" language-none">dnaCode</code>. А тепер уяви, що таких «значних» полів у нас було б не 1, а 50. І якщо всі 50 полів у двох об'єктів рівні, то об'єкти рівні. Таке також може бути. Головна проблема в тому, що обчислення рівності 50 полів - витратний за часом та ресурсами процес. Тепер уяви, що крім класу <code class=" language-none">Man</code>у нас є клас <code class=" language-none">Woman</code>з такими ж полями, як і в <code class=" language-none">Man</code>. І якщо твоїми класами користуватиметься інший програміст, він запитто може написати у своїй програмі щось на кшталт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">Man</span></span> man <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//Купа параметрів у конструкторі</span></span>

   <span class="token class-name"><span class="token class-name">Woman</span></span> woman <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Woman</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token comment"><span class="token comment">//така ж купа параметрів.</span></span>

   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>man<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>woman<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Перевіряти значення полів у разі безглуздо: ми бачимо, що маємо об'єкти двох різних класів, і вони можуть бути рівні у принципі! Значить, у метод <code class=" language-none">equals()</code>нам потрібно помістити перевірку — порівняння об'єктів двох однакових класів. Добре, що ми про це подумали! 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Man</span></span> man <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dnaCode <span class="token operator"><span class="token operator">==</span></span> man<span class="token punctuation"><span class="token punctuation">.</span></span>dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Але, може, ми забули щось ще? Хм… Як мінімум, треба було б перевірити, що ми не порівнюємо об'єкт сам із собою! Якщо посилання А і Б вказують на одну адресау в пам'яті, це один і той же об'єкт, і нам теж не треба витрачати час і порівнювати 50 полів. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Man</span></span> man <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dnaCode <span class="token operator"><span class="token operator">==</span></span> man<span class="token punctuation"><span class="token punctuation">.</span></span>dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Крім того, не завадить додати перевірку на <code class=" language-none">null</code>: ніякий об'єкт не може дорівнювати <code class=" language-none">null</code>, і в такому випадку немає сенсу в додаткових перевірках. З урахуванням всього цього, наш метод <code class=" language-none">equals()</code>для класу <code class=" language-none">Man</code>виглядатиме так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">||</span></span> <span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Man</span></span> man <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Man</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dnaCode <span class="token operator"><span class="token operator">==</span></span> man<span class="token punctuation"><span class="token punctuation">.</span></span>dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми проводимо всі початкові перевірки, про які сказали вище. Якщо в результаті виявилося, що: 
<ul>
 <li>ми порівнюємо два об'єкти одного класу</li>
 <li>це не один і той самий об'єкт</li>
 <li>ми порівнюємо наш об'єкт не з<code class=" language-none">null</code></li>
</ul>...тоді переходимо до порівнянню значних характеристик. У нашому випадку – поля <code class=" language-none">dnaCode</code>двох об'єктів. Перевизначаючи метод <code class=" language-none">equals()</code>, обов'язково дотримуйся цих вимог: 
<ol>
 <li>
  <p>Рефлексивність.</p>
  <p>Будь-який об'єкт має бути <code class=" language-none">equals()</code>самому собі. <br>
    Ми вже врахували цю вимогу. У нашому методі вказано:</p>
  <p></p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre>
  <p></p></li>
 <li>
  <p>Симетричність.</p>
  <p>Якщо <code class=" language-none">a.equals(b) == true</code>, то й <code class=" language-none">b.equals(a)</code>має повертати <code class=" language-none">true</code>. <br>
    Цій вимогі наш метод теж відповідає.</p></li>
 <li>
  <p>Транзитивність.</p>
  <p>Якщо два об'єкти дорівнюють якомусь третьому об'єкту, значить, вони повинні дорівнювати один і одному. <br>
    Якщо , <code class=" language-none">a.equals(b) == true</code>значить <code class=" language-none">a.equals(c) == true</code>перевірка <code class=" language-none">b.equals(c)</code>теж повинна повертати true.</p></li>
 <li>
  <p>Постійність.</p>
  <p>Результати роботи <code class=" language-none">equals()</code>повинні змінюватися тільки при зміні полів, що входять до нього. Якщо дані двох об'єктів не змінювалися, результати перевірки <code class=" language-none">equals()</code>повинні бути завжди однаковими.</p></li>
 <li>
  <p>Нерівність с <code class=" language-none">null</code>.</p>
  <p>Це не просто набір якихось «корисних рекомендацій», а саме жорсткий <code class=" language-none">a.equals(null)</code>контракт <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" rel="nofollow" target="_blank">методів</a> , прописаний у документації Oracle<br><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" rel="nofollow" target="_blank"></a></p></li>
</ol><a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="59330fa6-8a41-42d5-ad6e-23137285212b" class="img-fluid" alt="Методи equals &amp;  hashCode: практика використання - 3" src="https://cdn.javarush.com/images/article/59330fa6-8a41-42d5-ad6e-23137285212b/1024.jpeg" style="width: 1024px;"></a>
<h2>Метод hashCode()</h2>Тепер поговоримо про метод <code class=" language-none">hashCode()</code>. Навіщо він потрібен? Рівно для тієї ж мети порівняння об'єктів. Але ж у нас уже є <code class=" language-none">equals()</code>! Навіщо ще один метод? Відповідь проста: підвищення продуктивності. Хеш-функція, яка представлена ​​Java методом <code class=" language-none">hashCode()</code>, повертає числове значення фіксованої довжини для будь-якого об'єкта. У випадку Java метод <code class=" language-none">hashCode()</code>повертає для будь-якого об'єкта 32-бітове число типу <code class=" language-none">int</code>. Порівняти два числа між собою набагато швидше, ніж порівняти два об'єкти методом <code class=" language-none">equals()</code>, особливо якщо в ньому використовується багато полів. Якщо в нашій програмі будуть порівнюватися об'єкти, набагато простіше зробити це за хеш-кодом, і тільки якщо вони рівні по <code class=" language-none">hashCode()</code>- переходити до порівняння<code class=" language-none">equals()</code>. Таким чином, до речі, працюють засновані на хеш структури даних - наприклад, відома тобі <code class=" language-none">HashMap</code>! Метод <code class=" language-none">hashCode()</code>, як і <code class=" language-none">equals()</code>, перевизначається самим розробником. І так само, як для <code class=" language-none">equals()</code>, для методу <code class=" language-none">hashCode()</code>є офіційні вимоги, прописані в документації Oracle: 
<ol>
 <li>
  <p>Якщо два об'єкти рівні (тобто метод <code class=" language-none">equals()</code>повертає true), вони мають бути однаковий хеш-код.</p>
  <p>Інакше наші методи будуть позбавлені сенсу. Перевірка по <code class=" language-none">hashCode()</code>, Як ми й сказали, повинна йти першою для підвищення швидкодії. Якщо хеш-коди будуть різними, перевірка поверне false, хоча об'єкти насправді рівні (згідно з нашим визначенням у методі <code class=" language-none">equals()</code>).</p></li>
 <li>
  <p>Якщо метод <code class=" language-none">hashCode()</code>викликається кілька разів на тому самому об'єкті, щоразу він повинен повертати те саме число.</p></li>
 <li>
  <p>Правило 1 не працює у зворотний бік. Одинаковий хеш-код може бути у двох різних об'єктів.</p></li>
</ol>Третє правило трохи збиває з пантелику. Як таке може бути? Пояснення досить просте. Метод <code class=" language-none">hashCode()</code>повертає <code class=" language-none">int</code>. <code class=" language-none">int</code>- Це 32-бітне число. Він має обмежену кількість значень — від -2,147,483,648 до +2,147,483,647. Іншими словами, всього існує трохи більше 4 мільярдів варіантів числа <code class=" language-none">int</code>. Тепер уяви, що ти створюєш програму для зберігання даних про всіх людей, що живуть на Землі. Кожній людині відповідатиме свій об'єкт класу <code class=" language-none">Man</code>. На землі мешкає ~7.5 мільярда людей. Іншими словами, який би хороший алгоритм перетворення об'єктів<code class=" language-none">Man</code>до числа ми не написали, нам просто не вистачить чисел. У нас лише 4,5 мільярда варіантів, а людей набагато більше. Отже, хоч би як ми намагалися, для якихось різних людей хеш-коди будуть однаковими. Така ситуація (збіг хеш-кодів у двох різних об'єктів) називається колізією. Одне із завдань програміста при перевизначенні методу <code class=" language-none">hashCode()</code>— скоротити потенційну кількість колізій наскільки це можливо. Яким же буде виглядати наш метод <code class=" language-none">hashCode()</code>для класу <code class=" language-none">Man</code>з урахуванням усіх цих правил? Ось так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dnaCode<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Здивований? :) Несподівано, але якщо ти подивишся на вимоги, побачиш, що ми дотримуємося всіх. Об'єкти, для яких наш <code class=" language-none">equals()</code>повертає true, будуть рівними і по <code class=" language-none">hashCode()</code>. Якщо два наші об'єкти <code class=" language-none">Man</code>будуть рівні <code class=" language-none">equals</code>(тобто у них однаковий <code class=" language-none">dnaCode</code>), наш метод поверне однакове число. Розглянемо приклад складніше. Допустимо, наша програма має відбирати елітні автомобілі для клієнтів-колекціонерів. Колекціонування – штука складна, і в ній багато особливостей. Автомобіль 1963 року випуску може коштувати у 100 разів дорожче, ніж той самий автомобіль 1964 року. Червоний автомобіль 1970 може коштувати в 100 разів дорожче, ніж синій автомобіль тієї ж марки того ж року. <img data-max-width="800" data-id="50868840-604e-46c9-8fe5-2d00e3073f6a" class="img-fluid" alt="Методи equals &amp;  hashCode: практика використання - 4" src="https://cdn.javarush.com/images/article/50868840-604e-46c9-8fe5-2d00e3073f6a/800.jpeg" style="width: 800px;">У першому випадку, з класом<code class=" language-none">Man</code>, ми відкинули більшість полів (тобто характеристик людини) як незначні і порівняння використовували лише поле <code class=" language-none">dnaCode</code>. Тут ми працюємо з дуже своєрідною сферою, і незначних деталей бути не може! Ось наш клас <code class=" language-none">LuxuryAuto</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>model <span class="token operator"><span class="token operator">=</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>manufactureYear <span class="token operator"><span class="token operator">=</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>dollarPrice <span class="token operator"><span class="token operator">=</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token comment"><span class="token comment">//...гетери, сетери і т.д.</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут при порівнянні ми маємо враховувати всі поля. Будь-яка помилка може коштувати сотні тисяч доларів для клієнта, тому краще перестрахуватися: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">||</span></span> <span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span> that <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">LuxuryAuto</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>manufactureYear <span class="token operator"><span class="token operator">!=</span></span> that<span class="token punctuation"><span class="token punctuation">.</span></span>manufactureYear<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>dollarPrice <span class="token operator"><span class="token operator">!=</span></span> that<span class="token punctuation"><span class="token punctuation">.</span></span>dollarPrice<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>that<span class="token punctuation"><span class="token punctuation">.</span></span>model<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У нашому методі <code class=" language-none">equals()</code>ми не забули всіх перевірок, про які говорабо раніше. Але тепер ми порівнюємо кожне із трьох полів наших об'єктів. У цій програмі рівність має бути абсолютною, по кожному полю. А що ж з <code class=" language-none">hashCode</code>? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">int</span></span> result <span class="token operator"><span class="token operator">=</span></span> model <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token operator"><span class="token operator">:</span></span> model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> result <span class="token operator"><span class="token operator">+</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> result <span class="token operator"><span class="token operator">+</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Поле <code class=" language-none">model</code>у ​​нашому класі – рядок. Це зручно: у класі <code class=" language-none">String</code>метод <code class=" language-none">hashCode()</code>уже перевизначено. Ми обчислюємо хеш-код поля <code class=" language-none">model</code>, а до нього додаємо суму двох інших числових полів. Java має одну невелику хитрість, яка використовується для скорочення кількості колізій: при обчисленні хеш-коду множити проміжний результат на непарне просте число. Найчастіше використовується число 29 або 31. Ми зараз не заглиблюватимемося в математичні тонкощі, але на майбутнє запам'ятай, що множення проміжних результатів на досить велике непарне число допомагає «розмазати» результати хеш-функції і отримати в результаті менше об'єктів з однаковим хешкодом. Для нашого методу <code class=" language-none">hashCode()</code>в LuxuryAuto це буде виглядати так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">int</span></span> result <span class="token operator"><span class="token operator">=</span></span> model <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token operator"><span class="token operator">:</span></span> model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span> <span class="token operator"><span class="token operator">*</span></span> result <span class="token operator"><span class="token operator">+</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span> <span class="token operator"><span class="token operator">*</span></span> result <span class="token operator"><span class="token operator">+</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Докладніше про всі тонкощі цього механізму можна прочитати <a href="https://stackoverflow.com/questions/3613102/why-use-a-prime-number-in-hashcode" rel="nofollow" target="_blank">в цьому пості на StackOverflow</a> , а також у Джошуа Блоха в книзі " <a href="https://www.amazon.com/dp/0321356683/?tag=stackoverfl08-20" rel="nofollow" target="_blank">Effective Java</a> ". Насамкінець ще один важливий момент, про який варто сказати. Щоразу при перевизначенні <code class=" language-none">equals()</code>і <code class=" language-none">hashCode()</code>ми вибирали певні поля об'єкта, які в цих методах враховувалися. Але чи можемо ми враховувати різні поля в <code class=" language-none">equals()</code>і <code class=" language-none">hashCode()</code>? Технічно, можемо. Але це погана ідея, і ось чому: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">||</span></span> <span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span> that <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">LuxuryAuto</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>manufactureYear <span class="token operator"><span class="token operator">!=</span></span> that<span class="token punctuation"><span class="token punctuation">.</span></span>manufactureYear<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> dollarPrice <span class="token operator"><span class="token operator">==</span></span> that<span class="token punctuation"><span class="token punctuation">.</span></span>dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">int</span></span> result <span class="token operator"><span class="token operator">=</span></span> model <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token operator"><span class="token operator">:</span></span> model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span> <span class="token operator"><span class="token operator">*</span></span> result <span class="token operator"><span class="token operator">+</span></span> manufactureYear<span class="token punctuation"><span class="token punctuation">;</span></span>
   result <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span> <span class="token operator"><span class="token operator">*</span></span> result <span class="token operator"><span class="token operator">+</span></span> dollarPrice<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ось наші методи <code class=" language-none">equals()</code>для <code class=" language-none">hashCode()</code>класу LuxuryAuto. Метод <code class=" language-none">hashCode()</code>залишився без змін, та якщо з методу <code class=" language-none">equals()</code>ми прибрали поле <code class=" language-none">model</code>. Тепер модель - не характеристика для порівняння двох об'єктів <code class=" language-none">equals()</code>. Але при розрахунку хеш-коду вона, як і раніше, враховується. Що ми отримаємо в результаті? Давай створимо два автомобілі та перевіримо! 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span> ferrariGTO <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ferrari 250 GTO"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1963</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">70000000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span> ferrariSpider <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LuxuryAuto</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ferrari 335 S Spider Scaglietti"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">1963</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">70000000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ці два об'єкти рівні один одному?"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrariGTO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrariSpider<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Які у них хеш-коди?"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrariGTO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ferrariSpider<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<pre class=" language-none" tabindex="0"><code class=" language-none">
Эти два об'єкта равны друг другу?
true
Какие у них хэш-коды?
-1372326051
1668702472</code></pre> Помилка! Використовуючи різні поля для <code class=" language-none">equals()</code>та <code class=" language-none">hashCode()</code>ми порушабо встановлений для них контракт! У двох рівних <code class=" language-none">equals()</code>об'єктів повинен бути однаковий хеш-код. Ми ж здобули для них різні значення. Подібні помилки можуть призвести до неймовірних наслідків, особливо при роботі з колекціями, що використовують хеш. Тому при перевизначенні <code class=" language-none">equals()</code>і <code class=" language-none">hashCode()</code>правильно буде використовувати одні й самі поля. Лекція вийшла чималенькою, але сьогодні ти дізнався багато нового! :) Саме час повернутися до вирішення завдань!