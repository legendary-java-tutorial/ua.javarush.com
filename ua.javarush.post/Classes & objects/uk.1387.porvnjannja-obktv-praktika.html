Порівняння об'єктів: практика
<p>----------------------------------------</p>
Це друга із статей, присвячених порівнянню об'єктів. У першій з них йшлося про теоретичний базис порівняння – як це робиться, чому і де використовується. У цій же статті йтиметься безпосередньо про порівняння чисел, об'єктів, про окремі вип
<p>----------------------------------------</p>
Це друга із статей, присвячених порівнянню об'єктів. У першій з них йшлося про теоретичний базис порівняння – як це робиться, чому і де використовується. У цій же статті йтиметься безпосередньо про порівняння чисел, об'єктів, про окремі випадки, тонкощі та неочевидні моменти. А якщо точніше, ми поговоримо ось про що: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="76d79372-ea50-4c16-bc8c-f18d95682094" data-max-width="710" alt="Порівняння об'єктів: практика - 1" src="https://cdn.javarush.com/images/article/76d79372-ea50-4c16-bc8c-f18d95682094/512.jpeg" style="width: 710px;">
 </div>
</div>
<ul>
 <li>Порівняння рядків: ' <code class=" language-none">==</code>і<code class=" language-none">equals</code></li>
 <li>Метод<code class=" language-none">String.intern</code></li>
 <li>Порівняння речових примітивів</li>
 <li><code class=" language-none">+0.0</code>і<code class=" language-none">-0.0</code></li>
 <li>Значення<code class=" language-none">NaN</code></li>
 <li>Java 5.0 Виробляючі методи та порівняння через ' <code class=" language-none">==</code>'</li>
 <li>Java 5.0 Autoboxing/Unboxing: ' <code class=" language-none">==</code>', ' <code class=" language-none">&gt;=</code>' і ' <code class=" language-none">&lt;=</code>' для об'єктних оболонок.</li>
 <li>Java 5.0 порівняння елементів перерахувань (тип <code class=" language-none">enum</code>)</li>
</ul>Отже, почнемо! 
<h2>Порівняння рядків: ' <code class=" language-none">==</code>і<code class=" language-none">equals</code></h2>Ах, ці рядки... Один з типів, що найчастіше використовуються, викликають при цьому чимало проблем. У принципі, про них є <a href="http://www.skipy.ru/technics/strings.html" rel="nofollow">окрема стаття</a> . А тут я торкнуся питань порівняння. Зрозуміло, що рядки можна порівнювати за допомогою <code class=" language-none">equals</code>. Більш того, їх потрібно порівнювати через <code class=" language-none">equals</code>. Однак є тонкощі, які варто знати. Насамперед, однакові рядки насправді є єдиним об'єктом. У чому легко переконатись, виконавши наступний код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> str1 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> str2 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>str1<span class="token operator"><span class="token operator">==</span></span>str2 <span class="token operator"><span class="token operator">?</span></span> <span class="token string"><span class="token string">"the same"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"not the same"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><strong>Результатом буде <em>"the same"</em></strong> . Що означає, що посилання рядки рівні. Це зроблено лише на рівні компілятора, очевидно, задля економії пам'яті. Компілятор створює один екземпляр рядка, і надає <code class=" language-none">str1</code>і <code class=" language-none">str2</code>посилання на цей екземпляр. Однак це стосується лише рядків, оголошених як літерали, у коді. Якщо скомпонувати рядок зі шматків, посилання на нього буде інше. Підтвердження – це приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> str1 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> str2 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"str"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> str3 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"ing"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>str1<span class="token operator"><span class="token operator">==</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>str2<span class="token operator"><span class="token operator">+</span></span>str3<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token string"><span class="token string">"the same"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"not the same"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><strong>Результатом буде <em>"not the same"</em></strong> . Також можна створити новий об'єкт за допомогою конструктора: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> str1 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> str2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>str1<span class="token operator"><span class="token operator">==</span></span>str2 <span class="token operator"><span class="token operator">?</span></span> <span class="token string"><span class="token string">"the same"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"not the same"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><strong>Результатом також буде <em>"not the same"</em> . </strong> Таким чином, іноді рядки можна порівнювати через порівняння посилань. Але на це краще не покладатися. Я хотів би торкнутися одного дуже цікавого методу, який дозволяє отримати так зване канонічне уявлення рядка – <code class=" language-none">String.intern</code>. Поговоримо про нього детальніше. 
<h2>Метод String.intern</h2>Почнемо з того, що клас <code class=" language-none">String</code>підтримує пул рядків. До цього пулу додаються всі рядкові літерали, визначені в класах, і не тільки вони. Так ось, метод <code class=" language-none">intern</code>дозволяє отримати з цього пулу рядок, який дорівнює наявному (той, у якого викликається метод <code class=" language-none">intern</code>) з точки зору <code class=" language-none">equals</code>. Якщо такого рядка в кулі не існує, то туди міститься існуюче, і повертається посилання на нього. Таким чином, якщо навіть посилання на два рівні рядки різні (як у двох прикладах вище), то виклики у цих рядків <code class=" language-none">intern</code>повернуть посилання на один і той же об'єкт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> str1 <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> str2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"string"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>str1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">intern</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">==</span></span>str2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">intern</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token string"><span class="token string">"the same"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"not the same"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><strong>Результатом виконання цього фрагмента коду буде <em>"the same"</em> . </strong> Я не можу сказати точно, навіщо це так. Метод <code class=" language-none">intern</code>- native, а в нетрі С-коду мені, чесно сказати, не хочеться. Швидше за все це зроблено для оптимізації споживання пам'яті та продуктивності. У будь-якому випадку, варто знати про цю особливість реалізації. Переходимо до наступної частини. 
<h2>Порівняння речових примітивів</h2>Для початку я хочу поставити запитання. Дуже простий. Чому дорівнює наступна сума - 0.3f + 0.4f? Чому? 0.7f? Перевіримо: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">float</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.7f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.3f</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token number"><span class="token number">0.4f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1==f2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f1<span class="token operator"><span class="token operator">==</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Як результат? Подобається? Мені теж. Для тих, хто не виконав цей фрагмент, скажу – результат... 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">f1<span class="token operator"><span class="token operator">==</span></span>f2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span></code></pre> Чому це відбувається?.. Виконаємо ще один тест: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">float</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.3f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.4f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f3 <span class="token operator"><span class="token operator">=</span></span> f1 <span class="token operator"><span class="token operator">+</span></span> f2<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f4 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.7f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1="</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f2="</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f3="</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>f3<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f4="</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">double</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>f4<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Зверніть увагу до приведення до <code class=" language-none">double</code>. Це зроблено для того, щоб вивести більше знаків після коми. Результат: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">f1<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">0.30000001192092896</span></span>
f2<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">0.4000000059604645</span></span>
f3<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">0.7000000476837158</span></span>
f4<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">0.699999988079071</span></span></code></pre> Власне, результат прогнозований. Подання дробової частини здійснюється за допомогою кінцевого ряду 2-n, а тому про точне уявлення довільно взятого числа говорити не доводиться. Як видно з прикладу, точність уявлення <code class=" language-none">float</code>– 7 знаків після коми. <em>Строго кажучи, у виставі </em><code class=" language-none">float</code> <em>на мантису відведено 24 біти. Таким чином, мінімальне за модулем число, яке можна представити за допомогою </em> <code class=" language-none">float</code> <em>(без урахування ступеня, бо ми говоримо про точність) – це 2-24≈6*10-8. Саме з таким кроком реально йдуть значення у виставі </em> <code class=" language-none">float</code><em>. А оскільки є квантування – є похибка. </em> Звідси висновок: числа у поданні<code class=" language-none">float</code>можна порівнювати лише з певною точністю. Я б рекомендував округлювати їх до 6-го знака після коми (10-6), або, що краще, перевіряв би <strong>абсолютне значення</strong> різниці між ними: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">float</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.3f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.4f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f3 <span class="token operator"><span class="token operator">=</span></span> f1 <span class="token operator"><span class="token operator">+</span></span> f2<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f4 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.7f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"|f3-f4|&lt;1e-6: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span> <span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">abs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f3<span class="token operator"><span class="token operator">-</span></span>f4<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">1e-6</span></span> <span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> І тут результат вселяє надію: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">|</span></span>f3<span class="token operator"><span class="token operator">-</span></span>f4<span class="token operator"><span class="token operator">|</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token number"><span class="token number">1e-6</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span></code></pre> Зрозуміло, точно та сама картина і з типом <code class=" language-none">double</code>. З єдиною різницею, що там на мантису відведено 53 біти, отже, точність уявлення – 2-53-10-16. Так, величина квантування значно менша, але вона є. І може зіграти злий жарт. До речі, у тестовій бібліотеці <a href="https://codegym.cc/groups/posts/605-junit" target="_blank">JUnit</a> у методах порівняння дійсних чисел точність вказується у явному вигляді. Тобто. Метод порівняння містить три параметри - число, чому воно має бути рівним і точність порівняння. <em>Ще до речі, хочу згадати про тонкість, пов'язану із записом чисел у науковому форматі, із зазначенням ступеня. Запитання. Як записати 10-6? Практика показує, що понад 80% відповідають – 10e-6. Тим часом правильна відповідь – 1e-6! А 10e-6 – це 10-5! Ми наступабо на ці граблі в одному із проектів, досить несподівано. Помилку шукали дуже довго, на константи дивабося разів 20. І ні в кого не виникло ні тіні сумніву в їхній правильності, поки одного разу, великою мірою випадково, константу 10e-3 не вивели на друк і не виявабо у неї після коми два знаки замість очікуваних трьох. А тому – будьте пильні! </em> Рухаємось далі. 
<h2>+0.0 та -0.0</h2>У поданні дійсних чисел старший біт є знаковим. А що буде, якщо всі інші біти дорівнюють 0? На відміну від цілих, де в такій ситуації виходить негативне число, що знаходиться на нижній межі діапазону уявлення, речове число тільки зі старшим бітом, виставленим в 1, теж означає 0, тільки зі знаком мінус. Таким чином, у нас є два нулі – +0.0 та -0.0. Виникає логічне питання – чи вважати ці числа рівними? Віртуальна машина вважає саме так. Однак це два <strong>різних</strong> числа, бо в результаті операцій з ними виходять різні значення: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">float</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0f</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token number"><span class="token number">1.0f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0f</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">1.0f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1="</span></span><span class="token operator"><span class="token operator">+</span></span>f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f2="</span></span><span class="token operator"><span class="token operator">+</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1==f2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f1<span class="token operator"><span class="token operator">==</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f3 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1.0f</span></span> <span class="token operator"><span class="token operator">/</span></span> f1<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">float</span></span> f4 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1.0f</span></span> <span class="token operator"><span class="token operator">/</span></span> f2<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f3="</span></span><span class="token operator"><span class="token operator">+</span></span>f3<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f4="</span></span><span class="token operator"><span class="token operator">+</span></span>f4<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> ... і результат: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">f1<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">0.0</span></span>
f2<span class="token operator"><span class="token operator">=</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">0.0</span></span>
f1<span class="token operator"><span class="token operator">==</span></span>f2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
f3<span class="token operator"><span class="token operator">=</span></span><span class="token class-name"><span class="token class-name">Infinity</span></span>
f4<span class="token operator"><span class="token operator">=</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token class-name"><span class="token class-name">Infinity</span></span></code></pre> Таким чином, у деяких випадках є сенс розцінювати +0.0 та -0.0 як два різні числа. А якщо у нас є два об'єкти, в одному з яких поле дорівнює +0.0, а в іншому -0.0 – ці об'єкти так само можна розцінювати як нерівні. Виникає питання – а як зрозуміти, що числа нерівні, якщо їхнє пряме порівняння віртуальною машиною дає <code class=" language-none">true</code>? Відповідь така. Незважаючи на те, що віртуальна машина вважає ці числа рівними, уявлення у них все ж таки відрізняються. Тому – єдине, що можна зробити, це порівняти уявлення. А для того, щоб його отримати, існують методи <code class=" language-none">int Float.floatToIntBits(float)</code>, <code class=" language-none">long Double.doubleToLongBits(double)</code>які повертають бітове уявлення у вигляді <code class=" language-none">int</code>і <code class=" language-none">long</code>відповідно (продовження попереднього прикладу): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> i1 <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Float</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">floatToIntBits</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">int</span></span> i2 <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Float</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">floatToIntBits</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1 (+0.0):"</span></span><span class="token operator"><span class="token operator">+</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toBinaryString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i2 (-0.0):"</span></span><span class="token operator"><span class="token operator">+</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toBinaryString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1==i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1 <span class="token operator"><span class="token operator">==</span></span> i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Результатом буде 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java">i1 <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">0</span></span>
i2 <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">10000000000000000000000000000000</span></span>
i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span></code></pre> Таким чином, якщо у вас +0.0 і -0.0 – різні числа, то порівнювати речові змінні слід через їхнє бітове уявлення. З +0.0 і -0.0 начебто розібралися. -0.0, проте, є єдиним сюрпризом. Є ще таке явище, як... 
<h2>Значення NaN</h2><code class=" language-none">NaN</code>розшифровується як <code class=" language-none">Not-a-Number</code>. Це значення у результаті некоректних математичних операцій, скажімо, поділу 0.0 на 0.0, нескінченності на нескінченність тощо. Особливістю цього значення є те, що воно не дорівнює самому собі. Тобто: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">float</span></span> x <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0f</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token number"><span class="token number">0.0f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"x="</span></span><span class="token operator"><span class="token operator">+</span></span>x<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"x==x: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>x<span class="token operator"><span class="token operator">==</span></span>x<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> ... дасть у результаті... 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java">x<span class="token operator"><span class="token operator">=</span></span><span class="token class-name"><span class="token class-name">NaN</span></span>
x<span class="token operator"><span class="token operator">==</span></span>x<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span></code></pre> Чим це може призвести до порівняння об'єктів? Якщо поле об'єкта дорівнюватиме <code class=" language-none">NaN</code>, то порівняння дасть <code class=" language-none">false</code>, тобто . об'єкти гарантовано вважатимуться нерівними. Хоча за логікою речей ми можемо хотіти якраз протилежного. Досягти потрібного результату можна, використовуючи метод <code class=" language-none">Float.isNaN(float)</code>. Він повертає <code class=" language-none">true</code>, якщо аргумент - <code class=" language-none">NaN</code>. На порівняння бітових уявлень я в цьому випадку не покладався, т.к. воно не стандартизоване. Мабуть, про примітиви вистачить. Перейдемо тепер до тонкощів, що з'явабося Java з версії 5.0. І перший момент, якого я хотів би торкнутися – 
<h2>Java 5.0 Виробляючі методи та порівняння через ' <code class=" language-none">==</code>'</h2>У проектуванні є шаблон, званий<strong> метод виробництва</strong><em></em>. Іноді його використання набагато вигідніше, ніж використання конструктора. Наведу приклад. Думаю, все добре знаю об'єктну оболонку <code class=" language-none">Boolean</code>. Цей клас незмінний, здатний містити лише два значення. Тобто, фактично, для будь-яких потреб вистачить лише двох примірників. І якщо їх створити заздалегідь, а потім просто повертати, це буде набагато швидше, ніж використання конструктора. Такий спосіб у <code class=" language-none">Boolean</code>є: <code class=" language-none">valueOf(boolean)</code>. З'явився він у версії 1.4. Подібні ж методи, що виробляють, були введені з версії 5.0 і в класах <code class=" language-none">Byte</code>, <code class=" language-none">Character</code>, <code class=" language-none">Short</code>, <code class=" language-none">Integer</code>і <code class=" language-none">Long</code>. При завантаженні цих класів створюються масиви їх екземплярів, що відповідають певним діапазонам значень примітивів. Діапазони такі: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c73693dc-ad41-413b-af79-448b315065bd" data-max-width="343" alt="Порівняння об'єктів: практика - 2" src="https://cdn.javarush.com/images/article/c73693dc-ad41-413b-af79-448b315065bd/256.jpeg" style="width: 343px;">
 </div>
</div>Це означає, що при використанні методу <code class=" language-none">valueOf(...)</code>при попаданні аргументу в зазначений діапазон завжди буде повертатися той самий об'єкт. Можливо, це дає якесь збільшення швидкості. Але при цьому виникають проблеми такого характеру, що докопатися до суті досить складно. Читайте про це далі. <em>Теоретично виробляючий метод <code class=" language-none">valueOf</code>доданий і до класів <code class=" language-none">Float</code>і<code class=" language-none">Double</code>. У тому описі сказано, що й потрібен новий екземпляр, краще користуватися цим шляхом, т.к. він може дати збільшення швидкості і т.д. і т.п. Однак у поточної (Java 5.0) реалізації цьому методі створюється новий екземпляр, тобто. збільшення швидкості його використання не дасть гарантовано. Більше того, мені важко уявити, як можна прискорити цей метод, бо через безперервність значень кеш там не організуєш. Хіба що для цілих чисел. У сенсі, без дрібної частини.</em>
<h2>Java 5.0 Autoboxing/Unboxing: ' <code class=" language-none">==</code>', ' <code class=" language-none">&gt;=</code>' і ' <code class=" language-none">&lt;=</code>' для об'єктних оболонок.</h2>Підозрюю, що виробляючі методи та кеш екземплярів були додані в оболонки для цілих примітивів для оптимізації операцій <code class=" language-none">autoboxing/unboxing</code>. Нагадаю, що це таке. Якщо операції повинен брати участь об'єкт, а бере участь примітив, цей примітив автоматично обертається в об'єктну оболонку. Це <code class=" language-none">autoboxing</code>. І навпаки – якщо в операції повинен брати участь примітив, то можна підставити туди об'єктну оболонку, і значення автоматично з неї буде розгорнуто. Це <code class=" language-none">unboxing</code>. <em>Звичайно, за таку зручність треба платити. Операції автоматичного перетворення дещо уповільнюють швидкість роботи програми. Однак до поточної теми це не стосується, тому залишимо це питання.</em> Все добре до тих пір, поки ми маємо справу з операціями, що однозначно відносяться до примітивів або оболонок. А що буде з операцією ' <code class=" language-none">==</code>'? Припустимо, у нас є два об'єкти <code class=" language-none">Integer</code>, з однаковим значенням усередині. Як вони порівнюватимуть? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Integer</span></span> i1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Integer</span></span> i2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1==i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Результат: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java">i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span>

Кто бы сомневался<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span> Сравниваются они як об'єкты<span class="token punctuation"><span class="token punctuation">.</span></span> А если так<span class="token operator"><span class="token operator">:</span></span></code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Integer</span></span> i1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Integer</span></span> i2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1==i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Результат: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span></code></pre> Ось це вже цікавіше! При <code class=" language-none">autoboxing</code>повертаються однакові об'єкти! Ось тут і знаходиться пастка. Якось виявивши, що повертаються однакові об'єкти, ми почнемо експериментувати, щоб перевірити, чи це завжди так. І скільки ми перевіримо значень? Одне? Десять? Сто? Швидше за все обмежимося сотнею в кожний бік навколо нуля. І скрізь отримаємо рівність. Здавалося б, усе гаразд. Однак, подивіться трохи назад, ось <a href="http://www.skipy.ru/technics/objCompPr.html#ranges" rel="nofollow">сюди</a> . Здогадалися, в чому підступ?.. Так, екземпляри об'єктних оболонок при <strong>autoboxing-і</strong> створюються за допомогою методів, що виробляють. Що добре ілюструється наступним тестом: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">AutoboxingTest</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">int</span></span> numbers<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">int</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">129</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">128</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token number"><span class="token number">127</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token number"><span class="token number">128</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> number <span class="token operator"><span class="token operator">:</span></span> numbers<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">Integer</span></span> i1 <span class="token operator"><span class="token operator">=</span></span> number<span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">Integer</span></span> i2 <span class="token operator"><span class="token operator">=</span></span> number<span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"number="</span></span> <span class="token operator"><span class="token operator">+</span></span> number <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">": "</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>i1 <span class="token operator"><span class="token operator">==</span></span> i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Результат буде таким:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">number<span class="token operator"><span class="token operator">=</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">129</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span>
number<span class="token operator"><span class="token operator">=</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">128</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
number<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">127</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
number<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">128</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span></code></pre> Для значень, що потрапляють в <a href="http://www.skipy.ru/technics/objCompPr.html#ranges" rel="nofollow">діапазон кешування,</a> повертаються однакові об'єкти, для тих, що знаходяться поза ним, – різні. А отже, якщо десь у додатку порівнюватимуть оболонки замість примітивів – є шанс отримати найстрашнішу помилку: плаваючу. Тому що тестувати код, швидше за все, також будуть на обмеженому діапазоні значень, в якому ця помилка не виявиться. А в реальній роботі вона то виявлятиметься, то зникатиме, залежно від результатів якихось обчислень. Простіше збожеволіти, ніж знайти таку помилку. А тому – я б радив уникати autoboxing-а де тільки можна. І це не все. Згадаймо математику, що не далі ніж 5-го класу. Нехай виконуються нерівності <code class=" language-none">A&gt;=B</code>та <code class=" language-none">А&lt;=B</code>. Що можна сказати про ставлення <code class=" language-none">A</code>та<code class=" language-none">B</code>? Тільки одне – вони рівні. Чи згодні? Думаю так. Запускаємо тест: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Integer</span></span> i1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Integer</span></span> i2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1&gt;=i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token operator"><span class="token operator">&gt;=</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1&lt;=i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token operator"><span class="token operator">&lt;=</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"i1==i2: "</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><strong>Результат:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java">i1<span class="token operator"><span class="token operator">&gt;=</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
i1<span class="token operator"><span class="token operator">&lt;=</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">true</span></span>
i1<span class="token operator"><span class="token operator">==</span></span>i2<span class="token operator"><span class="token operator">:</span></span> <span class="token boolean"><span class="token boolean">false</span></span></code></pre> І ось це для мене – найбільша дивина. Я взагалі не розумію, навіщо було вводити в мову цю нагоду, якщо вона вносить такі протиріччя. Загалом, повторю ще раз - якщо є можливість обійтися без <code class=" language-none">autoboxing/unboxing</code>, то варто цю можливість використовувати на повну котушку. Остання тема, яку я хотів би торкнутися, це... <strong>Java 5.0. порівняння елементів перерахувань (тип enum)</strong> Як відомо, з версії 5.0 Java з'явився такий тип як <strong>enum</strong> – перерахування. Його екземпляри за промовчанням містять ім'я та порядковий номер в оголошенні екземпляра у класі. Відповідно, при зміні порядку оголошення номера змінюються. Однак, як я вже <a href="http://www.skipy.ru/technics/serialization.html#enum_ser" rel="nofollow">говорив</a> у статті <a href="http://www.skipy.ru/technics/serialization.html" rel="nofollow">'Серіалізація як вона є'</a>, це не викликає проблем. Усі елементи перерахування існують у єдиному екземплярі, це контролюється лише на рівні віртуальної машини. Тому їх можна порівнювати безпосередньо за посиланнями. * * * Мабуть, це все на сьогодні про практичний бік реалізації порівняння об'єктів. Можливо, я щось упустив. Як завжди, чекаю коментарів! А поки що дозвольте відкланятися. Всім дякую за увагу! <em>Посилання на першоджерело: <a href="http://www.skipy.ru/technics/objCompPr.html" rel="nofollow">Порівняння об'єктів: практика</a></em>