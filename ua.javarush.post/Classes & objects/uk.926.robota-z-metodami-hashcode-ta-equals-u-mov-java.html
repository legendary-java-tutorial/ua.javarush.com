Робота з методами hashCode() та equals() у мові Java
<p>----------------------------------------</p>
У цьому пості викладу своє розуміння методів і . Я хочу розповісти про їхню реалізацію за умовчанням, а також про те, як коректно перевизначити їх. Я також напишу про реалізацію цих методів, використовуючи Apache Common package's допоміжні 
<p>----------------------------------------</p>
У цьому пості викладу своє розуміння методів <code class=" language-none">hashCode()</code>і <code class=" language-none">equals()</code>. Я хочу розповісти про їхню реалізацію за умовчанням, а також про те, як коректно перевизначити їх. Я також напишу про реалізацію цих методів, використовуючи Apache Common package's допоміжні класи. <img data-id="27f0db45-7c24-4d76-832e-88f203cd1300" data-max-width="850" alt="Робота з методами hashCode() та equals() у мові Java - 1" src="https://cdn.javarush.com/images/article/27f0db45-7c24-4d76-832e-88f203cd1300/800.jpeg" style="width: 850px;"><strong>Зміст цієї посади:</strong>
<ol>
 <li>Використання <code class=" language-none">hashCode()</code>та <code class=" language-none">equals()</code>.</li>
 <li>Перевизначення стандартної поведінки.</li>
 <li>Перевизначення <code class=" language-none">hashCode()</code>та <code class=" language-none">equals()</code>, використовуючи Apache Commons Lang.</li>
 <li>Те, що важливо пам'ятати.</li>
 <li>Особлива увага При використанні ORM.</li>
</ol>Методи <code class=" language-none">hashCode()</code>були <code class=" language-none">equals()</code>визначені в класі <code class=" language-none">Object</code>, який є батьківським класом для об'єктів java. Тому всі java об'єкти успадковують від цих методів реалізацію за умовчанням.
<h2>Використання hashCode() та equals()</h2>Метод <code class=" language-none">hashCode()</code>використовується для отримання цілого цілого номера для даного об'єкта. Коли необхідно зберегти об'єкт як структуру даних у якійсь хеш-таблиці (такий об'єкт також називають кошиком - bucket), цей номер використовується для визначення його місцезнаходження у цій таблиці. За промовчанням метод <code class=" language-none">hashCode()</code>об'єкта повертає номер комірки пам'яті, де об'єкт зберігається. Метод <code class=" language-none">equals()</code>, як і з його назви, використовується для простої перевірки рівності двох об'єктів. Реалізація цього методу за замовчуванням просто перевіряє за посиланнями два об'єкти щодо їх еквівалентності. 
<h2>Перевизначення поведінки за промовчанням</h2>Все працює добре, поки ви не перевизначаєте жоден з цих методів у своїх класах. Але іноді в програмах необхідно змінювати стандартну поведінку деяких об'єктів. Давайте візьмемо приклад, де у вашому додатку є об'єкт <code class=" language-none">Employee</code>. Давайте напишемо мінімально можливу структуру такого класу. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>id <span class="token operator"><span class="token operator">=</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getFirstname</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setFirstname</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> firstname<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>firstname <span class="token operator"><span class="token operator">=</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>lastName <span class="token operator"><span class="token operator">=</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getDepartment</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setDepartment</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> department<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>department <span class="token operator"><span class="token operator">=</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Описаний вище клас <code class=" language-none">Employee</code>має деякі основні атрибути та методи доступу. Зараз розглянемо просту ситуацію, де необхідно порівняти два об'єкти класу <code class=" language-none">Employee</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">EqualsTest</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Employee</span></span> e1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Employee</span></span> e2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        e1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        e2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token comment"><span class="token comment">//Печатает false в консоли</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Не треба бути ясновидячим, щоб здогадатися, що написаний вище метод поверне “false”. Але чи правильно це насправді, враховуючи, що ці обидва об'єкти однакові? У реальному часі application метод повинен повернути true. Щоб досягти коректної поведінки, нам потрібно перевизначити метод <code class=" language-none">equals()</code>, як і зроблено нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token class-name"><span class="token class-name">Employee</span></span> e <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">==</span></span> e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Додайте цей метод до свого класу <code class=" language-none">Employee</code>, і перевірка на еквівалентність поверне “true”. Однак, чи ми все зробабо? Поки немає. Перевіримо наш модифікований клас ще одним способом. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HashSet</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Set</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">EqualsTest</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Employee</span></span> e1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Employee</span></span> e2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        e1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        e2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token comment"><span class="token comment">//Печатает 'true'</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token class-name"><span class="token class-name">Set</span></span> employees <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HashSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        employees<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        employees<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token comment"><span class="token comment">//Печатает два об'єкта</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>employees<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Команда <code class=" language-none">System.out.println(employee)</code>друкує два об'єкти. Якщо обидва об'єкти були еквівалентні, а <code class=" language-none">Set</code>містяться тільки унікальні об'єкти, то всередині <code class=" language-none">HashSet</code>повинен бути тільки один екземпляр, тобто. обидва об'єкти посилаються на однакові екземпляри класу <code class=" language-none">Employee</code>. Що ж ми пропустабо? Ми пропустабо другий важливий метод <code class=" language-none">hashCode()</code>. Як сказано в документації java, якщо ви перевизначаєте спосіб <code class=" language-none">equals()</code>, то ви повинні перевизначити спосіб <code class=" language-none">hashCode()</code>. Отже, давайте додамо ще один метод у наш клас <code class=" language-none">Employee</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
 <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">int</span></span> PRIME <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">int</span></span> result <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    result <span class="token operator"><span class="token operator">=</span></span> PRIME <span class="token operator"><span class="token operator">*</span></span> result <span class="token operator"><span class="token operator">+</span></span> <span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми додали один раз цей метод до нашого класу, і на друк буде виведено лише один об'єкт, і, таким чином, перевірка еквівалентності е1 та е2 показала true. 
<h2>Перевизначення <code class=" language-none">hashCode()</code>та <code class=" language-none">equals()</code>, використовуючи Apache Commons Lang</h2>Apache Commons надає два чудові допоміжні класи для виклику методів <code class=" language-none">hashCode()</code>і <code class=" language-none">equals()</code>. Нижче дивимося використання: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>apache<span class="token punctuation"><span class="token punctuation">.</span></span>commons<span class="token punctuation"><span class="token punctuation">.</span></span>lang3<span class="token punctuation"><span class="token punctuation">.</span></span>builder<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">EqualsBuilder</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>apache<span class="token punctuation"><span class="token punctuation">.</span></span>commons<span class="token punctuation"><span class="token punctuation">.</span></span>lang3<span class="token punctuation"><span class="token punctuation">.</span></span>builder<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HashCodeBuilder</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
 <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>id <span class="token operator"><span class="token operator">=</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getFirstname</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setFirstname</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> firstname<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>firstname <span class="token operator"><span class="token operator">=</span></span> firstname<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>lastName <span class="token operator"><span class="token operator">=</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getDepartment</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">setDepartment</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> department<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>department <span class="token operator"><span class="token operator">=</span></span> department<span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">hashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
 <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">int</span></span> PRIME <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">31</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HashCodeBuilder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">%</span></span><span class="token number"><span class="token number">2</span></span><span class="token operator"><span class="token operator">==</span></span><span class="token number"><span class="token number">0</span></span><span class="token operator"><span class="token operator">?</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token operator"><span class="token operator">+</span></span><span class="token number"><span class="token number">1</span></span><span class="token operator"><span class="token operator">:</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> PRIME<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
           <span class="token function"><span class="token function">toHashCode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
 <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> <span class="token function"><span class="token function">getClass</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">Employee</span></span> e <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Employee</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> o<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">EqualsBuilder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
              <span class="token function"><span class="token function">append</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>
              <span class="token function"><span class="token function">isEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
 <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> З іншого боку, якщо ви використовуєте один з редакторів коду, вони також повинні бути здатні викликати деякі хороші структури для вас. Наприклад, якщо в Eclipse IDE натиснути правою клавішею на <em>class &gt;&gt; sourse &gt; Generating hashCode() and equals() …</em> буде згенерована дуже хороша реалізація для вас. <img data-id="d56dbce5-b4b8-4f42-a7d5-7c64f833f10c" data-max-width="300" alt="Робота з методами hashCode() та equals() у мові Java - 2" src="https://cdn.javarush.com/images/article/d56dbce5-b4b8-4f42-a7d5-7c64f833f10c/256.jpeg" style="width: 300px;"><strong>Те, що важливо пам'ятати.</strong>
<ol>
 <li>Завжди використовуйте самі атрибути об'єкта для виклику та <code class=" language-none">hashCode()</code>та <code class=" language-none">equals()</code>. Саме в нашому випадку ми використовували <code class=" language-none">employee id</code>.</li>
 <li>Метод <code class=" language-none">equals()</code>має бути стійким (якщо об'єкт не змінювався, метод повинен повертати те саме значення).</li>
 <li>Щоразу, коли <code class=" language-none">a.equals(b)</code>, то <code class=" language-none">a.hashCode()</code>має бути таким же, як <code class=" language-none">b.hashCode()</code>.</li>
 <li>Якщо ви перевизначабо один метод, то обов'язково маємо перевизначити другий.</li>
</ol>
<h2>Особлива Увага При використанні ORM</h2>Якщо ви маєте справу з ORM (ru.wikipedia.org/wiki/ORM), то завжди використовуйте гетери і ніколи не використовуйте в <code class=" language-none">hashCode()</code>і <code class=" language-none">equals()</code>посилання на поля. Це тому, що в ORM, іноді поля завантажуються за допомогою відкладеного завантаження (lazy load) і не доступні, поки не викликані їх гетери. Наприклад, у нашому класі <code class=" language-none">Employee</code>ми використовуємо <code class=" language-none">e1.id == e2.id</code>. Цілком можливо, що поля <code class=" language-none">i</code>d завантажені за допомогою відкладеного завантаження. Одне з полів може бути 0 або null і ми отримаємо некоректну поведінку. Але якщо використовується <code class=" language-none">e1.getId() == e2.getId()</code>, ми можемо бути впевнені, навіть якщо поля були завантажені за допомогою відкладеного завантаження; виклик геттера першим заповнить поле. Це все, що я знаю про методи <code class=" language-none">hashCode()</code>і<code class=" language-none">equals()</code>. Сподіваюся, що це десь комусь допоможе. Успіхів в навчанні!! ps Це моя перша спроба перекладу. Постаралася передати якомога ближче до того, що хотів сказати автор. Якщо є зауваження, будь ласка, напишіть у коментарях. Строго не судіть :-))) <a href="http://howtodoinjava.com/2012/10/09/working-with-hashcode-and-equals-methods-in-java/" rel="nofollow" target="_blank">Oригінал статті</a>