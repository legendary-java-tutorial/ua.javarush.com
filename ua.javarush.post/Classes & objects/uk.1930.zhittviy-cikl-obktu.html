Життєвий цикл об'єкту
<p>----------------------------------------</p>
Вітання! Думаю, ти не сильно здивуєшся, якщо тобі сказати, що розмір пам'яті на твоєму комп'ютері обмежений:) Навіть жорсткий диск, який у рази більший за оперативну пам'ять, можна забити під зав'язку улюбленими іграми, серіалами та іншим. 
<p>----------------------------------------</p>
Вітання! Думаю, ти не сильно здивуєшся, якщо тобі сказати, що розмір пам'яті на твоєму комп'ютері обмежений:) Навіть жорсткий диск, який у рази більший за оперативну пам'ять, можна забити під зав'язку улюбленими іграми, серіалами та іншим. Щоб цього не сталося, необхідно стежити за поточним станом пам'яті і видаляти з комп'ютера непотрібні файли. Яке відношення до цього має програмування на Java? Пряме! Адже під час створення будь-якого об'єкта Java-машиною під нього виділяється пам'ять. У реальній великій програмі створюються десятки та сотні тисяч об'єктів, під кожен із яких у пам'яті виділяється свій шматочок.<img data-id="8b70deaf-eb68-4b2d-babd-e3ba2d2f0837" data-max-width="850" alt="Життєвий цикл об'єкту - 1" src="https://cdn.javarush.com/images/article/8b70deaf-eb68-4b2d-babd-e3ba2d2f0837/800.jpeg" style="width: 850px;">Але як ти думаєш, скільки є всі ці об'єкти? "Чи живуть" вони весь час, поки працює наша програма? Зрозуміло, що ні. За всіх переваг Java-об'єктів, вони не безсмертні :) Об'єкти мають власний життєвий цикл. Сьогодні ми трохи відпочинемо від написання коду і розглянемо цей процес :) Тим більше, що він є дуже важливим для розуміння роботи програми та розпорядження ресурсами. Отже, з чого починається життя об'єкта? Як і в людини — з її народження, тобто створення. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Cat</span></span> cat <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Cat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token comment"><span class="token comment">//вот сейчас и начался життєвий цикл нашего об'єкта Cat!</span></span></code></pre> Спочатку віртуальна Java-машина виділяє необхідний обсяг пам'яті створення об'єкта. Потім вона створює на нього посилання, в нашому випадку — <code class=" language-none">cat</code>щоб мати можливість його відстежувати. Після цього відбувається ініціалізація всіх змінних, виклик конструктора і ось наш свіжий об'єкт вже живе своїм життям :) Термін життя у об'єктів різний, точних цифр тут не існує. У будь-якому випадку, протягом якогось часу він живе всередині програми та виконує свої функції. Якщо говорити точно, об'єкт є "живим" поки що на нього є посилання. Як тільки посилань не залишається - об'єкт "вмирає". Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Car</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>model <span class="token operator"><span class="token operator">=</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">Car</span></span> lamborghini  <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Lamborghini Diablo"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       lamborghini <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У способі <code class=" language-none">main()</code>об'єкт машини Lamborghini Diablo перестає бути живим вже на другому рядку. На нього було лише одне посилання, а тепер це посилання було присвоєно <code class=" language-none">null</code>. Оскільки на Lamborghini Diablo не залишилося посилань, він стає "сміттям". Посилання при цьому не обов'язково обнулювати: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Car</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> model<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>model <span class="token operator"><span class="token operator">=</span></span> model<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">Car</span></span> lamborghini  <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Lamborghini Diablo"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">Car</span></span> lamborghiniGallardo <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Car</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Lamborghini Gallardo"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       lamborghini <span class="token operator"><span class="token operator">=</span></span> lamborghiniGallardo<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут ми створабо другий об'єкт, після чого взяли посилання <code class=" language-none">lamborghini</code>і надали їй цей новий об'єкт. Тепер об'єкт <code class=" language-none">Lamborghini Gallardo</code>вказує два посилання, але в об'єкт <code class=" language-none">Lamborghini Diablo</code>— жодної. Тому об'єкт <code class=" language-none">Diablo</code>стає сміттям. І в цей момент в роботу вступає вбудований механізм Java під назвою збирач сміття, або інакше - Garbage Collector, GC. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="90f951c8-7932-4b1b-91d8-ba17fae210fc" data-max-width="850" alt="Життєвий цикл об'єкта - 2" src="https://cdn.javarush.com/images/article/90f951c8-7932-4b1b-91d8-ba17fae210fc/800.jpeg" style="width: 850px;">
 </div>
</div>Складальник сміття – внутрішній механізм Java, який відповідає за звільнення пам'яті, тобто видалення з неї непотрібних об'єктів. Ми не дарма вибрали для його зображення картинку з роботом-пилососом. Адже збирач сміття працює приблизно так само: у фоновому режимі він їздить за твоєю програмою, збирає сміття, і при цьому ти з ним практично не взаємодієш. Його робота – видаляти об'єкти, які вже не використовуються у програмі. Таким чином, він звільняє в комп'ютері пам'ять для інших об'єктів. Пам'ятаєш на початку лекції ми говорабо, що у звичайному житті тобі доводиться стежити за станом твого комп'ютера та видаляти старі файли? Так от, у випадку з Java-об'єктами збирач сміття робить це замість тебе. Garbage Collector запускається багаторазово протягом роботи твоєї програми: його не треба викликати спеціально та віддавати команди, хоча технічно це можливо. Пізніше ми ще поговоримо про нього та розберемо процес його роботи детальніше. У момент, коли збирач сміття дістався об'єкта, перед його знищенням, у об'єкта викликається спеціальний метод.<code class=" language-none">finalize()</code>. Його можна використовувати, щоб звільнити додаткові ресурси, які використовував об'єкт. Метод <code class=" language-none">finalize()</code>належить класу <code class=" language-none">Object</code>. Тобто, нарівні з <code class=" language-none">equals()</code>, <code class=" language-none">hashCode()</code>і <code class=" language-none">toString()</code>, з якими ти вже познайомився раніше, він має будь-який об'єкт. Його відмінність від інших методів у тому, що він... як би це сказати... дуже норовливий. А саме перед знищенням об'єкта він викликається далеко не завжди. Програмування – штука точна. Програміст каже комп'ютеру щось зробити – комп'ютер це робить. Ти, гадаю, вже звик до такої поведінки, і тобі спочатку може бути складно прийняти ідею: “Перед знищенням об'єктів викликається метод <code class=" language-none">finalize()</code>класу” <code class=" language-none">Object</code>. Або не викликається. Як пощастить!" Проте, це справді так. Java-машина сама визначає, викликати метод<code class=" language-none">finalize()</code>у кожному конкретному випадку чи ні. Наприклад, давай спробуємо заради експерименту запустити такий код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Cat</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Cat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>name <span class="token operator"><span class="token operator">=</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Cat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Throwable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">1000000</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

           <span class="token class-name"><span class="token class-name">Cat</span></span> cat <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Cat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           cat <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token comment"><span class="token comment">//вот здесь первый об'єкт становится доступен сборщику мусора</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">finalize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Throwable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Объект Cat уничтожен!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми створюємо об'єкт <code class=" language-none">Cat</code>і вже в наступному рядку коду обнулюємо єдине посилання на нього. І так – мільйон разів. Ми явно перевизначабо метод <code class=" language-none">finalize()</code>, і він повинен мільйон разів вивести рядок у консоль, щоразу перед знищенням об'єкта <code class=" language-none">Cat</code>. Але немає! Якщо бути точним, на моєму комп'ютері він відпрацював лише 37346 разів! Тобто тільки в одному випадку з 27-ми встановлена ​​у мене Java-машина приймала рішення викликати спосіб <code class=" language-none">finalize()</code>- в інших випадках складання сміття проходила без цього. Спробуй запустити цей код у себе: швидше за все, результат відрізнятиметься. Як бачиш, <code class=" language-none">finalize()</code>важко назвати надійним партнером :) Тому невелика порада на майбутнє: не варто покладатися на метод<code class=" language-none">finalize()</code>у випадку зі звільненням якихось критично важливих ресурсів. Може JVM його викличе, а може, ні. Хто знає? Якщо твій об'єкт за життя займав якісь суперважливі для продуктивності ресурси, наприклад, тримав відкритим з'єднання з базою даних, краще створи у своєму класі спеціальний метод для їх звільнення і виклич його явно, коли об'єкт вже буде не потрібен. Так ти точно знатимеш, що продуктивність твоєї програми не постраждає. На самому початку ми сказали, що робота з пам'яттю та видалення сміття є дуже важливими, і це дійсно так. Неналежна робота з ресурсами та нерозуміння процесу складання непотрібних об'єктів можуть призвести до витоку пам'яті. Це одна з найвідоміших помилок у програмуванні. Неправильно написаний програмістом код може призвести до того, що для новостворених об'єктів щоразу виділятиметься нова пам'ять, при цьому старі, непотрібні об'єкти будуть недоступні для видалення збирачем сміття. Якщо ми привели аналогію з роботом пилососом, уяви, що буде, якщо перед запуском робота розкидати по дому шкарпетки, розбити скляну вазу і залишити на підлозі розібраний конструктор Lego. Робот, звичайно, спробує щось зробити, але одного разу він застрягне. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f1d8aa4a-eff7-41c2-ac32-5753ac45bee3" data-max-width="850" alt="Життєвий цикл об'єкта - 3" src="https://cdn.javarush.com/images/article/f1d8aa4a-eff7-41c2-ac32-5753ac45bee3/800.jpeg" style="width: 850px;">
 </div>
</div>Для його правильної роботи потрібно тримати підлогу у нормальному стані та прибирати звідти все, з чим не впорається пилосос. За таким же принципом працює і збирач сміття. Якщо в програмі буде залишатися багато об'єктів, які він не може зібрати (як носок або Lego для робота-пилососа), одного разу пам'ять закінчиться. І зависне як написана тобою програма, а й інші програми, запущені у цей час на комп'ютері. Для них теж не вистачатиме пам'яті. <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="9d4b9d05-f0e1-4207-8d15-70af1d873b9b" class="img-fluid" alt="Життєвий цикл об'єкта - 4" src="https://cdn.javarush.com/images/article/9d4b9d05-f0e1-4207-8d15-70af1d873b9b/1024.jpeg" style="width: 1024px;"></a>Ось так виглядають у Java життєвий цикл об'єктів та збирач сміття. Це не треба заучувати: досить просто зрозуміти принцип роботи. У наступній лекції ми поговоримо про ці процеси докладніше, а поки що - можеш повернутися до вирішення задач CodeGym :) Успіхів!