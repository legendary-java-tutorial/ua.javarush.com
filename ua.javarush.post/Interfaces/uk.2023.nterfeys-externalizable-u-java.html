Інтерфейс Externalizable у Java
<p>----------------------------------------</p>
Вітання! Сьогодні ми продовжимо знайомство із серіалізацією та десеріалізацією об'єктів Java. Минулої лекції ми познайомилися з інтерфейсом-маркером , розглянули приклади його використання, а також дізналися, як можна керувати процесом сері
<p>----------------------------------------</p>
Вітання! Сьогодні ми продовжимо знайомство із серіалізацією та десеріалізацією об'єктів Java. Минулої лекції ми познайомабося з інтерфейсом-маркером <span class="code">Serializable</span> , розглянули приклади його використання, а також дізналися, як можна керувати процесом серіалізації за допомогою ключового слова <span class="code">transient</span> . Ну, «керувати процесом», звісно, ​​голосно сказано. У нас є одне ключове слово, один ідентифікатор версії, і взагалі все. Решта процесу «зашитий» всередину Java, і до нього доступу немає. З погляду зручності це, звісно, ​​добре. Але програміст у роботі повинен орієнтуватися не тільки на власний комфорт, чи не так? :) Є інші фактори, які потрібно враховувати. Тому <span class="code">Serializable</span>- Не єдиний інструмент для серіалізації-десеріалізації в Java. Сьогодні познайомимося з інтерфейсом <span class="code">Externalizable</span> . Але ще до того, як ми перейшли до його вивчення, у тебе могло виникнути резонне питання: а навіщо нам ще один інструмент? <code class=" language-none">Serializable</code>справлявся зі своєю роботою, та й автоматична реалізація всього процесу не може не тішити. Приклади, які ми розглянули, також не були складними. Так у чому ж справа? Навіщо ще один інтерфейс для по суті того ж завдання? Справа в тому, що <code class=" language-none">Serializable</code>має ряд недоліків. Перерахуємо деякі з них: 
<ol>
 <li>
  <p><strong>Продуктивність. </strong>У інтерфейсу <code class=" language-none">Serializable</code>багато плюсів, але висока продуктивність явно не з-поміж них.</p></li>
</ol><img data-id="907267fe-57bb-475e-835c-bf4be46d1291" data-max-width="850" alt="Ознайомлення з інтерфейсом Externalizable - 2" src="https://cdn.javarush.com/images/article/907267fe-57bb-475e-835c-bf4be46d1291/800.jpeg" style="width: 850px;">
<p style="margin-left:46px;"><strong>По-перше</strong> , внутрішній механізм <code class=" language-none">Serializable</code>під час роботи генерує великий обсяг службової інформації та різного роду тимчасових даних. <br><strong>По-друге</strong> (у це можеш зараз не заглиблюватися та почитати на дозвіллі, якщо цікаво), робота <code class=" language-none">Serializable</code>заснована на використанні Reflection API. Ця штуковина дозволяє робити, здавалося б, неможливі в Java речі: наприклад, змінювати значення приватних полів. На CodeGym є чудова <a href="https://codegym.cc/groups/posts/513-reflection-api-refleksija-temnaja-storona-java" target="_blank">стаття про Reflection API</a> , можеш почитати про неї тут.</p>
<ol>
 <li value="2">
  <p><strong>Гнучкість. </strong>Ми взагалі не керуємо процесом серіалізації-десеріалізації при використанні інтерфейсу <code class=" language-none">Serializable</code>.</p>
  <p>З одного боку, це дуже зручно, адже якщо нас не особливо турбує продуктивність, можливість не писати код видається зручною. Але якщо нам дійсно необхідно додати якісь свої фічі (приклад однієї з них буде нижче) в логіку серіалізації?</p>
  <p>По суті, все, що ми маємо для управління процесом, — це ключове слово <code class=" language-none">transient</code>для виключення будь-яких даних, і все. Такий собі інструментарій :/</p></li>
 <li>
  <p><strong>Безпека. </strong>Цей пункт частково випливає із попереднього.</p>
  <p>Ми раніше над цим особливо не замислювалися, але що робити, якщо якась інформація в твоєму класі не призначена для «чужих вух» (точніше, очей)? Простий приклад – пароль або інші персональні дані користувача, які у сучасному світі регулюються купою законів.</p>
  <p>Використовуючи <code class=" language-none">Serializable</code>ми за фактом нічого з цим зробити не можемо. Серіалізуємо все як є.</p>
  <p>Адже, по-хорошому, такі дані ми повинні зашифрувати перед записом у файл чи передачею через мережу. Але <code class=" language-none">Serializable</code>цієї можливості не надає.</p></li>
</ol><img data-id="18b6e742-a064-4d9e-84de-60f92cda200e" data-max-width="850" alt="Ознайомлення з інтерфейсом Externalizable - 3" src="https://cdn.javarush.com/images/article/18b6e742-a064-4d9e-84de-60f92cda200e/800.jpeg" style="width: 850px;">Що ж, давай нарешті подивимося, як виглядатиме клас із використанням інтерфейсу <code class=" language-none">Externalizable</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Externalizable</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ObjectInput</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ObjectOutput</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">UserInfo</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Externalizable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> firstName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> superSecretInformation<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">long</span></span> SERIAL_VERSION_UID <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1L</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">//...конструктор, геттеры, сеттеры, toString()...</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">writeExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectOutput</span></span> out<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">readExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectInput</span></span> in<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачиш, у нас з'явабося суттєві зміни! Головне з них очевидне: при імплементації інтерфейсу <code class=" language-none">Externalizable</code>ти маєш реалізувати два обов'язкові методи — <code class=" language-none"><strong>writeExternal()</strong></code>і<code class=" language-none"><strong>readExternal()</strong></code>. Як ми й казали раніше, вся відповідальність за серіалізацію та десеріалізацію лежатиме на програмісті. Але тепер ти можеш вирішити проблему відсутності контролю над цим процесом! Весь процес програмується безпосередньо тобою, що, звичайно, створює набагато більш гнучкий механізм. Крім того, вирішується проблема і з безпекою. Як бачиш, у нас у класі є поле: персональні дані, які не можна зберігати у незашифрованому вигляді. Тепер ми легко можемо написати код, який відповідає цьому обмеженню. Наприклад, додати до нашого класу два простих приватних методи для шифрування та дешифрування секретних даних. Записувати їх у файл та вичитувати з файлу ми будемо саме у зашифрованому вигляді. А решту даних будемо записувати і зчитувати як є :) В результаті наш клас буде виглядати приблизно так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Externalizable</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ObjectInput</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ObjectOutput</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Base64</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">UserInfo</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Externalizable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> firstName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> superSecretInformation<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">long</span></span> serialVersionUID <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1L</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">UserInfo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">UserInfo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> firstName<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> lastName<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> superSecretInformation<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>firstName <span class="token operator"><span class="token operator">=</span></span> firstName<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>lastName <span class="token operator"><span class="token operator">=</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>superSecretInformation <span class="token operator"><span class="token operator">=</span></span> superSecretInformation<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">writeExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectOutput</span></span> out<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getFirstName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encryptString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSuperSecretInformation</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">readExternal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ObjectInput</span></span> in<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       firstName <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> in<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       lastName <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> in<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       superSecretInformation <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">decryptString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> in<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">encryptString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> data<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">String</span></span> encryptedData <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Base64</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getEncoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encodeToString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encryptedData<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> encryptedData<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">decryptString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> data<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">String</span></span> decrypted <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Base64</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDecoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">decode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>decrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> decrypted<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getFirstName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> firstName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getLastName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> lastName<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getSuperSecretInformation</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> superSecretInformation<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми реалізували два методи, які в якості параметрів використовують ті ж <code class=" language-none"><strong>ObjectOutput</strong> out</code>і <code class=" language-none"><strong>ObjectInput</strong></code>, з якими ми вже зустрічалися в лекції о <code class=" language-none">Serializable</code>. У потрібний момент ми шифруємо або розшифровуємо необхідні дані, і у такому вигляді використовуємо їх для серіалізації нашого об'єкта. Подивимося, як це виглядатиме на практиці: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">FileOutputStream</span></span> fileOutputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"C:\\Users\\Username\\Desktop\\save.ser"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span> objectOutputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileOutputStream<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">UserInfo</span></span> userInfo <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">UserInfo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ivan"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Ivanov"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Ivan Ivanov's passport data"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       objectOutputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">writeObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>userInfo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       objectOutputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У методах <code class=" language-none"><strong>encryptString()</strong></code>ми <code class=" language-none"><strong>decryptString()</strong></code>спеціально додали висновок у консоль, щоб перевірити, в якому вигляді будуть записані і прочитані секретні дані. <strong>Код вище вивів у консоль рядок: <em>SXZhbiBJdmFub3YncyBwYXNzcG9ydCBkYXRh</em></strong> Шифрування вдалося! <strong>Повний зміст файлу виглядає так: <em>sr UserInfo!}ҐџC‚ћ xpt Ivant Ivanovt $SXZhbiBJdmFub3YncyBwYXNzcG9ydCBkYXRhx</em></strong> Тепер спробуємо використовувати написану нами логіку десеріалізації. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">FileInputStream</span></span> fileInputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"C:\\Users\\Username\\Desktop\\save.ser"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span> objectInputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileInputStream<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>


       <span class="token class-name"><span class="token class-name">UserInfo</span></span> userInfo <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">UserInfo</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> objectInputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>userInfo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       objectInputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ну, начебто нічого складного тут немає, має працювати! <strong>Запускаємо… <em>Exception in thread "main" java.io.InvalidClassException: UserInfo; no valid constructor</em></strong> <img data-id="e6228cd8-1dc0-4259-abc0-1f8ecf902dcc" data-max-width="850" alt="Ознайомлення з інтерфейсом Externalizable - 4" src="https://cdn.javarush.com/images/article/e6228cd8-1dc0-4259-abc0-1f8ecf902dcc/800.jpeg" style="width: 850px;"> Упс :( Все виявилося не так просто! Механізм десеріалізації викинув виняток і зажадав від нас створити конструктор за замовчуванням. Цікаво, навіщо? Ми <code class=" language-none">Serializable</code>обходабося і без нього… :/ Тут ми підійшли до ще одного важливого нюансу. Різниця між <code class=" language-none">Serializable</code>і <code class=" language-none">Externalizable</code>полягає не тільки в «розширеному» доступі для програміста та можливість більш гнучко керувати процесом, а й у самому процесі, насамперед <strong>у механізмі десеріалізації</strong> .<code class=" language-none">Serializable</code>під об'єкт просто виділяється пам'ять, після чого з потоку зчитуються значення, якими заповнюються всі поля. Якщо ми використовуємо <code class=" language-none">Serializable</code>конструктор об'єкта не викликається! Вся робота проводиться через рефлексію (Reflection API, яку ми миттю згадували в минулій лекції). У випадку <code class=" language-none">Externalizable</code>механізм десеріалізації буде іншим. Спочатку викликається конструктор за замовчуванням. І тільки потім у створеного об'єкта <code class=" language-none">UserInfo</code>викликається метод <code class=" language-none">readExternal()</code>, який відповідає за заповнення полів об'єкта. Саме тому <strong>будь-який клас, що імплементує інтерфейс <code class=" language-none">Externalizable</code>, повинен мати конструктор за замовчуванням</strong> . Додамо його в наш клас <code class=" language-none">UserInfo</code>і перезапустимо код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">FileInputStream</span></span> fileInputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"C:\\Users\\Username\\Desktop\\save.ser"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span> objectInputStream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileInputStream<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>


       <span class="token class-name"><span class="token class-name">UserInfo</span></span> userInfo <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">UserInfo</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> objectInputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">readObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>userInfo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       objectInputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Виведення в консоль: <em>Ivan Ivanov's passport data UserInfo{firstName='Ivan', lastName='Ivanov', superSecretInformation='Ivan Ivanov's passport data'}</em></strong> Зовсім інша річ! У консоль спочатку було виведено дешифрований рядок із секретними даними, а після наш відновлений з файлу об'єкт у рядковому форматі! Ось так ми успішно вирішабо всі проблеми :) Тема серіалізації та десеріалізації, здавалося б, нескладна, але лекції у нас вийшли, як бачиш, більшими. І це далеко ще не все! Є ще безліч тонкощів при використанні кожного з цих інтерфейсів, але щоб зараз у тебе не вибухав мозок від обсягу нової інформації, я коротко перерахую ще кілька важливих моментів і дам посилання на додаткове читання. Отже, що ще потрібно знати? <strong>По перше</strong>, при серіалізації (неважливо, використовуєш ти <code class=" language-none">Serializable</code>або <code class=" language-none">Externalizable</code>) звертай увагу на змінні <code class=" language-none">static</code>. При використанні <code class=" language-none">Serializable</code>ці поля взагалі не серіалізуються (і, відповідно, їх значення не змінюється, тому <code class=" language-none">static</code>поля належать класу, а не об'єкту). А ось при використанні <code class=" language-none">Externalizable</code>ти керуєш процесом сам, тому технічно це зробити можна. Але не рекомендується, тому що це загрожує важкими помилками. <strong>По-друге</strong> , увагу варто також звернути на змінні з модифікатором <code class=" language-none">final</code>. При використанні <code class=" language-none">Serializable</code>вони серіалізуються і десеріалізуються як завжди, а ось <strong>при використанні <code class=" language-none">Externalizable</code>десеріалізувати <code class=" language-none">final</code>змінну неможливо</strong> ! Причина проста: все<code class=" language-none">final</code>-поля ініціалізуються при виклику конструктора за замовчуванням, і після цього їх значення неможливо змінити. Тому для серіалізації об'єктів, що містять <code class=" language-none">final</code>поля, використовуй стандартну серіалізацію через <code class=" language-none">Serializable</code>. <strong>По-третє</strong> , при використанні успадкування всі класи-спадкоємці, що походять від якогось <code class=" language-none">Externalizable</code>класу, теж повинні мати конструктори за замовчуванням. Ось кілька посилань на добрі статті про механізми серіалізації: 
<ul>
 <li><a href="http://www.skipy.ru/technics/serialization.html#performance" rel="nofollow" target="_blank">Серіалізація як вона є</a> ;</li>
 <li><a href="https://habr.com/post/319604/" rel="nofollow" target="_blank">Серіалізація даних: тест продуктивності та опис застосування;</a></li>
 <li><a href="https://java2blog.com/serialversionuid-in-java-serialization/" rel="nofollow" target="_blank">serialVersionUID in java Serialization</a></li>
</ul> До зустрічі! :)