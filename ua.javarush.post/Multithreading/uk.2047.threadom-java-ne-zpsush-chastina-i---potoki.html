Thread'ом Java не зіпсуєш: Частина I - потоки
<p>----------------------------------------</p>
Багатопотоковість в Java була закладена з перших днів. Тому давайте коротко ознайомимося з тим, про що це багатопоточність. Візьмемо за точку відліку офіційний урок від Oracle: " ". Код нашого Hello World програми трохи змінимо на наступний
<p>----------------------------------------</p>
<h2>Вступ</h2>Багатопотоковість в Java була закладена з перших днів. Тому давайте коротко ознайомимося з тим, про що це багатопоточність. <img data-max-width="800" data-id="d11b1a73-0135-42f8-a780-056b8d124192" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 1" src="https://cdn.javarush.com/images/article/d11b1a73-0135-42f8-a780-056b8d124192/800.jpeg" style="width: 800px;">Візьмемо за точку відліку офіційний урок від Oracle: " <a href="https://docs.oracle.com/javase/tutorial/getStarted/cupojava/index.html" target="_blank" rel="nofollow">Lesson: The "Hello World!" Application</a> ". Код нашого Hello World програми трохи змінимо на наступний: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorldApp</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, "</span></span> <span class="token operator"><span class="token operator">+</span></span> args<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><code class=" language-none">args</code>- Це масив вхідних параметрів, що передаються при запуску програми. Збережемо цей код у файл з ім'ям, яке збігається з ім'ям класу та з розширенням <code class=" language-none">.java</code>. Після цього викличемо наш код з яким-небудь параметром, наприклад, Roger: У нашого коду <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javac.html" target="_blank" rel="nofollow">зараз</a> є серйозна вада. Якщо не передати жодного аргументу (тобто виконати просто java HelloWorldApp), ми отримаємо помилку: <code class=" language-none">javac HelloWorldApp.java</code><code class=" language-none">java HelloWorldApp Roger</code> <img data-max-width="512" data-id="4096999d-c3f3-4ca8-9bf0-2e3a4b72b0a6" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 2" src="https://cdn.javarush.com/images/article/4096999d-c3f3-4ca8-9bf0-2e3a4b72b0a6/512.jpeg" style="width: 512px;">
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Exception</span></span> in thread <span class="token string"><span class="token string">"main"</span></span> <span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>lang<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>ArrayIndexOutOfBoundsException</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">0</span></span>
        at <span class="token class-name"><span class="token class-name">HelloWorldApp</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HelloWorldApp</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>java<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span></code></pre> Виник виняток (тобто помилка) в thread (в потоці) з ім'ям <code class=" language-none">main</code>. Виходить, у Java є якісь потоки? Звідси розпочинається наш шлях. 
<h2>Java та потоки</h2>Щоб розібратися, що таке потік, треба зрозуміти, як відбувається запуск програми Java. Давайте змінимо наш код в такий спосіб: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorldApp</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
			<span class="token comment"><span class="token comment">//Do nothing</span></span>
		<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер давайте скомпілюємо це знову за допомогою javac. Далі для зручності запустимо Java код в окремому вікні. У Windows можна зробити так: <code class=" language-none">start java HelloWorldApp</code>. Тепер за допомогою утиліти <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jps.html" target="_blank" rel="nofollow">jps</a> подивимося, яку інформацію нам повідомить Java: <img data-max-width="512" data-id="11a50b18-bd63-4cbf-b69c-539be300aefc" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 3" src="https://cdn.javarush.com/images/article/11a50b18-bd63-4cbf-b69c-539be300aefc/512.jpeg" style="width: 512px;">Перше число – це PID або Process ID, ідентифікатор процесу. Що таке процес? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">Процесс — это совокупность кода и данных<span class="token punctuation"><span class="token punctuation">,</span></span> разделяющих общее виртуальное адресаное пространство<span class="token punctuation"><span class="token punctuation">.</span></span></code></pre> За допомогою процесів виконання різних програм ізольовано один від одного: кожна програма використовує свою область пам'яті, не заважаючи іншим програмам. Більш докладно раджу ознайомитись у статті: " <a href="https://habr.com/post/164487/" target="_blank" rel="nofollow">https://habr.com/post/164487/</a> ". Процес не може існувати без потоків, тому, якщо існує процес, у ньому існує хоча б один потік. Як це відбувається в Java? Коли ми запускаємо програму Java, її виконання починається з методу <code class=" language-none">main</code>. Ми хіба що входимо у програму, тому цей особливий метод <code class=" language-none">main</code>називається точкою входу, чи "entry point". Метод <code class=" language-none">main</code>завжди повинен бути <code class=" language-none">public static void</code>, щоб віртуальна машина Java (JVM) змогла розпочати виконання нашої програми. Докладніше див. " <a href="https://stackoverflow.com/questions/146576/why-is-the-java-main-method-static/151666#151666" target="_blank" rel="nofollow">Why is the Java main method static?"</a>Виходить, що java launcher (java.exe або javaw.exe) - це проста програма (simple C application): вона завантажує різні DLL, які насправді є JVM. Java launcher виконує певний набір Java Native Interface (JNI) викликів JNI - це механізм, що з'єднує світ віртуальної машини Java і світ C++ Виходить, що launcher - це не JVM, а її завантажувач Він знає, які правильні команди потрібно виконати, щоб запустилася JVM Знає, як організувати все необхідне оточення за допомогою JNI викликів У цю організацію оточення входить і створення головного потоку, який зазвичай називається, <code class=" language-none">main</code>щоб наочніше розглянути, які живуть потоки в java процесі, використовуємо <a href="https://visualvm.github.io/" target="_blank" rel="nofollow">програму</a>, яка входить до постачання JDK. Знаючи pid процесу, ми можемо відкрити дані відразу по ньому: <code class=" language-none">jvisualvm --openpid айдипроцесса</code> <img data-max-width="800" data-id="701b8cbb-5750-4efc-bdea-c2d19f629339" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 4" src="https://cdn.javarush.com/images/article/701b8cbb-5750-4efc-bdea-c2d19f629339/800.jpeg" style="width: 800px;">Цікаво, що кожен потік має свою відокремлену область пам'яті, виділеної для процесу. Цю структуру пам'яті називають стеком. Стек складається з фреймів. Фрейм це точка виклику методу, execution point. Також кадр може бути представлений як StackTraceElement (див. Java API для <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StackTraceElement.html" target="_blank" rel="nofollow">StackTraceElement</a> ). Докладніше про пам'ять, що виділяється кожному потоку, можна прочитати <a href="https://stackoverflow.com/questions/36898701/how-does-java-jvm-allocate-stack-for-each-thread" rel="nofollow" target="_blank">тут</a> . Якщо подивитися на <a href="https://docs.oracle.com/javase/8/docs/api/" target="_blank" rel="nofollow">Java API</a> і пошукати слово Thread, ми побачимо, що є клас <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html" target="_blank" rel="nofollow">java.lang.Thread</a> . Саме цей клас представляє в Java потік, і з ним нам і доведеться працювати. <img data-max-width="512" data-id="989d7446-4d6f-4b26-98b4-c2ab6243885f" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 5" src="https://cdn.javarush.com/images/article/989d7446-4d6f-4b26-98b4-c2ab6243885f/512.jpeg" style="width: 512px;">
<div class="email-subscription">
 <iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no" data-savepage-key="0-2"></iframe>
</div>
<h2>java.lang.Thread</h2>Потік Java представлений у вигляді екземпляра класу <code class=" language-none">java.lang.Thread</code>. Варто відразу розуміти, що екземпляри класу Thread в Java власними силами є потоками. Це лише свого роду API для низькорівневих потоків, якими управляє JVM та операційна система. Коли за допомогою java launcher'а ми запускаємо JVM, вона створює головний потік з ім'ям <code class=" language-none">main</code>та ще кілька службових потоків. Як сказано в JavaDoc класу Thread: <code class=" language-none">When a Java Virtual Machine starts up, there is usually a single non-daemon thread</code> Існує 2 типи потоків: демони і не демони. Демон-потоки - це фонові потоки (службові), які виконують якусь роботу на тлі. Такий цікавий термін - це посилання до "демону Максвелла", про що докладніше можна прочитати у вікіпедії у статті про " <a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B5%D0%BC%D0%BE%D0%BD_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0)" target="_blank" rel="nofollow">демонів</a> ". Як сказано в документації, JVM продовжує виконання програми (процесу), доки: 
<ul>
 <li>Не викликано методу <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Runtime.html#exit-int-" target="_blank" rel="nofollow">Runtime.exit</a></li>
 <li>Усі не демон-потоки завершабо свою роботу (як без помилок, так і з викиданням винятків)</li>
</ul>Звідси і важлива деталь: демон-потоки можуть бути завершені на будь-якій команді, що виконується. Тому цілісність даних у них не гарантується. Тому демон потоки підходять для якихось службових завдань. Наприклад, Java має потік, який відповідає за обробку методів finalize або потоки, що відносяться до збирача сміття (Garbage Collector, GC). Кожен потік входить у якусь групу ( <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadGroup.html" target="_blank" rel="nofollow">ThreadGroup</a> ). А групи можуть входити один в одного, утворюючи деяку ієрархію або структуру. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Thread</span></span> currentThread <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentThread</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">ThreadGroup</span></span> threadGroup <span class="token operator"><span class="token operator">=</span></span> currentThread<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getThreadGroup</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Thread: "</span></span> <span class="token operator"><span class="token operator">+</span></span> currentThread<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Thread Group: "</span></span> <span class="token operator"><span class="token operator">+</span></span> threadGroup<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Parent Group: "</span></span> <span class="token operator"><span class="token operator">+</span></span> threadGroup<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getParent</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Групи дозволяють упорядкувати керування потоками та вести їх облік. Крім груп, потоки мають свого обробника винятків. Погляньмо на приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Thread</span></span> th <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentThread</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	th<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUncaughtExceptionHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Thread<span class="token punctuation"><span class="token punctuation">.</span></span>UncaughtExceptionHandler</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
		<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">uncaughtException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Thread</span></span> t<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Throwable</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
			<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Виникла помилка: "</span></span> <span class="token operator"><span class="token operator">+</span></span> e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Поділ на нуль викликає помилку, яку буде перехоплено обробником. Якщо обробник не вказувати самому, відпрацює реалізація обробника за замовчуванням, яка в StdError виводитиме стек помилки. Детальніше можна прочитати в огляді <a href="http://pro-java.ru/java-dlya-opytnyx/obrabotchik-neperexvachennyx-isklyuchenij-java/" target="_blank" rel="nofollow">http://pro-java.ru/java-dlya-opytnyx/obrabotchik-neperexvachennyx-isklyuchenij-java/</a> ". Крім того, у потоку є пріоритет. Докладніше про пріоритети можна прочитати в статті " <a href="https://www.geeksforgeeks.org/java-thread-priority-multithreading/" target="_blank" rel="nofollow">Java Thread Priority в Multithreading</a> ". <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="48934eae-8399-4d0e-b431-3a74ace6bab3" class="img-fluid" alt="Thread'ом Java не зіпсуєш: Частина I - потоки - 6" src="https://cdn.javarush.com/images/article/48934eae-8399-4d0e-b431-3a74ace6bab3/1024.jpeg" style="width: 1024px;"></a>
<h2>Створення потоку</h2>Як і сказано в документації, у нас два способи створити потік. Перший – створити свого спадкоємця. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorld</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MyThread</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
        <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">run</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, World!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Thread</span></span> thread <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">MyThread</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        thread<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачимо, запуск завдання виконується у методі <code class=" language-none">run</code>, а запуск потоку у методі <code class=" language-none">start</code>. Не варто їх плутати, т.к. якщо ми запустимо метод <code class=" language-none">run</code>безпосередньо, ніякий новий потік не буде запущено. Саме метод <code class=" language-none">start</code>просить JVM створити новий потік. Варіант із нащадком від Thread поганий вже тим, що ми до ієрархії класів включаємо Thread. Другий мінус - ми починаємо порушувати принцип Єдиної відповідальності SOLID, т.к. наш клас стає одночасно відповідальним і за керування потоком і за деяке завдання, яке має виконуватися в цьому потоці. Як правильно? Відповідь знаходиться в тому самому методі <code class=" language-none">run</code>, який ми перевизначаємо: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">run</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>target <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		target<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">run</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут <code class=" language-none">target</code>це деякий <code class=" language-none">java.lang.Runnable</code>, який ми можемо передати для Thread при створенні екземпляра класу. Тому ми можемо зробити так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloWorld</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Runnable</span></span> task <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Runnable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">run</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, World!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Thread</span></span> thread <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>task<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        thread<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> А ще <code class=" language-none">Runnable</code>є функціональним інтерфейсом, починаючи з Java 1.8. Це дозволяє писати код завдань для потоків ще красивіше: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span>args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Runnable</span></span> task <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, World!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">Thread</span></span> thread <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>task<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	thread<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h2>Разом</h2>Отже, сподіваюся, з цієї розповіді зрозуміло, що таке потік, як вони існують і які базові операції з ними можна виконувати. У <a href="https://codegym.cc/groups/posts/2048-threadom-java-ne-isportishjh--chastjh-ii---sinkhronizacija" target="_blank">наступній частині</a> варто розібратися, як потоки взаємодіють один з одним та який у них життєвий цикл. #Viacheslav 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <th>Що ще почитати:</th>
   </tr>
   <tr>
    <td><a href="https://codegym.cc/groups/posts/2048-threadom-java-ne-isportishjh--chastjh-ii---sinkhronizacija" target="_blank">Thread'ом Java не зіпсуєш: Частина II - синхронізація </a><br><a href="https://codegym.cc/groups/posts/2060-threadom-java-ne-isportishjh--chastjh-iii---vzaimodeystvie" target="_blank">Thread'ом Java не зіпсуєш: Частина III - взаємодія </a><br><a href="https://codegym.cc/groups/posts/2065-threadom-java-ne-isportishjh--chastjh-iv---callable-future-i-druzjhja" target="_blank">Thread'ом Java не зіпсуєш: Частина IV - Callable, Future та друзі </a><br><a href="https://codegym.cc/groups/posts/2078-threadom-java-ne-isportishjh--chastjh-v---executor-threadpool-fork-join-pool" target="_blank">Thread'ом Java не зіпсуєш: Частина V - Executor, ThreadPool , Fork Join </a><br><a href="https://codegym.cc/groups/posts/2111-threadom-java-ne-isportishjh--chastjh-vi---k-barjheru" target="_blank">Thread'ом Java не зіпсуєш: Частина VI - До бар'єру!</a></td>
   </tr>
  </tbody>
 </table>
</div>