Як користуватися CopyOnWriteArraySet у Java з прикладом (переклад)
<p>----------------------------------------</p>
це молодший брат класу . Це спеціалізований набір класів, доданих до JDK 1.5 разом з їх популярним двоюрідним братом . Вони є частиною та розташовані в пакеті . найкраще підходить для read-only колекцій, розмір яких досить малий, щоб їх ско
<p>----------------------------------------</p>
<code class=" language-none">CopyOnWriteArraySet</code>це молодший брат класу <code class=" language-none">CopyOnWriteArrayList</code>. Це спеціалізований набір класів, доданих до JDK 1.5 разом з їх популярним двоюрідним братом <code class=" language-none">ConcurrentHashMap</code>. Вони є частиною <code class=" language-none">concurrent collection framework</code>та розташовані в пакеті <code class=" language-none">java.util.concurrent</code>. <img data-id="46fdb1db-cf3d-4745-97f7-21b6bc70ac6a" data-max-width="850" alt="Як користуватися CopyOnWriteArraySet в Java з прикладом (переклад) - 1" src="https://cdn.javarush.com/images/article/46fdb1db-cf3d-4745-97f7-21b6bc70ac6a/800.jpeg" style="width: 850px;"><code class=" language-none">CopyOnWriteArraySet</code>найкраще підходить для read-only колекцій, розмір яких досить малий, щоб їх скопіювати, якщо відбудуться деякі зміни операцій. Наприклад, ви можете використовувати <code class=" language-none">CopyOnWriteArraySet</code>для зберігання об'єкта при запуску програми, і дати безліч інших потоків доступ до цього об'єкта протягом життєвого циклу програми. Якщо новий стан або об'єкт приходять протягом цього часу, він також може бути доданий до цього <code class=" language-none">Set</code>, з вартістю створення нового масиву. Одна з найважливіших речей, яку варто знати про <code class=" language-none">CopyOnWriteArraySet</code>те, що він реалізований за допомогою<code class=" language-none">CopyOnWriteArrayList</code>. Це означає, що <code class=" language-none">CopyOnWriteArraySet</code>також поділяє всі основні властивості <code class=" language-none">CopyOnWriteArrayList</code>. Ще одна важлива річ, яку варто запам'ятати: ітератори цього класу колекції не підтримують операцію <code class=" language-none">remove()</code>. Спроба видалити елемент під час інтегрування призведе до викиду <code class=" language-none">UnsupportedOperationException</code>. Це зроблено, щоб гарантувати швидкість під час обходу. Обхід цієї реалізації <code class=" language-none">Set</code>використовуючи ітератор здійснюється досить швидко, і під час нього виключені втручання інших потоків. У своїй роботі ітератори спираються на моментальний знімок масиву, зроблений під час створення ітератора. Коротше кажучи, використовуйте <code class=" language-none">CopyOnWriteArraySet</code>якщо<code class=" language-none">set</code>досить малий, щоб копіювати його при додаванні, завданні значення або видаленні об'єктів, і основною метою є читання оновлюваних час від часу даних. Крім того, якщо ви хочете видалити елементи під час ітерації, не використовуйте цю реалізацію, тому що її ітератор не підтримує <code class=" language-none">remove()</code>і кидає <code class=" language-none">java.lang.UnsupportedOperationException</code>, як показано нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">[</span></span>RAJ<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token class-name"><span class="token class-name">Event</span></span> received <span class="token operator"><span class="token operator">:</span></span> FOUR
<span class="token class-name"><span class="token class-name">Exception</span></span> in thread <span class="token string"><span class="token string">"main"</span></span> <span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>lang<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>UnsupportedOperationException</span></span>
    at <span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span>concurrent<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>CopyOnWriteArrayList</span></span>$<span class="token class-name"><span class="token class-name">COWIterator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Unknown</span></span> <span class="token class-name"><span class="token class-name">Source</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    at <span class="token class-name"><span class="token class-name">Publisher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">notifySubs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HelloHP</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>java<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">43</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    at <span class="token class-name"><span class="token class-name">HelloHP</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HelloHP</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>java<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">23</span></span><span class="token punctuation"><span class="token punctuation">)</span></span></code></pre>
<h2>CopyOnWriteArraySet приклад на Java</h2>Ось готова програма на Java, що показує, як використовувати <code class=" language-none">CopyOnWriteArraySet</code>. У нашому прикладі ми використовували шаблон проектування "Видавець-передплатник" (англ. <em>publisher-subscriber pattern</em> ), щоб продемонструвати його використання. Більшість передплатників підписані під час запуску програми та головним завданням видавця є їх перебір та повідомлення про будь-які оновлення. Час від часу може траплятися додавання та видалення передплатника. Так як нам потрібен швидкий обхід, <code class=" language-none">CopyOnWriteArraySet</code>є добрим вибором, особливо в багатопотоковому середовищі, де один потік може додати абонента, а інший потік обробляє оновлення. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span>concurrent<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">CopyOnWriteArraySet</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">/**
 * Java program to demonstrate how to use CopyOnWriteArraySet in Java. Remember,
 * CopyOnWriteArraySet doesn't support remove() operation.
 *
 * @author Javin Paul
 */</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">CopyOnWriteArraySetDemo</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> args<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Publisher</span></span> cricNext <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Publisher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token class-name"><span class="token class-name">SubScriber</span></span> raj <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SubScriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RAJ"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">SubScriber</span></span> adom <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SubScriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"ADOM"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        cricNext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addSubscriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>raj<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        cricNext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addSubscriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>adom<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        cricNext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">notifySubs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"FOUR"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        cricNext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">notifySubs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SIX"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Publisher</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">CopyOnWriteArraySet</span></span> setOfSubs <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CopyOnWriteArraySet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">addSubscriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">SubScriber</span></span> sub<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        setOfSubs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sub<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">notifySubs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> score<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Iterator</span></span> itr <span class="token operator"><span class="token operator">=</span></span> setOfSubs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>itr<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hasNext</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">SubScriber</span></span> sub <span class="token operator"><span class="token operator">=</span></span> itr<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            sub<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">receive</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>score<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

            <span class="token comment"><span class="token comment">//itr.remove(); // not allowed, throws UnsupportedOperationException</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">SubScriber</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> _name<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">SubScriber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>_name <span class="token operator"><span class="token operator">=</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">receive</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> score<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printf</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"[%s] Event received : %s %n"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> _name<span class="token punctuation"><span class="token punctuation">,</span></span> score<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Output:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">[</span></span>RAJ<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token class-name"><span class="token class-name">Event</span></span> received <span class="token operator"><span class="token operator">:</span></span> FOUR
<span class="token punctuation"><span class="token punctuation">[</span></span>ADOM<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token class-name"><span class="token class-name">Event</span></span> received <span class="token operator"><span class="token operator">:</span></span> FOUR
<span class="token punctuation"><span class="token punctuation">[</span></span>RAJ<span class="token punctuation"><span class="token punctuation">]</span></span> <span class="token class-name"><span class="token class-name">Event</span></span> received <span class="token operator"><span class="token operator">:</span></span> SIX
<span class="token punctuation"><span class="token punctuation">[</span></span>ADOM<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token class-name"><span class="token class-name">Event</span></span> received <span class="token operator"><span class="token operator">:</span></span> SIX</code></pre>
<h2>Що потрібно запам'ятати</h2><code class=" language-none">CopyOnWriteArraySet</code>реалізує інтерфейси <code class=" language-none">Collection</code>і <code class=" language-none">Set</code>, а також доданий в JDK 1.5, разом з іншою спеціальною реалізацією <code class=" language-none">Set</code>'а, <code class=" language-none">EnumSet</code>. Це також <code class=" language-none">Set</code>, який використовує внутрішній <code class=" language-none">CopyOnWriteArrayList</code>для всіх своїх операцій. Таким чином, він поділяє самі основні властивості цього класу. Так як це не <code class=" language-none">SortedSet</code>порядок елементів не гарантується протягом ітерації. <img data-id="d3c21b91-1eeb-4137-b423-9cc1d88b1b34" data-max-width="650" alt="Як користуватися CopyOnWriteArraySet в Java з прикладом (переклад) - 2" src="https://cdn.javarush.com/images/article/d3c21b91-1eeb-4137-b423-9cc1d88b1b34/512.jpeg" style="width: 650px;">
<ol>
 <li>
  <p><strong><code class=" language-none">CopyOnWriteArraySet</code>найкраще підходить для додатків, в яких:</strong></p>
  <ul>
   <li>Розміри <code class=" language-none">Set</code>'ів, як правило, залишаються невеликими.</li>
   <li>Операції <code class=" language-none">read-only</code>значно перевершують операції, що змінюють об'єкти.</li>
   <li>Ви повинні запобігти перешкод між потоками під час обходу <code class=" language-none">Set</code>'а.</li>
  </ul></li>
 <li><strong>Ще однією перевагою <code class=" language-none">CopyOnWriteArraySet</code>є потокобезпека. Ця колекція підтримує паралелізм.</strong></li>
 <li><strong>Мутативні операції (додавання, зміна, видалення тощо) є дорогими, оскільки вони, зазвичай, вимагають копіювання всього базового масиву.</strong></li>
 <li><strong>Ітератори не підтримують мутаційну операцію видалення.</strong></li>
 <li><strong>Обхід, використовуючи ітератор, досить швидкий і під час нього виключені втручання інших потоків. У своїй роботі ітератори спираються на моментальний знімок масиву, зроблений під час створення ітератора.</strong></li>
</ol>На цьому все про використання <code class=" language-none">CopyOnWriteArraySet</code>Java. Як я сказав, він є молодшим братом <code class=" language-none">CopyOnWriteArrayList</code>. Так що якщо ви розумієте хоча б один із них, то зможете використовувати й інший. Єдина відмінність у тому, що один є <code class=" language-none">List</code>'ом а інший <code class=" language-none">Set</code>', таким чином це тягне за собою успадкування всіх відмінностей між цими структурами даних в Java. Наприклад, <code class=" language-none">List</code>важливий порядок розташування елементів, і він може містити дублікати. У той час, як <code class=" language-none">Set</code>є невпорядкованим, але не дозволяє дублювання об'єктів. Завжди пам'ятайте, що <code class=" language-none">CopyOnWriteArraySet</code>це особливий <code class=" language-none">Collection</code>клас. Його варто використовувати лише коли умови є сприятливими. У будь-якому іншому випадку можна скористатися реалізаціями загального призначення. Наприклад, <code class=" language-none">HashSet</code>,<code class=" language-none">LinkedHashSet</code>або синхронізованими класами колекцій. Оригінал: <a href="https://www.javacodegeeks.com/2014/06/how-to-use-copyonwritearrayset-in-java-with-example.html" rel="nofollow" target="_blank">How to use CopyOnWriteArraySet в Java with Example</a>