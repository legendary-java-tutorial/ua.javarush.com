У чому різниця між м'ютексом, монітором та семафором
<p>----------------------------------------</p>
Вітання! Вивчаючи багатопоточність на JavaRush, ти часто зустрічав поняття "м'ютекс" та "монітор". Чи зможеш зараз, без підгляду відповісти, чим вони відрізняються? :) Якщо зміг - молодець! Якщо ж ні (а найчастіше так і буває) – не дивно. П
<p>----------------------------------------</p>
Вітання! Вивчаючи багатопоточність на CodeGym, ти часто зустрічав поняття "м'ютекс" та "монітор". Чи зможеш зараз, без підгляду відповісти, чим вони відрізняються? :) <img data-id="98bc41b3-a1db-4ba9-8821-8e0520c6053e" data-max-width="850" alt="У чому різниця між м'ютексом, монітором та семафором?" src="https://cdn.javarush.com/images/article/98bc41b3-a1db-4ba9-8821-8e0520c6053e/800.jpeg" style="width: 850px;">Якщо зміг - молодець! Якщо ж ні (а найчастіше так і буває) – не дивно. Поняття «м'ютекс» та «монітор» справді пов'язані між собою. Більше того, читаючи лекції та дивлячись відео по багатопоточності на зовнішніх ресурсах в Інтернеті, ти зіткнешся з ще одним схожим поняттям – «семафор». Його функціонал теж багато в чому схожий на монітор і м'ютекс. Тому розберемося з цими трьома термінами, розглянемо кілька прикладів і остаточно впорядкуємо в голові розуміння того, чим вони один від одного відрізняються :) 
<h2>М'ютекс</h2>М'ютекс – це спеціальний об'єкт для синхронізації потоків. Він «прикріплений» до кожного об'єкта в Java - це ти вже знаєш :) Неважливо, чи користуєшся ти стандартними класами або створив власні класи, скажімо, <code class=" language-none">Cat</code>і <code class=" language-none">Dog</code>: <strong>у всіх об'єктів всіх класів є м'ютекс</strong> . Назва "м'ютекс" походить від англійського "MUTual EXclusion" - "взаємний виняток", і це відмінно відображає його призначення. Як ми й говорабо в одній із минулих лекцій, <strong>завдання м'ютексу — забезпечити такий механізм, щоб доступ до об'єкта в певний час був лише в одного потоку.</strong>. Популярною аналогією мьютексу в реальному житті можна вважати приклад з туалетом. Коли людина заходить у туалет, вона зачиняє зсередини двері на замок. Туалет виконує роль об'єкта, доступ якого отримують кілька потоків. Замок на дверях туалету – роль м'ютексу, а черга з людей зовні – роль потоків. Замок на дверях - м'ютекс туалету: він гарантує, що всередині одночасно може бути лише одна людина. <img data-id="2af6a4b9-893f-44e3-8c31-d584a0ae27c8" data-max-width="850" alt="У чому різниця між м'ютексом, монітором та семафором - 2" src="https://cdn.javarush.com/images/article/2af6a4b9-893f-44e3-8c31-d584a0ae27c8/800.jpeg" style="width: 850px;">Іншими словами, лише один потік у певний час може працювати із загальними ресурсами. Спроби інших потоків (людей) отримати доступ до зайнятих ресурсів будуть невдалими. У м'ютексу є кілька важливих особливостей. <strong>По-перше</strong> , можливі лише два стани — «вільний» і «зайнятий». Це спрощує розуміння принципу роботи: можна провести паралелі з булевими змінними<em>true/false</em> або двійковою системою числення 1/0. <strong>По-друге</strong> , станами не можна керувати безпосередньо. У Java немає механізмів, які б явно взяти об'єкт, отримати його м'ютекс і привласнити йому потрібний статус. Іншими словами, ти не можеш зробити щось на кшталт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Object</span></span> myObject <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Mutex</span></span> mutex <span class="token operator"><span class="token operator">=</span></span> myObject<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMutex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
mutex<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">free</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Таким чином, звільнити м'ютекс об'єкта не можна. Прямий доступ до нього є лише Java-машини. Програмісти працюють з м'ютексами за допомогою засобів мови. 
<h2>Монітор</h2>Монітор — це додаткова надбудова над м'ютексом. Фактично <strong>монітор - це "невидимий" для програміста шматок коду</strong> . Говорячи про м'ютекс раніше, ми наводабо простий приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Object</span></span> obj <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doSomething</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token comment"><span class="token comment">//...якась логіка, доступна всім потоків</span></span>

       <span class="token keyword"><span class="token keyword">synchronized</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

           <span class="token comment"><span class="token comment">// Логіка, яка одночасно доступна тільки для одного потоку</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У блоці коду, який позначений словом <code class=" language-none"><strong>synchronized</strong></code>, відбувається захоплення м'ютексу нашого об'єкта <code class=" language-none"><strong>obj</strong></code>. Добре, захоплення відбувається, але як саме забезпечується «захисний механізм»? Чому побачивши слова <code class=" language-none">synchronized</code>інші потоки не можуть пройти всередину блоку? Захисний механізм створює саме монітор! Компілятор перетворює слово <code class=" language-none"><strong>synchronized</strong></code>на кілька спеціальних шматків коду. Ще раз повернемося до нашого прикладу з методом <code class=" language-none"><strong>doSomething()</strong></code>та доповнимо його: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Object</span></span> obj <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doSomething</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token comment"><span class="token comment">//...якась логіка, доступна всім потоків</span></span>

       <span class="token comment"><span class="token comment">// Логіка, яка одночасно доступна тільки для одного потоку</span></span>
       <span class="token keyword"><span class="token keyword">synchronized</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

           <span class="token comment"><span class="token comment">/*выполнить важную работу, при которой доступ к об'єкту
           должен быть только у одного потока*/</span></span>
           obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">someImportantMethod</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ось що відбуватиметься «під капотом» нашої програми після того, як компілятор перетворює цей код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Object</span></span> obj <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doSomething</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">InterruptedException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token comment"><span class="token comment">//...якась логіка, доступна всім потоків</span></span>

       <span class="token comment"><span class="token comment">//логика, которая одновременно доступна только для одного потока:</span></span>

       <span class="token comment"><span class="token comment">/*до тех пор, пока мьютекс об'єкта занят -
       любой другой поток (кроме того, который его захватил), спит*/</span></span>
       <span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMutex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isBusy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sleep</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token comment"><span class="token comment">//пометить мьютекс об'єкта як занятый</span></span>
       obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMutex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isBusy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">/*выполнить важную работу, при которой доступ к об'єкту
       должен быть только у одного потока*/</span></span>
       obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">someImportantMethod</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">//освободить мьютекс об'єкта</span></span>
       obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMutex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isBusy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Приклад, звісно, ​​несправжній. Тут ми за допомогою Java-подібного коду спробували відобразити те, що відбувається у цей момент усередині Java-машини. Однак цей псевдокод дає чудове розуміння того, що насправді відбувається з об'єктом і потоками всередині блоку <code class=" language-none">synchronized</code>і як компілятор перетворює це слово на кілька «невидимих» для програміста команд. Насправді, <strong>монітор в Java виражений за допомогою слова<code class=" language-none">synchronized</code></strong> . Весь код, який з'явився замість слова <code class=" language-none">synchronized</code>в останньому прикладі, — це монітор. 
<h2>Семафор</h2>Ще одне слово, з яким ти стикаєшся при самостійному вивченні багатопотоковості - "семафор". Давай розберемося що це таке, і чим він відрізняється від монітора та м'ютексу. Семафор – це засіб для синхронізації доступу до якогось ресурсу. <strong>Його особливість у тому, що з створенні механізму синхронізації він використовує лічильник. </strong> Лічильник показує, скільки потоків одночасно можуть отримувати доступ до спільного ресурсу. <img data-id="532cb267-686d-430d-aacc-1539d2eb9ffc" data-max-width="850" alt="У чому різниця між м'ютексом, монітором та семафором - 3" src="https://cdn.javarush.com/images/article/532cb267-686d-430d-aacc-1539d2eb9ffc/800.jpeg" style="width: 850px;">Семафори в Java представлені класом <code class=" language-none">Semaphore</code>. Під час створення об'єктів-семафорів ми можемо використовувати такі конструктори: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Semaphore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> <span class="token keyword"><span class="token keyword">permits</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token class-name"><span class="token class-name">Semaphore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> <span class="token keyword"><span class="token keyword">permits</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> fair<span class="token punctuation"><span class="token punctuation">)</span></span></code></pre> У конструктор ми передаємо: 
<ul>
 <li>
  <p><code class=" language-none"><strong>int permits</strong></code>- Початкове і максимальне значення лічильника. Тобто, скільки потоків одночасно можуть мати доступ до загального ресурсу;</p></li>
 <li>
  <p><code class=" language-none"><strong>boolean fair</strong></code>— для встановлення порядку, де потоки отримуватимуть доступ. Якщо <code class=" language-none">fair</code>= <em>true</em> , доступ надається очікуваним потокам у тому порядку, у якому вони запитували. Якщо він дорівнює <em>false</em> , порядок визначатиме планувальник потоків.</p></li>
</ul>Класичний приклад використання семафорів - <a href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE%D0%B1_%D0%BE%D0%B1%D0%B5%D0%B4%D0%B0%D1%8E%D1%89%D0%B8%D1%85_%D1%84%D0%B8%D0%BB%D0%BE%D1%81%D0%BE%D1%84%D0%B0%D1%85" rel="nofollow" target="_blank">завдання про філософів, що обідають</a> . 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="433e2831-8242-4394-99c1-c902994a7fce" data-max-width="850" alt="У чому різниця між м'ютексом, монітором та семафором - 4" src="https://cdn.javarush.com/images/article/433e2831-8242-4394-99c1-c902994a7fce/800.jpeg" style="width: 850px;">
 </div>
</div>Ми трохи спростимо її умови для кращого розуміння. Уяви, що ми маємо 5 філософів, яким треба пообідати. При цьому ми маємо один стіл, і одночасно перебувати за ним можуть не більше двох осіб. Наше завдання – нагодувати всіх філософів. Ніхто з них не повинен залишитися голодним, і при цьому вони не повинні заблокувати один одного при спробі сісти за стіл (ми повинні уникнути deadlock). Ось як виглядатиме наш клас філософа: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">Thread</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Semaphore</span></span> sem<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// поел ли философ</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> full <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Semaphore</span></span> sem<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>sem<span class="token operator"><span class="token operator">=</span></span>sem<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>name<span class="token operator"><span class="token operator">=</span></span>name<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">run</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
   <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">try</span></span>
       <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token comment"><span class="token comment">// если философ еще не ел</span></span>
           <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">!</span></span>full<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
               <span class="token comment"><span class="token comment">//Запрашиваем у семафора разрешение на выполнение</span></span>
               sem<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">acquire</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
               <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span>println <span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" садится за стол"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

               <span class="token comment"><span class="token comment">// философ ест</span></span>
               <span class="token function"><span class="token function">sleep</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">300</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
               full <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

               <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span>println <span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" поел! Он выходит из-за стола"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
               sem<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">release</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

               <span class="token comment"><span class="token comment">// философ ушел, освободив место другим</span></span>
               <span class="token function"><span class="token function">sleep</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">300</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           <span class="token punctuation"><span class="token punctuation">}</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
       <span class="token keyword"><span class="token keyword">catch</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">InterruptedException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span>println <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Що-то пошло не так!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> А ось код для запуску нашої програми: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token class-name"><span class="token class-name">Semaphore</span></span> sem <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Semaphore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sem<span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Сократ"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sem<span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Платон"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sem<span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Аристотель"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sem<span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Фалес"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Philosopher</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>sem<span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Пифагор"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">start</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми створабо семафор з лічильником 2, щоб відповідати умові: одночасно їсти можуть лише два філософи. Тобто одночасно працювати можуть лише два потоки, адже наш клас <code class=" language-none">Philosopher</code>успадкований від <code class=" language-none">Thread</code>! Методи <code class=" language-none"><strong>acquire()</strong></code>та <code class=" language-none"><strong>release()</strong></code>класу <code class=" language-none">Semaphore</code>управляють його лічильником дозволів. Метод <code class=" language-none">acquire()</code>запитує дозвіл доступу до ресурсу у семафора. Якщо лічильник &gt; 0, дозвіл надається, а лічильник зменшується на 1. Метод <code class=" language-none">release()</code>«звільняє» виданий раніше дозвіл і повертає його до лічильника (збільшує лічильник дозволів семафору на 1). Що ж у нас вийде під час запуску програми? Чи вирішено завдання, чи не переберуться наші філософи, чекаючи своєї черги? :) Ось який висновок у консоль ми отримали: <em>Сократ сідає за стіл Платон сідає за стіл <u>Сократ поїв! Він виходить із-за столу Платон поїв! Він виходить з-за столу</u> Арістотель сідає за стіл Піфагор сідає за стіл <u>Арістотель поїв! Він виходить із-за столу Піфагор поїв! Він виходить з-за столу</u> Фалес сідає за стіл <u>Фалес поїв! Він виходить із-за столу</u></em> У нас все вийшло! І хоча Фалесу довелося обідати поодинці, думаю, він на нас не в образі :) <strong> Ти міг помітити деяку подібність між м'ютексом та семафором. </strong> У них загалом однакове призначення: синхронізувати доступ до якогось ресурсу. <img data-id="cd3b352a-d979-4826-84b7-0a0e5c836035" data-max-width="850" alt="У чому різниця між м'ютексом, монітором та семафором - 5" src="https://cdn.javarush.com/images/article/cd3b352a-d979-4826-84b7-0a0e5c836035/800.jpeg" style="width: 850px;">Різниця тільки в тому, що м'ютекс об'єкта може захопити одночасно лише один потік, а у випадку з семафором використовується лічильник потоків, і доступ до ресурсу можуть отримати відразу кілька з них. І це не просто випадкова схожість :) Насправді <strong>м'ютекс - це одномісний семафор</strong> . Тобто це семафор, лічильник якого спочатку встановлено у значенні 1. Його ще називають «двійковим семафором», оскільки його лічильник може мати лише 2 значення — 1 («вільно») та 0 («зайнято»). От і все! Як бачиш, все виявилося не таким вже й заплутаним :) Тепер, якщо ти захочеш вивчити тему багатопоточності докладніше в Інтернеті, тобі буде легше орієнтуватися в поняттях. До зустрічі на наступних уроках!