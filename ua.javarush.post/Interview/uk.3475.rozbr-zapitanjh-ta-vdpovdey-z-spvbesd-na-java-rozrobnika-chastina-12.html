Розбір запитань та відповідей із співбесід на Java-розробника. Частина 12
<p>----------------------------------------</p>
Вітання! Знання – сила. Чим більше знань буде у вас до першої вашої співбесіди, тим впевненіше на ній почуватиметеся. З хорошим багажем знань вас буде складно спантеличити, і в той же час ви зможете приємно здивувати вашого інтерв'юера. Том
<p>----------------------------------------</p>
Вітання! Знання – сила. Чим більше знань буде у вас до першої вашої співбесіди, тим впевненіше на ній почуватиметеся. <img data-max-width="800" data-id="22a91827-1d65-4758-905b-3a110e9a9e2d" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 - 1" src="https://cdn.javarush.com/images/article/22a91827-1d65-4758-905b-3a110e9a9e2d/800.jpeg" style="width: 800px;">З хорошим багажем знань вас буде складно спантеличити, і в той же час ви зможете приємно здивувати вашого інтерв'юера. Тому сьогодні ми без зайвих передмов продовжимо посилювати вашу теоретичну базу, розбираючи <a href="https://dou.ua/lenta/articles/interview-questions-java-developer/" rel="nofollow" target="_blank">250+ питань для Java-розробника</a> . <img data-max-width="512" data-id="65de589d-55f3-41b0-9d20-80ac3e0d10e4" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 - 2" src="https://cdn.javarush.com/images/article/65de589d-55f3-41b0-9d20-80ac3e0d10e4/512.jpeg" style="width: 512px;">
<h4>103. Які правила для перевірки винятків при наслідуванні?</h4>Якщо я правильно розумію питання, тут запитують про правила роботи з винятками під час наслідування, і вони такі:
<ul>
 <li>Перевизначуваний або реалізований метод у спадкоємці/реалізації не може викидати контрольовані винятки, які вищі за ієрархією ніж винятки у методі суперкласу/інтерфейсу.</li>
</ul>Тобто якщо у нас є інтерфейс <span class="code">Animal</span> з методом, що кидає <span class="text-bold">IOException</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span>  <span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
   <span class="token keyword">void</span> <span class="token function">voice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> У реалізації даного інтерфейсу ми не можемо виставити більш загальний викид (наприклад, <span class="text-bold">Exception</span> , <span class="text-bold">Throwable</span> ), але можемо замінити його на виключення спадкоємця, як, наприклад, на <span class="text-bold">FileNotFoundException</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">voice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">{</span>
<span class="token comment">// некоторая реализация</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
 <li>Конструктор підкласу повинен включити у свій блок <span class="code">throws</span> всі класи винятків конструктором суперкласу, що прокидається, до якого йде звернення при створенні об'єкта.</li>
</ul>Припустимо, що конструктор класу <span class="code">Animal</span> кидає безліч винятків: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">,</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span></code></pre> Тоді спадкоємець класу в конструкторі також повинен їх вказати: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">,</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span></code></pre> Або, як і у випадку з методами, можна вказати не ті ж винятки, а загальніші. У нашому випадку достатньо буде вказати загальніший виняток — <span class="text-bold">Exception</span> , оскільки це загальний предок всіх розглянутих трьох винятків: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span></code></pre>
<h4>104. Чи могли б ви написати код, коли блок finally не буде виконаний?</h4>Для початку згадаємо, що таке <span class="code">finally</span> . Раніше ми розглядали механізм перехоплення винятків: блок <span class="code">try</span> окреслює зону перехоплення, водночас блок (блоки) <span class="code">catch</span> — код, який спрацює при падінні певного виключення. <span class="code">Finally</span> — третій блок коду після слова <span class="code">finally</span> , який взаємозамінний з <span class="code">catch</span> , але не взаємовиключним. Суть даного блоку полягає в тому, що код у ньому спрацьовує завжди, незалежно від результату спрацьовування <span class="code">try</span> або <span class="code">catch .</span>(незалежно від того чи впав виняток чи ні). Випадки його неспрацьовування дуже рідкісні і є нештатними. Найпростіший випадок неспрацьовування - це коли в коді вище буде викликаний метод <span class="code">System.exit(0)</span> , який завершує програму (гасить її): 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Данное сообщение не будет выведенно в консоль"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Також є деякі інші ситуації, у яких <span class="code">finally</span> не спрацює:
<ul>
 <li>Аварійне завершення програми, викликане критичними неполадками системи, або падіння деякої Error, яка "упустить" програму (прикладом error може стати та ж <span class="text-bold">StackOwerflowError</span> , що виникає при переповненні пам'яті стека).</li>
 <li>Коли через блок <span class="code">ry…finally</span> проходить <span class="code">deamon</span> -потік та паралельно з цим програма завершується. Адже <span class="code">deamon</span> - поток - це потік для фонових дій, тобто він не є пріоритетним і обов'язковим і додаток не чекатиме закінчення його роботи.</li>
 <li>Найбанальніший нескінченний цикл, в <span class="code">try</span> або <span class="code">catch</span> , потрапивши в який потік там залишиться назавжди: 
  <p></p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Данное сообщение не будет выведенно в консоль"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
  <p></p></li>
</ul>Це питання дуже популярне на співбесідах новачків, тому кілька цих виняткових ситуацій варто пам'ятати. <img data-max-width="512" data-id="81ef834f-1b54-420a-a492-62cd881ee96c" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 – 3" src="https://cdn.javarush.com/images/article/81ef834f-1b54-420a-a492-62cd881ee96c/512.jpeg" style="width: 512px;">
<h4>105. Напишіть приклад обробки кількох винятків в одному блоці catch</h4><em><span class="text-bold">1) Можливо питання було поставлене некоректно. </span></em> Наскільки я розумію в даному питанні мається на увазі безліч<span class="code"> catch</span> для одного блоку<span class="code"> try</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileNotFoundException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Упс, у вас упало исключение - "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Упс, у вас упало исключение - "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Упс, у вас упало исключение - "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Якщо в блоці <span class="code">try</span> падає виняток, то блоки <span class="code">catch</span> почергово зверху вниз намагаються його перехопити, якщо в деякого блоку <span class="code">catch</span> це виходить, він отримує право на обробку виключення, в той час коли інші блоки нижче не зможуть спробувати перехопити і по своєму обробити його. Тому вужчі винятки ставляться в ланцюжку <span class="code">catch</span> блоків вище, а ширші — нижчі. Наприклад, якщо у нас у першому <span class="code">catch</span> блоці відловлюється виняток класу <span class="text-bold">Exception</span> , то в інші блоки виключення, що перевіряються, ніяк не зможуть (інші блоки з спадкоємцями <span class="text-bold">Exception</span> будуть абсолютно марні). <em><span class="text-bold">2) Питання було поставлено коректно</span></em> У такому разі наша обробка матиме вигляд на кшталт наступного: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">FileNotFoundException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// некоторая обработка с сужением типа (FileNotFoundException)e</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ArithmeticException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// некоторая обработка с сужением типа (ArithmeticException)e</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// некоторая обработка с сужением типа (NullPointerException)e</span>
   <span class="token punctuation">}</span></code></pre> Зловивши виняток через <span class="code">catch</span> , ми намагаємося з'ясувати його конкретний тип через метод <span class="code">instanceof</span> , який використовується для перевірки – чи належить об'єкт певному типу, щоб потім без негативних наслідків можна було звузити його до цього типу. Обидва розглянуті підходи можуть застосовуватися в одній і тій же ситуації, але про некоректність питання я сказав через те, що другий варіант я б не назвав добрим і у своїй практиці жодного разу не зустрічав, водночас перший спосіб з мультикетчами отримав широке поширення. <img data-max-width="512" data-id="d2ddf472-f48d-4221-86e3-ab9a3bffd82b" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 – 4" src="https://cdn.javarush.com/images/article/d2ddf472-f48d-4221-86e3-ab9a3bffd82b/512.jpeg" style="width: 512px;">
<h4>106. Який оператор дозволяє примусово викинути виняток? Напишіть приклад</h4>Вище я вже неодноразово використовував, проте повторюю це ключове слово - <span class="code">throw</span> . Приклад використання (примусове викидання виключення): 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4>107. Чи може метод main викинути throws-выключение? Якщо так, то куди передасть?</h4>В першу чергу хочу відзначити, що <span class="code">main</span> це не більше ніж звичайний метод, і так, він викликається віртуальною машиною для початку виконання програми, але крім цього він може бути викликаний і з будь-якого іншого коду. Тобто на нього також поширюються звичайні правила вказівки винятків, що викидаються (checked exceptions) після <span class="code">throws</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></code></pre> Відповідно в ньому також можуть падати винятки. Якщо <span class="code">main</span> не був викликаний в якомусь методі, а був запущений як точка запуску програми, викинутий ним виняток буде оброблятися перехоплювачем <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.UncaughtExceptionHandler.html" rel="nofollow" target="_blank">.UncaughtExceptionHandler</a> . Цей обробник один на свій потік (тобто по одному обробнику в кожному потоці). При потребі можна створити свій обробник і задати його за допомогою методу <span class="code">setDefaultUncaughtExceptionHandler</span> , викликаного у об'єкта <span class="code">Thread</span> . 
<h3>Багатопоточність</h3><img data-max-width="512" data-id="d28c1698-d371-4f1a-bd24-6ca578363625" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 - 5" src="https://cdn.javarush.com/images/article/d28c1698-d371-4f1a-bd24-6ca578363625/512.jpeg" style="width: 512px;">
<h4>108. Які засоби для роботи з багатопоточністю знаєте?</h4>Основні/базові засоби для використання багатопоточності в Java:
<ul>
 <li><span class="text-bold">Synchronized</span> — механізм закриття (блокування) методу/блоку при вході до нього потоку, від інших потоків.</li>
 <li><span class="text-bold">Volatile</span> – механізм забезпечення узгодженого доступу до змінної різними потоками, тобто з наявністю даного модифікатора у змінної всі операції присвоєння та читання її мають бути атомарними. Тобто потоки не копіюватимуть цю змінну в свою локальну пам'ять і змінювати її, а змінюватимуть її початкове значення.</li>
</ul>Докладніше про volatile читайте ось <a href="https://codegym.cc/groups/posts/1998-upravlenie-potokami-metodih-volatile-i-yield" target="_blank">тут</a> .
<ul>
 <li><span class="text-bold">Runnable</span> - інтерфейс, реалізувавши який (зокрема його метод run) у деякому класі:</li>
</ul>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// некоторая логика</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> І створивши об'єкт цього класу, можна запустити новий потік, задавши цей об'єкт у конструктор нового об'єкта <span class="code">Thread</span> , і викликавши метод <span class="code">start()</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> Метод <span class="code">start</span> запускає реалізований метод <span class="code">run()</span> окремому потоці.
<ul>
 <li><span class="text-bold">Thread</span> - клас, успадкувавши від якого (при цьому перевизначивши метод <span class="code">run</span> ):</li>
</ul>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// некоторая логика</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> І створивши об'єкт даного класу і запустивши його за допомогою методу <span class="code">start()</span> , запустимо тим самим новий потік: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token keyword">new</span> <span class="token class-name">CustomThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
 <li><span class="text-bold">Concurrency</span> — пакет із інструментами для роботи у багатопотоковому середовищі.</li>
</ul>Він складається з:
<ul>
 <li><span class="text-bold">Concurrent Collections</span> – набір колекцій, спеціалізованих під роботу у багатопотоковому середовищі.</li>
 <li><span class="text-bold">Queues</span> - спеціалізовані черги для багатопотокового середовища (блокуючі та неблокуючі).</li>
 <li><span class="text-bold">Synchronisers</span> – спеціалізовані утиліти для роботи у багатопотоковому середовищі.</li>
 <li><span class="text-bold">Executors</span> – механізми для створення пулів потоків.</li>
 <li><span class="text-bold">Locks</span> - механізми синхронізації потоків (гнучкіші ніж стандартні - synchronized, wait, notify, notifyAll).</li>
 <li><span class="text-bold">Atomics</span> – класи оптимізовані під багатопоточне виконання, саме у них кожна операція – атомарна.</li>
</ul>Докладніше про concurrent пакет читайте ось <a href="https://habr.com/ru/company/luxoft/blog/157273/" rel="nofollow" target="_blank">тут</a> . 
<h4>109. Розкажіть про синхронізацію між потоками. Для чого використовують методи wait(), notify() - notifyAll() join()?</h4>Наскільки я зрозумів питання, синхронізація між потоками — це про ключового модифікатора <span class="code">synhronized</span> . Цей модифікатор можна поставити або безпосередньо біля блоку: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// некоторая логика</span>
<span class="token punctuation">}</span></code></pre> Або у сигнатурі способу: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// некоторая логика}</span></code></pre> Як я і сказав раніше, <span class="code">synhronized</span> це механізм, що дозволяє закривати блок / метод від інших потоків, коли в нього вже зайшов один потік. Представимо блок/метод як кімнату. Деякий потік, прийшовши до неї, зайде в неї і закриє її на ключ, інші потоки, прийшовши до кімнати і побачивши, що вона зачинена, чекатимуть біля неї, поки вона не звільниться. Зробивши свої справи, перший потік виходить із кімнати та звільняє ключ. І я не дарма постійно говорив про ключ, адже він справді існує. Це спеціальний об'єкт, який має стан зайнятий/вільний. Цей об'єкт прикріплений до кожного об'єкта Java, тому при використанні <span class="code">synhronized</span> блоку нам потрібно в дужках вказувати об'єкт, на чий м'ютекс ми хочемо зачиняти двері. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">Cat</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">synchronized</span> <span class="token punctuation">(</span>cat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// некоторая логика</span>
<span class="token punctuation">}</span></code></pre> Також можна використовувати м'ютекс класу, як я це зробив у першому прикладі ( <span class="code">Main.class</span> ). Коли ми використовуємо <span class="code">synhronized</span> на методі, адже ми не вказуємо об'єкт на якому хочемо закрити правильно? У такому випадку для нестатичного методу закриватиметься на м'ютекс об'єкта <span class="code">this</span> , тобто поточний об'єкт даного класу. Статичний закриватиметься на м'ютекс поточного класу ( <span class="code">this.getClass();</span> ). Детальніше про м'ютекс можна почитати ось <a href="https://codegym.cc/groups/posts/2174-v-chem-raznica-mezhdu-mjhjuteksom-monitorom-i-semaforom" target="_blank">тут</a> . Ну а про <span class="code">synhronized</span> читати ось <a href="https://codegym.cc/groups/posts/1994-sinkhronizacija-potokov-operator-synchronized" target="_blank">тут</a> . <span class="code">Wait()</span>- метод, який звільняє м'ютекс і переводить поточний потік в режим очікування як би прикріплюючись до поточного монітора (щось на зразок якоря). Через це цей метод може бути викликаний тільки з <span class="code">синхронізованого</span> блоку або методу (інакше, що йому звільняти і чого йому чекати). Також наголошу, що це метод класу <span class="code">Object</span> . Точніше не один, а навіть три:
<ul>
 <li>
  <p><span class="code">Wait()</span> — переводить поточний потік у режим очікування доки інший потік не викличе метод <span class="code">notify()</span> або <span class="code">notifyAll()</span> для цього об'єкта (про ці методи поговоримо далі).</p></li>
 <li>
  <p><span class="code">Wait (long timeout)</span> — переводить поточний потік у режим очікування доки інший потік не викличе метод <span class="code">notify()</span> або <span class="code">notifyAll()</span> для цього об'єкта або не закінчиться вказаний час — <span class="code">timeout</span> .</p></li>
 <li>
  <p><span class="code">Wait (long timeout, int nanos)</span> - аналогічний попередньому, тільки <span class="code">nanos</span> дозволяє вказати наносекунди (точніше налаштування часу).</p></li>
 <li>
  <p><span class="code">Notify()</span> — метод, який дозволяє пробудити один рандомний потік поточного блоку синхронізації. Знову ж таки, може бути викликаний тільки в <span class="code">синхронізованому</span> блоці або методі (адже в інших місцях йому не буде кого розморожувати).</p></li>
 <li>
  <p><span class="code">NotifyAll()</span> — метод, що пробуджує всі очікувані потоки на поточному моніторі (теж використовується лише у <span class="code">синхронізованому</span> блоці або методі).</p></li>
</ul>
<h4>110. Як зупинити потік?</h4>Перше, що треба сказати, - це те, що при повному виконанні методу <span class="code">run()</span> потік автоматично знищується. Але іноді треба вбити його достроково, до завершення цього методу. І що ж тоді робити? Можливо, у об'єкта <span class="code">Thread</span> використовувати метод <span class="code">stop()</span> ? Як би не так! Цей метод вважається застарілим і може призвести до збоїв системи. <img data-max-width="512" data-id="4fa7b937-b813-4aca-819d-44e3181305a9" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 - 6" src="https://cdn.javarush.com/images/article/4fa7b937-b813-4aca-819d-44e3181305a9/512.jpeg" style="width: 512px;">Ну, а що тоді? Є два способи зробити це: <span class="text-bold">Перший</span> - використання свого внутрішнього логічного прапора. Давайте розглянемо на прикладі. У нас є своя реалізація потоку, який має виводити на екран якусь фразу до повної зупинки: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> isActive<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">CustomThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token punctuation">{</span>
           <span class="token keyword">while</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Поток выполняет некую логику..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Поток остановлен!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopRunningThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       isActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> З використанням методу <span class="code">stopRunning()</span> внутрішній прапор стає false і метод <span class="code">run</span> припиняє свою роботу. Давайте запустимо його в <span class="code">main</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Начало выполнения программы"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CustomThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// пока наш основной поток спит, вспомогательный  CustomThread работает и выводит в коноль своё сообщение</span>
thread<span class="token punctuation">.</span><span class="token function">stopRunningThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Конец выполнения программы"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> У результаті в консолі ми побачимо щось на кшталт цього: 
<div class="terminal">
 Початок виконання програми Потік виконує якусь логіку... Потік виконує якусь логіку... Потік виконує якусь логіку... Потік виконує якусь логіку... Потік виконує якусь логіку... Потік виконує якусь логіку... Кінець виконання програми Потік зупинено !
</div> А це означає, що наш потік відпрацював, вивів кілька повідомлень у консоль і був успішно зупинений. Зазначу, що кількість виведених повідомлень від запуску до запуску буде різною, іноді додатковий потік навіть нічого не виводив. Як я помітив, це залежить від часу сну основного потоку, чим він більший, тим менший шанс, що додатковий потік нічого не виведе. При часі сну 1мс виведення повідомлень майже ніколи не відбувається, але якщо виставити 20мс майже завжди спрацьовує. Можливо, за малого часу потік просто не встигає запуститися і розпочати свою роботу, а його одразу ж зупиняють. <span class="text-bold">Другий</span> спосіб полягає у використанні на об'єкті <span class="code">Thread</span> методу <span class="code">interrupted()</span>, який повертає значення внутрішнього прапора переривання (за замовчуванням цей прапор <span class="text-bold">false</span> ) та іншого його методу <span class="code">interrupt()</span> - ставить цей прапор у true (коли цей прапор <span class="text-bold">true</span> потік повинен зупинити свою роботу). Дивимося приклад: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token punctuation">{</span>
           <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Поток выполняет некую логику..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Поток остановлен!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Запуск у <span class="code">main</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Начало выполнения программы"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Конец выполнения программы"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> Підсумок виконання буде таким самим, як і в першому випадку, але цей підхід мені подобається більше: ми пишемо менше коду і більше використовуємо вже готовий, стандатний функціонал. <img data-max-width="512" data-id="ae095341-54e0-4a83-8eac-9fcc6afcef16" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 – 7" src="https://cdn.javarush.com/images/article/ae095341-54e0-4a83-8eac-9fcc6afcef16/512.jpeg" style="width: 512px;">На цьому сьогодні й зупинимося.<img data-max-width="512" data-id="d0cc1122-d82e-4d63-9c01-60b642930fdb" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 – 8" src="https://cdn.javarush.com/images/article/d0cc1122-d82e-4d63-9c01-60b642930fdb/512.jpeg" style="width: 512px;">
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <th>Інші матеріали серії:</th>
   </tr>
   <tr>
    <td>
     <ul>
      <li><a href="https://codegym.cc/groups/posts/3243-razbor-voprosov-i-otvetov-na-sobesedovanii-chastjh-1" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 1</a></li>
      <li><a href="https://codegym.cc/groups/posts/3252-razbor-voprosov-i-otvetov-na-sobesedovanii-chastjh-2" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 2</a></li>
      <li><a href="https://codegym.cc/groups/posts/3273-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-3" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 3</a></li>
      <li><a href="https://codegym.cc/groups/posts/3284-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-4" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 4</a></li>
      <li><a href="https://codegym.cc/groups/posts/3296-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-5" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 5</a></li>
      <li><a href="https://codegym.cc/groups/posts/3341-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-6" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 6</a></li>
      <li><a href="https://codegym.cc/groups/posts/3386-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-7" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 7</a></li>
      <li><a href="https://codegym.cc/groups/posts/3415-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-8" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 8</a></li>
      <li><a href="https://codegym.cc/groups/posts/3434-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-9" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 9</a></li>
      <li><a href="https://codegym.cc/groups/posts/3452-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-10" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 10</a></li>
      <li><a href="https://codegym.cc/groups/posts/3464-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-11" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 11</a></li>
      <li><a href="https://codegym.cc/groups/posts/3507-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-13" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 13</a></li>
      <li><a href="https://codegym.cc/groups/posts/3558-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-14" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 14</a></li>
      <li><a href="https://codegym.cc/groups/posts/3592-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-15" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 15</a></li>
      <li><a href="https://codegym.cc/groups/posts/3621-razbor-voprosov-i-otvetov-s-sobesedovaniy-na-java-razrabotchika-chastjh-16" target="_blank">Розбір запитань та відповідей із співбесід на Java-розробника. Частина 16</a></li>
     </ul></td>
   </tr>
  </tbody>
 </table>
</div><a href="https://codegym.cc/login/signup" target="_blank"><img data-max-width="1080" id="click_banner5_articles" data-id="c11da258-625d-43d0-a00a-7f80367b4279" alt="Розбір запитань та відповідей із співбесід на Java-розробника.  Частина 12 - 9" src="https://cdn.javarush.com/images/article/c11da258-625d-43d0-a00a-7f80367b4279/1080.jpeg" style="width: 1080px;"></a>