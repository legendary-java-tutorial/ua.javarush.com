Прийоми та поради. Як уникнути NullPointerException у Java додатках
<p>----------------------------------------</p>
Сьогодні я покажу вам прості прийоми, як уникнути NullPointerException у ваших додатках. Їм легко слідувати, але при цьому вони помітно підвищують надійність та якість вашого коду. Більш того, на мій досвід, одна перша порада вплине на якіс
<p>----------------------------------------</p>
<img data-id="8b1c5b74-498c-4613-b31f-5830673999e2" data-max-width="850" alt="Прийоми та поради.  Як уникнути NullPointerException в Java додатках - 1" src="https://cdn.javarush.com/images/article/8b1c5b74-498c-4613-b31f-5830673999e2/800.jpeg" style="width: 850px;">Сьогодні я покажу вам прості прийоми, як уникнути NullPointerException у ваших додатках. Їм легко слідувати, але при цьому вони помітно підвищують надійність та якість вашого коду. Більш того, на мій досвід, одна перша порада вплине на якість вашого коду. Якщо ви знаєте якісь ще прийоми програмування Java, не соромтеся ділитися ними в коментарях. <img data-id="9305fa75-212c-4902-8562-2d01d2562c30" data-max-width="625" alt="Прийоми та поради.  Як уникнути NullPointerException в Java додатках - 2" src="https://cdn.javarush.com/images/article/9305fa75-212c-4902-8562-2d01d2562c30/512.jpeg" style="width: 625px;">
<h2>Викликайте методи equals() та equalsIgnoreCase() у відомого рядка літералу, а не у невідомого об'єкта</h2>Завжди викликайте метод <code class=" language-none">equals()</code>у відомого рядка, про який ви знаєте, що він не <code class=" language-none">null</code>. Метод <code class=" language-none">equals()</code>симетричний, тобто виклик <code class=" language-none">a.equals(b)</code>і <code class=" language-none">b.equals(a)</code>дасть однаковий результат (якщо <code class=" language-none">a</code>й <code class=" language-none">b</code>не <code class=" language-none">null</code>), і з цієї причини багато програмістів не приділяють уваги тому, у яких об'єктів викликається <code class=" language-none">equals()</code>, <code class=" language-none">a</code>або <code class=" language-none">b</code>. Одним з побічних ефектів цього стає NullPointerException, якщо метод викликається у <code class=" language-none">null</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Object</span></span> unknownObject <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">//плохой способ - может вызвать NullPointerException</span></span>
<span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>unknownObject<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"knownObject"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>err<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"This may result in NullPointerException if unknownObject is null"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token comment"><span class="token comment">//правильный способ - исключение NullPointerException не возникнет, даже если unknownObject null</span></span>
<span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"knownObject"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>unknownObject<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>err<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"better coding avoided NullPointerException"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Це була найпростіша порада, як уникнути NullPointerException, але вона одна призводить до величезних поліпшень, оскільки метод <code class=" language-none">equals()</code>зустрічається повсюдно. 
<h2>Вибирайте valueOf(), а не toString(), у випадках, коли обидва дають один результат</h2>Оскільки виклик <code class=" language-none">toString()</code>у посилання зі значенням <code class=" language-none">null</code>викликає виняток NullPointerException, краще використовувати виклик <code class=" language-none">valueOf()</code>, коли ми можемо отримати той самий результат, оскільки виклик <code class=" language-none">valueOf()</code>від <code class=" language-none">null</code>повернення <code class=" language-none">null</code>. Особливо це стосується класів обгорток, таких як <code class=" language-none">Integer</code>, <code class=" language-none">Float</code>, <code class=" language-none">Double</code>або <code class=" language-none">BigDecimal</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">BigDecimal</span></span> bd <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getPrice</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">valueOf</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bd<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//не выбрасывает NPE</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bd<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//выбрасывает "Exception in thread "main" java.lang.NullPointerException"</span></span></code></pre> Використовуйте ці поради, коли не впевнені, чи може об'єкт бути <code class=" language-none">null</code>чи ні. 
<h2>Використовуйте <code class=" language-none">null</code>безпечні методи та бібліотеки</h2>Існує безліч опенсорсних бібліотек, які беруть на собі важкий тягар перевірки <code class=" language-none">null</code>. Одна з найпоширеніших – <code class=" language-none">StringUtils</code>від Apache Commons. Використовуючи такі методи як <code class=" language-none">StringUtils.isBlank()</code>, <code class=" language-none">isNumeric()</code>, <code class=" language-none">isWhiteSpace()</code>і т.д. Ви можете не турбуватися про виникнення NullPointerException. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">//Методы StringUtils являются null-безопасными, они не вызовут NullPointerException</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">StringUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEmpty</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">StringUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isBlank</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">StringUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isNumeric</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">StringUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isAllUpperCase</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Висновок: <em>true true false false</em> І все ж таки перед використанням, не забудьте прочитати документацію <code class=" language-none">null</code>-безпечних методів і класів. Це ще один із найкращих Java прийомів, який, не вимагаючи значних зусиль, веде до величезних покращень. 
<h2>Намагайтеся не повертати <code class=" language-none">null</code>з методу, краще поверніть порожню колекцію</h2>Це ще одна хороша порада з програмування на Java, яку Джошуа Блох описує у своїй книзі "Java. Ефективне програмування". Повертаючи порожні колекції чи масиви, переконайтеся, що під час виклику базових методів начебто <code class=" language-none">size()</code>чи <code class=" language-none">length()</code>виникне NullPointerException. У класі <code class=" language-none">Collections</code>спеціально оголошено зручні реалізації порожніх списків, множин і словників: <code class=" language-none">Collections.EMPTY_LIST</code>, <code class=" language-none">Collections.EMPTY_SET</code>and <code class=" language-none">Collections.EMPTY_MAP</code>. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">List</span></span> <span class="token function"><span class="token function">getOrders</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Customer</span></span> customer<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">List</span></span> result <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>EMPTY_LIST<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Аналогічно можна використовувати <code class=" language-none">Collections.EMPTY_SET</code>замість <code class=" language-none">Collections.EMPTY_MAP</code>того, щоб повертати <code class=" language-none">null</code>. 
<h2>Використовуйте анотації @NotNull та @Nullable</h2>В описі ваших методів ви можете визначити угоду <code class=" language-none">null</code>-безпеки методів, використовуючи анотації <code class=" language-none">@NotNull</code>і @Nullable щоб показати може метод повертати <code class=" language-none">null</code>чи ні. Сучасні компілятори та IDE можуть використовувати ці анотації для аналізи вашого коду та видавати відповідні поради, наприклад, про пропущену перевірку на <code class=" language-none">null</code>, або навпаки, про можливість прибрати зайву перевірку, що засмічує код. Такі інструкції, наприклад, підтримують IntelliJ IDE і FindBugs, крім цього вони входять до JSR 305. Але навіть якщо ваша IDE і не підтримує такі інструкції, вони самі по собі будуть гарною документацією. Дивлячись на <code class=" language-none">@NotNull</code>програмісту <code class=" language-none">@Nullable</code>буде простіше зрозуміти де потрібно додавати перевірку на<code class=" language-none">null</code>, А де - ні. Це, до речі, досить нова серед програмістів Java практика, і має пройти час, щоб вона поширилася. 
<h2>Уникайте непотрібного автоупаковки та авторозпакування у вашому коді</h2>Мало того, що це веде до створення зайвих часових об'єктів, автоупаковка ще може викликати NullPointerException, якщо клас обгортки - <code class=" language-none">null</code>. Наприклад, наступний код "звалиться" в NullPointerException, якщо запис про людину не містить телефону і повертає <code class=" language-none">null</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Person</span></span> ram <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Person</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"ram"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">int</span></span> phone <span class="token operator"><span class="token operator">=</span></span> ram<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPhone</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> При використанні автоупаковки або автораспаковування не тільки рівності, але й нерівності <code class=" language-none">&lt;</code>, <code class=" language-none">&gt;</code>можуть призводити до NullPointerException. 
<h2>Дотримуйтесь угод і визначайте розумні значення за замовчуванням.</h2>Один з найкращих способів уникнути NullPointerException в Java - правильне оголошення угод про кодування та дотримання їх. Більшість винятків NullPointerException виникають тоді, коли об'єкт намагаються створити, не володіючи всіма необхідними йому даними та залежностями. Заборонивши створення незавершених об'єктів, витончено відхиляючи подібні запити, ви позбавите себе у майбутньому великої кількості NullPointerException. Аналогічно, якщо ви дозволяєте створення об'єкта, то ви повинні підібрати розумне значення за замовчуванням. Наприклад, об'єкт класу <code class=" language-none">Employee</code>не може бути створений без імені та <code class=" language-none">id</code>, але може не мати номер телефону. У такому разі в об'єктів <code class=" language-none">Employee</code>, позбавлених номера, замість<code class=" language-none">null</code>може повертатися нуль. Хоча подібна поведінка об'єкта варто заздалегідь продумати - можливо, що простіше буде перевірити на <code class=" language-none">null</code>, ніж дзвонити за неіснуючим номером. У такому разі наявність додаткових умов на те, які поля <code class=" language-none">null</code>, а які ні, допоможе ухвалити правильне рішення. Загалом вибір між негайним падінням програми чи присвоєнням <code class=" language-none">null</code>— це важливе рішення у проектуванні, і зробивши вибір, ви повинні йому послідовно дотримуватися. 
<h2>Задавайте обмеження на рівні СУБД</h2>Використовуючи базу даних для зберігання об'єктів вашої програми, таких як покупці (Customers) або замовлення (Orders), буде розумно встановити " <code class=" language-none">null</code>-овість" ваших об'єктів на рівні СУБД, за допомогою відповідних обмежень на таблиці. Бази даних часто містять інформацію з різних джерел і введення перевірок на пропущені значення підвищить цілісність ваших даних. Крім цього наявність перевірок на null на рівні СУБД, зменшить їх у вашому Java коді: завантажуючи дані з БД в Java-об'єкти, ви можете бути впевнені в їх наявності та прибрати зайві коди програми <code class=" language-none">!= null</code>. 
<h2>Використовуйте шаблон Null-об'єкта</h2>Створення спеціальних <code class=" language-none">Null</code>об'єктів - ще один спосіб уникнути NullPointerExcpetion в Java. Припустимо, якийсь метод у нашому додатку повертає об'єкт, з яким згодом працює програма, викликаючи його методи. Наприклад, метод <code class=" language-none">Collection.iterator()</code>повертає об'єкт класу <code class=" language-none">Iterator</code>, який використовується для проходу колекції. Тоді якщо у початкового об'єкта немає ніякого ітератора, натомість <code class=" language-none">null</code>можна повернути спеціальний <code class=" language-none">Null</code>об'єкт, у якого є метод <code class=" language-none">hasNext()</code>, який завжди повертає.<code class=" language-none">false</code>. Ось і все дорогий читач, на цьому я закінчую свої поради щодо позбавлення Java програм від помилок NullPointerException. Ви оціните, наскільки можуть бути корисні ці прості та не обтяжливі правила. Нагадую, що якщо ви хочете поділитися якимись ще прийомами NullPointerException в програмах на Java, не соромтеся робити це в коментарях. <em>Перекладено спеціально для студентів CodeGym. </em> <a href="https://javarevisited.blogspot.com/2013/05/ava-tips-and-best-practices-to-avoid-nullpointerexception-program-application.html" rel="nofollow" target="_blank">Оригінал</a>