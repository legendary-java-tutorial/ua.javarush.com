Java 7 try-with-resources
<p>----------------------------------------</p>
Починаючи з сьомої версії Java пропонує покращене керування ресурсами, які мають бути закриті після закінчення роботи з ними. До таких ресурсів відносяться, наприклад, потоки файли, з'єднання з базами даних і сокетами. Цій меті є спеціальна
<p>----------------------------------------</p>
Починаючи з сьомої версії Java пропонує покращене керування ресурсами, які мають бути закриті після закінчення роботи з ними. До таких ресурсів відносяться, наприклад, потоки файли, з'єднання з базами даних і сокетами. Цій меті є спеціальна мовна конструкція try-with-resources. Для того щоб це автоматичне закриття працювало створено спеціальний інтерфейс <code class=" language-none">AutoCloseable</code>. <img data-id="d422c039-05f6-4f6f-b1e2-598eaa081fdd" data-max-width="850" alt="Java 7 try-with-resources - 1" src="https://cdn.javarush.com/images/article/d422c039-05f6-4f6f-b1e2-598eaa081fdd/800.jpeg" style="width: 850px;">У Java 7 всі класи ресурсів реалізують цей інтерфейс. Його сигнатура виглядає так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">AutoCloseable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Інтерфейс оголошує метод <code class=" language-none">close()</code>, який автоматично викликається для об'єктів, що обслуговуються конструкцією <code class=" language-none">try-with-resources</code>. Незважаючи на те, що класи ресурсів в Java 7 реалізують цей інтерфейс, безліч бібліотек, якими ви користуєтеся цього не роблять, оскільки бібліотеку ще не оновабо для роботи з інтерфейсом AutoCloseable <em>або</em> ви просто не маєте можливості оновити бібліотеку. Найчастіше це вирішується просто. Наслідуйте клас ресурсу, який повинен брати участь у конструкції <code class=" language-none">try-with-resources</code>. Візьмемо для прикладу <code class=" language-none">ITextRenderer</code>(з проекту Flying Saucer). Після закінчення роботи з <code class=" language-none">ITextRenderer</code>, повинен бути викликаний метод <code class=" language-none">finishPDF()</code>. Зазвичай ви робабо б це в блоці <code class=" language-none">finally</code>. Але створюючи новий клас, що розширює <code class=" language-none">ITextRenderer</code>та реалізує інтерфейс<code class=" language-none">AutoCloseable</code>Ви можете включити його в конструкцію <code class=" language-none">try-with-resources</code>. Новий клас <code class=" language-none">AutoCloseableITextRenderer</code>при цьому виглядатиме так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">AutoCloseableITextRenderer</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">ITextRenderer</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">AutoCloseable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">super</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">finishPDF</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Розширення оригінального класу в нащадку є найбільш розумним рішенням, оскільки новий клас як і раніше буде <code class=" language-none">ITextRenderer</code>. Якщо вихідний клас оголошено як <code class=" language-none">final</code>, необхідно використовувати композицію. І ось як при цьому виглядатиме використання: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">AutoCloseableITextRenderer</span></span> iTextRenderer <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">AutoCloseableITextRenderer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">ByteArrayOutputStream</span></span> out<span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// contains the data to be converted to PDF, not shown here.</span></span>
            iTextRenderer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setDocumentFromString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toByteArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            iTextRenderer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">layout</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            iTextRenderer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createPDF</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>pdfOutputStream<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            pdfOutputStream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">flush</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> От і все. Будь ласка, зверніть увагу, що я не викидав виняток із методу <code class=" language-none">close()</code>в класі <code class=" language-none">AutoCloseableITextRenderer</code>. У Javadoc інтерфейсу <code class=" language-none">AutoCloseable</code>з цього приводу сказано наступне: Хоча метод інтерфейсу декларовано викидати винятки <code class=" language-none">Exception</code>, що реалізує цей метод настійно рекомендується використовувати при реалізації методу більш специфічні класи винятків, або взагалі не викидати винятків, якщо метод <code class=" language-none">close()</code>не може впасти.