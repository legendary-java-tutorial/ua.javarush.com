MVP в Android для найменших
<p>----------------------------------------</p>
Коли я починав свій шлях Android-розробника, слова «Архітектура мобільного додатка» викликали в мене глибоке здивування, гугл і статті на Хабре вганяли ще більшу депресію - дивлюся в книгу, бачу фігу. Думаю, якщо ти читаєш цю статтю, то вже
<p>----------------------------------------</p>
Коли я починав свій шлях Android-розробника, слова «Архітектура мобільного додатка» викликали в мене глибоке здивування, гугл і статті на Хабре вганяли ще більшу депресію - дивлюся в книгу, бачу фігу. Думаю, якщо ти читаєш цю статтю, то вже не раз вивчав цю картинку і намагався зрозуміти, що відбувається: <img data-id="197f820a-daa9-43b4-9a4d-bb4e9d130ee7" data-max-width="850" alt="MVP в Android для найменших - 1" src="https://cdn.javarush.com/images/article/197f820a-daa9-43b4-9a4d-bb4e9d130ee7/800.jpeg" style="width: 850px;">Проблема розуміння архітектурного підходу в мобільній розробці, як на мене, криється в абстрактності самої архітектури. У кожного розробника своє бачення того, як правильно реалізувати той чи інший патерн. Більш-менш пристойні приклади реалізації MVP знайшлися в англомовному секторі інтернету, що не дивно. Коротенько розберемо, що є що, і перейдемо, наприклад. <strong>Model</strong> – рівень даних. Не люблю використовувати термін «бізнес логіка», тому у своїх додатках я називаю його<strong>Repository</strong> і він спілкується з базою даних та мережею. <strong>View</strong> – рівень відображення. Це буде <strong>Activity</strong> , <strong>Fragment</strong> або <strong>Custom View</strong> , якщо ви не любите танців з бубном та взаємодії з життєвим циклом. Нагадаю, що спочатку всі додатки Android підпорядковані структурі <strong>MVC</strong> , де <strong>Controller</strong> це <strong>Activity</strong> або <strong>Fragment</strong> . <strong>Presenter</strong>- Прошарок між View і Model. View передає йому події, що відбуваються, презентер обробляє їх, при необхідності звертається до Model і повертає View дані на малювання. Стосовно Android і конкретного прикладу, виділю важливу частину - Contract. Це інтерфейс, який описує всі взаємодії між перерахованими компонентами. <strong>Резюмуючи теоретичну частину:</strong>
<ul>
 <li>View знає про Presenter;</li>
 <li>Presenter знає про View та Model (Repository);</li>
 <li>Model сама по собі;</li>
 <li>Контракт регулює взаємодії між ними.</li>
</ul>Власне, сам приклад, для простоти експерименту за натисканням на кнопку завантажувати рядок з БД і відображати в <strong>TextView</strong> . Наприклад, БД містить список найкращих ресторанів міста. <strong>Почнемо з контракту:</strong> Створимо інтерфейс <code class=" language-none">MainContract</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">MainContract</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">View</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">showText</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">Presenter</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onButtonWasClicked</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onDestroy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">Repository</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">loadMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Поки що ми просто виділяємо 3 компоненти нашого майбутнього додатку і що вони робитимуть. <strong>Далі опишемо Repository:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MainRepository</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>Repository</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> TAG <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"MainRepository"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">loadMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"loadMessage()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token comment"><span class="token comment">/** Здесь обращаемся к БД або сети.
         * Я специально ничего не пишу, чтобы не загромождать пример
         * DBHelper'ами и прочими не относяшимеся к теме об'єктами.
         * Поэтому я буду возвращать строку Сосисочная =)
         */</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> "Сосисочная у Лёхи»<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> З ним все зрозуміло, просто завантаження – вивантаження даних. <strong>Далі на черзі Presenter:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MainPresenter</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>Presenter</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> TAG <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"MainPresenter"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">//Компоненты MVP програми</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>View</span></span> mView<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>Repository</span></span> mRepository<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">//Сообщение</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>


    <span class="token comment"><span class="token comment">//Обрати внимание на аргументы конструктора - мы передаем экземпляр View, а Repository просто создаём конструктором.</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">MainPresenter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>View</span></span> mView<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>mView <span class="token operator"><span class="token operator">=</span></span> mView<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>mRepository <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">MainRepository</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Constructor"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token comment"><span class="token comment">//View сообщает, что кнопка была нажата</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onButtonWasClicked</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        message <span class="token operator"><span class="token operator">=</span></span> mRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">loadMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        mView<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">showText</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"onButtonWasClicked()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onDestroy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token comment"><span class="token comment">/**
         * Если бы мы работали например с RxJava, в этом классе стоило бы отписываться от подписок
         * Кроме того, при работе с другими методами асинхронного андроида,здесь мы боремся с утечкой контекста
         */</span></span>

        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"onDestroy()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Пам'ятаєш, я писав про танці з бубном та життєвий цикл? Presenter живе до тих пір, поки живе його View, при розробці складних користувальницьких сценаріїв, раджу дублювати всі колбеки View в Presenter'e і викликати їх у відповідні моменти, дублюючи ЖЦ Activity/Fragment, щоб вчасно зрозуміти, що потрібно зробити з тими даними, які висять зараз у «прошарку». <strong>І нарешті, View:</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MainActivity</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">AppCompatActivity</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>View</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> TAG <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"MainActivity"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">MainContract<span class="token punctuation"><span class="token punctuation">.</span></span>Presenter</span></span> mPresenter<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Button</span></span> mButton<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">TextView</span></span> myTv<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onCreate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Bundle</span></span> savedInstanceState<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">super</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">onCreate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>savedInstanceState<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token function"><span class="token function">setContentView</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">R</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>layout<span class="token punctuation"><span class="token punctuation">.</span></span>activity_main<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token comment"><span class="token comment">//Создаём Presenter и в аргументе передаём ему this - эта Activity расширяет интерфейс MainContract.View</span></span>
        mPresenter <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">MainPresenter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        myTv <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">TextView</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token function"><span class="token function">findViewById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">R</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>id<span class="token punctuation"><span class="token punctuation">.</span></span>text_view<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        mButton <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Button</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token function"><span class="token function">findViewById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">R</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>id<span class="token punctuation"><span class="token punctuation">.</span></span>button<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        mButton<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setOnClickListener</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">View<span class="token punctuation"><span class="token punctuation">.</span></span>OnClickListener</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
            <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onClick</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">View</span></span> v<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                mPresenter<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">onButtonWasClicked</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"onCreate()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">showText</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        myTv<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setText</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"showMessage()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token comment"><span class="token comment">//Вызываем у Presenter метод onDestroy, чтобы избежать утечек контекста и прочих неприятностей.</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onDestroy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">super</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">onDestroy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        mPresenter<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">onDestroy</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">Log</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">d</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>TAG<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"onDestroy()"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Що ж відбувається?</strong>
<ul>
 <li>Activity, вона ж View, у методі <code class=" language-none">onCreate()</code>створює примірник Presenter і передає йому конструктор себе.</li>
 <li>Presenter при створенні явно отримує View і створює екземпляр Repository (його, до речі, можна зробити Singleton)</li>
 <li>При натисканні на кнопку View стукає презентеру і повідомляє: «Кнопка була натиснута».</li>
 <li>Presenter звертається до Repository: «Завантаж мені цю шнягу».</li>
 <li>Repository вантажить і віддає "шнягу" Presenter'у.</li>
 <li>Presenter звертається до View: "Ось тобі дані, малюй"</li>
</ul>Ось і все, хлопці. PS Важливо чітко розмежувати обов'язки компонентів. Наприклад, в одному з моїх навчальних проектів натискання на кнопку необхідно було змінити дані в БД. Модель описувалася POJO – класом, я передавав інформацію про розташування view, що відповідає за інформацію про об'єкт на екрані, Presenter шукав цей об'єкт у списку та віддавав його на запис у Repository. Здається, все логічно? Але мій наставник звернув увагу на наступне: Repository повинен займатися ТІЛЬКИ записом та читанням, він не повинен витягувати з POJO потрібну інформацію та приймати рішення, що йому потрібно писати. Presenter повинен віддати йому лише інформацію на запис і нічого більше. Нема жорстких рамок реалізації архітектури: експериментуй, пробуй, шукай те, що зручно особисто тобі. І не забудь показати старшим товаришам на code review =) <strong>Приклад доступний на GitHub: </strong><a href="https://github.com/admitrevskiy/MVP_Example" target="_blank" rel="nofollow">https://github.com/admitrevskiy/MVP_Example</a>