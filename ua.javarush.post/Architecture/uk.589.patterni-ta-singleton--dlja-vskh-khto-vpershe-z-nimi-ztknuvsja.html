Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся
<p>----------------------------------------</p>
Ця стаття орієнтована на тих, хто вперше зіткнувся з поняттям патернів, почув про 'e, або якимось чином його зробив, але так нічого й не зрозуміли. Welcome! Вперше з патернами студенти JavaRush стикаються на 15 рівні, коли несподіваним чино
<p>----------------------------------------</p>
Ця стаття орієнтована на тих, хто вперше зіткнувся з поняттям патернів, почув про <code class=" language-none">Singleton</code>'e, або якимось чином його зробив, але так нічого й не зрозуміли. Welcome! Вперше з патернами студенти CodeGym стикаються на 15 рівні, коли несподіваним чином кеп просить "закріпити" і реалізувати патерн <code class=" language-none">Singleton</code>з лінивою реалізацією. У студентів, які вперше почули про <code class=" language-none">Singleton</code>, миттєво виникає купа питань: що взагалі таке патерн, навіщо він потрібен, який ще й нарешті <code class=" language-none">Singleton</code>, що ще за лінива реалізація. Почнемо відповідати по-порядку: <img data-id="15de364e-776e-43a7-8638-d3e4dafef2ac" data-max-width="850" alt="Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся." src="https://cdn.javarush.com/images/article/15de364e-776e-43a7-8638-d3e4dafef2ac/800.jpeg" style="width: 850px;">
<h2>Що взагалі таке патерн</h2>Відповідати на це питання для кращого розуміння, гадаю, варто з історії. Серед програмістів є така знаменита четвірка авторів: Еріх Гамма, Річард Хелм, Ральф Джонсон та Джон Вліссідес, яким спала на думку цікава думка. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="96dd7ea7-8d3f-457a-936d-f66badabc64a" data-max-width="588" alt="Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся." src="https://cdn.javarush.com/images/article/96dd7ea7-8d3f-457a-936d-f66badabc64a/512.jpeg" style="width: 588px;">
 </div>
</div>Вони помітабо, що з написанні програм їм часто доводиться вирішувати приблизно одні й самі завдання, і писати структурою однотипний код. Тому вони вирішабо описати як патернів типові шаблони, які часто доводиться використовувати в об'єктно-орієнтованому програмуванні. Книжка вийшла 1995 року під назвою <a href="https://www.ozon.ru/context/detail/id/2457392/" target="_blank" rel="nofollow">«Прийоми об'єктно-орієнтованого проектування. Паттерни проектування»</a> . Назва книги виявилася занадто довгою, і її просто почали називати <strong>«Книгою банди чотирьох»</strong> . У першому виданні було опубліковано 23 патерни, після чого було відкрито і десятки інших. Так от, відповідаючи на запитання цього параграфа, — <strong>«Що ж таке патерни»</strong> , підсумуємо буквально кількома словами: 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Паттерн – це стандартизоване вирішення проблеми, що часто зустрічається.</td>
   </tr>
  </tbody>
 </table>
</div>І <code class=" language-none">Singleton</code>– це лише один з таких патернів. 
<h2>Навіщо потрібні патерни (шаблони проектування)</h2>Програмувати виходить і без знання патернів, переконатися в цьому можна просто усвідомивши той факт, що до 15 рівня на CodeGym ви написали сотні міні-програм, нічого не знаючи про їх існування. Це говорить про те, що патерн - це свого роду інструмент, наявність якого і відрізняє майстра від любителя: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="976aacbf-71d7-49c5-ba2e-a6854d8c89bd" data-max-width="1009" alt="Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся - 3" src="https://cdn.javarush.com/images/article/976aacbf-71d7-49c5-ba2e-a6854d8c89bd/800.jpeg" style="width: 1009px;">
 </div>
</div>У патернах описується, як правильно вирішувати одне з типових завдань. Як наслідок, знання патернів заощаджує ваш час. Можна навести аналогію з алгоритмами. Наприклад, можна вигадувати "свій" алгоритм сортування<s> з блекджеком та цифрами</s>і витратити на це багато часу, а можна використовувати вже давно описаний та реалізувати його. Те саме і з патернами. Плюс до всього, з використанням патернів код стає більш стандартизованим, а при використанні потрібних шаблонів у вас буде менше ймовірності зробити помилки, оскільки їх уже давно передбачали та усунули у цьому патернті. Ну і плюс до всього, знання патернів дозволяє програмістам краще розуміти одне одного. Досить просто вимовити назву шаблону, замість того, щоб намагатися пояснити своїм колегам-програмістам, чого ви хочете від них. <strong>Отже, підсумуємо,</strong> шаблони проектування допомагають: 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>
     <ul>
      <li>не винаходити велосипед, а використовувати стандартні рішення;</li>
      <li>стандартизувати код;</li>
      <li>стандартизувати термінологію;</li>
     </ul></td>
   </tr>
  </tbody>
 </table>
</div>Наприкінці цього розділу відзначимо, що всі різноманіття патернів можна спрощено розбити на три великі групи: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="19d3d0c0-1922-468f-a147-65066ef51e38" data-max-width="977" alt="Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся - 4" src="https://cdn.javarush.com/images/article/19d3d0c0-1922-468f-a147-65066ef51e38/800.jpeg" style="width: 977px;">
 </div>
</div>
<h2>Нарешті патерн Singleton</h2><code class=" language-none">Singleton</code>відноситься до <u>породжувальних патернів</u> . Його дослівний переклад – одинак. Цей патерн гарантує, що клас має лише один об'єкт (один екземпляр класу) і до цього об'єкта надається глобальна точка доступу. З опису має бути зрозуміло, що цей патерн повинен застосовуватись у двох випадках: 
<ol>
 <li>коли у вашій програмі має бути створено не більше одного об'єкта будь-якого класу. Наприклад, у комп'ютерній грі у вас є клас «Персонаж», і цей клас повинен мати лише один об'єкт, що описує самого персонажа.</li>
 <br>
 <li>коли потрібно надати глобальну точку доступу до об'єкта класу. Іншими словами, потрібно зробити так, щоб об'єкт викликався з будь-якого місця програми. І, на жаль, для цього не просто створити глобальну змінну, адже вона не захищена від запису і будь-хто може змінити значення цієї змінної і глобальна точка доступу до об'єкта буде втрачена. Це властивості <code class=" language-none">Singleton</code>'a потрібно, наприклад, коли у вас є об'єкт класу, який працює з базою даних, і вам потрібно, щоб до бази даних був доступ із різних частин програми. А <code class=" language-none">Singleton</code>гарантуватиме, що жодний інший код не замінив створений раніше екземпляр класу.</li>
</ol>Ось ці дві задачі і вирішує <code class=" language-none">Singleton</code>: об'єкт у програмі має бути один і до нього є глобальний доступ. У прикладі на 15 рівні кеп просить реалізувати цей патерн для наступного завдання (ось її опис): 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="19790e28-cc64-4e28-b619-e0e4afdee35f" data-max-width="789" alt="Паттерни та Singleton – для всіх, хто вперше з ними зіткнувся - 5" src="https://cdn.javarush.com/images/article/19790e28-cc64-4e28-b619-e0e4afdee35f/512.jpeg" style="width: 789px;">
 </div>
</div>Уважно прочитавши умову, стає зрозуміло, навіщо тут потрібен саме <code class=" language-none">Singleton</code>(Одиночка). Адже в програмі просять створити по одному об'єкту кожного класу: <code class=" language-none">Sun</code>, <code class=" language-none">Moon</code>, <code class=" language-none">Earth</code>. І логічно припустити, що кожен клас у програмі повинен створювати не більше одного Сонця / Місяця / Землі, інакше це буде абсурд, якщо, звичайно, ви не пишите свою версію зоряних воїн. <strong>Особливість реалізації <code class=" language-none">Singleton</code>Java за три кроки</strong> Поведінка Одинаки Java неможливо реалізувати за допомогою звичайного конструктора, тому що конструктор завжди повертає новий об'єкт. Тому всі реалізації<code class=" language-none">Singleton</code>'a зводяться до того, щоб приховати конструктор і створити публічний статичний метод, який буде керувати існуванням об'єкта-одиначки і «знищувати» всіх об'єктів, що знову з'являються. У разі виклику <code class=" language-none">Singleton</code>'a він повинен створити новий об'єкт (якщо його ще немає в програмі), або повернути вже створений. І тому: <strong>#1. </strong>– Потрібно додати до класу приватне статичне поле, що містить одиночний об'єкт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> instance<span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//#1</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>#2. </strong>- Зробити конструктор класу (конструктор за замовчуванням) приватним (щоб доступ до нього був закритий за межами класу, тоді він не зможе повертати нові об'єкти): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> instance<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token comment"><span class="token comment">// #2</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>#3</strong> . – Оголосити статичний метод, який буде використовуватися для отримання одинаки: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> instance<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span> <span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span> <span class="token comment"><span class="token comment">// #3</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>instance <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>		<span class="token comment"><span class="token comment">//якщо об'єкт ще створено</span></span>
            instance <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LazyInitializedSingleton</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>	<span class="token comment"><span class="token comment">//створити новий об'єкт</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> instance<span class="token punctuation"><span class="token punctuation">;</span></span>		<span class="token comment"><span class="token comment">// Повернути раніше створений об'єкт</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Вищеописаний приклад дещо незграбний, адже ми просто приховуємо конструктор і надаємо замість стандартного конструктора свій метод. Так як ця стаття спрямована на те, щоб студенти CodeGym'a змогли вперше доторкнутися до цього патерна (і патернами в принципі), тут не будуть наведені особливості реалізації більш складних одинаків. Зазначимо лише, що залежно від складності програми може знадобитися докладніше доопрацювання цього патерну. Наприклад, у багатопотоковому середовищі (див. тему Thread'и), кілька різних потоків можуть одночасно викликати метод отримання Одинаки, і описаний вище код перестане працювати, бо кожен окремий потік зможе створити відразу кілька екземплярів класу. Тому є ще кілька різних підходів до створення правильних Thread-safe одинаків. Але це вже інша історія =) <strong>І на останок. Що ж таке Лінива Ініціалізація, про яку просив кеп</strong> Ледачу ініціалізацію (Lazy Initialization) ще називають відкладеною ініціалізацією. Це прийом у програмуванні, коли ресурсомістка операція (а створення об'єкта – це ресурсомістка операція) виконується на вимогу, а чи не заздалегідь. Що загалом і відбувається у нашому коді <code class=" language-none">Singleton</code>'a. Інакше кажучи, наш об'єкт створюється на момент звернення щодо нього, а чи не заздалегідь. Не слід вважати, що поняття лінивої ініціалізації якось жорстко пов'язане саме з ним <code class=" language-none">Singleton</code>. Відкладена ініціалізація також використовується і в інших патернах проектування, що породжують, наприклад в таких як Proxy (Заступник) і Factory Method (Фабричний метод), але це теж інша історія =) <strong>Під час підготовки матеріалів статті використовувалися такі источники:</strong>
<ol>
 <li><a href="https://www.journaldev.com/1377/java-singleton-design-pattern-best-practices-examples#lazy-initialization" target="_blank" rel="nofollow">Java Singleton Design Pattern Best Practices with Examples</a></li>
 <li><a href="https://refactoring.guru/ru/design-patterns" target="_blank" rel="nofollow">Патерни проектування</a></li>
 <li><a href="https://habr.com/post/129494/" target="_blank" rel="nofollow">Правильний Singleton в Java</a></li>
</ol>