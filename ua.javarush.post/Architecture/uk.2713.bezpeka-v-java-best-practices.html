Безпека в Java: best practices
<p>----------------------------------------</p>
У серверних додатках один із найважливіших показників — це безпека. Це один із видів (нефункціональних вимог). Безпека включає безліч компонентів. Зрозуміло, щоб охопити повною мірою та об'ємом усі ті захисні принципи та дії, які відомі, по
<p>----------------------------------------</p>
У серверних додатках один із найважливіших показників — це безпека. Це один із видів <a href="https://en.wikipedia.org/wiki/Non-functional_requirement" rel="nofollow" target="_blank">Non-Functional Requirements</a> (нефункціональних вимог). <img data-max-width="800" data-id="0b2f7b30-4236-4863-82b4-b34826db5fd6" class="img-fluid" alt="Безпека в Java: best practices - 1" src="https://cdn.javarush.com/images/article/0b2f7b30-4236-4863-82b4-b34826db5fd6/800.jpeg" style="width: 800px;">Безпека включає безліч компонентів. Зрозуміло, щоб охопити повною мірою та об'ємом усі ті захисні принципи та дії, які відомі, потрібно написати не одну статтю, тож зупинимося на найважливішому. Людина, яка добре розуміється на цій темі, зможе налаштувати всі процеси і простежити, щоб вони не створювали нових дірок у безпеці, буде потрібна в будь-якій команді. Звичайно, не варто думати, що якщо дотримуватися цих практик, то додаток буде однозначно безпечним. Ні! Але воно точно буде безпечнішим з ними. Поїхали. 
<h2>1. Забезпечити безпеку на рівні мови Java</h2>Перш за все, безпека Java починається прямо на рівні можливостей мови. Ось що б ми робабо, якби не було модифікаторів доступу? Анархія, не інакше. Мова програмування допомагає нам писати безпечний код, а також користуватися багатьма неявними функціями безпеки: 
<ol>
 <li><span class="text-bold">Сувора типізація. Java</span> - це мова зі статичною типізацією, яка дає можливість виявлення помилок, пов'язаних з типами під час виконання.</li>
 <li><span class="text-bold">Модифікатори доступу. </span>Завдяки їм ми можемо налаштовувати доступ до класів, методів та полів класів так, як нам потрібно.</li>
 <li><span class="text-bold">Автоматичне керування пам'яттю. </span>Для цієї справи у нас (у джавістів;)) є Garbage Collector, який звільняє від налаштування вручну. Так, іноді виникають проблеми.</li>
 <li><span class="text-bold">Перевірка байткод:</span> Java компілюється в байткод, який перевіряє <span class="text-bold">runtime</span> , перш ніж запустити його.</li>
</ol>Крім того, є <a href="https://www.oracle.com/java/technologies/security.html" rel="nofollow" target="_blank">рекомендації від Оракла</a> з безпеки. Звичайно написано не "високим складом" і можна заснути кілька разів при прочитанні, але воно варте того. Особливо важливим є документ <a href="https://www.oracle.com/technetwork/java/seccodeguide-139067.html" rel="nofollow" target="_blank">Secure Coding Guidelines for Java SE</a> , в якому є поради, як писати безпечний код. Цей документ має багато корисного. Якщо є можливість обов'язково варто прочитати. Для розігріву інтересу до цього матеріалу наведу кілька цікавих порад: 
<ol>
 <li>Уникайте серіалізації чутливих до безпеки (secure-sensitive) класів. У цьому випадку можна отримати за серіалізованим файлом інтерфейс класу, не кажучи вже про серіалізовані дані.</li>
 <li>Намагайтеся уникати mutable класів для даних. Це дає всі переваги незмінних класів (наприклад, безпека потоку). Якщо об'єкт, що змінюється, це може призвести до несподіваної поведінки.</li>
 <li>Створюйте копії об'єктів, що змінюються. Якщо метод повертає посилання на внутрішній об'єкт, що змінюється, тоді клієнтський код може змінити внутрішній стан об'єкта.</li>
 <li>І так далі…</li>
</ol>Загалом, у Secure Coding Guidelines for Java SE зібрано набір порад та рекомендацій щодо того, як правильно та безпечно писати код на Java. 
<h2>2. Усунути SQL injection вразливість</h2>Унікальна вразливість. Унікальність її полягає в тому, що вона одночасно і одна з найвідоміших, і одна з найчастіших вразливостей. Якщо не цікавитись питанням безпеки, то про це й не дізнаєшся. Що таке SQL injection? Це атака бази даних за допомогою впровадження додаткового SQL коду там, де це не очікується. Припустимо, ми маємо метод, який приймає якийсь параметр для запиту в базу даних. Наприклад, ім'я користувача. Код з уразливістю виглядатиме приблизно так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Метод достает из базы данных всех пользователей с определенным именем</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">findByFirstName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> firstName<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token comment"><span class="token comment">// Создается связь с базой данных</span></span>
   <span class="token class-name"><span class="token class-name">Connection</span></span> connection <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">DriverManager</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DB_URL<span class="token punctuation"><span class="token punctuation">,</span></span> USER<span class="token punctuation"><span class="token punctuation">,</span></span> PASS<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// Пишем sql запит в базу данных с нашим firstName</span></span>
   <span class="token class-name"><span class="token class-name">String</span></span> query <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"SELECT * FROM USERS WHERE firstName = "</span></span> <span class="token operator"><span class="token operator">+</span></span> firstName<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// выполняем запит</span></span>
   <span class="token class-name"><span class="token class-name">Statement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">ResultSet</span></span> result <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeQuery</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// при помощи mapToUsers переводит ResultSet в коллекцию юзеров.</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> <span class="token function"><span class="token function">mapToUsers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">mapToUsers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ResultSet</span></span> resultSet<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token comment"><span class="token comment">//переводит в коллекцию юзеров</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У цьому прикладі SQL запит готується заздалегідь в окремому рядку. Здавалося б, у чому проблема, так? Може, проблема в тому, що краще б використати <code class=" language-none">String.format</code>? Ні? А в чому ж тоді? Поставимо себе місце тестувальника і подумаємо, що можна передати у значенні <code class=" language-none">firstName</code>. Наприклад: 
<ol>
 <li>Можна передати те, що очікується, — ім'я користувача. Тоді база даних поверне всіх користувачів із таким ім'ям.</li>
 <li>Можна передати порожній рядок: тоді повернуться всі користувачі.</li>
 <li>А можна передати таке: “”; DROP TABLE USERS;”. І тут вже будуть великі проблеми. Цим запитом буде видалена таблиця з бази даних. З усіма даними. ВСІМИ.</li>
</ol>Уявляєте, які проблеми можуть бути через це? Далі можна писати що завгодно. Можна змінити ім'я всіх користувачів, можна видалити їх адресаи. Простір для шкідництва великий. Щоб уникнути цього, потрібно припинити впровадження вже готового запиту і натомість формувати його за допомогою параметрів. Це має бути єдиний спосіб створення запитів до бази даних. У такий спосіб можна усунути цю вразливість. Приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Метод достает из базы данных всех пользователей с определенным именем</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">findByFirstName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> firstName<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token comment"><span class="token comment">// Создается связь с базой данных</span></span>
   <span class="token class-name"><span class="token class-name">Connection</span></span> connection <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">DriverManager</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DB_URL<span class="token punctuation"><span class="token punctuation">,</span></span> USER<span class="token punctuation"><span class="token punctuation">,</span></span> PASS<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// Создаем параметризированный запит.</span></span>
   <span class="token class-name"><span class="token class-name">String</span></span> query <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"SELECT * FROM USERS WHERE firstName = ?"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// Создаем подготовленный стейтмент с параметризованным запитом</span></span>
   <span class="token class-name"><span class="token class-name">PreparedStatement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">prepareStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// Передаем значення параметра</span></span>
   statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> firstName<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// выполняем запит</span></span>
   <span class="token class-name"><span class="token class-name">ResultSet</span></span> result <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeQuery</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token comment"><span class="token comment">// при помощи mapToUsers переводим ResultSet в коллекцию юзеров.</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> <span class="token function"><span class="token function">mapToUsers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">mapToUsers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ResultSet</span></span> resultSet<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token comment"><span class="token comment">//переводим в коллекцию юзеров</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Таким чином уникають цієї вразливості. Для тих, кому хочеться поринути у питання глибше цієї статті – <a href="https://habr.com/ru/post/148151/" rel="nofollow" target="_blank">ось чудовий приклад</a> . Як зрозуміти, що ви зрозуміли цю частину? Якщо жарт нижче став зрозумілим, то це вірна ознака, що суть вразливості ясна :D <img data-max-width="800" data-id="dc9fc7cc-6c42-4199-812f-8d754da2dcb9" class="img-fluid" alt="Безпека в Java: best practices - 2" src="https://cdn.javarush.com/images/article/dc9fc7cc-6c42-4199-812f-8d754da2dcb9/800.jpeg" style="width: 800px;">
<h2>3. Сканувати та тримати оновленими залежності</h2>Що це означає? Для тих, хто не знає, що таке залежність (dependency), поясню: це jar архів з кодом, який підключають до проекту за допомогою систем автоматичного складання (Maven, Gradle, Ant) для того, щоб перевикористовувати чиєсь рішення. Наприклад, <a href="https://projectlombok.org/" rel="nofollow" target="_blank">Project Lombok</a>, який за нас генерує в рантаймі гетери, сетери і т.д. А якщо говорити про великі програми, то вони використовують безліч різних залежностей. Деякі транзитивно (тобто, у кожної залежності можуть бути свої залежності, і так далі). Тому зловмисники все частіше звертають увагу на open-source залежності, тому що їх регулярно використовують, і через них у багатьох клієнтів можуть бути проблеми. Важливо переконатися, що у всьому дереві залежностей (а саме так це і виглядає) немає відомих уразливостей. А для цього є кілька шляхів. 
<h3>Використати Snyk для моніторингу</h3>Інструмент <a href="https://snyk.io/" rel="nofollow" target="_blank">Snyk</a> перевіряє всі залежності проекту та відзначає відомі вразливості. Там можна зареєструватися та імпортувати свої проекти через GitHub, наприклад. <img data-max-width="800" data-id="9e0e99e0-ac2b-4459-8775-19f76df22b65" class="img-fluid" alt="Безпека в Java: best practices - 3" src="https://cdn.javarush.com/images/article/9e0e99e0-ac2b-4459-8775-19f76df22b65/800.jpeg" style="width: 800px;">Також, як видно з картинки вище, якщо в новішій версії є рішення цієї вразливості, Snyk запропонує зробити це і створити Pull-Request. Використовувати її можна безкоштовно для open-source проектів. Проекти скануватимуться з якоюсь періодичністю: раз на тиждень, раз на місяць. Я зареєструвався і додав усі свої публічні репозиторії у сканування Snyk (у цьому немає нічого небезпечного: вони й так у відкритому доступі для всіх). Далі Snyk показав результат сканування: <img data-max-width="1024" data-id="2ea60bb0-6e43-4853-aaf3-b02c3d264f4b" class="img-fluid" alt="Безпека в Java: best practices - 4" src="https://cdn.javarush.com/images/article/2ea60bb0-6e43-4853-aaf3-b02c3d264f4b/1024.jpeg" style="width: 1024px;">А через деякий час, Snyk-bot підготував кілька Pull-Request'ів у проектах, де потрібно оновити залежності: <img data-max-width="800" data-id="f9456b32-95db-4ee1-b9f2-560a7dde4712" class="img-fluid" alt="Безпека в Java: best practices - 5" src="https://cdn.javarush.com/images/article/f9456b32-95db-4ee1-b9f2-560a7dde4712/800.jpeg" style="width: 800px;">І ось ще: <img data-max-width="800" data-id="01c21b1f-6a24-4eae-9eee-018b6bfd5923" class="img-fluid" alt="Безпека в Java: best practices - 6" src="https://cdn.javarush.com/images/article/01c21b1f-6a24-4eae-9eee-018b6bfd5923/800.jpeg" style="width: 800px;">Так що це чудовий інструмент для пошуку вразливостей та моніторингу щодо оновлення нових версій. 
<h3>Використовувати GitHub Security Lab</h3>Ті, хто працює GitHub, можуть скористатися та їх вбудованими інструментами. Більш детально про цей підхід можна почитати у моєму перекладі з їхнього блогу <a href="https://codegym.cc/groups/posts/2376-anons-github-security-lab-zajshita-vsego-koda-vmeste" target="_blank">Анонс GitHub Security Lab</a> . Цей інструмент, звичайно, простіше, ніж Snyk, але нехтувати ним точно не варто. Плюс до всього кількість відомих уразливостей тільки зростатиме, тому і Snyk, і GitHub Security Lab розширюватимуться і покращуватимуться. 
<h3>Активувати Sonatype DepShield</h3>Якщо користуватися GitHub'ом для зберігання своїх репозиторіїв, можна додати до себе на проекти з MarketPlace одну з програм - Sonatype DepShield. За його допомогою можна також сканувати проекти залежно. Більше того, якщо він знайде щось, буде створено GitHub Issue з відповідним описом, як показано нижче: <img data-max-width="800" data-id="28344ac3-3581-4fb0-964b-d8f6cb2393ab" class="img-fluid" alt="Безпека в Java: best practices - 7" src="https://cdn.javarush.com/images/article/28344ac3-3581-4fb0-964b-d8f6cb2393ab/800.jpeg" style="width: 800px;">
<h2>4. Обережно поводитися з конфіденційними даними</h2><img data-max-width="800" data-id="bf38ad94-faf3-4a51-8035-73cf7fefd71c" class="img-fluid" alt="Безпека в Java: best practices - 8" src="https://cdn.javarush.com/images/article/bf38ad94-faf3-4a51-8035-73cf7fefd71c/800.jpeg" style="width: 800px;">В англійській мові найчастіше зустрічається словосполучення “sensitive data”. Розкриття персональних даних, номерів кредитних карток та іншої особистої інформації клієнта може завдати непоправної шкоди. Насамперед, потрібно уважно подивитися на дизайн програми та визначити, чи дійсно потрібні якісь дані. Можливо, щодо них жодної потреби немає, а додали їх для майбутнього, яке не настало і навряд чи настане. До того ж, під час логування проекту може статися витік таких даних. Простий спосіб запобігти попаданню конфіденційних даних у ваші логи – очистити методи <code class=" language-none">toString()</code>доменних сутностей (таких як User, Student, Teacher тощо). Таким чином, не можна буде роздрукувати конфіденційні поля випадково. Якщо використовувати Lombok для генерації методу <code class=" language-none">toString()</code>, то можна використовувати інструкцію<code class=" language-none">@ToString.Exclude</code>щоб поле не використовувалося у виведенні через метод <code class=" language-none">toString()</code>. Крім того, будьте дуже обережні, передаючи дані до зовнішнього світу. Наприклад, є http endpoint, який відображає імена всіх користувачів. Не потрібно показувати внутрішній унікальний ідентифікатор користувача. Чому? Тому що по ньому зловмисник може отримати іншу, більш конфіденційну інформацію про кожного користувача. Наприклад, якщо задіяти Jackson для серіалізації та десеріалізації <a href="https://ru.wikipedia.org/wiki/POJO" rel="nofollow" target="_blank">POJO</a> у <a href="https://ru.wikipedia.org/wiki/JSON" rel="nofollow" target="_blank">JSON</a> , то можна використовувати анотації <code class=" language-none">@JsonIgnore</code>та <code class=" language-none">@JsonIgnoreProperties</code>, щоб виключити серіалізацію та десеріалізацію конкретних полів. А взагалі потрібно використовувати різні класи POJO для різних місць. Що це означає? 
<ol>
 <li>Для роботи з базою даних використовувати одні POJO – Entity.</li>
 <li>Для роботи з бізнес логікою перекладати Entity в Model.</li>
 <li>Для роботи із зовнішнім світом та з відправкою на http запити – використовувати треті сутності – DTO.</li>
</ol>Таким чином, можна чітко визначити, які саме поля будуть видно зовні, а які — ні. 
<h2>Використовувати надійні алгоритми шифрування та хешування</h2>Конфіденційні дані клієнтів слід зберігати надійно. Для цього необхідно використовувати шифрування. Залежно від завдання потрібно вирішити, який тип шифрування використовувати. Далі, сильніше шифрування вимагає більше часу, тому знову ж таки потрібно враховувати, наскільки його необхідність виправдовує витрачений на цей час. Зрозуміло, можна написати алгоритм самому. Але це зайве. Можна скористатися вже існуючими рішеннями у цій галузі. Наприклад, <a href="https://github.com/google/tink" rel="nofollow" target="_blank">Google Tink</a> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">!</span></span><span class="token operator"><span class="token operator">--</span></span> https<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>mvnrepository<span class="token punctuation"><span class="token punctuation">.</span></span>com<span class="token operator"><span class="token operator">/</span></span>artifact<span class="token operator"><span class="token operator">/</span></span>com<span class="token punctuation"><span class="token punctuation">.</span></span>google<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span>tink<span class="token operator"><span class="token operator">/</span></span>tink <span class="token operator"><span class="token operator">--</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>com<span class="token punctuation"><span class="token punctuation">.</span></span>google<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span>tink<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>tink<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">1.3</span></span><span class="token number"><span class="token number">.0</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Подивимося, як ним користуватися, на прикладі того, як провести шифрування в один і інший бік: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">encryptDecryptExample</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">AeadConfig</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">register</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">KeysetHandle</span></span> handle <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeysetHandle</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateNew</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">AeadKeyTemplates</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>AES128_CTR_HMAC_SHA256<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">String</span></span> plaintext <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Цой жив!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">String</span></span> aad <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Юрий Клинских"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">Aead</span></span> aead <span class="token operator"><span class="token operator">=</span></span> handle<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrimitive</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Aead</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> encrypted <span class="token operator"><span class="token operator">=</span></span> aead<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encrypt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>plaintext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> aad<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">String</span></span> encryptedString <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Base64</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getEncoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encodeToString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encryptedString<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> decrypted <span class="token operator"><span class="token operator">=</span></span> aead<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">decrypt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Base64</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDecoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">decode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> aad<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>decrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3>Шифрування паролів</h3>Для цього завдання найбезпечніше використовувати асиметричне шифрування. Чому? Тому що в програмі реально не потрібно розшифровувати паролі назад. Такий загальний підхід. Насправді, коли користувач вводить пароль, система шифрує його і порівнює з тим, що лежить у сховищі паролів. Шифрування проходить одним і тим же засобом, тому можна очікувати, що вони збігатимуться (при введенні правильного пароля;), зрозуміло). Для цієї справи підходять BCrypt та SCrypt. Обидва є односторонніми функціями (криптографічними хешами) з обчислювально-складними алгоритмами, які займають багато часу. Це саме те, що потрібно, тому що розшифровка в лоба займе цілу вічність. Наприклад, Spring Security підтримує низку алгоритмів. Можна скористатися <code class=" language-none">SCryptPasswordEncoder</code>і<code class=" language-none">BCryptPasswordEncoder</code>. Те, що зараз є сильним алгоритмом шифрування, наступного року може бути слабким. Внаслідок цього робимо висновок, що потрібно перевіряти алгоритми, що використовуються, і оновлювати бібліотеки з алгоритмами. 
<h2>Замість виведення</h2>Сьогодні ми поговорабо про безпеку і, зрозуміло, багато речей залишилося за кадром. Я лише прочинив вам двері в новий світ: світ, який живе своїм життям. З безпекою так само, як із політикою: якщо ви не займатиметеся політикою, політика займеться вами. Традиційно пропоную підписатися на <a href="https://github.com/romankh3" rel="nofollow" target="_blank">мій гітхаб аккаунт</a> . Я там викладаю свої напрацювання за різними технологіями, які вивчаю та застосовую на роботі. <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="c4ec753f-5e69-45c8-bbf0-67059d0b2260" class="img-fluid" alt="Безпека в Java: best practices - 9" src="https://cdn.javarush.com/images/article/c4ec753f-5e69-45c8-bbf0-67059d0b2260/1024.jpeg" style="width: 1024px;"></a>
<h2>Корисні посилання</h2>Так, майже всі статті на читати написані англійською. Хочемо ми цього чи ні, але англійська це мова для комунікації програмістів. Усі нові статті, книги, журнали з програмування пишуть англійською. Тому і посилання мої на рекомендації в основному англійською: 
<ol>
 <li>Хабр: <a href="https://habr.com/ru/post/148151/" rel="nofollow" target="_blank">SQL Injection для початківців</a></li>
 <li>Oracle: <a href="https://www.oracle.com/java/technologies/security.html" rel="nofollow" target="_blank">Java Security Resource Center</a></li>
 <li>Oracle: <a href="https://www.oracle.com/technetwork/java/seccodeguide-139067.html" rel="nofollow" target="_blank">Secure Coding Guidelines for Java SE</a></li>
 <li>Baeldung: <a href="https://www.baeldung.com/java-security-overview" rel="nofollow" target="_blank">The Basics of Java Security</a></li>
 <li>Medium: <a href="https://medium.com/myheritage-engineering/10-tips-to-power-up-your-java-security-f3daa4522530" rel="nofollow" target="_blank">10 tips для Power-up вашої Java Security</a></li>
 <li>Snyk: <a href="https://snyk.io/blog/10-java-security-best-practices/" rel="nofollow" target="_blank">10 java security best practices</a></li>
 <li>JR: <a href="https://codegym.cc/groups/posts/2376-anons-github-security-lab-zajshita-vsego-koda-vmeste" target="_blank">Анонс GitHub Security Lab: захист всього коду разом</a></li>
</ol>