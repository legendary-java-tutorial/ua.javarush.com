Java Cryptography Architecture: Перше знайомство
<p>----------------------------------------</p>
Безпека обміну даними - одна з найважливіших властивостей сучасних програм. З давніх-давен люди вигадували хитрі способи, які з розвитком людства стали цілою наукою Криптографією. Звичайно, Java не залишилася осторонь і запропонувала розроб
<p>----------------------------------------</p>
Безпека обміну даними - одна з найважливіших властивостей сучасних програм. З давніх-давен люди вигадували хитрі способи, які з розвитком людства стали цілою наукою Криптографією. Звичайно, Java не залишилася осторонь і запропонувала розробникам Java Cryptography Architecture (JCA). Цей огляд повинен дати перші уявлення про те, як це працює. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="92f6b161-b1fb-41bb-a68c-8cf574ef9060" data-max-width="263" alt="Java Cryptography Architecture: Перше знайомство - 1" src="https://cdn.javarush.com/images/article/92f6b161-b1fb-41bb-a68c-8cf574ef9060/256.jpeg" style="width: 263px;">
 </div>
</div>Зміст: 
<ul>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%9F%D1%80%D0%B5%D0%B4%D0%B8%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D0%B5">Передмова</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#JCA">JCA</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#MessageDigest">MessageDigest</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Симетричне шифрування (symmetric key cryptography)</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%90%D1%81%D1%81%D0%B8%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Асиметричне шифрування (asymmetric cryptography)</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%A6%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C">Цифровий підпис</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#KeyAgreement">KeyAgreement</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%A1%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D1%8B">Сертифікати</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%A5%D1%80%D0%B0%D0%BD%D0%B8%D0%BB%D0%B8%D1%89%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">Сховище ключів (KeyStore)</a></li>
 <li><a href="https://codegym.cc/groups/posts/2277#%D0%98%D1%82%D0%BE%D0%B3">Підсумок</a></li>
</ul>
<h2 id="Предисловие">Передмова</h2>Пропоную перенестися на якийсь час у минуле. Перед нами Стародавній Рим. І перед нами Гай Юлій Цезар, який відправляє своїм полководцям послання. Давайте подивимося, що в цьому повідомленні: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c858d61a-9a97-44b3-bd21-7204fc2c2e85" data-max-width="458" alt="Java Cryptography Architecture: Перше знайомство - 2" src="https://cdn.javarush.com/images/article/c858d61a-9a97-44b3-bd21-7204fc2c2e85/256.jpeg" style="width: 458px;">
 </div>
</div>Що може це значить: <code class=" language-none">"ЕСКЕУГЬГМХИФЯ Е УЛП"</code>? Давайте відкриємо Java Online Compiler, наприклад: <a href="https://repl.it/languages/java" target="_blank" rel="nofollow">repl.it</a>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> code <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"ЕСКЕУГЬГМХИФЯ Е УЛП"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">char</span></span> symbol <span class="token operator"><span class="token operator">:</span></span> code<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>symbol <span class="token operator"><span class="token operator">!=</span></span> <span class="token string"><span class="token string">' '</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        symbol <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">char</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>symbol <span class="token operator"><span class="token operator">-</span></span> <span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token punctuation"><span class="token punctuation">}</span></span>
      <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>symbol<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Перед нами найпростіша реалізація "Шифра Цезаря" (Caesar Cipher). Згідно з працею давньоримського історика Светонія під назвою "Життя дванадцяти цезарів" саме так Цезар шифрував послання до своїх полководців. І це - одна з найдавніших згадок про використання такої речі, як <strong>Криптографія</strong> . Слово " криптографія " походить від давньогрецьких слів " прихований " і " пишу " , тобто. це наука про методи забезпечення конфіденційності. У Java є своя підтримка криптографії і називається вона – <strong>Java Cryptography Architecture</strong> (JCA). Опис можна знайти в офіційній документації від Oracle - " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#Introduction" target="_blank" rel="nofollow">Java Cryptography Architecture (JCA)</a> ". Пропоную подивитись, які можливості ми отримуємо завдяки JCA. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="189" alt="Java Cryptography Architecture: Перше знайомство - 3" src="https://cdn.javarush.com/images/article/f16acbfe-a661-4817-bc9a-1663d4501d74/original.jpeg">
 </div>
</div>
<h2 id="JCA">JCA</h2>Як ми вже раніше дізналися, Java для роботи з криптографією пропонує Java Cryptography Architecture (JCA). Ця архітектура містить API (тобто деякий набір інтерфейсів) та провайдери (які їх реалізують): 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="d197e3a6-3ee3-4d27-928e-58ebf6d2c408" data-max-width="300" alt="Java Cryptography Architecture: Перше знайомство - 4" src="https://cdn.javarush.com/images/article/d197e3a6-3ee3-4d27-928e-58ebf6d2c408/256.jpeg" style="width: 300px;">
 </div>
</div>Як сказано в документації, " <strong>The Java platform включає в себе номер built-in providers</strong> ". Тобто платформа Java надає набір вбудованих провайдерів, які можна доповнити. Це можна побачити самим: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Provider</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Security</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">Provider</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> providers <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Security</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProviders</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Provider</span></span> p <span class="token operator"><span class="token operator">:</span></span> providers<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>p<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Зареєструвати сторонній провайдер дуже просто. Наприклад: <code class=" language-none">Security.addProvider(new BouncyCastleProvider());</code> Цей приклад включає один з найвідоміших провайдерів - <a href="https://www.bouncycastle.org/" target="_blank" rel="nofollow">BouncyCastle</a> . Але в цьому огляді ми користуватимемося лише базовими засобами, без сторонніх бібліотек. Наш основний документ: " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="nofollow">Java Cryptography Architecture (JCA)</a> ". Розуміння роботи JCA допоможе простіше зрозуміти технології, в рамках яких активно використовується цей JCA. Наприклад: HTTPS (див. " <a href="https://codegym.cc/groups/posts/2279-ot-http-do-https" target="_blank" rel="nofollow">Від HTTP до HTTPS</a> "). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="0cf266c7-9cb0-45ba-9d05-2c25a7be716b" data-max-width="316" alt="Java Cryptography Architecture: Перше знайомство - 5" src="https://cdn.javarush.com/images/article/0cf266c7-9cb0-45ba-9d05-2c25a7be716b/256.jpeg" style="width: 316px;">
 </div>
</div>
<h2 id="MessageDigest">MessageDigest</h2>Перше, про що згадується в документації JCA - це MessageDigest. Взагалі Digest російською буде так само - дайджест і відповідає за змістом "короткий виклад". Але в криптографії дайджестом називається хеш-сума. А ще можна легко запам'ятати, що англійською Digest можна перекласти ще як перетравлювати. Докладніше можна прочитати в документації JCA у розділі " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#MessageDigest" target="_blank" rel="nofollow">MessageDigest</a>Як сказано в документації, MessageDigest генерує фіксованого розміру результат, званий digest або hash. першоджерело Але якщо хешується однакові об'єкти (наприклад, рядки з однакових символів), то їх хеш повинен збігатися. даних.Хешування може виконуватися використовуючи різні алгоритми.Доступні алгоритми можна подивитися в документі " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#MessageDigest" target="_blank" rel="nofollow">Java Cryptography Architecture Standard Algorithm Name Documentation for JDK 8</a> ". Давайте виконаємо хешування і виведемо хеш в консоль: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>xml<span class="token punctuation"><span class="token punctuation">.</span></span>bind<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token class-name"><span class="token class-name">MessageDigest</span></span> digester <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">MessageDigest</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SHA-512"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> input <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Secret string"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> digest <span class="token operator"><span class="token operator">=</span></span> digester<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">digest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>input<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printHexBinary</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>digest<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">NoSuchAlgorithmException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Хешування може бути корисним, наприклад, при зберіганні паролів. Оскільки хеш пароля, що вводиться, можна звірити з раніше збереженим хеш. Якщо хеші збіглися, значить і пароль теж збігся. Для ще безпечнішого хешування використовують таке поняття, як "сіль" (salt). Сіль можна реалізувати за допомогою класу <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#SecureRandom" target="_blank" rel="nofollow">SecureRandom</a> . Перед виконанням методу digest опишемо додавання "солі": 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> salt <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">16</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">SecureRandom</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstanceStrong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>salt<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
digester<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>salt<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Але хеш – функція одностороння. А що робити, якщо хочеться мати можливість зашифрувати та розшифрувати? 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="7fc1178f-c80c-4f5b-9a21-812f45504d18" data-max-width="288" alt="Java Cryptography Architecture: Перше знайомство - 6" src="https://cdn.javarush.com/images/article/7fc1178f-c80c-4f5b-9a21-812f45504d18/256.jpeg" style="width: 288px;">
 </div>
</div>
<h2 id="Симметричное_шифрование">Симетричне шифрування (symmetric key cryptography)</h2>Симетричне шифрування - це шифрування, при якому для шифрування та дешифрування використовується той самий ключ. Для того, щоб використовувати симетричне шифрування, нам потрібен ключ. Щоб його отримати використовуємо <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#KeyGenerator" target="_blank" rel="nofollow">KeyGenerator</a> . Крім того, нам знадобиться клас, що є шифром ( <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#Cipher" target="_blank" rel="nofollow">Cipher</a> ). Як сказано в документації JCA у розділі " <strong>Creating a Cipher Object</strong> ", щоб створити Cipher потрібно вказати у рядку не просто алгоритм, а "трансформацію". Опис трансформації виглядає наступним чином: "algorithm/mode/padding": 
<ul>
 <li><strong>Алгоритм</strong> : тут дивимося в стандартних іменах для " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#Cipher" target="_blank" rel="nofollow">Cipher (Encryption) Algorithms</a> ". Рекомендується використовувати AES.</li>
 <li><strong>Режим</strong> : режим шифрування. Наприклад: ECB або CBC (про це ми поговоримо трохи далі)</li>
 <li><strong>Відступ/розбивка</strong> : кожен блок даних шифрується окремо. Цей параметр визначає, який обсяг даних рахувати за 1 блок.</li>
</ul>Наприклад, візьмемо таку трансформацію: <code class=" language-none">"AES/ECB/PKCS5Padding"</code>. Тобто алгоритм шифрування – AES, режим шифрування ECB (скорочення для Electronic Codebook), розмір блоку – PKCS5Padding. PKCS5Padding каже, що розмір одного блоку – 2 байти (16 біт). Режим шифрування Electronic Codebook передбачає послідовне шифрування кожного блоку: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="05234cac-36e5-4a9a-a34e-a751bf9a70e3" data-max-width="547" alt="Java Cryptography Architecture: Перше знайомство - 7" src="https://cdn.javarush.com/images/article/05234cac-36e5-4a9a-a34e-a751bf9a70e3/512.jpeg" style="width: 547px;">
 </div>
</div>Виглядати в коді це може так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>xml<span class="token punctuation"><span class="token punctuation">.</span></span>bind<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Key</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> text <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"secret!!secret!!secret!!secret!!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Generate new key</span></span>
    <span class="token class-name"><span class="token class-name">KeyGenerator</span></span> keygen <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AES"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    keygen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">Key</span></span> key <span class="token operator"><span class="token operator">=</span></span> keygen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Encrypt with key</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> transformation <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"AES/ECB/PKCS5Padding"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">Cipher</span></span> cipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>transformation<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ENCRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> encrypted <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>text<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printHexBinary</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Decrypt with key</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>DECRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> result <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encrypted<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Якщо ми здійснимо, то очікувано побачимо повтор, т.к. ми вказали 32 символи. Ці символи становлять 2 блоки по 16 біт: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f6c33a57-014a-41a4-9ca0-47f5d2ee76b4" data-max-width="592" alt="Java Cryptography Architecture: Перше знайомство - 8" src="https://cdn.javarush.com/images/article/f6c33a57-014a-41a4-9ca0-47f5d2ee76b4/512.jpeg" style="width: 592px;">
 </div>
</div>Щоб уникнути у такому разі повтору, слід використовувати інший режим — Cipher Block Chaining (CBC). Цей режим вводить поняття Initialization Vector (представлений класом IvParameterSpec). А також завдяки цьому режиму результат генерації минулого блоку буде використаний для генерації наступного: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="19a3fe6c-1a1a-4de7-916a-9859506f2655" data-max-width="401" alt="Java Cryptography Architecture: Перше знайомство - 9" src="https://cdn.javarush.com/images/article/19a3fe6c-1a1a-4de7-916a-9859506f2655/256.jpeg" style="width: 401px;">
 </div>
</div>Напишемо тепер це в коді: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>xml<span class="token punctuation"><span class="token punctuation">.</span></span>bind<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span>spec<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">IvParameterSpec</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token comment"><span class="token comment">// Initialization Vector</span></span>
    <span class="token class-name"><span class="token class-name">SecureRandom</span></span> random <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">SecureRandom</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstanceStrong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> rnd <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token number"><span class="token number">16</span></span><span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    random<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rnd<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">IvParameterSpec</span></span> ivSpec <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IvParameterSpec</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rnd<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Prepare key</span></span>
    <span class="token class-name"><span class="token class-name">KeyGenerator</span></span> keygen <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AES"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    keygen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">256</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">Key</span></span> key <span class="token operator"><span class="token operator">=</span></span> keygen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// CBC</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> text <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"secret!!secret!!secret!!secret!!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> transformation <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"AES/CBC/PKCS5Padding"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">Cipher</span></span> cipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>transformation<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ENCRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> key<span class="token punctuation"><span class="token punctuation">,</span></span> ivSpec<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> enc <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>text<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DatatypeConverter</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printHexBinary</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>enc<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Decrypt</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>DECRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> key<span class="token punctuation"><span class="token punctuation">,</span></span> ivSpec<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">String</span></span> result <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>enc<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як ми бачимо — в результаті ми не бачимо блоків шифру, що повторюються. Тому режим ECB не рекомендується, т.к. дає можливість побачити повтори та використовувати це знання для дешифрування. Детальніше про ECB та CBC раджу прочитати матеріал: " <a href="https://docplayer.ru/46528105-1-rezhim-elektronnoy-kodovoy-knigi-v-russkom-variante-rezhim-prostoy-zameny.html" target="_blank" rel="nofollow">Режим електронної кодової книги</a> ". Але симетричне шифрування має очевидну проблему – треба якось передати ключ від того, хто шифрує, тому хто шифрує. І на цьому шляху цей ключ можна перехопити, і тоді буде можливість перехоплювати дані. І цю проблему має вирішити асиметричне шифрування. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="221" alt="Java Cryptography Architecture: Перше знайомство - 10" src="https://cdn.javarush.com/images/article/8e7d8a58-c813-4434-bf78-b3c7c58c7292/original.jpeg">
 </div>
</div>
<h2 id="Ассиметричное_шифрование">Асиметричне шифрування (asymmetric cryptography)</h2>Асиметричне шифрування або Public-key cryptography - це такий спосіб шифрування, при якому використовується пара ключів: private key (зберігається від усіх у секреті) і public key (доступний публічно). Такий поділ потрібний для того, щоб безпечно обмінюватися відкритим ключем між сторонами обміну інформацією, зберігаючи секретний ключ у безпеці. У створенні пари ключів нам недостатньо KeyGenerator, нам потрібен <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#KeyPairGenerator" target="_blank" rel="nofollow">KeyPairGenerator</a> . Подивимося на приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span> generator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    generator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initialize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1024</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">KeyPair</span></span> keyPair <span class="token operator"><span class="token operator">=</span></span> generator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKeyPair</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Encrypt with PRIVATE KEY</span></span>
    <span class="token class-name"><span class="token class-name">Cipher</span></span> cipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ENCRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> data <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello!"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Decrypt with PUBLIC KEY</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>DECRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> result <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут важливо розуміти, що використовуючи асиметричне шифрування, ми завжди з KeyPair використовуємо один ключ для шифрування, а інший для дешифрування. Але т.к. сенс шифрування у цьому, щоб розшифрувати зміг лише одержувач, то шифрується громадським ключем, а розшифровується лише приватним. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="246" alt="Java Cryptography Architecture: Перше знайомство - 11" src="https://cdn.javarush.com/images/article/47f718fc-9a00-436f-a2fc-bd181e25f42c/original.jpeg">
 </div>
</div>
<h2 id="Цифровая_подпись">Цифровий підпис</h2>Як ми бачабо вище, знаючи public key можна надсилати дані так, щоб їх розшифрував тільки власник private key. Тобто суть асиметричного шифрування в тому, що шифрує будь-хто, а читаємо тільки ми. Є і зворотна процедура – ​​цифровий підпис, представлений класом <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#Signature" target="_blank" rel="nofollow">Signature</a> . Цифровий підпис може використовувати такі алгоритми: " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#Signature" target="_blank" rel="nofollow">Signature Algorithms</a> ". Документація по JCA пропонує придивитися до цих двох: DSAwithMD5 і RSAwithMD5 Що краще DSA або RSA і в чому їх відмінність можна прочитати тут: "Which Works Best <a href="https://www.jscape.com/blog/bid/82975/Which-Works-Best-for-Encrypted-File-Transfers-RSA-or-DSA" target="_blank" rel="nofollow">for Encrypted File Transfers - RSA or DSA?</a> ". Або почитати обговорення тут: " <a href="https://security.stackexchange.com/questions/5096/rsa-vs-dsa-for-ssh-authentication-keys" target="_blank" rel="nofollow">RSA vs. DSA for SSH authentication keys</a>Отже, цифровий підпис. Нам знадобиться, як і раніше, пара ключів KeyPair та новий клас Signature. Якщо Ви досі тестували в онлайн компіляторах, то наступний приклад може для них виявитися дещо важким. У мене приклад виконався тільки тут: <a href="https://rextester.com/l/java_online_compiler" target="_blank" rel="nofollow">rextester .com</a> Імпортуємо необхідні нам класи: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>crypto<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> А також перепишемо main метод: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token comment"><span class="token comment">// Generate keys</span></span>
    <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span> generator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">SecureRandom</span></span> random <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">SecureRandom</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstanceStrong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    generator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initialize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2048</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> random<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">KeyPair</span></span> keyPair <span class="token operator"><span class="token operator">=</span></span> generator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKeyPair</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Digital Signature</span></span>
    <span class="token class-name"><span class="token class-name">Signature</span></span> dsa <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Signature</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SHA256withRSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initSign</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Update and sign the data</span></span>
    <span class="token class-name"><span class="token class-name">Cipher</span></span> cipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ENCRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> data <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello!"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> signature <span class="token operator"><span class="token operator">=</span></span> dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sign</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Verify signature</span></span>
    dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initVerify</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">boolean</span></span> verifies <span class="token operator"><span class="token operator">=</span></span> dsa<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">verify</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>signature<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Signature is ok: "</span></span> <span class="token operator"><span class="token operator">+</span></span> verifies<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Decrypt if signature is correct</span></span>
    <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>verifies<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
      cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>DECRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> result <span class="token operator"><span class="token operator">=</span></span> cipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
      <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ось таким чином працює цифровий підпис. Цифровий підпис – цікава тема. Раджу подивитись на цю тему доповідь: <a href="https://www.youtube.com/watch?v=WK6y5Jm8eHA&amp;t=1762s" target="_blank" rel="nofollow">
 <div class="row justify-content-center jr-image-wrap">
  <div class="col-12 col-sm-10 col-md-8">
   <img data-id="3cab9610-ad30-40ab-bf11-541c3a22090a" data-max-width="719" alt="Java Cryptography Architecture: Перше знайомство - 12" src="https://cdn.javarush.com/images/article/3cab9610-ad30-40ab-bf11-541c3a22090a/512.jpeg" style="width: 719px;">
  </div>
 </div></a>Вище ми побачабо, як сторони обмінюються даними. Чи немає якогось стандартного інтерфейсу для цієї взаємодії, передбаченої JCA? Виявляється – є. Давайте розглянемо його. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="188" alt="Java Cryptography Architecture: Перше знайомство - 13" src="https://cdn.javarush.com/images/article/7c98eab3-a01e-4fb1-8687-d962b899446c/original.jpeg">
 </div>
</div>
<h2 id="KeyAgreement">KeyAgreement</h2>Java Cryptography Architecture вводить важливий інструмент - Key agreement is a protocol. Представлений він класом <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#KeyAgreement" target="_blank" rel="nofollow">KeyAgreement</a> . Як зазначено в документації JCA, цей протокол дозволяє встановити однаковий криптографічний ключ для кількох сторін, при цьому жодної секретної інформації між сторонами не передається. Звучить дивно? Тоді давайте подивимося на приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// 1. Одна из сторон (Алиса) генерирует пару ключей. Encoded публичный ключ отдаёт.</span></span>
<span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span> generator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">KeyPair</span></span> aliceKeyPair <span class="token operator"><span class="token operator">=</span></span> generator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKeyPair</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> alicePubKeyEncoded <span class="token operator"><span class="token operator">=</span></span> aliceKeyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getEncoded</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">// 2. Другая сторона (например, Боб) получает открытый ключ Алисы</span></span>
<span class="token class-name"><span class="token class-name">KeyFactory</span></span> bobKeyFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyFactory</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">X509EncodedKeySpec</span></span> x509KeySpec <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X509EncodedKeySpec</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>alicePubKeyEncoded<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">PublicKey</span></span> alicePubKey <span class="token operator"><span class="token operator">=</span></span> bobKeyFactory<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generatePublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>x509KeySpec<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Параметры, которые использовала Алиса при генерации ключей</span></span>
<span class="token class-name"><span class="token class-name">DHParameterSpec</span></span> dhParamFromAlicePubKey <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DHPublicKey</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>alicePubKey<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getParams</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Создаёт свою пару ключей. Отдаёт свой Encoded открытый ключ</span></span>
<span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span> bobKpairGen <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
bobKpairGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initialize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>dhParamFromAlicePubKey<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">KeyPair</span></span> bobKeyPair <span class="token operator"><span class="token operator">=</span></span> bobKpairGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKeyPair</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> bobPubKeyEncoded <span class="token operator"><span class="token operator">=</span></span> bobKeyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getEncoded</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

Теперь<span class="token punctuation"><span class="token punctuation">,</span></span> у Алисы есть открытый ключ Боба<span class="token punctuation"><span class="token punctuation">,</span></span> а у Боба есть открытый ключ Алисы<span class="token punctuation"><span class="token punctuation">.</span></span> Що дальше<span class="token operator"><span class="token operator">?</span></span>
Как сказано в документации JCA<span class="token punctuation"><span class="token punctuation">,</span></span> у нас есть инструмент <span class="token class-name"><span class="token class-name">KeyAgreement</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> https<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>docs<span class="token punctuation"><span class="token punctuation">.</span></span>oracle<span class="token punctuation"><span class="token punctuation">.</span></span>com<span class="token operator"><span class="token operator">/</span></span>javase<span class="token operator"><span class="token operator">/</span></span><span class="token number"><span class="token number">8</span></span><span class="token operator"><span class="token operator">/</span></span>docs<span class="token operator"><span class="token operator">/</span></span>technotes<span class="token operator"><span class="token operator">/</span></span>guides<span class="token operator"><span class="token operator">/</span></span>security<span class="token operator"><span class="token operator">/</span></span>crypto<span class="token operator"><span class="token operator">/</span></span><span class="token class-name"><span class="token class-name">CryptoSpec</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>html#<span class="token class-name"><span class="token class-name">KeyAgreement</span></span> который позволяет установить одинаковые ключи шифрования без необходимости обмениваться секретной информацией <span class="token punctuation"><span class="token punctuation">(</span></span>т<span class="token punctuation"><span class="token punctuation">.</span></span>е<span class="token punctuation"><span class="token punctuation">.</span></span> без обмена <span class="token keyword"><span class="token keyword">private</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span> Соглашение выглядит следующим образом<span class="token operator"><span class="token operator">:</span></span>
<span class="token comment"><span class="token comment">// 3. Соглашение по протоколу Диффи-Хеллмана (Diffie–Hellman, DH)</span></span>
<span class="token class-name"><span class="token class-name">KeyAgreement</span></span> aliceKeyAgree <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyAgreement</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
aliceKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>aliceKeyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Алиса на основе ключа боба и своего private key создаёт общий shared ключ</span></span>
<span class="token class-name"><span class="token class-name">KeyFactory</span></span> aliceKeyFactory <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyFactory</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
x509KeySpec <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X509EncodedKeySpec</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bobPubKeyEncoded<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">PublicKey</span></span> bobPubKey <span class="token operator"><span class="token operator">=</span></span> aliceKeyFactory<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generatePublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>x509KeySpec<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
aliceKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doPhase</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bobPubKey<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> aliceSharedSecret <span class="token operator"><span class="token operator">=</span></span> aliceKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateSecret</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">SecretKeySpec</span></span> aliceAesKey <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>aliceSharedSecret<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">16</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"AES"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Боб на основе ключа Алисы и своего private key создаёт общий shared ключ</span></span>
<span class="token class-name"><span class="token class-name">KeyAgreement</span></span> bobKeyAgree <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyAgreement</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"DH"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
bobKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bobKeyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
bobKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doPhase</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>alicePubKey<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> bobSharedSecret <span class="token operator"><span class="token operator">=</span></span> bobKeyAgree<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateSecret</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">SecretKeySpec</span></span> bobAesKey <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>bobSharedSecret<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">16</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"AES"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Общий ключ у Алисы и Боба одинаков</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Shared keys are equals: "</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>aliceSharedSecret<span class="token punctuation"><span class="token punctuation">,</span></span> bobSharedSecret<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

Далее Боб и Алиса<span class="token punctuation"><span class="token punctuation">,</span></span> используя общий ключ<span class="token punctuation"><span class="token punctuation">,</span></span> про который больше никто не знает<span class="token punctuation"><span class="token punctuation">,</span></span> обмениваются зашифрованными данными<span class="token operator"><span class="token operator">:</span></span>
<span class="token comment"><span class="token comment">// 4. Боб шифрует сообщение для Алисы</span></span>
<span class="token class-name"><span class="token class-name">Cipher</span></span> bobCipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AES/CBC/PKCS5Padding"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
bobCipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ENCRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> bobAesKey<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> ciphertext <span class="token operator"><span class="token operator">=</span></span> bobCipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, Alice!"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Передаёт Алисе параметры, с которыми выполнялась шифровка</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> encodedParamsFromBob <span class="token operator"><span class="token operator">=</span></span> bobCipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getParameters</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getEncoded</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">// 5. Алиса принимает сообщение и расшифровывает его</span></span>
<span class="token class-name"><span class="token class-name">AlgorithmParameters</span></span> aesParams <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">AlgorithmParameters</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AES"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
aesParams<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>encodedParamsFromBob<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Cipher</span></span> aliceCipher <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AES/CBC/PKCS5Padding"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
aliceCipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Cipher</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>DECRYPT_MODE<span class="token punctuation"><span class="token punctuation">,</span></span> aliceAesKey<span class="token punctuation"><span class="token punctuation">,</span></span> aesParams<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> recovered <span class="token operator"><span class="token operator">=</span></span> aliceCipher<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">doFinal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ciphertext<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>recovered<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Цей приклад було взято з прикладом документації JCA: " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#DH2Ex" target="_blank" rel="nofollow">Diffie-Hellman Key Exchange між 2 Parties</a> ". Приблизно так виглядає робота асиметричного шифрування у виконанні Java Cryptography Architecture із використанням Key agreement protocol'а. Докладніше про асиметричне шифрування рекомендуються відео: 
<ul>
 <li><a href="https://www.youtube.com/watch?v=Cr4f6Cwjugs" target="_blank" rel="nofollow">Асиметричне шифрування. Як це працює?</a></li>
 <li><a href="https://www.youtube.com/watch?v=PYPCU4vyjfM" target="_blank" rel="nofollow">Урок 10 протокол Діффі-Хеллмана</a></li>
</ul>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="196" alt="Java Cryptography Architecture: Перше знайомство - 14" src="https://cdn.javarush.com/images/article/1318d366-a118-466a-865f-1cf33ecb033d/original.jpeg">
 </div>
</div>
<h2 id="Сертификаты">Сертифікати</h2>Ну і на солодке у нас залишилося не менш важливе сертифікати. Зазвичай сертифікати генеруються за допомогою утиліти keytool, що входить до постачання jdk. Докладніше можна прочитати, наприклад, тут: " <a href="https://community.pivotal.io/s/article/Generating-a-self-signed-SSL-certificate-using-the-Java-keytool-command" target="_blank" rel="nofollow">Generating a self-signed SSL certificate using the Java keytool command</a> " . Також можна прочитати в посібниках від Oracle. Наприклад, тут: " <a href="https://docs.oracle.com/cd/E19798-01/821-1841/gjrgy/" target="_blank" rel="nofollow">To Use keytool to Create a Server Certificate</a> ". Для прикладу скористаємося <a href="https://www.tutorialspoint.com/compile_java_online.php" target="_blank" rel="nofollow">Tutorialspoint Java Online Compiler</a> 'ом: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">sun<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span>tools<span class="token punctuation"><span class="token punctuation">.</span></span>keytool<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">CertAndKeyGen</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">sun<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span>x509<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span>cert<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Compiler args: -XDignore.symbol.file</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">CertAndKeyGen</span></span> certGen <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertAndKeyGen</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"SHA256WithRSA"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// generate it with 2048 bits</span></span>
    certGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2048</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">PrivateKey</span></span> privateKey <span class="token operator"><span class="token operator">=</span></span> certGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivateKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">X509Key</span></span> publicKey <span class="token operator"><span class="token operator">=</span></span> certGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublicKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// prepare the validity of the certificate</span></span>
    <span class="token keyword"><span class="token keyword">long</span></span> validSecs <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">long</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token number"><span class="token number">365</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">24</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">60</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">60</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// valid for one year</span></span>
    <span class="token comment"><span class="token comment">// enter your details according to your application</span></span>
    <span class="token class-name"><span class="token class-name">X500Name</span></span> principal <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X500Name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"CN=My Application,O=My Organisation,L=My City,C=DE"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// add the certificate information, currently only valid for one year.</span></span>
    <span class="token class-name"><span class="token class-name">X509Certificate</span></span> cert <span class="token operator"><span class="token operator">=</span></span> certGen<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSelfCertificate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>principal<span class="token punctuation"><span class="token punctuation">,</span></span> validSecs<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token comment"><span class="token comment">// Public Key from Cert equals Public Key from generator</span></span>
    <span class="token class-name"><span class="token class-name">PublicKey</span></span> publicKeyFromCert <span class="token operator"><span class="token operator">=</span></span> cert<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublicKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>publicKeyFromCert<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>publicKey<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачимо, сертифікат надає можливість надати публічний ключ. Цей спосіб є недолік — ми використовуємо <code class=" language-none">sun.security</code>, що вважається ризикованим, т.к. цей пакет не є частиною публічного Java API. Саме тому при компіляції необхідно вказати параметр <code class=" language-none">XDignore.symbol.file</code>. Є ще один спосіб створити сертифікат вручну. Мінус у тому, що використовується внутрішній API, який не задокументований. Проте знати про нього корисно. Як мінімум, тому що наочно видно, як використовується специфікація RFC-2459: " <a href="https://www.ietf.org/rfc/rfc2459.txt" target="_blank" rel="nofollow">Internet X.509 Public Key Infrastructure</a> ". Ось приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// 1. Генерируем пару ключей</span></span>
<span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span> keyPairGenerator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyPairGenerator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"RSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
keyPairGenerator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initialize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">4096</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">KeyPair</span></span> keyPair <span class="token operator"><span class="token operator">=</span></span> keyPairGenerator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generateKeyPair</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// 2. Определяем данные сертификата</span></span>
<span class="token comment"><span class="token comment">// Определяем срок действия сертификата</span></span>
<span class="token class-name"><span class="token class-name">Date</span></span> from <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Date</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Date</span></span> <span class="token keyword"><span class="token keyword">to</span></span> <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Date</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>from<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token number"><span class="token number">365</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">1000L</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">24L</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">60L</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">60L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">CertificateValidity</span></span> interval <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertificateValidity</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>from<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">to</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Определяем subject name, т.е. ім'я того, с чем ассоциирован публичный ключ</span></span>
<span class="token comment"><span class="token comment">// CN = Common Name. Через точку с запятой могут быть указаны также другие атрибуты</span></span>
<span class="token comment"><span class="token comment">// См. https://docs.oracle.com/cd/E24191_01/common/tutorials/authz_cert_attributes.html</span></span>
<span class="token class-name"><span class="token class-name">X500Name</span></span> owner <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X500Name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"cn=Unknown"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Уникальный в пределах CA, т.е. Certificate Authority (тот, кто выдаёт сертификат) номер</span></span>
<span class="token class-name"><span class="token class-name">BigInteger</span></span> number <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BigInteger</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">64</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">SecureRandom</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">CertificateSerialNumber</span></span> serialNumber <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertificateSerialNumber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>number<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Определяем алгоритм подписи сертификата</span></span>
<span class="token class-name"><span class="token class-name">AlgorithmId</span></span> algorithmId <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">AlgorithmId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">AlgorithmId</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>md5WithRSAEncryption_oid<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">CertificateAlgorithmId</span></span> certificateAlgorithmId <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertificateAlgorithmId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>algorithmId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// 3. По подготовленной информации создаём сертификат</span></span>
<span class="token class-name"><span class="token class-name">X509CertInfo</span></span> info <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>VALIDITY<span class="token punctuation"><span class="token punctuation">,</span></span> interval<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>SERIAL_NUMBER<span class="token punctuation"><span class="token punctuation">,</span></span> serialNumber<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>SUBJECT<span class="token punctuation"><span class="token punctuation">,</span></span> owner<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ISSUER<span class="token punctuation"><span class="token punctuation">,</span></span> owner<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>KEY<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertificateX509Key</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>VERSION<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CertificateVersion</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">CertificateVersion</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>V3<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
info<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">set</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">X509CertInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>ALGORITHM_ID<span class="token punctuation"><span class="token punctuation">,</span></span> certificateAlgorithmId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// 4. Подписываем сертификат</span></span>
<span class="token class-name"><span class="token class-name">X509CertImpl</span></span> certificate <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">X509CertImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>info<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
certificate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sign</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"SHA256withRSA"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// 5. Проверка сертификата</span></span>
<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token comment"><span class="token comment">// В случае ошибки здесь будет брошено исключение. Например: java.security.SignatureException</span></span>
	certificate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">verify</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPublic</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Exception</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b327b810-a68c-4ec3-b90b-8ab3211ae217" data-max-width="337" alt="Java Cryptography Architecture: Перше знайомство - 15" src="https://cdn.javarush.com/images/article/b327b810-a68c-4ec3-b90b-8ab3211ae217/256.jpeg" style="width: 337px;">
 </div>
</div>
<h2 id="Хранабоще_ключей">Сховище ключів (KeyStore)</h2>Останнє, про що хотілося б поговорити, це про сховище ключів та сертифікатів, яке називається KeyStore. Зрозуміло, що постійно генерувати сертифікати та ключі дорого і безглуздо. Тому їх треба якось безпечно зберігати. Для цього є засіб – KeyStore. Сховище ключів описано в документації JCA у розділі " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#KeyManagement" target="_blank" rel="nofollow">KeyManagement</a> ". API до роботи з ним дуже зрозуміле. Ось невеликий приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">KeyStore</span></span> keyStore <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">KeyStore</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">KeyStore</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDefaultType</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">load</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">String</span></span> alias <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"EntityAlias"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span>cert<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>Certificate</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> chain <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>certificate<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setKeyEntry</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>alias<span class="token punctuation"><span class="token punctuation">,</span></span> keyPair<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPrivate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"keyPassword"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> chain<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Загрузка содержимого (Private Key + Certificate)</span></span>
<span class="token class-name"><span class="token class-name">Key</span></span> key <span class="token operator"><span class="token operator">=</span></span> keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>alias<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"keyPassword"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Certificate</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> certificateChain <span class="token operator"><span class="token operator">=</span></span> keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCertificateChain</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>alias<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token comment"><span class="token comment">// Сохранение KeyStore на диск</span></span>
<span class="token class-name"><span class="token class-name">File</span></span> file <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">File</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createTempFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"security_"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">".ks"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getAbsolutePath</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">FileOutputStream</span></span> fos <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	keyStore<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">store</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fos<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"keyStorePassword"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toCharArray</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як очевидно з прикладу, спочатку виконується <code class=" language-none">load</code>для KeyStore. Але у разі ми вказали перший атрибут null, тобто. джерела для KeyStore немає. Значить KeyStore створюється порожньою, щоб зберегти його далі. Другий параметр також null, т.к. ми створюємо новий KeyStore. Якби ми завантажували KeyStore з файлу, тут потрібно було б вказати пароль (за аналогією з методом KeyStore з назвою store). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="05e60ad8-6baa-4881-9341-5e72f5f21db4" data-max-width="335" alt="Java Cryptography Architecture: Перше знайомство - 16" src="https://cdn.javarush.com/images/article/05e60ad8-6baa-4881-9341-5e72f5f21db4/256.jpeg" style="width: 335px;">
 </div>
</div>
<h2 id="Итог">Підсумок</h2>Ось ми і розглянули з Вами основні і елементарні дії в рамках Java Cryptography Architecture (воно ж JCA). Ми побачабо, що таке симетричне та асиметричне шифрування і як це реалізовано у JCA. Ми побачабо, як створюються сертифікати та цифрові підписи, а також як використовуються. Це лише основи основ, за якими стоїть ще багато складних і цікавих речей. Сподіваюся, дані оглядовий матеріал буде корисним та зацікавить Вас на подальше вивчення даного напрямку. Ну і на завершення хотілося б вказати супер відео на цю тему: <a href="https://www.youtube.com/watch?v=itmNhVckTPc" target="_blank" rel="nofollow">
 <div class="row justify-content-center jr-image-wrap">
  <div class="col-12 col-sm-10 col-md-8">
   <img data-id="d2c65ad5-f66c-4b21-bf29-16b49b409981" data-max-width="579" alt="Java Cryptography Architecture: Перше знайомство - 17" src="https://cdn.javarush.com/images/article/d2c65ad5-f66c-4b21-bf29-16b49b409981/512.jpeg" style="width: 579px;">
  </div>
 </div></a> Додаткові матеріали: 
<ul>
 <li>Курс на udacity: " <a href="https://www.udacity.com/course/intro-to-information-security--ud459" target="_blank" rel="nofollow">Intro to Information Security</a> ".</li>
 <li>Курс на udacity: "</li>
</ul>