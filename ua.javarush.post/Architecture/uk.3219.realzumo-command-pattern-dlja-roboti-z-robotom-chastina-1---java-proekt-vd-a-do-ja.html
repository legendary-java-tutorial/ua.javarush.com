Реалізуємо Command Pattern для роботи з роботом. (Частина 1) - "Java-проект від А до Я"
<p>----------------------------------------</p>
Всім привіт, дорогі друзі. Сьогодні реалізовуватимемо шаблон (шаблон — патерн, у нашому контексті це одне й теж) проектування Command для наших потреб. За допомогою цього шаблону ми будемо зручно та правильно працювати з обробкою команд наш
<p>----------------------------------------</p>
Всім привіт, дорогі друзі. Сьогодні реалізовуватимемо шаблон (шаблон — патерн, у нашому контексті це одне й теж) проектування Command для наших потреб. За допомогою цього шаблону ми будемо зручно та правильно працювати з обробкою команд нашого бота. <img data-max-width="800" data-id="4d083e79-c172-4654-b9e3-72f21e6d379b" alt="&quot;Java-проект від А до Я&quot;: Реалізуємо Command Pattern для роботи з роботом.  Частина 1 - 1" src="https://cdn.javarush.com/images/article/4d083e79-c172-4654-b9e3-72f21e6d379b/800.jpeg" style="width: 800px;">
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Друзі, подобається <a href="https://github.com/codegymcommunity/codegym-telegrambot" rel="nofollow" target="_blank">проект Javarush Telegram Bot</a> ? Не лінуйтеся: ставте <a href="https://github.com/codegymcommunity/codegym-telegrambot/stargazers" rel="nofollow" target="_blank">зірку</a> . Так буде зрозуміло, що він цікавий, і його буде приємніше розвивати!</td>
   </tr>
  </tbody>
 </table>
</div>Для початку добре було б поговорити про те, що це за патерн Command. Але якщо я зроблю це, стаття буде дуже великою і громіздкою. Тому я вибрав матеріали для самостійного вивчення:
<ol>
 <li>Це <a href="https://codegym.cc/groups/posts/1684-pattern-command-svoimi-slovami" target="_blank">моя стаття</a> 4-річної давнини. Писав її ще коли був джуніором, тож не судіть суворо.</li>
 <li><a href="https://www.youtube.com/watch?v=9qA5kw8dcSU" rel="nofollow" target="_blank">Відео дуже емоційного та інтерактивного шведа на ютубі. </a>Дуже раджу. Розповідає шикарно, англійська мова чиста та зрозуміла. І взагалі у нього є відео про інші патерни проектування.</li>
 <li>У коментарях до моєї статті хтось <a href="https://codegym.cc/users/1710975" target="_blank">Nullptr35</a> радив це <a href="https://www.youtube.com/watch?v=8gE-icd93WA" rel="nofollow" target="_blank">відео</a> .</li>
</ol>Цього має вистачити, щоб поринути у тему і бути на одній хвилі зі мною. Ну а ті, хто знайомий із цим шаблоном проектування, можуть пропустити сміливо та йти далі.
<h2>Пишемо JRTB-3</h2>Так само, як і раніше:
<ol>
 <li>Обновляємо main гілку.</li>
 <li>На основі оновленої гілки main створюємо нову <span class="text-bold">JRTB-3</span> .</li>
 <li>Реалізуємо патерн.</li>
 <li>Створюємо новий коміт з описом виконаної роботи.</li>
 <li>Створюємо пул-реквест, перевіряємо, і якщо все ок — мержемо нашу роботу.</li>
</ol>Пункти 1-2 не показуватиму: я їх дуже ретельно описував у попередніх статтях, тому приступимо відразу до реалізації шаблону. Чому нам підійде цей шаблон? Та тому що кожного разу, коли ми виконуватимемо якусь команду, ми заходитимемо в метод <span class="code">onUpdateReceived(Update update)</span> , і вже залежно від команди виконуватимемо різну логіку. Без цього патерна у нас була б ціла темрява if-else if виразів. Щось типу такого: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/start"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">doStartCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/stop"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">doStopCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/addUser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">doAddUserCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/makeMeHappy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">doMakeMeHappyCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Причому там, де три крапки, може бути ще кілька десятків команд. І як це обробляти нормально? Як підтримувати? Складно та важко. А отже, нам такий варіант не підходить. Потрібно, щоб це виглядало десь так: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>COMMAND_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> commandIdentifier <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   commandContainer<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span>commandIdentifier<span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   commandContainer<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span>NO<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> І все! І скільки б команд ми не додавали, ця ділянка коду буде незмінною. Що він робить? Перший ІФ дивиться, що повідомлення починається з префікса команди "/". Якщо це так, то відокремлюємо рядок до першого пробілу і шукаємо відповідну команду CommandContainer, як тільки знайшли її - запускаємо команду. І все ...) Якщо буде бажання і час, можна реалізувати роботу з командами спочатку відразу в одному класі, з купою умов і всього такого, а потім - за допомогою шаблону. Ви побачите різницю. Яка буде краса! Спершу створимо пакет поруч із пакетом bot, який і називатиметься <span class="text-bold">command</span> . <img data-max-width="800" data-id="71040e87-9610-4c4b-9d1a-7377af6daa97" alt="&quot;Java-проект від А до Я&quot;: Реалізуємо Command Pattern для роботи з роботом.  Частина 1 - 2" src="https://cdn.javarush.com/images/article/71040e87-9610-4c4b-9d1a-7377af6daa97/800.jpeg" style="width: 800px;">І вже в цьому пакеті будуть усі класи, які відносяться до реалізації команди. А нам потрібен один інтерфейс для роботи з командами. Для цієї справи створимо його: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Command interface for handling telegram-bot commands.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token comment">/**
    * Main method, which is executing command logic.
    *
    * @param update provided {@link Update} object with all the needed data for command.
    */</span>
   <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> На цьому етапі нам не потрібно реалізовувати зворотну операцію команди, тому пропустимо цей метод (unexecute). У методі execute як аргумент приходить об'єкт <span class="text-bold">Update</span> - саме той, який приходить у наш головний метод у боті. Цей об'єкт міститиме все необхідне для обробки команди. Далі додамо enum, у якому зберігатимуться значення команд (start, stop тощо.). Навіщо нам це потрібне? Щоб ми мали лише одне джерело істини для назв команд. Створюємо його також у нашому пакеті <span class="text-bold">command</span> . Назвемо його <span class="code">CommandName</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Enumeration for {@link Command}'s.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CommandName</span> <span class="token punctuation">{</span>

   <span class="token function">START</span><span class="token punctuation">(</span><span class="token string">"/start"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token function">STOP</span><span class="token punctuation">(</span><span class="token string">"/stop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> commandName<span class="token punctuation">;</span>

   <span class="token class-name">CommandName</span><span class="token punctuation">(</span><span class="token class-name">String</span> commandName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>commandName <span class="token operator">=</span> commandName<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> commandName<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre> Також нам потрібний сервіс, який займатиметься відправкою повідомлень через робота. І тому справи створимо поруч із пакетом <span class="text-bold">command</span> — пакет <span class="text-bold">service</span> , у якому додаватимемо всі необхідні послуги. <em>Тут варто загострити увагу на тому, що я маю на увазі під словом сервіс у даному випадку. Якщо розглянути додаток, то часто воно ділиться на кілька шарів: шар роботи з ендпоінтами - контролери, бізнес-логіки - сервіси, і шар роботи з БД - репозиторій. Тому в нашому випадку сервіс – це клас, який здійснює якусь бізнес-логіку.</em> Як правильно робити сервіс? Спочатку створити інтерфейс щодо нього і реалізацію. Реалізацію за допомогою інструкції `@Service` додати в Application Context нашого SpringBoot додатки, і вже за необхідності підтягувати його за допомогою інструкції `@Autowired`. Тому створюємо інтерфейс SendBotMessageService (у назві сервісів зазвичай додають наприкінці імені Service): 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Service for sending messages via telegram-bot.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SendBotMessageService</span> <span class="token punctuation">{</span>

   <span class="token comment">/**
    * Send message via telegram bot.
    *
    * @param chatId provided chatId in which messages would be sent.
    * @param message provided message to be sent.
    */</span>
   <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> chatId<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Далі створюємо його реалізацію: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>bot<span class="token punctuation">.</span></span><span class="token class-name">JavarushTelegramBot</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>send<span class="token punctuation">.</span></span><span class="token class-name">SendMessage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span><span class="token class-name">TelegramApiException</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Implementation of {@link SendBotMessageService} interface.
*/</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendBotMessageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SendBotMessageService</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JavarushTelegramBot</span> codegymBot<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">public</span> <span class="token class-name">SendBotMessageServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">JavarushTelegramBot</span> codegymBot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>codegymBot <span class="token operator">=</span> codegymBot<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> chatId<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">SendMessage</span> sendMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       sendMessage<span class="token punctuation">.</span><span class="token function">setChatId</span><span class="token punctuation">(</span>chatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
       sendMessage<span class="token punctuation">.</span><span class="token function">enableHtml</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       sendMessage<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           codegymBot<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TelegramApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//todo add logging to the project.</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Отак виглядає реалізація. Найголовніша магія знаходиться там, де створюється конструктор. За допомогою анотації @Autowired при конструкторі, SpringBoot шукатиме у себе в Application Context об'єкт цього класу. А він уже там перебуває. Виходить так робота: у нашому додатку будь-де ми можемо отримати доступ до бота і щось зробити. І ось цей сервіс відповідає за те, щоб надсилати повідомлення. Щоб ми не писали щоразу в кожному місці щось на кшталт такого: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">SendMessage</span> sendMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sendMessage<span class="token punctuation">.</span><span class="token function">setChatId</span><span class="token punctuation">(</span>chatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
sendMessage<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
   codegymBot<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TelegramApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//todo add logging to the project.</span>
   e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Ми цю логіку винесли в окремий клас і за потреби будемо нею користуватися. Тепер нам потрібно реалізувати три команди: StartCommand, StopCommand та UnknownCommand. Потрібні вони для того, щоб було чим заповнювати наш контейнер для команд. Тексти поки що будуть сухі та малоінформативні, в рамках цього завдання це не дуже важливо. Отже, StartCommand: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Start {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> START_MESSAGE <span class="token operator">=</span> <span class="token string">"Привет. Я Javarush Telegram Bot. Я помогу тебе быть в курсе последних "</span> <span class="token operator">+</span>
           <span class="token string">"статей тех авторов, котрые тебе интересны. Я еще маленький и только учусь."</span><span class="token punctuation">;</span>

   <span class="token comment">// Здесь не добавляем сервис через получение из Application Context.</span>
   <span class="token comment">// Потому что если это сделать так, то будет циклическая зависимость, которая</span>
   <span class="token comment">// ломает работу програми.</span>
   <span class="token keyword">public</span> <span class="token class-name">StartCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> START_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Уважно прочитайте коментарі перед конструктором. Циклічна залежність ( <a href="https://java-ru-blog.blogspot.com/2020/05/spring-ioc-container-dependency-resolution.html" rel="nofollow" target="_blank">кругова залежність</a> ) може статися через не зовсім правильну архітектуру. У нашому випадку ми зробимо все так, щоб усе працювало та було правильним. Реальний об'єкт із Application Context буде доданий при створенні команди вже CommandContainer. StopCommand: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Stop {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> STOP_MESSAGE <span class="token operator">=</span> <span class="token string">"Деактивировал все ваши подписки \uD83D\uDE1F."</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">StopCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> STOP_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> І UnknownCommand. Навіщо він нам потрібний? Для нас це важлива команда, яка відповідатиме у випадку, якщо ми не змогли знайти ту команду, яку нам передали. А ще нам потрібна буде NoCommand та HelpCommand.
<ul>
 <li>NoCommand - відповідатиме за ситуацію, коли повідомлення починається зовсім не з команди;</li>
 <li>HelpCommand – буде путівником для користувача, своєрідною документацією.</li>
</ul>Додамо HelpCommand: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandName</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
* Help {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelpCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> HELP_MESSAGE <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"✨&lt;b&gt;Дотупные команды&lt;/b&gt;✨\n\n"</span>

                   <span class="token operator">+</span> <span class="token string">"&lt;b&gt;Начать\\закончить работу с ботом&lt;/b&gt;\n"</span>
                   <span class="token operator">+</span> <span class="token string">"%s - начать работу со мной\n"</span>
                   <span class="token operator">+</span> <span class="token string">"%s - приостановить работу со мной\n\n"</span>
                   <span class="token operator">+</span> <span class="token string">"%s - получить помощь в работе со мной\n"</span><span class="token punctuation">,</span>
           START<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> STOP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HELP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">HelpCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HELP_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> NoCommand: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* No {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NoCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> NO_MESSAGE <span class="token operator">=</span> <span class="token string">"Я поддерживаю команды, начинающиеся со слеша(/).\n"</span>
           <span class="token operator">+</span> <span class="token string">"Щобы посмотреть список команд введите /help"</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">NoCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NO_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> І для цього завдання залишився ще UnknownCommand: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Unknown {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnknownCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UNKNOWN_MESSAGE <span class="token operator">=</span> <span class="token string">"Не понимаю вас \uD83D\uDE1F, напишите /help чтобы узнать что я понимаю."</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">UnknownCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> UNKNOWN_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Далі додамо контейнер для наших команд. У ньому зберігатимуться об'єкти наших команд, і на запит ми очікуємо отримати необхідну команду. Назвемо його <span class="code">CommandContainer</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span></span><span class="token class-name">ImmutableMap</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandName</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment">/**
* Container of the {@link Command}s, which are using for handling telegram commands.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommandContainer</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Command</span><span class="token punctuation">&gt;</span></span> commandMap<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Command</span> unknownCommand<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">CommandContainer</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       commandMap <span class="token operator">=</span> <span class="token class-name">ImmutableMap</span><span class="token punctuation">.</span>&lt;string<span class="token punctuation">,</span> command<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>START<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StartCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>STOP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">StopCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>HELP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HelpCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>NO<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NoCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       unknownCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnknownCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">Command</span> <span class="token function">retrieveCommand</span><span class="token punctuation">(</span><span class="token class-name">String</span> commandIdentifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> commandMap<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>commandIdentifier<span class="token punctuation">,</span> unknownCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre> Як видно, все зроблено просто. У нас є незмінна карта з ключем у вигляді значення команди та значенням у вигляді об'єкта команди типу Command. У конструкторі ми заповнюємо незмінну карту один раз і весь час додатку до неї звертаємося. Головний та єдиний метод для роботи з контейнером - <span class="code">retrieveCommand(String commandIdentifier)</span> . Існує команда UnknownCommand, яка відповідає за випадки, коли ми не можемо знайти відповідну команду. Тепер ми готові впровадити контейнер у наш клас з ботом - в CodeGymTelegramBot: Ось так тепер виглядає наш клас бота: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>bot</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandContainer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>bots<span class="token punctuation">.</span></span><span class="token class-name">TelegramLongPollingBot</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandName</span><span class="token punctuation">.</span>NO<span class="token punctuation">;</span>

<span class="token comment">/**
* Telegram bot for Javarush Community from Javarush community.
*/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavarushTelegramBot</span> <span class="token keyword">extends</span> <span class="token class-name">TelegramLongPollingBot</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> COMMAND_PREFIX <span class="token operator">=</span> <span class="token string">"/"</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${bot.username}"</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${bot.token}"</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CommandContainer</span> commandContainer<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">JavarushTelegramBot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>commandContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommandContainer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SendBotMessageServiceImpl</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdateReceived</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">hasMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">String</span> message <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>COMMAND_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">String</span> commandIdentifier <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               commandContainer<span class="token punctuation">.</span><span class="token function">retrieveCommand</span><span class="token punctuation">(</span>commandIdentifier<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
               commandContainer<span class="token punctuation">.</span><span class="token function">retrieveCommand</span><span class="token punctuation">(</span>NO<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> username<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> token<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> І все, зміни у коді закінчено. Як це перевірити? Потрібно запустити робота і перевірити, що все працює. Для цього application.properties оновлюю токен, ставлю правильний і в класі JavarushTelegramBotApplication запускаю програму: <img data-max-width="1080" data-id="9c491117-6475-4c8a-b531-54861e81bfde" alt="&quot;Java-проект від А до Я&quot;: Реалізуємо Command Pattern для роботи з роботом.  Частина 1 - 3" src="https://cdn.javarush.com/images/article/9c491117-6475-4c8a-b531-54861e81bfde/1080.jpeg" style="width: 1080px;">Тепер потрібно перевірити, що команди працюють як потрібно. Поетапно перевіряю:
<ul>
 <li>StopCommand;</li>
 <li>StartCommand;</li>
 <li>HelpCommand;</li>
 <li>NoCommand;</li>
 <li>UnknownCommand.</li>
</ul>Ось що вийшло: <img data-max-width="512" data-id="6e46d97a-ed7b-4361-af00-559932d6ff84" alt="&quot;Java-проект від А до Я&quot;: Реалізуємо Command Pattern для роботи з роботом.  Частина 1 - 4" src="https://cdn.javarush.com/images/article/6e46d97a-ed7b-4361-af00-559932d6ff84/512.jpeg" style="width: 512px;">Бот відпрацював саме так, як ми очікували. Продовження <a href="https://codegym.cc/groups/posts/3220-java-proekt-ot-a-do-ja-realizuem-command-pattern-dlja-rabotih-s-botom-chastjh-2" target="_blank">за посиланням</a> .<a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="&quot;Java-проект від А до Я&quot;: Реалізуємо Command Pattern для роботи з роботом.  Частина 1 - 5" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>