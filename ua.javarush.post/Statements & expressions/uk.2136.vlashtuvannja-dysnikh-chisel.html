Влаштування дійсних чисел
<p>----------------------------------------</p>
Вітання! У сучасній лекції розповімо про числах в Java, саме — про матеріальних числах. Без паніки! :) Жодних математичних складнощів у лекції не буде. Говоритимемо про речові числа виключно з нашої, «програмістської» точки зору. Отже, що т
<p>----------------------------------------</p>
Вітання! У сучасній лекції розповімо про числах в Java, саме — про матеріальних числах. <img data-id="bad6cab4-00e1-45c6-9c10-8c65b13687e8" data-max-width="850" alt="Влаштування дійсних чисел - 1" src="https://cdn.javarush.com/images/article/bad6cab4-00e1-45c6-9c10-8c65b13687e8/800.jpeg" style="width: 850px;">Без паніки! :) Жодних математичних складнощів у лекції не буде. Говоритимемо про речові числа виключно з нашої, «програмістської» точки зору. Отже, що таке «речові числа»? <span class="text-bold">Речові числа</span> - це числа, які мають дробову частину (вона може бути нульовою). Вони можуть бути позитивними чи негативними. Ось кілька прикладів: <span class="text-bold">15 56.22 0.0 1242342343445246 -232336.11</span> Як же влаштовано речовинне число? Досить просто: воно складається з цілої частини, дробової частини та знаку. У позитивних чисел знак зазвичай не вказують явно, а негативні вказують. Раніше ми <a href="https://codegym.cc/groups/posts/1924-operacii-nad-chislami-v-java" target="_blank">докладно розібрали</a>, які операції над числами можна здійснювати Java. Серед них було багато стандартних математичних операцій — додавання, віднімання тощо. буд. Було й дещо нове для тебе: наприклад, залишок від поділу. Але як саме влаштовано роботу з числами всередині комп'ютера? Як вони зберігаються у пам'яті? 
<h2>Зберігання дійсних чисел у пам'яті</h2>Думаю, тобі не стане відкриттям, що числа бувають великими і маленькими :) Їх можна порівнювати один з одним. Наприклад, число 100 менше від числа 423324. Чи впливає це на роботу комп'ютера та нашої програми? Насправді <span class="text-bold">так</span> . Кожне число представлено в Java певним <span class="text-bold">діапазоном значень</span> : 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <th>Тип</th>
    <th>Розмір у пам'яті (біт)</th>
    <th>Діапазон значень</th>
   </tr>
   <tr>
    <td><code class=" language-none">byte</code></td>
    <td>8 біт</td>
    <td>від -128 до 127</td>
   </tr>
   <tr>
    <td><code class=" language-none">short</code></td>
    <td>16 біт</td>
    <td>від -32768 до 32767</td>
   </tr>
   <tr>
    <td><code class=" language-none">char</code></td>
    <td>16 біт</td>
    <td>беззнакове ціле число, яке є символом UTF-16 (літери та цифри)</td>
   </tr>
   <tr>
    <td><code class=" language-none">int</code></td>
    <td>32 біта</td>
    <td>від -2147483648 до 2147483647</td>
   </tr>
   <tr>
    <td><code class=" language-none">long</code></td>
    <td>64 біта</td>
    <td>від -9223372036854775808 до 9223372036854775807</td>
   </tr>
   <tr>
    <td><code class=" language-none">float</code></td>
    <td>32 біта</td>
    <td>від 2 <sup>-149</sup> до (2-2 <sup>-23</sup> )*2 <sup>127</sup></td>
   </tr>
   <tr>
    <td><code class=" language-none">double</code></td>
    <td>64 біта</td>
    <td>від 2 <sup>-1074</sup> до (2-2 <sup>-52</sup> )*2 <sup>1023</sup></td>
   </tr>
  </tbody>
 </table>
</div>Сьогодні поговоримо саме про останні два типи — <code class=" language-none"><span class="text-bold">float</span></code>і <code class=" language-none"><span class="text-bold">double</span></code>. Обидва виконують одну й ту саму задачу — являють собою дробові числа. Їх ще дуже часто називають " <span class="text-bold">числа з плаваючою точкою"</span> . Запам'ятай цей термін на майбутнє:) Наприклад, число 2.3333 або 134.1212121212. Досить дивно. Адже виходить, немає жодної різниці між цими двома типами, якщо вони виконують одну й ту саму задачу? Але різниця є. Зверніть увагу на стовпець «розмір у пам'яті» у таблиці вище. Усі числа (та й не тільки числа – взагалі вся інформація) зберігається у пам'яті комп'ютера у вигляді бітів. Біт - це найменша одиниця виміру інформації. Вона досить проста. Будь-який біт дорівнює або 0, або 1. Та й саме слово " <span class="text-bold">bit</span> " походить від англійської " <span class="text-bold">binary digit"</span>» - Двійкове число. Думаю, ти, напевно, чув про існування двійкової системи числення в математиці. Будь-яке звичне нам десяткове число можна у вигляді набору одиниць і нулів. Наприклад, число 584.32 у двійковій системі буде виглядати так: <span class="text-bold">100100100001010001111</span> . Кожна одиниця та нуль у цьому числі є окремим бітом. Тепер тобі має бути зрозуміліша різниця між типами даних. Наприклад, якщо ми створюємо число типу <code class=" language-none">float</code>, у нашому розпорядженні є лише 32 біти. При створенні числа <code class=" language-none">float</code>стільки місця буде виділено для нього в пам'яті комп'ютера. Якщо ж ми хочемо створити число 123456789.65656565656565, у двійковому вигляді воно виглядатиме так: <span class="text-bold">111010110111100110100010101101010000000</span>. Воно складається з 38 одиниць та нулів, тобто для його зберігання в пам'яті потрібно 38 біт. У тип <code class=" language-none">float</code>це число просто не влізе! Тому число 123456789 можна як типу <code class=" language-none">double</code>. Для його зберігання виділяється цілих 64 біти: це нам підходить! Зрозуміло, і діапазон значень теж буде сприятливим. Для зручності ти можеш представляти число як маленький ящик із осередками. Якщо осередків вистачає для зберігання кожного біта, значить, тип даних обраний правильно :) <img data-id="27b62ec0-7eec-46eb-bebd-1a5369f3fd10" data-max-width="850" alt="Влаштування дійсних чисел - 2" src="https://cdn.javarush.com/images/article/27b62ec0-7eec-46eb-bebd-1a5369f3fd10/800.jpeg" style="width: 850px;">Зрозуміло, різна кількість пам'яті, що виділяється, впливає і на саме число. Зверніть увагу, що у типів <code class=" language-none">float</code>і <code class=" language-none">double</code>відрізняється діапазон значень. Що це означає на практиці? Число <code class=" language-none">double</code>може виразити більшу точність, ніж число <code class=" language-none">float</code>. У 32-бітних чисел з плаваючою точкою (у Java це якраз тип<code class=" language-none">float</code>) точність становить приблизно 24 біти, тобто близько 7 знаків після коми. А у 64-бітних чисел (в Java це тип <code class=" language-none">double</code>) - точність приблизно 53 біти, тобто приблизно 16 знаків після коми. Ось приклад, який добре демонструє цю різницю: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">float</span></span> f <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0f</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">0.1111111111111111</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Що ми повинні отримати тут як результат? Здавалося б, усе досить просто. У нас є число 0.0, і ми 7 разів поспіль додаємо до нього 0.11111111111111111. У результаті має вийти 0.77777777777777777. Але ми створабо число <code class=" language-none">float</code>. Його розмір обмежений 32 бітами і, як ми сказали раніше, він здатний відобразити число приблизно до 7 знак після коми. Тому результат, який ми отримаємо в консолі, відрізнятиметься від того, що ми очікували: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
0.7777778</code></pre> Число ніби було «обрізане». Ти вже знаєш як зберігаються дані в пам'яті - у вигляді бітів, тому тебе не повинно це дивувати. Зрозуміло, чому це сталося: результат 0.77777777777777777 просто не вліз у виділені нам 32 біти, тому і був обрізаний так, щоб поміститися в змінну типу :) Ми можемо змінити <code class=" language-none">float</code>тип змінної на <code class=" language-none">double</code>нашому прикладі, і тоді підсумковий результат не буде обрізаний: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">double</span></span> f <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">0.1111111111111111</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<pre class=" language-none" tabindex="0"><code class=" language-none">
0.7777777777777779</code></pre> Тут уже 16 знаків після коми, результат «змістився» у 64 біти. До речі, можливо, ти помітив, що в обох випадках результати вийшли не зовсім коректними? Підрахунок було зроблено з невеликими помилками. Про причини цього ми поговоримо нижче:) Тепер скажемо пару слів про те, як можна порівняти числа між собою. 
<h2>Порівняння дійсних чисел</h2>Ми частково вже торкалися цього питання в минулій лекції, коли говорабо про операції порівняння. Такі операції як <code class=" language-none">&gt;</code>, <code class=" language-none">&lt;</code>, <code class=" language-none">&gt;=</code>, <code class=" language-none">&lt;=</code>повторно розбирати ми не будемо. Натомість розглянемо цікавіший приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">double</span></span> f <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i<span class="token operator"><span class="token operator">=</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">0.1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як ти думаєш, скільки буде виведено на екран? Логічною відповіддю була б відповідь: число 1. Ми починаємо відлік із числа 0.0 і послідовно додаємо до нього 0.1 десять разів поспіль. Начебто все правильно, повинна вийти одиниця. Спробуй запустити цей код, і відповідь сильно здивує тебе :) Висновок в консоль: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
0.9999999999999999</code></pre> Але чому такому простому прикладі виникла помилка? О_о Тут би навіть п'ятикласник легко відповів, але програма на Java видала неточний результат. «Неточний» тут найкраще слово, ніж «неправильний». Ми таки отримали дуже близьке до одиниці число, а не просто якесь рандомне значення :) Воно відрізняється від правильного буквально на міліметр. Але чому? Можливо, це просто одноразова помилка. Може, комп заглючив? Спробуємо написати інший приклад. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token comment"><span class="token comment">//додаємо до нуля 0.1 одинадцять разів поспіль</span></span>
       <span class="token keyword"><span class="token keyword">double</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f1 <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">.1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token comment"><span class="token comment">//Помножуємо 0.1 на 11</span></span>
       <span class="token keyword"><span class="token keyword">double</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.1</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">//повинно вийти одне й те саме - 1.1 в обох випадках</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f2 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">// Перевіримо!</span></span>
       <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>f1 <span class="token operator"><span class="token operator">==</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 рівні!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">else</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 не рівні!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Виведення в консоль: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
f1 = 1.0999999999999999
f2 = 1.1
f1 и f2 не равны!</code></pre> Так, справа явно не в глюках компа :) Що відбувається? Подібні помилки пов'язані з тим, як числа представлені у двійковому вигляді в пам'яті комп'ютера. Справа в тому, що <span class="text-bold">в двійковій системі неможливо точно уявити число 0,1</span> . У десятковій системі, до речі, теж є подібна проблема: в ній не можна правильно уявити дроби (і замість ⅓ ми отримаємо 0.333333333333333, що теж не зовсім правильний результат). Здавалося б, дрібниця: за таких підрахунків різниця може бути в одну стотисячну частину (0,00001) або навіть менша. Але якщо від цього порівняння залежатиме весь результат роботи твоєї Дуже Серйозної Програми? 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>f1 <span class="token operator"><span class="token operator">==</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span>
   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ракета летить у космос"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">else</span></span>
   <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Запуск скасовується, всі розходяться додому"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Ми явно очікували, що два числа будуть рівними, але через особливості внутрішнього пристрою пам'яті ми скасували запуск ракети. <img data-id="f14c5f54-f6c5-48a0-9537-c2f75288d0ef" data-max-width="850" alt="Влаштування дійсних чисел - 3" src="https://cdn.javarush.com/images/article/f14c5f54-f6c5-48a0-9537-c2f75288d0ef/800.jpeg" style="width: 850px;">Раз так, нам потрібно визначитися, як все ж таки порівняти два числа з плаваючою точкою, щоб результат порівняння був більш ... еммм ... передбачуваним. Отже, правило №1 при порівнянні дійсних чисел ми вже засвоїли: <span class="text-bold">ніколи не використовуй <code class=" language-none">==</code>при порівнянні чисел із плаваючою точкою. </span> Ок, поганих прикладів, думаю, досить:) Давай розглянемо гарний приклад! 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">double</span></span> threshold <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0.0001</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">//додаємо до нуля 0.1 одинадцять разів поспіль</span></span>
       <span class="token keyword"><span class="token keyword">double</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">.0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f1 <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">.1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token comment"><span class="token comment">//Помножуємо 0.1 на 11</span></span>
       <span class="token keyword"><span class="token keyword">double</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">.1</span></span> <span class="token operator"><span class="token operator">*</span></span> <span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f2 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Math</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">abs</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f1 <span class="token operator"><span class="token operator">-</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">&lt;</span></span> threshold<span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 рівні"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">else</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 не рівні"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут ми по суті робимо те саме, але змінюємо спосіб порівняння чисел. Ми маємо спеціальне «порогове» число — 0.0001, одна десятитисячна. Воно може бути іншим. Це залежить від того, наскільки точне порівняння тобі потрібне в конкретному випадку. Можна зробити його і більше, і менше. За допомогою методу <code class=" language-none">Math.abs()</code>ми одержуємо модуль числа. Модуль — це значення числа, незалежно від знака. Наприклад, у чисел -5 і 5 модуль буде однаковим і дорівнює 5. Ми віднімаємо друге число з першого, і якщо отриманий результат, незалежно від знака, буде меншим за той поріг, який ми встановабо, значить наші числа рівні. <span class="text-bold">У всякому разі, вони рівні настільки точності, яку ми встановабо за допомогою нашого «порогового числа»</span>, тобто як мінімум вони дорівнюють аж до однієї десятитисячної. Такий спосіб порівняння позбавить тебе несподіваної поведінки, яку ми побачабо у випадку з <code class=" language-none">==</code>. Ще один хороший спосіб порівняння дійсних чисел - використовувати спеціальний клас <code class=" language-none">BigDecimal</code>. Цей клас спеціально був створений для зберігання дуже великих чисел із дрібною частиною. На відміну від <code class=" language-none">double</code>і <code class=" language-none">float</code>при використанні <code class=" language-none">BigDecimal</code>додавання, віднімання та інші математичні операції виконуються не за допомогою операторів ( <code class=" language-none">+-</code>і т.д.), а за допомогою методів. Ось як це буде виглядати у нашому випадку: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>math<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">BigDecimal</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Main</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token comment"><span class="token comment">/*Створюємо два об'єкти BigDecimal - нуль та 0.1.
       Робимо те саме, що й раніше - додаємо 0.1 до нуля 11 разів поспіль
       У класі BigDecimal додавання здійснюється за допомогою методу add()*/</span></span>
       <span class="token class-name"><span class="token class-name">BigDecimal</span></span> f1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BigDecimal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0.0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">BigDecimal</span></span> pointOne <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BigDecimal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0.1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;=</span></span> <span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           f1 <span class="token operator"><span class="token operator">=</span></span> f1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>pointOne<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>

       <span class="token comment"><span class="token comment">/*Тут теж нічого не змінилося: створюємо два об'єкти BigDecimal
       та множимо 0.1 на 11
       У класі BigDecimal множення здійснюється за допомогою методу multiply()*/</span></span>
       <span class="token class-name"><span class="token class-name">BigDecimal</span></span> f2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BigDecimal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0.1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">BigDecimal</span></span> eleven <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BigDecimal</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">11</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       f2 <span class="token operator"><span class="token operator">=</span></span> f2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">multiply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>eleven<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f2 = "</span></span> <span class="token operator"><span class="token operator">+</span></span> f2<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token comment"><span class="token comment">/*Ще одна особливість BigDecimal - об'єкти чисел потрібно порівнювати між
       собою за допомогою спеціального методу compareTo()*/</span></span>
       <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>f1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">compareTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>f2<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">==</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 рівні"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">else</span></span>
           <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"f1 та f2 не рівні"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Який висновок у консоль ми отримаємо? 
<pre class=" language-none" tabindex="0"><code class=" language-none">
f1 = 1.1000000000000000610622663543836097232997417449951171875
f2 = 1.1000000000000000610622663543836097232997417449951171875
f1 и f2 равны</code></pre> Ми отримали саме той результат, на який розраховували. І зверни увагу, наскільки точними вийшли наші числа, і скільки знаків після коми у них вмістилося! Набагато більше, ніж у <code class=" language-none">float</code>і навіть у <code class=" language-none">double</code>! Запам'ятай клас <code class=" language-none">BigDecimal</code>на майбутнє, він тобі обов'язково стане в нагоді :) <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="04981c5b-31a9-497d-acce-53e82e2e623a" class="img-fluid" alt="Влаштування дійсних чисел - 4" src="https://cdn.javarush.com/images/article/04981c5b-31a9-497d-acce-53e82e2e623a/1024.jpeg" style="width: 1024px;"></a>Фух! Лекція вийшла чималенькою, але ти впорався: молодець! :) Побачимося на наступному занятті, майбутній програміст!