For і For-Each Loop: оповідання про те, як я ітерувався, ітерувався, та не витірувався
<p>----------------------------------------</p>
- це одна з базових структур мов програмування. Наприклад, на сайті Oracle є розділ " ", в якому циклам відведений окремий урок " ". Освіжимо у пам'яті основне: Цикл складається з трьох виразів (statements): (initialization), (termination) 
<p>----------------------------------------</p>
<h2>Вступ</h2><strong>Цикли</strong> - це одна з базових структур мов програмування. Наприклад, на сайті Oracle є розділ " <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/index.html" target="_blank" rel="nofollow">Lesson: Language Basics</a> ", в якому циклам відведений окремий урок " <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/for.html" target="_blank" rel="nofollow">The for Statement</a> ". Освіжимо у пам'яті основне: Цикл складається з трьох виразів (statements): <em>ініціалізація</em> (initialization), <em>умова</em> (termination) та <em>інкремент</em> (increment): 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="24e2be60-87ff-40e1-8024-94737f1d446f" data-max-width="384" alt="For та For-Each Loop: розповідь про те, як я ітерувався, ітерувався, та не виітерувався - 1" src="https://cdn.javarush.com/images/article/24e2be60-87ff-40e1-8024-94737f1d446f/256.jpeg" style="width: 384px;">
 </div>
</div>Цікаво, що всі вони опціональні, тобто ми можемо, якщо захочемо, написати: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Щоправда, у разі ми отримаємо нескінченний цикл, т.к. у нас не вказана умова виходу із циклу (termination). Вираз ініціалізації виконується лише один раз, перед виконанням всього циклу. Варто пам'ятати, що з циклу своя область видимості. Це означає, що <em>initialization</em> , <em>termination</em> , <em>increment</em> і тіло циклу бачать одні й самі змінні. Область видимості завжди легко визначити за фігурними дужками. Все, що всередині дужок не видно зовні дужок, проте все, що зовні дужок видно усередині дужок. <strong>Ініціалізація</strong>- Просто вираз. Наприклад, замість ініціалізації змінної можна взагалі зробити виклик методу, який нічого не повертатиме. Або просто пропустити, залишивши перед першою точкою з комою порожнє місце. Наступне вираз показує <strong>умову виходу</strong> (termintation). Поки воно <em>true</em> , цикл виконується. А якщо <em>false</em> – нова ітерація не розпочнеться. Якщо подивитися на картинку нижче, на ній ми при компіляції отримуємо помилку і IDE лаятиметься: наш вираз у циклі недосяжний. Оскільки ми не буде жодної ітерації у циклі, ми відразу вийдемо, т.к. false: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="d1597f69-e273-486f-9327-03e427e51624" data-max-width="285" alt="For і For-Each Loop: оповідь про те, як я ітерувався, ітерувався, та не витерувався - 2" src="https://cdn.javarush.com/images/article/d1597f69-e273-486f-9327-03e427e51624/256.jpeg" style="width: 285px;">
 </div>
</div>За виразом в <em>termination statement</em> варто стежити: від цього залежить, чи не буде у вашому додатку нескінченних циклів. <strong>Інкремент</strong> - найпростіший вираз. Воно виконується після кожної успішної циклу ітерації. І цей вираз також можна пропустити. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> outerVar <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>outerVar <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	outerVar <span class="token operator"><span class="token operator">+=</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Value = "</span></span> <span class="token operator"><span class="token operator">+</span></span> outerVar<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як видно з прикладу, кожну ітерацію циклу ми робитимемо приріст з кроком 2, але тільки поки значення <code class=" language-none">outerVar</code>менше 10. Крім того, оскільки вираз у <em>increment statement</em> насправді просто вираз, в ньому може бути все, що завгодно. Тому замість інкременту ніхто не забороняє використовувати декремент, тобто. зменшувати значення. Варто завжди стежити за написанням інкременту. <code class=" language-none">+=</code>виконує спочатку збільшення, а потім присвоєння, а от якщо в прикладі вище написати навпаки, ми отримаємо нескінченний цикл, адже змінна ніколи <code class=" language-none">outerVar</code>не отримає зміненого значення: воно у разі <code class=" language-none">=+</code>обчислюватиметься після присвоєння. До речі, з інкрементом виду <code class=" language-none">++</code>так само. Наприклад, у нас був цикл: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token operator"><span class="token operator">++</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">[</span></span>i<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Цикл працював та проблем не було. Але тут прийшла людина-рефакторинг. Він не розібрався з інкрементом і просто зробив так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span><span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">;</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">[</span></span><span class="token operator"><span class="token operator">++</span></span>i<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Якщо знак інкременту стоїть перед значенням, це означає, що спочатку воно збільшиться, а потім повернеться в місце, де вказано. У цьому прикладі з масиву ми відразу почнемо діставати елемент під індексом 1, пропустивши перший. А потім на індексі 3 впадемо з помилкою " <strong>java.lang.ArrayIndexOutOfBoundsException</strong> ". Як ви здогадалися, це працювало просто тому, що інкремент викликається після виконання ітерації. При перенесенні цього висловлювання на ітерацію все зламалося. Як виявляється, навіть у простому циклі можна наламати дров ) Якщо є масив, можна якось простіше вивести всі елементи? 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="5acafa67-e12d-4ff9-9df0-6fc9cf154e69" data-max-width="421" alt="For і For-Each Loop: оповідь про те, як я ітерувався, ітерувався, та не витірувався - 3" src="https://cdn.javarush.com/images/article/5acafa67-e12d-4ff9-9df0-6fc9cf154e69/256.jpeg" style="width: 421px;">
 </div>
</div>
<h3>For each loop</h3>Починаючи з Java 1.5, розробники Java дали нам конструкцію <code class=" language-none">for each loop</code>, описану на сайті Oracle в Guide під назвою " <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/foreach.html" target="_blank" rel="nofollow">The For-Each Loop</a> " або для версії <a href="https://docs.oracle.com/javase/1.5.0/docs/guide/language/foreach.html" target="_blank" rel="nofollow">1.5.0</a> . У загальному випадку, виглядатиме так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="cc016321-e38c-49f4-8618-514102482fc2" data-max-width="406" alt="For та For-Each Loop: розповідь про те, як я ітерувався, ітерувався, та не виітерувався - 4" src="https://cdn.javarush.com/images/article/cc016321-e38c-49f4-8618-514102482fc2/256.jpeg" style="width: 406px;">
 </div>
</div>У Java Language Specification (JLS) можна ознайомитися з описом цієї конструкції, щоб переконатися, що це ніяка не магія. Описана дана конструкція у розділі " <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-14.html#jls-14.14.2" target="_blank" rel="nofollow">14.14.2. The enhanced for statement</a> ". Як видно, <em>for each loop</em> можна використовувати з масивами та з тими, хто реалізує інтерфейс <em>java.lang.Iterable</em> . Тобто якщо дуже хочеться, ви можете реалізувати інтерфейс <em>java.lang.Iterable</em> і <em>for each loop</em> можна буде використовувати і з вашим класом. Ви відразу скажете "Так, об'єкт ітерування, але ж масив не об'єкт. Начебто". І будете не праві, т.к. Java масиви є динамічно створюваними об'єктами. Про це нам говорить специфікація мови:<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-10.html" target="_blank" rel="nofollow">У загальному випадку, масиви це</a> трохи JVM магії, тому що те, як влаштований масив всередині, невідомо і знаходиться десь всередині віртуальної машини Java. Кому цікаво, може почитати відповіді на stackoverflow: " <a href="https://stackoverflow.com/questions/2910774/how-does-array-class-work-in-java" target="_blank" rel="nofollow">How does array class work in Java?" </a>". Виходить, що якщо ми використовуємо не масив, то ми повинні використовувати щось, що реалізує <em>Iterable</em> . Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> name <span class="token operator"><span class="token operator">:</span></span> names<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Name = "</span></span> <span class="token operator"><span class="token operator">+</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут можна просто запам'ятати, що якщо ми використовуємо колекції ( <strong>java.util.Collection</strong> ), завдяки цьому отримуємо точно і <strong>Iterable</strong> . Якщо об'єкт має клас, що реалізує Iterable, він зобов'язується надавати при викликі методу iterator якийсь Ітератор, який виконуватиме ітерацію за вмістом цього об'єкта. Код вище, наприклад, матиме приблизно наступний байткод (в IntelliJ Idea ви можете виконати "View" -&gt; "Show bytecode": 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="48c1b29e-f93b-423b-87b5-e526b843313b" data-max-width="461" alt="For і For-Each Loop: оповідання про те, як я ітерувався, ітерувався, та не витерувався - 5" src="https://cdn.javarush.com/images/article/48c1b29e-f93b-423b-87b5-e526b843313b/256.jpeg" style="width: 461px;">
 </div>
</div>Як бачите, справді використовується ітератор. Якби не <em>for each loop</em> нам довелося б писати самим щось на кшталт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Iterator</span></span> i <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">/* continue if */</span></span> i<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hasNext</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">/* skip increment */</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> name <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> i<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Name = "</span></span> <span class="token operator"><span class="token operator">+</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3>Iterator</h3>Як ми бачабо вище, інтерфейс <em>Iterable</em> каже, що для екземплярів деякого об'єкта можна отримати ітератор, за допомогою якого можна ітеруватись за вмістом. Знову ж таки, можна сказати, що це принцип єдиної відповідальності з <a href="https://codegym.cc/groups/posts/osnovnye-principy-dizajna-klassov-solid-v-java" target="_blank">SOLID</a> . Структура даних сама собою не повинна керувати обходом, але може дати того, хто повинен. Базова реалізація <em>Iterator</em> 'а зводиться до того, що він оголошений зазвичай як внутрішній клас, який має доступ до зовнішнього вмісту і надає потрібний елемент, що міститься в зовнішньому класі. Ось приклад із класу <code class=" language-none">ArrayList</code>того, як ітератор повертає елемент: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">E</span></span> <span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token function"><span class="token function">checkForComodification</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> cursor<span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>i <span class="token operator"><span class="token operator">&gt;=</span></span> size<span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">NoSuchElementException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> elementData <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>elementData<span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>i <span class="token operator"><span class="token operator">&gt;=</span></span> elementData<span class="token punctuation"><span class="token punctuation">.</span></span>length<span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ConcurrentModificationException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            cursor <span class="token operator"><span class="token operator">=</span></span> i <span class="token operator"><span class="token operator">+</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">E</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> elementData<span class="token punctuation"><span class="token punctuation">[</span></span>lastRet <span class="token operator"><span class="token operator">=</span></span> i<span class="token punctuation"><span class="token punctuation">]</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачимо, з допомогою <code class=" language-none">ArrayList.this</code>ітератор отримує доступом до зовнішнього класу та її змінної <code class=" language-none">elementData</code>, після чого повертає елемент від туди. Отже, отримання ітератора відбувається дуже просто: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Робота його зводиться до того, що ми можемо перевірити, чи є елементи далі (метод <strong>hasNext</strong> ), отримати наступний елемент (метод <strong>next</strong> ) і метод <strong>remove</strong> , який видаляє останній отриманий через <em>next</em> елемент. Метод <em>remove</em> є опціональним і те, що його буде реалізовано, не гарантовано. Насправді з розвитком Java допрацьовуються і інтерфейси. Тому, в Java 8 з'явився ще й метод <code class=" language-none">forEachRemaining</code>, що дозволяє виконати деякі дії над елементами, що залишабося невідвіданими ітератором, якусь дію. Що в ітераторі та колекціях є цікавого? Наприклад, є клас <code class=" language-none"><strong>AbstractList</strong></code>. Це абстрактний клас, який є батьківським для <code class=" language-none">ArrayList</code>і<code class=" language-none">LinkedList</code>. І цікавий він нам через таке поле, як <strong>modCount</strong> . Кожна зміна вмісту списку змінюється. І що нам із того? А те, що ітератор стежить, щоб під час роботи не відбулася зміна колекції, за якою він ітерується. Як ви розумієте, реалізація ітератора для списків знаходиться там же, де і <em>modcount</em> , тобто в класі <code class=" language-none">AbstractList</code>. Розглянемо простий приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"modcount++"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тут перша цікавість, хоч і за темою. Насправді <code class=" language-none">Arrays.asList</code>повертає свій особливий <code class=" language-none">ArrayList</code>( <strong>java.util.Arrays.ArrayList</strong> ). У нього не реалізовані методи додавання, тому він є немодифікованим. Про нього написано JavaDoc: <strong>fixed-size</strong> . Але насправді він більш ніж <em>fixed-size</em> . Він включаючи <em>immutable</em> , тобто незмінний; remove на ньому теж не спрацює. А ще ми матимемо помилку, т.к. створивши ітератор, ми запам'ятали в ньому <em>modcount</em> . Потім ми змінабо "зовні" (тобто не через ітератор) стан колекції та виконали метод ітератора. Тому отримаємо помилку: <strong>java.util.ConcurrentModificationException</strong>. Щоб цього уникнути, зміну при ітеруванні потрібно виконувати через сам ітератор, а не через звернення до колекції: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Як ви знаєте, якщо <code class=" language-none">iterator.remove()</code>не виконати <code class=" language-none">iterator.next()</code>, то т.к. ітератор не вказує на жодний елемент, то ми отримаємо помилку. У прикладі ж ітератор перейде на елемент <em>John</em> , видалить його, а потім отримає елемент <em>Sara</em> . І тут все б було добре, але ось невдача, знову є "нюанси") <em>java.util.ConcurrentModificationException</em> буде тільки тоді, коли <code class=" language-none">hasNext()</code>повертає <em>true</em> . Тобто, видалити через саму колекцію останній елемент, то ітератор не впаде. Докладніше тут краще подивитися доповідь про Java паззлери з " <a href="https://youtu.be/g7B1dyARu6M?t=350" target="_blank" rel="nofollow">#ITsubbotnik Секція JAVA: Java пазлери</a> ". Таку детальну розмову ми завели з тієї простої причини, що однаково ті самі нюанси діють при<code class=" language-none">for each loop</code>, т.к. усередині "під капотом" використовується наш улюблений ітератор. І всі ці нюанси діють там. Єдине, ми не матимемо доступу до ітератора, і ми не зможемо безпечно видалити елемент. До речі, як ви знаєте, стан запам'ятовується в момент створення ітератора. І безпечне видалення працює лише там, де викликано. Тобто такий варіант не пройде: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator1 <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator2 <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>iterator2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тому що для iterator2 видалення через iterator1 було "зовнішнім", тобто виконувалося десь зовні і він про це нічого не знає. У тему ітераторів хотілося б відзначити ось що. Спеціально для реалізації інтерфейсу <code class=" language-none">List</code>створабо спеціальний, розширений ітератор. І назвали його <code class=" language-none">ListIterator</code>. Він дозволяє просуватися не тільки вперед, а й назад, а також дозволяє дізнаватися індекс попереднього елемента та наступного. Крім того, дозволяє замінити поточний елемент або вставити новий на позицію між поточним положенням ітератора і наступним. Як ви здогадалися, <code class=" language-none">ListIterator</code>можна зробити так як для <code class=" language-none">List</code>реалізації доступу по індексу. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="e82f24ec-52a8-49e1-aa97-2aea05b06e8e" data-max-width="324" alt="For та For-Each Loop: розповідь про те, як я ітерувався, ітерувався, та не виітерувався - 6" src="https://cdn.javarush.com/images/article/e82f24ec-52a8-49e1-aa97-2aea05b06e8e/256.jpeg" style="width: 324px;">
 </div>
</div>
<h3>Java 8 та ітерування</h3>Вихід у світ Java 8 спростила багатьом життя. Не оминули стороною й ітерацію щодо вмісту об'єктів. Щоб зрозуміти, як це працює, треба сказати кілька слів про що. У Java 8 з'явився клас <em>java.util.function.Consumer</em> . Ось приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Consumer</span></span> consumer <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Consumer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">accept</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> o<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>o<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><em>Consumer</em> є функціональним інтерфейсом, що означає, що всередині інтерфейсу є лише один нереалізований абстрактний метод, що вимагає обов'язкової реалізації в тих класах, які вкажуть implements даного інтерфейсу. Це дозволяє використовувати таку магічну штуку, як лямбда. Ця стаття не про це, але треба розуміти, чому ми можемо це використати. Так ось, за допомогою лямбд, вище вказаний <em>Consumer</em> можна переписати ось так: <code class=" language-none">Consumer consumer = (obj) -&gt; System.out.println(obj);</code> Це означає, що Java бачить, що на вхід буде передано щось під ім'ям obj, а далі для цього obj буде виконано вираз після -&gt;. А щодо ітерування, то тепер ми можемо робити так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Consumer</span></span> consumer <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>consumer<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Якщо ви перейдете в метод <code class=" language-none">forEach</code>, то побачите, що все до шаленства просто. Там усіма коханий нами <code class=" language-none">for-each loop</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">default</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Consumer</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token operator"><span class="token operator">?</span></span> <span class="token keyword"><span class="token keyword">super</span></span> <span class="token class-name"><span class="token class-name">T</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> action<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">Objects</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">requireNonNull</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>action<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">T</span></span> t <span class="token operator"><span class="token operator">:</span></span> <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            action<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">accept</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>t<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Також є можливість за допомогою ітератора красиво видалити елемент, наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Predicate</span></span> predicate <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">removeIf</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>predicate<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> В даному випадку метод <em>removeIf</em> приймає на вхід не <em>Consumer</em> , а <em>Predicate</em> . Він повертає <em>boolean</em> . У разі якщо предикат каже " <em>true</em> " , тоді виконається видалення елемента. Цікаво, що не все очевидно і тут)) А як ви хочете? Потрібно ж людям дати простір для створення паззлерів на конференції. Наприклад, візьмемо такий код усунення всього, до чого зможе дійти ітератор після якогось ітерування: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// Курсор на John</span></span>
<span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">hasNext</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// Следующий элемент</span></span>
    iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// Удалабо его</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Добре, тут все працює. Але ми пам'ятаємо, що Java 8 адже. Тому спробуємо спростити код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Iterator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> iterator <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">iterator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// Курсор на John</span></span>
iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEachRemaining</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> iterator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">remove</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>names<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Правда ж стало гарнішим? Однак, тут буде <strong>java.lang.IllegalStateException</strong> . І причиною тут... помилка у Java. Виявляється, вона виправлена, але в JDK 9. Ось посилання на таск OpenJDK: <a href="https://bugs.openjdk.java.net/browse/JDK-8168745" target="_blank" rel="nofollow">Iterator.forEachRemaining vs. Iterator.remove</a> . Природно, це вже обговорювалося: <a href="https://stackoverflow.com/questions/29210510/why-iterator-foreachremaining-doesnt-remove-element-in-the-consumer-lambda" target="_blank" rel="nofollow">Why iterator.forEachRemaining doesnt remove element в Consumer lambda? </a> Ну і ще один спосіб - безпосередньо через Stream API: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> names <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">asList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Sara"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Jack"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Stream</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> stream <span class="token operator"><span class="token operator">=</span></span> names<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">stream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
stream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre>
<h2>Висновки</h2>Як ми бачабо з усього матеріалу вище, цикл <code class=" language-none">for-each loop</code>- лише "синтаксичний цукор" над ітератором. Однак він тепер багато де використовується. Крім того, потрібно будь-який засіб використовувати з обережністю. Наприклад, необразливий <code class=" language-none">forEachRemaining</code>може крити неприємні сюрпризи. І це ще раз доводить, що unit тести потрібні. Хороший тест міг би виявити такий кейс використання у вашому коді. Що можна подивитися/почитати на тему: 
<ul>
 <li>Відео з конференції: " <a href="https://youtu.be/g7B1dyARu6M?t=350" target="_blank" rel="nofollow">#ITsubbotnik Секція JAVA: Java пазлери</a> "</li>
 <li>Відео з конференції: " <a href="https://youtu.be/lhXQZGuNyUk?t=930" target="_blank" rel="nofollow">Java 8 Puzzlers.Зураб Білий</a> "</li>
 <li>Хороша стаття на Java Rush: " <a href="https://codegym.cc/groups/posts/1884-pattern-iterator" target="_blank" rel="nofollow">Паттерн Iterator</a> "</li>
</ul> #Viacheslav