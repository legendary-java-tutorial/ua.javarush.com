String += String чи StringBuilder.append(String)?
<p>----------------------------------------</p>
У цій статті, хотілося б розглянути, розібрати, розповісти і показати, у чому різниця між методом append з класу і оператором для . Тут питання стоятиме не так в областях застосування, як в оптимізації коду. Так, людина, яка безперечно не з
<p>----------------------------------------</p>
У цій статті, хотілося б розглянути, розібрати, розповісти і показати, у чому різниця між методом append з класу <code class=" language-none">StringBuilder</code>і оператором <code class=" language-none">+=</code>для <code class=" language-none">String</code>. Тут питання стоятиме не так в областях застосування, як в оптимізації коду. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="99a2446c-b5c1-48b8-8c38-7498ae415245" data-max-width="437" alt="String += String чи StringBuilder.append(String)?  - 1" src="https://cdn.javarush.com/images/article/99a2446c-b5c1-48b8-8c38-7498ae415245/256.jpeg" style="width: 437px;">
 </div>
</div> Так, людина, яка безперечно не заглиблювалася в це питання, скаже: "Навіщо мені замінювати оператор + = створенням нового об'єкта взагалі іншого класу, після чого викликати ще й метод? Про яку оптимальність мова? Адже вибір очевидний, ти про що взагалі? <code class=" language-none">toString()</code>" і буде зовсім не правий. Одна із проблем полягає в тому, що <code class=" language-none">String</code>не є примітивом. <code class=" language-none">String</code>- об'єкт як і будь-який <code class=" language-none">class</code>Java, а як відомо, Java немає такого поняття як перевантаження операторів (Як наприклад в С++), оператори визначені тільки для примітивів, для будь-якого ж класу ми з вами не може перевизначити ніякий оператор. Саме тому оператори " <code class=" language-none">+</code>" та "<code class=" language-none">+</code>=" є свого роду "мабоцями" бібліотеки Java, а мабоця завжди зазнає втрат. Власне, давайте перестанемо тягнути хвіст за кота і перейдемо до вимірів. Ось проста програма заміряє час "склеювання" рядка зі змінною циклу 100000 разів. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MainClass</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">long</span></span> time<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>

        <span class="token function"><span class="token function">saveTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">String</span></span> s <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"Вітання"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">100000</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token operator"><span class="token operator">++</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
            s<span class="token operator"><span class="token operator">+=</span></span>i<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token function"><span class="token function">printDiff</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">saveTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        time <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">printDiff</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-</span></span> time<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> На моєму комп'ютері в консоль вивелося 6815ms. Тобто моєму комп'ютеру знадобилося майже 7 секунд, щоб склеїти цей рядок. Тепер давайте замінимо на StringBuilder і навіть включимо метод <code class=" language-none">toString()</code>у виміри. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MainClass</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">long</span></span> time<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>

        <span class="token function"><span class="token function">saveTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token class-name"><span class="token class-name">StringBuilder</span></span> sb <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">StringBuilder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Вітання"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">for</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> i <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> i <span class="token operator"><span class="token operator">&lt;</span></span> <span class="token number"><span class="token number">100000</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token operator"><span class="token operator">++</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
            sb<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">append</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>i<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token class-name"><span class="token class-name">String</span></span> s <span class="token operator"><span class="token operator">=</span></span> sb<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token function"><span class="token function">printDiff</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">saveTime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        time <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">printDiff</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">currentTimeMillis</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-</span></span> time<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"ms"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Мій ПК сказав мені 10ms. Т. е. 0.01 Секунди. Думаю, різниця на практиці дуже очевидна, грубо кажучи у 700 разів <code class=" language-none">append</code>відпрацював швидше. Викликано це тим, що найімовірніше " <code class=" language-none">+</code>" і "<code class=" language-none">+=</code>і самі можуть викликати цей же append, але при цьому пройшовши довгий шлях по мабоцях мови, щоб зрозуміти, що такий оператор взагалі є і що він повинен робити (останній абзац не більше ніж здогад, я не розробник JVM і не знаю що там і як) Це наочний приклад того, що зайвий об'єкт зовсім не завжди є витратним.Так, код стане на кілька рядків довшим, зате економія часу у великих проектах може стати колосальною.Прошу помітити, що виміри проводабося далеко не на офісному ПК з доісторичним процесором, а тепер уявіть, яка різниця буде на цьому самому офісному комп'ютері, який важко тягне косинку.