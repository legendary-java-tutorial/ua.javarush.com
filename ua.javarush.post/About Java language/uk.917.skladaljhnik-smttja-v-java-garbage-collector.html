Складальник сміття в Java (Garbage Collector)
<p>----------------------------------------</p>
Java-програмісту не потрібно стежити за розподілом пам'яті, оскільки збирач сміття керує пам'яттю автоматично. Складальник сміття (Garbage Collector) запускається віртуальною машиною Java (JVM). Складальник сміття — це низькопріоритетний пр
<p>----------------------------------------</p>
<h2>Лінія поведінки збирача сміття (утилізатора пам'яті)</h2>Java-програмісту не потрібно стежити за розподілом пам'яті, оскільки збирач сміття керує пам'яттю автоматично. Складальник сміття (Garbage Collector) запускається віртуальною машиною Java (JVM). Складальник сміття — це низькопріоритетний процес, який періодично запускається і звільняє пам'ять, використану об'єктами, які більше не потрібні. Різні JVM мають відмінні один від одного алгоритми збору сміття. Існує кілька використовуваних алгоритмів, наприклад: алгоритм підрахунку посилань або алгоритми розмітки та очищення.<img data-id="1347de00-5020-4e24-9a7c-3a03011dcfe9" data-max-width="850" alt="Складання сміття - 1" src="https://cdn.javarush.com/images/article/1347de00-5020-4e24-9a7c-3a03011dcfe9/800.jpeg" style="width: 850px;">
<h2>Запуск збирача сміття в Java</h2>JVM зазвичай запускає збирач сміття за низького рівня вільної пам'яті. Але робота збирача сміття не гарантує, що завжди залишатиметься достатньо вільної пам'яті. Якщо пам'яті недостатньо навіть після відновлення, JVM генерує виключення OutOfMemoryError. Зверніть увагу, що перед генеруванням виключення JVM обов'язково запускає збирач сміття щонайменше 1 раз. Ви можете запитити запуск збирача сміття Java, але ви не можете примусово задавати цю дію. 
<h2>Запит запуску збирача сміття</h2>Для запиту ви можете викликати один із таких методів: 
<pre class="  language-java" tabindex="0"><code class="  language-java"><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">gc</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token class-name"><span class="token class-name">Runtime</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getRuntime</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">gc</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span></code></pre>
<h2>Придатність для запуску збирача сміття</h2>Об'єкт підлягає утилізації, коли вона недоступна живому потоку. Об'єкт може підлягати утилізації в різних випадках: 
<ul>
 <li>Якщо змінна типу посилання, яка посилається на об'єкт, встановлена ​​в положення "0", об'єкт підлягає утилізації, у тому випадку, якщо на нього немає інших посилань.</li>
 <li>Якщо змінна типу посилання, яка посилається на об'єкт, створена для посилання на інший об'єкт, об'єкт підлягає утилізації, якщо на нього немає інших посилань.</li>
 <li>Об'єкти, створені локально в методі, підлягають утилізації, коли метод завершує роботу, якщо вони не експортуються з цього методу (тобто, повертаються або генеруються як виняток).</li>
 <li>Об'єкти, які посилаються один на одного, можуть підлягати утилізації, якщо жоден із них не доступний живому потоку.</li>
</ul>Розглянемо приклад: 
<pre class="  language-java" tabindex="0"><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">TestGC</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token class-name"><span class="token class-name">Object</span></span> o1 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>               <span class="token comment"><span class="token comment">// Line 1</span></span>
      <span class="token class-name"><span class="token class-name">Object</span></span> o2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Tutorial"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>       <span class="token comment"><span class="token comment">// Line 2</span></span>
      o1 <span class="token operator"><span class="token operator">=</span></span> o2<span class="token punctuation"><span class="token punctuation">;</span></span>                                  <span class="token comment"><span class="token comment">// Line 3</span></span>
      o2 <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>                                <span class="token comment"><span class="token comment">// Line 4</span></span>
      <span class="token comment"><span class="token comment">// Rest of the code here</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У цьому прикладі об'єкт <code class=" language-none">Integer</code>(цілочисленний), який спочатку посилається покажчик o1 може піддаватися утилізації після рядка 3, так як o1 тепер посилається на об'єкт <code class=" language-none">String</code>(рядковий). Незважаючи на те, що o2 створений для посилання на нуль, об'єкт <code class=" language-none">String</code>(рядковий) не підлягає утилізації, оскільки o1 посилається на нього. 
<h2>Фіналізація</h2>Java-технологія дозволяє використовувати метод <code class=" language-none">finalize()</code>(фіналізувати), щоб зробити необхідне очищення перед тим, як збирач сміття витягує об'єкт із пам'яті. Цей метод викликається для об'єкта збирачем сміття, коли збирач сміття обчислює, що посилань до об'єкта більше немає. Це описано в класі <code class=" language-none">Object</code>, отже, це успадковується всіма класами. Підклас скасовує метод <code class=" language-none">finalize()</code>, щоб звільнитися від системних ресурсів або ще однієї очищення: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">finalize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Throwable</span></span></code></pre> Якщо незареєстрований виняток генерується методом <code class=" language-none">finalize()</code>, виняток ігнорується і фіналізація цього об'єкта припиняється. Метод <code class=" language-none">finalize()</code>буде активовано лише один раз за час існування об'єкта. Можливе використання методу <code class=" language-none">finalize()</code>будь-якого об'єкта, щоб захистити його від утилізації. Але в цьому випадку збирач сміття вже не активує <code class=" language-none">finalize()</code>для цього об'єкта. Метод <code class=" language-none">finalize()</code>завжди буде активізований один раз перед тим, як об'єкт буде видалений збирачем сміття. Однак, можливо, що метод <code class=" language-none">finalize()</code>не буде активізовано для даного об'єкта за весь час його існування, оскільки він може не підлягати утилізації. 
<h2>Резюме</h2>У цьому розділі ми розглянули процес складання сміття, який відноситься до техніки управління пам'яттю Java. Складання сміття не може бути задане примусово. Ми познайомабося з різними способами звернення об'єктів у утилізації, що підлягають, і дізналися, що метод <code class=" language-none">finalize()</code>активізується перед тим, як об'єкт витягується збирачем сміття. 
<h2>Вправа</h2><strong>Запитання:</strong> <em> Скільки об'єктів підлягатимуть утилізації після рядка 7?</em>
<pre class="  language-java" tabindex="0"><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">TutorialGC</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> <span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
      <span class="token class-name"><span class="token class-name">Object</span></span> a <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>  <span class="token comment"><span class="token comment">// Line1</span></span>
      <span class="token class-name"><span class="token class-name">Object</span></span> b <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Long</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>     <span class="token comment"><span class="token comment">// Line2</span></span>
      <span class="token class-name"><span class="token class-name">Object</span></span> c <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"100"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// Line3</span></span>
      a <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>                     <span class="token comment"><span class="token comment">// Line4</span></span>
      a <span class="token operator"><span class="token operator">=</span></span> c<span class="token punctuation"><span class="token punctuation">;</span></span>                        <span class="token comment"><span class="token comment">// Line5</span></span>
      c <span class="token operator"><span class="token operator">=</span></span> b<span class="token punctuation"><span class="token punctuation">;</span></span>                        <span class="token comment"><span class="token comment">// Line6</span></span>
      b <span class="token operator"><span class="token operator">=</span></span> a<span class="token punctuation"><span class="token punctuation">;</span></span>                        <span class="token comment"><span class="token comment">// Line7</span></span>
      <span class="token comment"><span class="token comment">// Rest of the code here</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Варіанти відповіді:</strong> A. 0 B. 1 C. 2 D. 3 E. Код неможливо скомпілювати <strong>Правильний варіант:</strong> B <strong>Пояснення:</strong> з трьох об'єктів, створених у рядках 1, 2 та 3, тільки об'єкт <code class=" language-none">Integer</code>підлягає утилізації в кінці рядка 7. Змінна посилання, a, яка спочатку посилалася на об'єкт <code class=" language-none">Integer</code>, посилається на об'єкт <code class=" language-none">String</code>у рядку 5. Таким чином, <code class=" language-none">Integer</code>об'єкт підлягає утилізації після рядка 5, оскільки немає змінних, які посилаються на нього. Змінні <code class=" language-none">b</code>та <code class=" language-none">c</code>посилаються на об'єкти <code class=" language-none">String</code>та <code class=" language-none">Long</code>об'єкти у рядках 6 та 7, тому вони не підлягають утилізації.