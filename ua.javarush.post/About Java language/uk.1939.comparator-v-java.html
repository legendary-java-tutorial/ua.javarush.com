Comparator в Java
<p>----------------------------------------</p>
Про Comparator і порівняння в Java не писав лише лінивий. Я не лінивий — тож прошу любити і шанувати ще одну варіацію. Сподіваюся, вона буде не зайвою. І так, дана стаття відповідає на запитання: "Чи зможеш ти написати на згадку компаратор?
<p>----------------------------------------</p>
Про Comparator і порівняння в Java не писав лише лінивий. Я не лінивий — тож прошу любити і шанувати ще одну варіацію. Сподіваюся, вона буде не зайвою. І так, дана стаття відповідає на запитання: "Чи зможеш ти написати на згадку компаратор?" Сподіваюся, після прочитання цієї статті кожен зможе написати компаратор з пам'яті. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="d1c56e1c-26c5-4e0e-81db-e690fd7c6cef" data-max-width="273" alt="Comparator в Java - 1" src="https://cdn.javarush.com/images/article/d1c56e1c-26c5-4e0e-81db-e690fd7c6cef/256.jpeg" style="width: 273px;">
 </div>
</div><strong>Вступ</strong> Java, як відомо, є об'єктно-орієнтованою мовою. Як наслідок - в Java прийнято оперувати об'єктами. Але рано чи пізно постає завдання порівняння об'єктів за якимось принципом. Отже, дано: У нас є деяке повідомлення, описане класом Message: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Message</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>message <span class="token operator"><span class="token operator">=</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>id <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"["</span></span> <span class="token operator"><span class="token operator">+</span></span> id <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"] "</span></span> <span class="token operator"><span class="token operator">+</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Додамо цей клас у <a href="https://www.tutorialspoint.com/compile_java_online.php" target="_blank" rel="nofollow"><strong>Tutorialspoint java compiler</strong></a> . Не забудемо також додати імпорти: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">List</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> У main методі створимо кілька повідомлень: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> messages <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    messages<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, World!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    messages<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, Sun!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>messages<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Давайте подумаємо, що нам робити, якщо ми хочемо їх порівняти? Наприклад, ми хочемо впорядкувати за id. А щоб створити порядок, потрібно якось порівняти об'єкти, щоб зрозуміти, який об'єкт попередній (тобто менший), а який наступний (тобто більший). Почнемо з такого класу, як <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" target="_blank" rel="nofollow">java.lang.Object</a> . Як ми знаємо, всі класи успадковуються неявним чином цього класу Object. І це логічно, т.к. насправді це висловлює сенс концепції: " Усе є об'єкт " і надає загальне поведінка всім класів. І цей клас визначає, що кожен клас має два методи: → <strong>hashCode</strong> Метод hashCode повертає деяке числове (int) уявлення об'єкта як екземпляра класу. Що це означає? Це означає, що якщо ви створабо два різні екземпляри класу, то так як екземпляри різні, то і hashCode у них мають бути різними. Так сказано й в описі до методу: "Як дуже вірно є практично практичний, у hashCode метод defined by class Object does return distinct integers for distinct objects" Тобто якщо це два різних instance, то у них повинні бути різні hashCode. Тобто для нашого порівняння цей метод не підійде. → <strong>equals</strong> Метод equals відповідає питанням " чи рівні об'єкти " і повертає boolean. Цей метод за замовчуванням має код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Object</span></span> obj<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span> <span class="token operator"><span class="token operator">==</span></span> obj<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тобто, не перевизначаючи даний метод у об'єкта, цей метод по суті говорить, чи збігаються посилання на об'єкт чи ні. Для наших повідомлень це не підійде, адже нас не цікавлять посилання на об'єкт, нас цікавить id повідомлення. І навіть якби ми перевизначабо метод equals, то максимум, що ми б отримали: "Вони рівні" або "Вони не рівні". А для визначення порядку нам цього замало.
<h2>Comparator і Comparable в Java</h2>Що ж нам личить? Якщо ми в перекладачі перекладемо слово "порівняти" на англійську, то отримаємо переклад "compare". Відмінно, значить, нам потрібен той, хто порівнюватиме. Якщо порівнювати це compare, то той, хто порівнює – Comparator. Відкриємо <a href="https://docs.oracle.com/javase/8/docs/api/" target="_blank" rel="nofollow">Java Api</a> і знайдемо там <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html" target="_blank" rel="nofollow">Comparator</a> . Є такий інтерфейс - java.util.Comparator <strong>java.util.Comparator і java.lang.Comparable</strong> Як видно, існує такий інтерфейс. Клас, який його реалізує свідчить, що "Я реалізую функцію порівняння об'єктів". Єдине, що треба справді запам'ятати – це контракт компаратора, який виражається в наступному: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
Comparator возвращает int по следующей схеме: 
<ul>
<li>отрицательный int (первый об'єкт отрицательный, то есть меньше)</li>
<li>положительный int (первый об'єкт положительный, хороший, то есть больший)</li>
<li>ноль = об'єкты равны</li>
</ul></code></pre> Тепер напишемо компаратора. Нам буде потрібно імпорт <strong>java.util.Comparator</strong> . Після імпорту додамо в main метод: <code class=" language-none">Comparator&lt;Message&gt; comparator = new Comparator&lt;Message&gt;();</code> Звісно, ​​це відпрацює, т.к. Comparator це інтерфейс. Тому після круглих дужок додамо фігурні <code class=" language-none">{ }</code>. У цих дужках напишемо метод: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">compare</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Message</span></span> o1<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Message</span></span> o2<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">return</span></span> o1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">compareTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>o2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Написання цього не треба навіть пам'ятати. Компаратор - це той, хто виконує порівняння, тобто робить compare. Щоб відповісти на питання, в якому порядку йдуть об'єкти, що порівнюються, ми повертаємо int. Ось і все, власне. Легко і просто. Як ми бачимо з прикладу, крім Comparator'а є ще один інтерфейс - <strong>java.lang.Comparable</strong> , реалізуючи який ми повинні визначити метод <strong>compareTo</strong> . Цей інтерфейс говорить, що "Клас, який реалізує інтерфейс, дозволяє порівнювати екземпляри класу". Наприклад, у Integer реалізація compareTo виглядає так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">(</span></span>x <span class="token operator"><span class="token operator">&lt;</span></span> y<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">1</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>x <span class="token operator"><span class="token operator">==</span></span> y<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">?</span></span> <span class="token number"><span class="token number">0</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span></code></pre> Як запам'ятати всі ці інтерфейси? А навіщо? Все йде від англійської. Compare - порівнювати, той хто порівнює - Comparator (як реєстратор, наприклад. Тобто той, хто реєструє), а прикметник "Comparable, що порівнюється". Ну а "порівняти з" перекладається не тільки як compare with, але і як compare to. Все просто. Мова Java писали адже англомовні люди і в назві всього Java вони керувалися просто англійською і в іменуванні була якась логіка. А метод compareTo описує те, як екземпляр класу потрібно порівнювати з іншими екземплярами. Наприклад, рядки порівнюються <a href="https://ru.wikipedia.org/wiki/%D0%9B%D0%B5%D0%BA%D1%81%D0%B8%D0%BA%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA" target="_blank" rel="nofollow">лексиграфічно</a> , а числа порівнюються за значенням. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f7969289-ed38-46d3-bbdc-59758f0044b9" data-max-width="328" alt="Comparator в Java - 2" src="https://cdn.javarush.com/images/article/f7969289-ed38-46d3-bbdc-59758f0044b9/256.jpeg" style="width: 328px;">
 </div>
</div> Java 8 внесла приємні зміни. Якщо придивитися до інтерфейсу Comparator, то ми побачимо, що над ним стоїть інструкція <code class=" language-none">@FunctionalInterface</code>. Насправді, ця інструкція для інформації і означає, що цей інтерфейс є функціональним. Це означає, що в цьому інтерфейсі є лише один абстрактний метод без реалізації. Що нам це дає? Ми можемо написати код компаратора тепер так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> comparator <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>o1<span class="token punctuation"><span class="token punctuation">,</span></span> o2<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> o1<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">compareTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>o2<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> У дужках – те, як ми назвемо змінні. Java сама побачить, що т.к. Метод то лише один, то відомо які вхідні параметри необхідні, скільки, яких типів. Далі ми говоримо стрілочкою, що хочемо їх передати ось у цю ділянку коду. Крім того, завдяки Java 8 з'явабося default методи в інтерфейсах – це такі методи, які за умовчанням з'являються (за замовчуванням – by default), коли ми реалізуємо інтерфейс. В інтерфейсі Comparator таких кілька. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Comparator</span></span> moreImportant <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">reverseOrder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Comparator</span></span> lessImportant <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">naturalOrder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Є ще один метод, який зробить ваш код чистішим. Подивимося приклад вище, де ми описували наш компаратор. Що він робить? Адже він досить примітивний. Він просто бере об'єкт і дістає з нього якесь значення, яке є comparable. Наприклад, Integer реалізує comparable, тому ми змогли виконати compareTo на значеннях ID повідомлення. Цю просту функцію компаратора можна записати і так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> comparator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">comparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тобто дослівно "У нас є Comparator, який порівнює так: бере об'єкти, дістає з них Comparable за допомогою методу getId(), порівнює через compareTo". І жодних страшних конструкцій більше. Ну і насамкінець, хочеться ще відзначити одну особливість. Компаратори можна поєднувати в ланцюжок. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> comparator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">comparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
comparator <span class="token operator"><span class="token operator">=</span></span> comparator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">thenComparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">length</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre>
<h3>Застосування</h3>Оголошення компаратора виявилося досить логічним, чи не так? Тепер треба подивитися, як його використовувати і в яких місцях. → <strong>Collections.sort (java.util.Collections)</strong> Звичайно, ми можемо сортувати колекції таким чином. Але не всі, а лише списки. І немає нічого незвичайного, т.к. саме список передбачає доступ до елемента за індексом. І це дозволяє елемент номер два поміняти місцями з елементом номер три. Тому й сортування таким чином є лише для списків: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> comparator <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">comparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>obj <span class="token operator"><span class="token operator">-&gt;</span></span> obj<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sort</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>messages<span class="token punctuation"><span class="token punctuation">,</span></span> comparator<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> → <strong>Arrays.sort (java.util.Arrays)</strong> Масиви також зручно сортувати. Знову, з тієї ж причини доступу до елементів за індексом. → <strong>Спадкоємці java.util.SortedSet та java.util.SortedMap</strong> Як ми пам'ятаємо, Set і Map не гарантують порядок зберігання записів. АЛЕ ми маємо спеціальні реалізації, які гарантують порядок. І якщо елементи колекції не реалізують java.lang.Comparable, ми в конструктор таких колекцій можемо передати Comparator: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Set</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> msgSet <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">TreeSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>comparator<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> → <strong>Stream API</strong> У Stream Api, які з'явабося в Java 8, компаратор дозволяє спрощувати роботу над елементами стриму. Наприклад, нам потрібна послідовність випадкових чисел від 0 до 999 включно: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Supplier</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> randomizer <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1000</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Stream</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">generate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>randomizer<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">limit</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">10</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sorted</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">naturalOrder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forEach</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Ми могли б і зупинитися, але є завдання цікавіше. Наприклад, потрібно підготувати Map, де ключ – id повідомлення. При цьому ми хочемо відсортувати ці ключі, щоб ключі йшли по порядку, від меншого до більшого. Почнемо з такого коду: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Map</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> collected <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">stream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>messages<span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sorted</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">comparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">collect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Collectors</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toMap</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Нам повернуть тут насправді HashMap. А як ми знаємо, вона не гарантує будь-який порядок. Тому наші відсортовані за ID запис просто втратабо порядок. Не добре. Прийде змінити трохи наш колектор: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Map</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> collected <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Arrays</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">stream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>messages<span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sorted</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Comparator</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">comparing</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">collect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Collectors</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toMap</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> msg <span class="token operator"><span class="token operator">-&gt;</span></span> msg<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>oldValue<span class="token punctuation"><span class="token punctuation">,</span></span> newValue<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> oldValue<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">TreeMap</span></span><span class="token operator"><span class="token operator">::</span></span><span class="token keyword"><span class="token keyword">new</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Код став виглядати дещо страшнішим, але завдання тепер вирішено правильно завдяки явній вказівці реалізації карти TreeMap. Докладніше про різні групування можна прочитати тут: 
<ul>
 <li><a href="https://vertex-academy.com/tutorials/ru/java-8-stream-collect-groupingby/" target="_blank" rel="nofollow">Java 8 Stream collect grouping</a></li>
 <li><a href="https://www.mkyong.com/java8/java-8-collectors-groupingby-and-mapping-example/" target="_blank" rel="nofollow">Java 8 – Stream Collectors groupingBy examples</a></li>
</ul> Колектор можна створити самим. Докладніше можна прочитати тут: <a href="https://blog.indrek.io/articles/creating-a-collector-in-java-8/" target="_blank" rel="nofollow">"Creating a custom collector in Java 8"</a> . І корисно прочитати обговорення тут: <a href="https://stackoverflow.com/questions/32859038/java-8-list-to-map-with-stream" target="_blank" rel="nofollow">"Java 8 list to map with stream"</a> . 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="226" alt="Comparator в Java - 3" src="https://cdn.javarush.com/images/article/7ba32ce5-f169-467a-be75-9d540239781b/original.jpeg">
 </div>
</div><strong>Граблі</strong> Comparator та Comparable це добре. Але з ними пов'язаний один аспект, про який варто пам'ятати. Коли клас виконує сортування, він розраховує, що можна привести Ваш клас до Comparable. Якщо це не так – у момент виконання ви отримаєте помилку. Подивимося на приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">SortedSet</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> msg <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">TreeSet</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Developer"</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Здається, що нічого поганого тут немає. Але насправді на нашому прикладі він впаде з помилкою: <code class=" language-none">java.lang.ClassCastException: Message cannot be cast to java.lang.Comparable</code> А все тому, що він намагався відсортувати елементи (Адже SortedSet). І не зміг. Слід не забути про це під час роботи з SortedMap та SortedSet. <strong>Додатково</strong> Рекомендується до перегляду: <a href="https://youtu.be/-S_huEuNJiU?t=5m2s" target="_blank" rel="nofollow">Юрій Ткач: HashSet та TreeSet - Collections #1 - Advanced Java</a>