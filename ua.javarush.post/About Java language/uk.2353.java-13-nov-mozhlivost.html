Java 13: нові можливості
<p>----------------------------------------</p>
Ми вже встигли звикнути до того, що новий реліз JDK з'являється раз на півроку. Поки що такий підхід себе виправдав, а переживання деяких розробників, мовляв, вони не встигатимуть за оновленнями, виявилися марними: піврічних змін трохи і во
<p>----------------------------------------</p>
Ми вже встигли звикнути до того, що новий реліз JDK з'являється раз на півроку. Поки що такий підхід себе виправдав, а переживання деяких розробників, мовляв, вони не встигатимуть за оновленнями, виявабося марними: піврічних змін трохи і вони не такі глобальні, як раніше. Ну а програмісти-початківці можуть і зовсім не помітити нововведення. <img data-id="0e9a1fd4-aebe-436d-b47a-9d99cb37686b" data-max-width="850" alt="Java 13: нові можливості - 1" src="https://cdn.javarush.com/images/article/0e9a1fd4-aebe-436d-b47a-9d99cb37686b/800.jpeg" style="width: 850px;">Тим не менш, майбутнім розробникам ПЗ краще бути в курсі нововведень. У цій статті ми традиційно опишемо прийняті пропозиції щодо розширення (JEP). Java 13 включає лише п'ять JEP'ів і 76 нових елементів базової бібліотеки (з яких майже половина — прості доповнення до пакету java.io). 
<h2><a href="https://openjdk.java.net/jeps/355" rel="nofollow" target="_blank">JEP 355</a> : Text Blocks (Preview)</h2>Почнемо із зміни синтаксису мови. Найзначніша з них – це текстові блоки. Вони дозволяють уникати екранування символів та вміють форматувати рядки. Можливо, ви <a href="https://codegym.cc/groups/posts/2171-java-12-uzhe-zdesjh-chto-novogo" target="_blank">пам'ятаєте</a> , що в JDK 12 так і не з'явилася очікувана фіча Raw String Literals (JEP 326) для роботи з рядковими літералами. У Java 13 їй на зміну прийшов JEP 355 із його текстовими блоками. Ви, найімовірніше, пам'ятаєте, що Java рядок обгорнуто в подвійні лапки. Це добре, але проблема в тому, що рядок не може займати більше однієї лінії вихідного файлу (щоб не плутати з Java-рядком, тут називатимемо рядок файлу "лінією"). Що ж, підемо в обхід і використовуємо, наприклад, символ<code class=" language-none"><strong>\n</strong></code>якщо потрібно розрив, або конкатенацію багаторядкових виразів. Не дуже гарно виходить! Особливо громіздко виглядають текстові літерали із вбудованими фрагментами HTML, XML, SQL чи JSON. Всі ці екранування, конкатенації, ручне редагування робить код незручним для написання і важко читати. Текстові блоки намагаються вирішити цю проблему. Вони починаються ЕЕЕ ... з потрійних подвійних лапок і закінчуються ними ж (знаю, звучить не дуже). Все, що знаходиться між лапками, інтерпретується як частина рядка, включаючи переклади на нову лінію. Текстові блоки можна використовувати точно так, як стандартні текстові літерали, Java скомпілює код однаково. Відкриваючі лапки повинні супроводжуватися обмежувачем рядка; текстові блоки не можна використовувати в одну лінію, тому код 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> smallBlock <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">""</span></span><span class="token string"><span class="token string">"Only one line"</span></span><span class="token string"><span class="token string">""</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> призведе до таких помилок: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">TextBlock</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>java<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">3</span></span><span class="token operator"><span class="token operator">:</span></span> error<span class="token operator"><span class="token operator">:</span></span> illegal text block <span class="token keyword"><span class="token keyword">open</span></span> <span class="token namespace"><span class="token namespace">delimiter</span></span> sequence<span class="token punctuation"><span class="token punctuation">,</span></span> missing line terminator
   <span class="token class-name"><span class="token class-name">String</span></span> smallBlock <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">""</span></span><span class="token string"><span class="token string">"Text Block"</span></span><span class="token string"><span class="token string">""</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                          <span class="token operator"><span class="token operator">^</span></span>
<span class="token class-name"><span class="token class-name">TextBlock</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>java<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">3</span></span><span class="token operator"><span class="token operator">:</span></span> error<span class="token operator"><span class="token operator">:</span></span> illegal text block <span class="token keyword"><span class="token keyword">open</span></span> <span class="token namespace"><span class="token namespace">delimiter</span></span> sequence<span class="token punctuation"><span class="token punctuation">,</span></span> missing line terminator
   <span class="token class-name"><span class="token class-name">String</span></span> smallBlock <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">""</span></span><span class="token string"><span class="token string">"Text Block"</span></span><span class="token string"><span class="token string">""</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
                                   	<span class="token operator"><span class="token operator">^</span></span></code></pre> Простий HTML-фрагмент тепер можна написати так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> htmlBlock <span class="token operator"><span class="token operator">=</span></span> <span class="token triple-quoted-string string"><span class="token triple-quoted-string string">"""
               	&lt;html&gt;
                 	&lt;body&gt;
                   	&lt;p&gt;CodeGym Web page&lt;/p&gt;
                 	&lt;/body&gt;
               	&lt;html&gt;
         	     """</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Згадаємо кілька тонкощів, про які краще знати під час використання текстових блоків. Розташування лапок виявляється важливим: воно визначає, як обробляється випадковий пробіл. У наведеному вище прикладі лапки, що закривають, вирівняні з відступом тексту HTML. У цьому випадку компілятор видалить прогалини відступу, і в результаті ми отримаємо такий рядок: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>html<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
  <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>body<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>p<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">My</span></span> web page<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>p<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>body<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>html<span class="token operator"><span class="token operator">&gt;</span></span></code></pre><mark>Зверніть увагу:</mark>такий рядок міститиме нову лінію в кінці рядка. Якщо вона не потрібна, закриваючі лапки “”” можна поставити безпосередньо після тега&lt;/html&gt;. Якщо ми перемістимо лапки, що закривають, ближче до лівого поля, це змінить кількість віддалених відступів. Якби ми перемістабо їх на два пробіли вліво, ми додали б два пробіли для відступу до кожної лінії рядка. Переміщення до лівого краю призведе до збереження всіх відступів. Переміщення лапок далі вправо не матиме жодного ефекту і не додасть більше відступів. У версію JDK 13 текстові блоки потрапабо як прев'ю-фічі. Це означає, що вони поки що не включені у відповідну специфікацію мови Java. Тобто незрозуміло, чи стане ця фіча постійною частиною мови, чи вона тут лише гість. В даний час розробники можуть протестувати фічу та висловити думку про неї. Від нього і залежатиме доля текстових блоків: фічу можуть покращити, а якщо вона не сподобається — то й зовсім вилучити. Якщо ви хочете випробувати текстові блоки на практиці, пам'ятайте, що прев'ю-фічі потрібно явно включати для компіляції та виконання. Компіляція: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
javac --enable-preview --release 13 TextBlock.java</code></pre> Щоб запустити програму, потрібно увімкнути функції попереднього перегляду: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
java --enable-preview TextBlock</code></pre> У класі <code class=" language-none">String</code>є три нові методи, які доповнюють цю зміну мови: 
<ul>
 <li><code class=" language-none"><strong>formatted()</strong></code>: форматує рядок, використовуючи сам рядок як рядок формату. Еквівалентний виклику<code class=" language-none">format(this, args)</code></li>
 <li><code class=" language-none"><strong>stripIndent()</strong></code>: видаляє випадкові пробіли з рядка. Це корисно, якщо ви читаєте багаторядкові рядки і хочете застосувати такий самий виняток випадкових прогалин, як і у разі явного оголошення.</li>
 <li><code class=" language-none"><strong>translateEscapes()</strong></code>: повертає рядок з escape-послідовностями (наприклад, <code class=" language-none">\ r</code>), переведеними у відповідне значення Unicode.</li>
</ul>Цікаво, що ці методи тільки з'явабося, але вже помічені як <strong>deprecated</strong> ... такий стан речей наводить на думку, що їх можуть вилучити в майбутній версії JDK. Це здається дещо ексцентричним — додавати новий метод і одразу відмовлятися від нього. Однак потрібно врахувати, що ці методи пов'язані з прев'ю-фічею, яка може бути змінена або видалена. Можливо, введення анотації <code class=" language-none">@PreviewFeature</code>допомогло б з подібними ситуаціями, але поки що така вона не входить до JDK (хоча з високою ймовірністю вона з'явиться в JDK 14). 
<h2><a href="https://openjdk.java.net/jeps/354" rel="nofollow" target="_blank">JEP 354</a> : Switch Expression (Preview)</h2>У Java 12 з'явилася пропозиція про нову форму написання виразів з оператором switch - <a href="http://openjdk.java.net/jeps/325" rel="nofollow" target="_blank">JEP 325</a> . Воно виявилося найпершою прев'ю-фічею і її доля доводить, що виносити пропозиції на суд користувачів - чудова ідея. До JDK 12 <code class=" language-none">switch</code>можна було використовувати лише як оператор, який виконує дію, але не повертає результату. А ось у Java 12 дозволила використовувати <code class=" language-none">switch</code>як вираз, що повертає результат, який можна присвоїти змінній. Були й інші зміни в синтаксисі операторів case всередині <code class=" language-none">switch</code>. Давайте розглянемо приклад із JEP, щоб розібратися, як це працює. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> numberOfLetters<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">switch</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>dayOfWeek<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> MONDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> FRIDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> SUNDAY<span class="token operator"><span class="token operator">:</span></span>
    numberOfLetter <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">break</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> <span class="token class-name"><span class="token class-name">TUESDAY</span></span>
    numberOfLetter <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">break</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> THURSDAY
  <span class="token keyword"><span class="token keyword">case</span></span> <span class="token class-name"><span class="token class-name">SATURDAY</span></span>
    numberOfLetter <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">break</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> <span class="token class-name"><span class="token class-name">WEDNESDAY</span></span>
    numberOfLetter <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">9</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">break</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">default</span></span><span class="token operator"><span class="token operator">:</span></span>
   <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Huh?: "</span></span> <span class="token operator"><span class="token operator">+</span></span> day<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У цьому прикладі ми використовуємо значення <code class=" language-none"><strong>dayOfWeek</strong></code>для визначення значення <code class=" language-none"><strong>numberOfLetters</strong></code>. Через особливості роботи оператора <code class=" language-none"><strong>switch</strong></code>, цей код — не найкрасивіший і легко наробити помилок. По-перше, якщо ми забудемо застосувати оператор <code class=" language-none"><strong>break</strong></code>для кожної групи case-міток, ми за замовчуванням перейдемо до наступної групи міток. Це може призвести до помилок, які важко знайти. По-друге, ми повинні визначити кожну групу case-міток. Якщо забудемо, то, зрозуміло, отримаємо помилку компілятора, однак такий варіант не ідеальний. Також наш код дуже багатослівний, оскільки кожне значення <code class=" language-none"><strong>dayOfWeek</strong></code>має мати свою власну case-мітку. Використовуючи новий синтаксис, ми отримуємо набагато чистіший і менш схильний до помилок код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> numberOfLetters <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">switch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>dayOfWeek<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">case</span></span> MONDAY<span class="token punctuation"><span class="token punctuation">,</span></span> FRIDAY<span class="token punctuation"><span class="token punctuation">,</span></span> SUNDAY <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">case</span></span> TUESDAY <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">case</span></span> THURSDAY<span class="token punctuation"><span class="token punctuation">,</span></span> SATURDAY <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">case</span></span> WEDNESDAY <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token number"><span class="token number">9</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">default</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Huh?: "</span></span> <span class="token operator"><span class="token operator">+</span></span> day<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тепер нам потрібно зробити привласнення тільки один раз (з повертається <code class=" language-none">switch</code>значенням) і можна використовувати список, що розділяється комами, для case-міток. І оскільки ми не використовуємо оператор <code class=" language-none">break</code>, то усуваємо пов'язані з ним проблеми. Синтаксис виразу <code class=" language-none">switch</code>дозволяє використовувати синтаксис більш старого стилю, тому JDK 12 ми можемо написати і так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> numberOfLetters <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">switch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>dayOfWeek<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> MONDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> FRIDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> SUNDAY<span class="token operator"><span class="token operator">:</span></span>
   <span class="token keyword"><span class="token keyword">break</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> TUESDAY
   <span class="token keyword"><span class="token keyword">break</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> THURSDAY
  <span class="token keyword"><span class="token keyword">case</span></span> SATURDAY
   <span class="token keyword"><span class="token keyword">break</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> WEDNESDAY
   <span class="token keyword"><span class="token keyword">break</span></span> <span class="token number"><span class="token number">9</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">default</span></span><span class="token operator"><span class="token operator">:</span></span>
   <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Huh?: "</span></span> <span class="token operator"><span class="token operator">+</span></span> day<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> На думку Java-спільноти, перевантаження використання <code class=" language-none">break</code>для вказівки значення, що повертається, може збивати з пантелику. Мова Java також дозволяє використовувати <code class=" language-none">break</code>(і <code class=" language-none">continue</code>) з позначкою на зразок оператора безумовного переходу <code class=" language-none">goto</code>. У JEP 354 було змінено подібне використання <code class=" language-none">break</code>, так що Java 13 наш код дещо змінюється: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> numberOfLetters <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">switch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>dayOfWeek<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> MONDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> FRIDAY<span class="token operator"><span class="token operator">:</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> SUNDAY<span class="token operator"><span class="token operator">:</span></span>
   <span class="token keyword"><span class="token keyword">yield</span></span> <span class="token number"><span class="token number">6</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> TUESDAY
   <span class="token keyword"><span class="token keyword">yield</span></span> <span class="token number"><span class="token number">7</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> THURSDAY
  <span class="token keyword"><span class="token keyword">case</span></span> SATURDAY
   <span class="token keyword"><span class="token keyword">yield</span></span> <span class="token number"><span class="token number">8</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">case</span></span> WEDNESDAY
   <span class="token keyword"><span class="token keyword">yield</span></span> <span class="token number"><span class="token number">9</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">default</span></span><span class="token operator"><span class="token operator">:</span></span>
   <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Huh?: "</span></span> <span class="token operator"><span class="token operator">+</span></span> day<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Наступні три JEP'а пов'язані з віртуальною машиною Java. 
<h2><a href="https://openjdk.java.net/jeps/350" rel="nofollow" target="_blank">JEP 350</a> Dynamic CDS Archive</h2>Це розширення дозволяє провести динамічне архівування класів наприкінці виконання Java-програми. CDS або Class Data Sharing дозволяє запакувати всі класи, що запускаються при старті, в спеціальний архів <code class=" language-none">class data sharing</code>, використовуючи список цих самих класів за замовчуванням. Це призводить до суттєвого прискорення запуску додатків та економії оперативної пам'яті. Раніше використання AppCDS було багатоетапним процесом, що включає створення списку відповідних класів та використання цього списку для створення архіву, який буде використовуватися для подальших запусків. Тепер все, що потрібно, - це один запуск програми з прапором -XX: <code class=" language-none">ArchiveClassesAtExit</code>, що вказує місце, куди буде записано архів. При такому підході класи автоматично упаковуються до архіву після нормальної зупинки програми. 
<h2><a href="https://openjdk.java.net/jeps/351" rel="nofollow" target="_blank">JEP 351 ZGC</a> : Uncommit unused memory</h2>Рік тому в <a href="https://codegym.cc/groups/posts/1961-vihshla-java-11-novihe-fichi-i-vozmozhnosti-" target="_blank">JDK 11</a> бид представлений ZGC - експериментальний збирач сміття, що масштабується, з низькою затримкою. Спочатку ZGC поводився досить дивно: він не дозволяв повернути пам'ять операційній системі, навіть якщо вона вже була не потрібна. Для деяких середовищ, наприклад, для контейнерів, де ресурси використовуються кількома службами одночасно, це може обмежувати масштабованість та ефективність системи. Купа ZGC складається з так званих ZPages. Коли ZPages очищаються під час циклу збору сміття, вони повертаються до кешу ZPageCache. ZPages у цьому кеші впорядковано за порядком давності використання. Java 13 ZGC повертатиме в операційну систему сторінки, які були визначені як ті, що не використовувалися досить довго. Таким чином, їх можна буде використовувати повторно для інших процесів. 
<h2><a href="https://openjdk.java.net/jeps/353" rel="nofollow" target="_blank">JEP 353</a> Reimplement the legacy Socket API</h2>Обидві реалізації API <code class=" language-none"><strong>java.net.Socket</strong></code>відносяться <code class=" language-none"><strong>java.net.ServerSocket</strong></code>ще JDK 1.0. У цій, та й у всіх наступних JDK, реалізація цих API-інтерфейсів використовує кілька методів (таких, як використання стека потоків як буфер введення-виведення), які роблять їх негнучкими і складними в обслуговуванні. Щоб вирішити цю проблему, JDK 13 надали нову реалізацію <code class=" language-none">NioSocketImpl</code>. Вона більше не вимагає нативного коду, тим самим спрощуючи портування на різні платформи. Цей клас також використовує існуючий механізм буферного кешу (за винятком використання стека потоків для цієї мети) і блокування <code class=" language-none">java.util.concurrent</code>, а не синхронізовані методи. Це спростить інтеграцію з файберами з <a href="https://openjdk.java.net/projects/loom/" rel="nofollow" target="_blank">Project Loom</a> . 
<h2>Нові API</h2>Ми вже згадували раніше, що Java 13 включає 76 нових API в бібліотеках базових класів. Вони охоплюють такі області: 
<ul>
 <li>Оновлення підтримки Unicode.</li>
 <li>Три нові методи <code class=" language-none"><strong>String</strong></code>для підтримки текстових блоків (див. опис JEP 255 вище).</li>
 <li>Класи <code class=" language-none"><strong>java.nio</strong></code>тепер мають абсолютні (на відміну від відносних) <code class=" language-none">get</code>та<cpode>
   set-методи. Вони, як і базовий абстрактний клас 
   <code class=" language-none">Buffer</code>, включають метод 
   <code class=" language-none">slice()</code>вилучення частини буфера.
  </cpode></li>
 <li>Метод <code class=" language-none"><strong>force()</strong></code>класу <code class=" language-none"><strong>MappedByteBuffer</strong></code>примусово записує розділ буфера у його резервне сховище.</li>
 <li><code class=" language-none"><strong>nio.FileSystem</strong></code>додає три нові перевантажені форми <code class=" language-none"><strong>newFileSystem()</strong></code>для доступу до вмісту як файлової системи.</li>
 <li>З'явився <code class=" language-none">javax.annotation.processing.ProcessingEnvironment</code>новий цікавий метод. <code class=" language-none">isPreviewEnabled()</code>. Він повідомить про те, чи включені preview-фічі. Це цікаво тому, що згадана вище інструкція <code class=" language-none">@PreviewFeature</code>не буде доступна до виходу JDK 14.</li>
 <li><code class=" language-none">DocumentBuilderFactory</code>і <code class=" language-none">SAXParserFactory</code>отримують <code class=" language-none">javax.xml.parsers</code>три нових методу для створення екземплярів, що підтримують простір імен.</li>
</ul><em>Матеріал заснований на статті <a href="https://www.azul.com/jdk-13-81-new-features-and-apis/" rel="nofollow" target="_blank">Саймона Ріттера</a> та <a href="http://openjdk.java.net/" rel="nofollow" target="_blank">офіційної документації</a> .</em>