RMI: практика використання
<p>----------------------------------------</p>
Вітання! Сьогодні ми розглянемо досить цікаву тему – . Це розшифровується як – віддалений виклик методів. За допомогою RMI ти можеш навчити дві програми спілкуватися між собою навіть якщо вони знаходяться на різних комп'ютерах. Звучить крут
<p>----------------------------------------</p>
Вітання! Сьогодні ми розглянемо досить цікаву тему – <strong>RMI</strong> . Це розшифровується як <strong>Remote Method Invocation</strong> – віддалений виклик методів. <img data-id="dd36e51a-c6bf-4d6c-bebc-fb3b6f0af6de" data-max-width="850" alt="RMI: практика використання - 1" src="https://cdn.javarush.com/images/article/dd36e51a-c6bf-4d6c-bebc-fb3b6f0af6de/800.jpeg" style="width: 850px;">За допомогою RMI ти можеш навчити дві програми спілкуватися між собою навіть якщо вони знаходяться на різних комп'ютерах. Звучить круто? :) А це не так вже й складно зробити! У сьогоднішній лекції ми розберемося, із яких частин складається RMI-взаємодія та як його налаштувати. Перше, що нам знадобиться – це <strong>клієнт</strong> та <strong>сервер</strong>. Можеш особливо не заглиблюватись у комп'ютерну термінологію. У випадку RMI це просто дві програми. Одна з них міститиме якийсь об'єкт, а друга викликатиме методи цього об'єкта. Викликати в одній програмі методи об'єкта, що знаходиться в іншій програмі, – такого ми ще не робабо! Саме час спробувати! :) Щоб не потонути в нетрях, нехай наша програма буде простою. Взагалі, на серверах зазвичай відбуваються якісь обчислення, які запитує клієнт. Так буде й у нас. У ролі сервера у нас буде проста програма-калькулятор. У неї буде лише один метод — <code class=" language-none"><strong>multiply()</strong></code>. Він множитиме два числа, які йому відправила програма-клієнт, і повертатиме результат. Насамперед нам знадобиться інтерфейс: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Remote</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">Calculator</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">Remote</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">multiply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> x<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> y<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Для чого нам інтерфейс? Справа в тому, що робота RMI заснована на створенні проксі, які ти вивчав в одній із <a href="https://codegym.cc/groups/posts/2281-dinamicheskie-proksi" target="_blank">минулих лекцій</a> . А робота з проксі, як ти, мабуть, пам'ятаєш, ведеться саме на рівні інтерфейсів, а не класів. До нашого інтерфейсу є дві важливі вимоги! 
<ol>
 <li>Він повинен успадковувати інтерфейс-маркер Remote.</li>
 <li>Всі його методи повинні викидати RemoteException (це не робиться в IDE автоматично, треба написати руками!).</li>
</ol>Тепер нам треба створити клас-сервер, який реалізовуватиме наш інтерфейс <code class=" language-none"><strong>Calculator</strong></code>. <img data-id="f8699f2b-2beb-47c7-a12e-99cea00f396c" data-max-width="850" alt="RMI: практика використання - 2" src="https://cdn.javarush.com/images/article/f8699f2b-2beb-47c7-a12e-99cea00f396c/800.jpeg" style="width: 850px;">Тут також усе досить просто: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">RemoteCalculationServer</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Calculator</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">multiply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> x<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> y<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">RemoteException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> x<span class="token operator"><span class="token operator">*</span></span>y<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут навіть коментувати особливо нічого :) Тепер нам потрібно написати програму-сервер, яка налаштовуватиме і запускатиме наш серверний клас-калькулятор. Вона виглядатиме ось так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">AlreadyBoundException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Remote</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span>registry<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span>registry<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Registry</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span>server<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">UnicastRemoteObject</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">ServerMain</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> UNIQUE_BINDING_NAME <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"server.calculator"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">AlreadyBoundException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">InterruptedException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">RemoteCalculationServer</span></span> server <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">RemoteCalculationServer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Registry</span></span> registry <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createRegistry</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2732</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">Remote</span></span> stub <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">UnicastRemoteObject</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exportObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>server<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">bind</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>UNIQUE_BINDING_NAME<span class="token punctuation"><span class="token punctuation">,</span></span> stub<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sleep</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>MAX_VALUE<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Давай розбиратися :) У першому рядку ми створюємо якусь рядкову змінну: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> UNIQUE_BINDING_NAME <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"server.calculator"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Цей рядок є <strong>унікальним ім'ям віддаленого об'єкта</strong> . За цим ім'ям програма-клієнт зможе знайти наш сервер: ти побачиш це пізніше. Далі ми створюємо наш об'єкт-калькулятор: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">RemoteCalculationServer</span></span> server <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">RemoteCalculationServer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тут усе зрозуміло. Далі вже цікавіше: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Registry</span></span> registry <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createRegistry</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2732</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Ця штука під назвою Registry - <strong>реєстр віддалених об'єктів</strong> . «Видалених» не в тому сенсі, що ми їх видалабо з комп'ютера, а в тому, що до об'єктів з цього регістру можливий віддалений доступ з інших програм :) У спосіб ми <code class=" language-none"><strong>LocateRegistry.createRegistry()</strong></code>передали число 2732. Це номер порту. Якщо не знаєш, що таке порт — можна почитати <a href="https://tcinet.ru/press-centre/glossary/article.php?ELEMENT_ID=5193" rel="nofollow" target="_blank">ось тут</a> , але зараз тобі достатньо запам'ятати, що це унікальний номер, за яким інші програми зможуть знайти наш реєстр об'єктів (це теж побачиш нижче). Їдемо далі. Подивимося, що у нас відбувається у наступному рядку: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Remote</span></span> stub <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">UnicastRemoteObject</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exportObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>server<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> У цьому рядку ми створюємо <strong>заглушку</strong> . <strong>Заглушка (stub)</strong> інкапсулює в собі весь процес віддаленого виклику. Можна сміливо сказати, що це <strong>найважливіший елемент</strong> RMI. Що вона робить? 
<ol>
 <li>Приймає всю інформацію про віддалений виклик якогось методу.</li>
 <li><strong>Якщо метод має параметри, заглушка десеріалізує їх. </strong>Зверніть увагу на цей пункт! Параметри, які ти передаєш методам для віддаленого дзвінка, повинні бути серіалізованими (адже вони передаватимуться по мережі). У нас такої проблеми немає – ми передаємо просто цифри. Але якщо ти будеш передавати об'єкти, не забудь про це!</li>
 <li>Після цього вона викликає необхідний спосіб.</li>
</ol>Ми передаємо метод <code class=" language-none"><strong>UnicastRemoteObject.exportObject()</strong></code>наш об'єкт-калькулятор server. Таким чином ми уможливлюємо віддалений виклик його методів. Нам залишилося зробити лише одне: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">bind</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>UNIQUE_BINDING_NAME<span class="token punctuation"><span class="token punctuation">,</span></span> stub<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Ми реєструємо нашу заглушку в реєстрі віддалених об'єктів під тим ім'ям, яке придумали на самому початку. Тепер клієнт зможе її знайти! Можливо, ти звернув увагу, що наприкінці ми приспали головний потік програми: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Thread</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">sleep</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>MAX_VALUE<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Нам просто потрібно, щоб сервер працював довгий час. Адже ми будемо запускати в IDEa відразу два методи <code class=" language-none">main()</code>: спочатку серверний (у класі <code class=" language-none"><strong>ServerMain</strong></code>, який ми вже написали), а потім - клієнтський (у класі <code class=" language-none"><strong>ClientMain</strong></code>, який ми напишемо нижче). Важливо, щоб програма-сервер не вирубалася, поки ми запускатимемо клієнт, тому ми її просто приспали на довгий час. Працювати вона все одно :) Тепер ми можемо запустити метод <code class=" language-none">main()</code>нашого сервера. Нехай він працює і чекає, коли програма-клієнт викличе якийсь метод:) Тепер давай напишемо програму-клієнт! Вона надсилатиме нашому серверу числа для множення. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">NotBoundException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span>registry<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>rmi<span class="token punctuation"><span class="token punctuation">.</span></span>registry<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Registry</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">ClientMain</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> UNIQUE_BINDING_NAME <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"server.calculator"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">RemoteException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">NotBoundException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

       <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Registry</span></span> registry <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getRegistry</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2732</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">Calculator</span></span> calculator <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Calculator</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">lookup</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>UNIQUE_BINDING_NAME<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token keyword"><span class="token keyword">int</span></span> multiplyResult <span class="token operator"><span class="token operator">=</span></span> calculator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">multiply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">20</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">30</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>multiplyResult<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Вона має нескладний вигляд. Що тут відбувається? По-перше, клієнт має бути в курсі унікального імені об'єкта, методи якого він викликатиме віддалено. Тому в програмі-клієнті ми теж створабо змінну <code class=" language-none">public static final String UNIQUE_BINDING_NAME = "server.calculator";</code> Далі, у методі <code class=" language-none">main()</code>ми отримуємо доступ до регістру віддалених об'єктів. Для цього нам потрібно викликати метод <code class=" language-none"><strong>LocateRegistry.getRegistry()</strong></code>і передати туди номер порту, на якому створювали наш регістр у програмі ServerMain - порт 2732 (цей номер був обраний для прикладу, ти можеш спробувати використати інший): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Registry</span></span> registry <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">LocateRegistry</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getRegistry</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2732</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тепер нам залишилося лише отримати з регістру потрібний об'єкт! Це легко, адже ми знаємо його унікальне ім'я! 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Calculator</span></span> calculator <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Calculator</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">lookup</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>UNIQUE_BINDING_NAME<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Зверніть увагу на приведення типів. Ми наводимо отриманий об'єкт до <strong>інтерфейсу <code class=" language-none">Calculator</code>, а чи не до конкретного класу</strong> <code class=" language-none">RemoteCalculationServer</code> . Як ми говорабо на початку лекції, робота RMI заснована на використанні проксі, тому віддалений виклик доступний лише для методів інтерфейсів, а не класів. Наприкінці ми віддалено викликаємо метод <code class=" language-none">multiply()</code>у нашого об'єкта та виводимо результат у консоль. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">int</span></span> multiplyResult <span class="token operator"><span class="token operator">=</span></span> calculator<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">multiply</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">20</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">30</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>multiplyResult<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Метод <code class=" language-none">main()</code>у класі <code class=" language-none">ServerMain</code>ми вже давно запустабо, саме час запустити метод <code class=" language-none">main()</code>у програмі-клієнті <code class=" language-none">ClientMain</code>! <strong>Висновок у консоль: <em>600</em></strong> Ось і все! Наша програма (навіть дві!) успішно виконала свою функцію:) Якщо у тебе є час і бажання, можеш трохи урізноманітнити її. Наприклад, зробити так, щоб калькулятор підтримував всі чотири стандартні операції, а як параметри передавалися не числа, а об'єкт <code class=" language-none"><strong>CalculationInstance</strong>(int x, int y)</code>. Як додатковий матеріал можеш подивитися статті та приклади — ось тут: 
<ul>
 <li><a href="http://www.intuit.ru/studies/courses/633/489/lecture/11079?page=1" rel="nofollow" target="_blank">Використання Java RMI</a></li>
 <li><a href="https://javatalks.ru/topics/8059" rel="nofollow" target="_blank">RMI: Основи на прикладі</a></li>
 <li><a href="http://fkn.ktu10.com/?q=node/4146" rel="nofollow" target="_blank">RMI що це</a></li>
</ul> Побачимося на наступних заняттях! :)