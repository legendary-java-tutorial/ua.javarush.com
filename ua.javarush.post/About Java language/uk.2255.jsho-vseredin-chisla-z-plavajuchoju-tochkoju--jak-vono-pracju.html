Що всередині числа з плаваючою точкою і як воно працює
<p>----------------------------------------</p>
У перші ж дні вивчення Java я натрапив на такий цікавий вид примітивів, як числа з плаваючою точкою. Мене одразу зацікавили їх особливості та, тим більше, спосіб запису у двійковому коді (що взаємопов'язано). На відміну від будь-якого діапа
<p>----------------------------------------</p>
<h3>Зміст:</h3>
<ul>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%92%D1%81%D1%82%D1%83%D0%BF%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5">Вступ</a></li>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%AD%D0%BA%D1%81%D0%BA%D1%83%D1%80%D1%81-%D0%B2-%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%8E">Екскурс в історію</a></li>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B8-%D1%87%D0%B8%D1%81%D0%BB%D0%B0-%D1%81-%D0%BF%D0%BB%D0%B0%D0%B2%D0%B0%D1%8E%D1%89%D0%B5%D0%B9-%D1%82%D0%BE%D1%87%D0%BA%D0%BE%D0%B9">Формат запису числа з плаваючою точкою</a></li>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%97%D0%BD%D0%B0%D0%BA-%D0%B8-%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D1%8C">Знак та ступінь</a></li>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%9C%D0%B0%D0%BD%D1%82%D0%B8%D1%81%D1%81%D0%B0">Мантіса</a></li>
 <li><a href="https://codegym.cc/groups/posts/2255#%D0%98%D1%82%D0%BE%D0%B3%D0%B8">Підсумки</a></li>
</ul><img data-id="fbfb24f2-c2f5-45de-ad83-b73740426053" data-max-width="850" alt="" src="https://cdn.javarush.com/images/article/fbfb24f2-c2f5-45de-ad83-b73740426053/800.jpeg" style="width: 850px;">
<center>
 <small><em>Зображення: http://pikabu.ru/</em></small>
</center>
<h2 id="Вступление">Вступ</h2>У перші ж дні вивчення Java я натрапив на такий цікавий вид примітивів, як числа з плаваючою точкою. Мене одразу зацікавабо їх особливості та, тим більше, спосіб запису у двійковому коді (що взаємопов'язано). На відміну від будь-якого діапазону цілих чисел, навіть у дуже малому проміжку (наприклад від 1 до 2) їх безліч. І маючи кінцевий розмір пам'яті, неможливо висловити цю множину. То як вони виражені в двійковому коді і як працюють? На жаль, пояснення у <a href="https://ru.wikipedia.org/wiki/%D0%A7%D0%B8%D1%81%D0%BB%D0%BE_%D1%81_%D0%BF%D0%BB%D0%B0%D0%B2%D0%B0%D1%8E%D1%89%D0%B5%D0%B9_%D0%B7%D0%B0%D0%BF%D1%8F%D1%82%D0%BE%D0%B9" target="_blank" rel="nofollow">вікі</a> і досить клювання статті на хабрі <a href="https://habr.com/ru/post/337260/" target="_blank" rel="nofollow">тут</a> не дали мені повного розуміння, хоча заклали базу. Усвідомлення прийшло лише після цієї <a href="http://www.softelectro.ru/ieee754.html" target="_blank" rel="nofollow">статті-розбору</a> вранці після прочитання. 
<h2 id="Экскурс-в-историю">Екскурс в історію</h2>( <em>Почерпнув з <a href="https://habr.com/ru/post/112953/" target="_blank" rel="nofollow">цієї</a> статті на Хабре</em> ) У 60-70 рр., коли комп'ютери були великими, а програми - маленькими, ще не було єдиного стандарту обчислень, як і стандарту виразу самого числа з плаваючою точкою. Кожен комп'ютер робив це по-своєму, і помилки були у кожного свої. Але в середині 70-х компанія Intel вирішила зробити нові процесори з підтримуваною "покращеною" арифметикою і заразом стандартизувати її. Для розробки залучабо професорів Вільяма Кехена та Джона Палмера (ні, не автора книг про пиво). Не обійшлося без драм, але все ж таки новий стандарт був розроблений. Нині цей стандарт називають IEEE754 
<h2 id="Формат-записи-числа-с-плавающей-точкой">Формат запису числа з плаваючою точкою</h2>Ще у підручниках шкільного курсу всі стикалися з незвичним способом запису дуже великих чи дуже малих чисел виду <strong>1,2×10 <sup>3</sup></strong> чи <strong>1,2E3</strong> , що дорівнює <strong>1,2×1000 = 1200</strong> . Це називається спосіб запису через експоненту. У разі ми маємо справу з виразом числа за такою формулою: <em><strong>N=M×n <sup>p</sup></strong></em> , де 
<ul>
 <li><strong>N = 1200</strong> - отримуване число</li>
 <li><strong>M = 1,2</strong> - мантіса - дробова частина, без урахування порядків</li>
 <li><strong>n = 10</strong> - основа порядку. В даному випадку і коли не йдеться про комп'ютери, підставою виступає цифра 10</li>
 <li><strong>p = 3</strong> - ступінь основи</li>
</ul>Досить часто підстава порядку мається на увазі, як і записують лише <strong>мантису</strong> і значення ступеня підстави, розділяючи їх буквою <strong>E</strong> . У нашому прикладі я навів рівнозначні записи <strong>1,2×10 <sup>3</sup></strong> і <strong>1,2E3</strong> . ступенями двійки, а чи не десятки, тобто. <strong>n = 2</strong> , вся струнка формула <strong>1,2E3</strong> ламається і це здорово зламало мені мозок. 
<h2 id="Знак-и-степень">Знак та ступінь</h2>І що ми маємо? У результаті ми також маємо двійкове число, яке складається з <strong>мантиси</strong> — частина, яку зводитимемо в ступінь і саму ступінь. Крім цього, так само як прийнято і у цілих типів, у числах з плаваючою точкою є біт, який визначає знак - буде число позитивним або негативним. Як приклад пропоную розглянути тип <code class=" language-none">float</code>, що складається з 32 біт. З числами подвійної точності <code class=" language-none">double</code>логіка така сама, тільки вдвічі більше біт. З 32 біт, перший старший відводиться на знак, наступні 8 біт відводяться на експоненту - ступінь, на яку зводитимемо мантису, а решта 23 біти - на мантису. Для демонстрації давайте подивимося приклад: <img data-id="e111c53f-57bd-4eb0-a9ed-34cba07e0256" data-max-width="1280" alt="Що всередині числа з плаваючою точкою і як воно працює - 1" src="https://cdn.javarush.com/images/article/e111c53f-57bd-4eb0-a9ed-34cba07e0256/1080.jpeg" style="width: 1280px;">З першим бітом все дуже просто. Якщо значення першого біта <strong>0</strong>, Те число, яке ми отримаємо буде <strong>позитивним</strong> . Якщо біт дорівнює <strong>1</strong> , то число буде <strong>негативним</strong> . Наступний блок із 8 біт - блок з експонентою. Експонента записується як звичайне <strong>восьмибітне</strong> число, а щоб отримати необхідну ступінь нам потрібно від отриманого числа відняти <strong>127</strong> У нашому випадку вісім біт експоненти - це <strong>10000001</strong> . Це відповідає числу <strong>129</strong> . Якщо є питання, як це порахувати, то на зображенні швидка відповідь. Розгорнутий можна отримати на будь-якому курсі булевої алгебри. <img data-id="04a786d4-be50-4dd9-bfd6-c0d119c1f960" data-max-width="1280" alt="Що всередині числа з плаваючою точкою і як воно працює - 2" src="https://cdn.javarush.com/images/article/04a786d4-be50-4dd9-bfd6-c0d119c1f960/1080.jpeg" style="width: 1280px;"><strong>1×2 <sup>7</sup> + 0×2 <sup>6</sup> + 0×2 <sup>5</sup> + 0×2 <sup>4</sup> + 0×2 <sup>3</sup>+ 0×2 <sup>2</sup> + 0×2 <sup>1</sup> + 1×2 <sup>0</sup> = 1×128 + 1×1 = 128+1=129</strong> Не складно порахувати, що максимальне число, яке ми можемо отримати з цих 8 біт <strong>11111111 <sub>2</sub> = 255 <sub>10</sub></strong> (підрядкові <strong>2</strong> і <strong>10</strong> означають двійкову та десятирічну системи обчислення) Однак, якщо використовувати тільки позитивні значення ступеня ( <strong>від 0 і до 255</strong> ), то отримані числа будуть мати багато чисел перед комою, але не після? Щоб отримувати негативні значення ступеня, із сформованої експоненти необхідно віднімати <strong>127</strong> . Таким чином, діапазон ступенів буде <strong>від -127 до 128</strong>. Якщо використати наш приклад, то необхідний ступінь буде <strong>129-127 = 2</strong> . Поки що запам'ятовуємо це число. 
<h2 id="Мантисса">Мантіса</h2>Тепер про мантис. Вона складається з 23 біт, проте спочатку завжди мається на увазі ще одна одиниця, на яку біти не виділяються. Це зроблено з метою доцільності та економії. Те саме число можна виражати різними ступенями, додаючи до мантиси нулі перед або після коми. Найпростіше це зрозуміти з десятковою експонентою: <strong>120 000 = 1,2 10 <sup>5</sup> = 0,12 10 <sup>6</sup> = 0,012 10 <sup>7</sup> = 0,0012 10 <sup>8</sup></strong> і т.д. Однак, ввівши фіксоване число в голові мантиси, ми щоразу отримуватимемо нові числа. Приймемо як даність, що перед нашими 23 бітами буде ще одна з одиницею. Зазвичай цей біт від інших оброблять точкою, яка, втім, нічого не означає. Просто так зручніше 1 . 11100000000000000000000 <img data-id="439a4ba7-8604-405e-b876-027913b878f1" data-max-width="1280" alt="Що всередині числа з плаваючою точкою і як воно працює - 3" src="https://cdn.javarush.com/images/article/439a4ba7-8604-405e-b876-027913b878f1/1080.jpeg" style="width: 1280px;">Тепер отриману мантису потрібно зводити на ступінь зліва направо, зменшуючи з кожним кроком ступінь на одну. Стартуємо зі значення ступеня, який ми отримали в результаті обчислення, тобто <strong>2</strong> (Я спеціально вибрав простий приклад, щоб не писати кожне значення ступеня двійки та в наведеній таблиці не обчислював їх, коли відповідний біт дорівнює нулю) <img data-id="984181a7-bcf6-4d18-ae43-51e629ede3cf" data-max-width="1280" alt="Що всередині числа з плаваючою точкою і як воно працює - 4" src="https://cdn.javarush.com/images/article/984181a7-bcf6-4d18-ae43-51e629ede3cf/1080.jpeg" style="width: 1280px;"><strong>1×2 <sup>2</sup> + 1×2 <sup>1</sup> + 1×2 <sup>0</sup> + 1×2 <sup>-1</sup> = 1×4 + 1×2 + 1×1 + 1×0,5 = 4+2+1+0,5 = 7,5</strong> та отримали результат <strong>7,5</strong> , правильність можна перевірити, наприклад, за <a href="http://www.binaryconvert.com/convert_float.html?hexadecimal=40F00000" target="_blank" rel="nofollow">цим посиланням</a>
<h2 id="Итоги">Підсумки</h2>Стандартне число з плаваючою точкою типу <code class=" language-none">float</code>складається з 32 біт, перший біт – знак (+ або -), наступні вісім – експонента, наступні 23 – мантиса. По знаку – якщо біт 0 – число позитивне. Якщо біт 1 – негативне. <strong>За експонентом</strong> — побітно переводимо в десяткове число (перший ліворуч біт — <strong>128</strong> , другий — <strong>64</strong> , третій — <strong>32</strong> , четвертий — <strong>16</strong> , п'ятий — <strong>8</strong> , шостий — <strong>4</strong> , сьомий — <strong>2 </strong><strong>,</strong> восьмий — <strong>1</strong> ), з отриманого отримуємо ступінь з якого стартуватимемо. <strong>По мантисі</strong><strong></strong><strong></strong>- До наявних 23 біт спереду дописуємо ще один біт зі значенням 1 і з нього починаємо зводити в отриману нами ступінь, з кожним наступним бітом декрементуючи цей ступінь. <a href="https://commons.wikimedia.org/wiki/File:Thats_all_folks.svg?uselang=ru" target="_blank" rel="nofollow">That's all folks, kids! </a> <img data-id="a052a81b-e582-4f54-be9c-b66910de4ac2" data-max-width="600" alt="Що всередині числа з плаваючою точкою і як воно працює - 5" src="https://cdn.javarush.com/images/article/a052a81b-e582-4f54-be9c-b66910de4ac2/512.jpeg" style="width: 600px;"><em>PS: У вигляді домашнього завдання, використовуючи цю статтю, залиште в коментарях свої версії, чому при великій кількості арифметичних операцій з числами з точкою, що плаває, виникають помилки точності</em>