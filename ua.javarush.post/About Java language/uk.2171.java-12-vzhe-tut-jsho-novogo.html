Java 12 вже тут: Що нового?
<p>----------------------------------------</p>
Отже, з'явилася Java під номером 12. І нехай це не LTS-реліз (тобто, не Long term support, не той реліз, який довго підтримуватиметься. Першим LTS-релізом з восьмирічним терміном підтримки вважається 11 версія), в ньому цікаві оновлення. Ро
<p>----------------------------------------</p>
Отже, з'явилася Java під номером 12. І нехай це не LTS-реліз (тобто, не Long term support, не той реліз, який довго підтримуватиметься. Першим LTS-релізом з восьмирічним терміном підтримки вважається 11 версія), в ньому <a href="https://codegym.cc/groups/posts/1961-vihshla-java-11-novihe-fichi-i-vozmozhnosti-" target="_blank">з'явабося</a> цікаві оновлення. Розглянемо найважливіші їх. Нагадаємо, у Java пропозиції щодо зміни скорочено називають jep'ами (від JDK Enhancement Proposal). <img data-id="eb6239b9-0950-4d5a-8715-df4abb756c61" data-max-width="850" alt="Java 12 вже тут: Що нового?  - 1" src="https://cdn.javarush.com/images/article/eb6239b9-0950-4d5a-8715-df4abb756c61/800.jpeg" style="width: 850px;">
<h2>Найцікавіші Jep'и JDK 12</h2><strong>189: <a href="http://openjdk.java.net/jeps/189" rel="nofollow" target="_blank">Shenandoah: A Low-Pause-Time Garbage Collector (Experimental)</a></strong> У збирачі сміття (Garbage Collector) на ім'я Shenandoah застосовано новий алгоритм, який скорочує час роботи, оскільки займається "чисткою" одночасно із запущеними потоками Java. При цьому час паузи в Shenandoah буде однаковим незалежно від розміру купи (heap). Oracle чомусь не включила Sheandoah до своїх "офіційних" релізних збірок, незважаючи на те, що розробники вважають цю фічу однією з найважливіших у новому релізі. Так що якщо ви плануєте випробувати просунутий Garbage Collector, потрібно використовувати збірки сторонніх компаній, наприклад, <a href="https://www.azul.com/downloads/zulu/" rel="nofollow" target="_blank">Azul</a> . <strong>230: <a href="http://openjdk.java.net/jeps/230" rel="nofollow" target="_blank">Microbenchmark Suite</a></strong> Microbenchmark це мікротест, який вимірює продуктивність якогось невеликого елемента. У Java їх пишуть і запускають за допомогою фреймворку JMH. Починаючи з 12 версії JMH була додана до JDK, і вже є <a href="https://hg.openjdk.java.net/jdk/jdk12/file/0276cba45aac/test/micro/org/openjdk/bench" rel="nofollow" target="_blank">тести</a> , які написані на ньому, що спрощує життя розробникам. <strong>325: <a href="http://openjdk.java.net/jeps/325" rel="nofollow" target="_blank">Switch Expressions (Preview)</a></strong> Нова форма написання виразу з оператором switch. На сторінці фічі наводиться приклад коду з традиційним використанням switch, де постійне використання break робить його надмірно багатослівним, що призводить до частих випадкових помилок. 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">switch</span> <span class="token punctuation">(</span>day<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> MONDAY<span class="token operator">:</span>
    <span class="token keyword">case</span> FRIDAY<span class="token operator">:</span>
    <span class="token keyword">case</span> SUNDAY<span class="token operator">:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> TUESDAY<span class="token operator">:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> THURSDAY<span class="token operator">:</span>
    <span class="token keyword">case</span> SATURDAY<span class="token operator">:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> WEDNESDAY<span class="token operator">:</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Автори оновлення пропонують ввести нову форму мітки switch “case L -&gt;” щоб очевидним чином показати, що виконуватиметься тільки код праворуч від мітки, якщо ця мітка – підходяща. Так, код, показаний вище за допомогою нового синтаксису, можна істотно скоротити: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">switch</span> <span class="token punctuation">(</span>day<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> MONDAY<span class="token punctuation">,</span> FRIDAY<span class="token punctuation">,</span> SUNDAY <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> TUESDAY                <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> THURSDAY<span class="token punctuation">,</span> SATURDAY     <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> WEDNESDAY              <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><strong>334: <a href="http://openjdk.java.net/jeps/334" rel="nofollow" target="_blank">JVM Constants API</a></strong> У пулі констант розташовуються так звані loadable constants. Це значення, наприклад типу String або будь-якого примітивного типу, а також run-time артефакти, такі як класи та методи. Під час роботи з клас-файлуми програмістам не завадабо б зручні інструменти для маніпуляції з loadable constants. Автори цього jep'а почали вирішувати цю проблему за допомогою введення нових value-based типів символічних посилань, при цьому кожна з них описуватиме конкретний вид констант. <a href="http://cr.openjdk.java.net/~vromero/constant.api/webrev.04/constants.api.patch" rel="nofollow" target="_blank">Код нововведення</a> . <strong>340: <a href="http://openjdk.java.net/jeps/340" rel="nofollow" target="_blank">One AArch64 Port, Not Two</a></strong> Під цією складною назвою ховається вирішення проблеми, що утворилася ще в Java 9, коли в киті з'явабося 64-бітові ARM-порти Oracle та aarch64 від Red Hat одночасно. При цьому вже під час виходу JDK 11 64-бітну версію портів Oracle не підтримувала навіть сама Oracle. Так що тепер 64-бітові порти Oracle прибрали, залишабося 32-бітові ARM32, і 64-бітові, більш продуктивні, aarch64. <strong>341: <a href="http://openjdk.java.net/jeps/341" rel="nofollow" target="_blank">Default CDS Archives</a></strong> Дуже приємне оновлення, оскільки воно реально прискорює запуск програм. Не секрет, що при старті Java-програми починає завантаження величезна кількість класів, а це досить тривалий процес. CDS розшифровується як Class Data Sharing, і ця функція дозволяє упаковувати всі ці класи, що запускаються при старті, в спеціальний class data sharing архів, використовуючи дефолтний список цих самих класів. В результаті швидкість запуску додатків суттєво зростає. <strong>344: <a href="http://openjdk.java.net/jeps/344" rel="nofollow" target="_blank">Abortable Mixed Collections for G1</a></strong> G1 - це збирач сміття, який став основним у JDK 9, змінивши на цій посаді Parallel GC. У Java 10 G1 навчився збирати сміття у кількох потоках. Однак його роботою були задоволені не всі, однією з головних проблем виявабось тривалі паузи. Тепер їх можна скасувати. G1 на основі аналізу поведінки програми визначає обсяг роботи, а потім збирає "живі" об'єкти в Collection set поки не збере все, не зупиняючись. Часто G1 промахувався з підрахунком обсягу роботи та працював надто довго. Після впровадження jep-344 G1 може перейти на покрокове складання сміття і якщо час виконання наступного кроку виходить за рамки розумного, цей крок можна перервати. <strong>346: <a href="http://openjdk.java.net/jeps/346" rel="nofollow" target="_blank">Promptly Return Unused Committed Memory from G1</a></strong> І ще трохи оновлень у стані вищезгаданого збирача G1. Деколи бувало, що купа Java heap memory є, а її, цю пам'ять, ніхто не використовує. Тепер Java 12 можна “повернути” неактивну пам'ять в операційну систему. Раніше домогтися G1 віддати пам'ять можна було дуже рідко, тепер все спростилося. З новою фічею додаток визначається як неактивне, якщо закінчився інтервал з останнього складання і немає concurrent cycle. Інша ситуація - якщо або якщо функція getloadavg(), роботу якої відстежували протягом якогось часу, показує навантаження нижче встановленого допустимого порога. Якщо сталася одна з двох подій, починається часткове складання сміття. <strong>Що в Java 12 немає: <a href="https://openjdk.java.net/jeps/326" rel="nofollow" target="_blank">Raw String Literals</a></strong> Багато розробників з цікавістю поставабося до цієї функції, проте вона так і не з'явилася в даному релізі. Її автори вирішабо, що над нею ще треба попрацювати. Отже, сміємо сподіватися, функція зручної роботи з рядковими літералами з'явиться в одній із найближчих версій Java. Підтримка необроблених рядкових літералів дозволяє працювати з рядковою інформацією незалежно від мови. Це усуває потребу в екрануванні. Особливо корисно в регулярних виразах, де широко використовується зворотний слеш і в Windows-path, де слеш використовується як роздільник. Тобто, щоб уникнути таких конструкцій: <em><strong>C:\My\Test\Pack\</strong></em>
<div class="table-container">
 <table class="table table--striped">
  <tbody>
   <tr>
    <td>Кожен програміст часто стикається з тими чи іншими труднощами під час роботи. Іноді вони пов'язані з недосвідченістю розробника, але часом з неідеальністю самого інструменту. Java - класна мова, але далеко не ідеальна. Можливо, ви вже зіткнулися з чимось у Java і знаєте, що хотіли б змінити у вашому “інструменті” (мові)? Діліться у коментарях!</td>
   </tr>
  </tbody>
 </table>
</div>
<h2>Висновки</h2>Жодної революції в Java 12 не відбулося. Проте її ніхто й не планував. Однак низка нововведень спрямована на оптимізацію роботи додатків та прискорення роботи, що не може не тішити. До речі, IDEA вже підтримує JDK 12, так що ви можете випробувати її можливості. Зрозуміло, мало якісь оновлення стосуються новачків безпосередньо, хоча погратися з новим switch (попередньо встановивши прапор --enable-preview) може навіть той, хто тільки почав навчання на CodeGym.