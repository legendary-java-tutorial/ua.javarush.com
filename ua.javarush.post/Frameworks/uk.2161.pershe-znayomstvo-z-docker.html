Перше знайомство з Docker
<p>----------------------------------------</p>
Контейнеризація — механізм, що часто застосовується на практиці. Наприклад, при пошуку по headhunter ви знайдете на поточний день 477 вакансій, де згадується Docker. Тому не зайвим буде ознайомитися з тим, що це таке. Сподіваюся, цей невели
<p>----------------------------------------</p>
Контейнеризація — механізм, що часто застосовується на практиці. Наприклад, при пошуку по headhunter ви знайдете на поточний день 477 вакансій, де згадується Docker. Тому не зайвим буде ознайомитися з тим, що це таке. Сподіваюся, цей невеликий огляд допоможе сформувати першу виставу. Ну і підкріпить його додатковими матеріалами, на кшталт курсів на Udemy. <img data-id="1ddedcb2-da7b-443c-a5c7-bf96e56d8eb5" data-max-width="850" alt="Перше знайомство з Docker - 1" src="https://cdn.javarush.com/images/article/1ddedcb2-da7b-443c-a5c7-bf96e56d8eb5/800.jpeg" style="width: 850px;">
<h2>Вступ</h2>У цьому невеликому огляді хочеться торкнутися такої теми, як контейнеризація. І розпочати треба з розуміння того, що таке взагалі контейнеризація. Відповідно до вікіпедії " <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F" target="_blank" rel="nofollow">Контейнеризація</a> " - це віртуалізація на рівні операційної системи (тобто <strong>НЕ</strong> апаратна), при якій ядро ​​операційної системи підтримує кілька ізольованих екземплярів простору користувача замість одного. " <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%BE" target="_blank" rel="nofollow">Простір користувача</a>Це дозволяє позбавитися від накладних витрат на емуляцію віртуального обладнання та запуску повноцінного екземпляра операційної системи. Можна сказати, що це "легковажна" віртуалізація. Ядро (kernel) - центральна частина ОС, що забезпечує програмам координований доступ до ресурсів комп'ютера, таких як процесорний час, пам'ять, зовнішнє апаратне забезпечення, зовнішній пристрій введення та виведення інформації. Також зазвичай ядро ​​надає послуги файлової системи та мережевих протоколів. Загалом це серце всієї системи. Як додаткова інформація може бути корисно ознайомитися з матеріалом " таким як процесорний час, пам'ять, зовнішнє апаратне забезпечення, зовнішній пристрій введення та виведення інформації. Також зазвичай ядро ​​надає послуги файлової системи та мережевих протоколів. Загалом це серце всієї системи. Як додаткова інформація може бути корисно ознайомитися з матеріалом " таким як процесорний час, пам'ять, зовнішнє апаратне забезпечення, зовнішній пристрій введення та виведення інформації. Також зазвичай ядро ​​надає послуги файлової системи та мережевих протоколів. Загалом це серце всієї системи. Як додаткова інформація може бути корисно ознайомитися з матеріалом "<a href="https://docs.microsoft.com/ru-ru/dotnet/standard/microservices-architecture/container-docker-introduction/" target="_blank" rel="nofollow">Загальні відомості про контейнери</a> ”. І ще пару слів, щоб вступ був повним. У нас тепер є розуміння, що в операційній системі є ядро. Воно забезпечує ізольованість екземплярів просторів користувачів. У цьому контексті Ви можете зустріти такий термін як “cgroups <a href="https://ru.wikipedia.org/wiki/Cgroups" target="_blank" rel="nofollow">”</a> . називається саме той самий механізм ядра Linux, який дозволяє цього досягти, тому можна сказати, що шлях контейнеризації почався з Linux систем, однак, починаючи з Windows 10 також з'явилася підтримка контейнеризації, для роботи з віртуалізацією необхідно в BIOS комп'ютера налаштувати підтримку віртуалізації. Як це залежить від комп'ютера, наприклад, це може виглядати так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1ab3d99e-e16b-4807-9325-241256a0ddb6" data-max-width="620" alt="Перше знайомство з Docker - 2" src="https://cdn.javarush.com/images/article/1ab3d99e-e16b-4807-9325-241256a0ddb6/512.jpeg" style="width: 620px;">
 </div>
</div>На Windows це можна перевірити у різний спосіб. Наприклад, можна завантажити спеціальну утиліту з сайту Microsoft: <a href="https://www.microsoft.com/en-us/download/details.aspx?id=592" target="_blank" rel="nofollow">Hardware-Assisted Virtualization Detection Tool</a> . Ну і варто згадати ще одне важливе поняття – гіпервізор. Гіпервізор (Hypervisor) - це монітор віртуальних машин, програма для забезпечення паралельного виконання кількох операційних систем на тому самому комп'ютері. Гіпервізор забезпечує ізоляцію операційних систем один від одного, розділяє між запущеними ОС ресурсами. Одним з таких гіпервізорів є <a href="https://www.virtualbox.org/" target="_blank" rel="nofollow">Oracle VirtualBox</a> . 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="471733b6-fed9-40d3-8292-2630717d6e81" data-max-width="370" alt="Перше знайомство з Docker - 3" src="https://cdn.javarush.com/images/article/471733b6-fed9-40d3-8292-2630717d6e81/256.jpeg" style="width: 370px;">
 </div>
</div>
<h2>Docker</h2>Отже, що таке віртуалізація – зрозуміло. Але як цим скористатися? І тут нам на допомогу приходить Docker. Docker — програмне забезпечення для автоматизації розгортання та керування програмами в середовищах з підтримкою контейнеризації. Варто почати з того, що Docker представлений таким поняттям, як Docker Engine. І почати варто з офіційного сайту докера та розділу " <a href="https://docs.docker.com/engine/docker-overview/" target="_blank" rel="nofollow">Docker Overview</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="246" alt="Перше знайомство з Docker - 4" src="https://cdn.javarush.com/images/article/abbc4697-9665-4e8a-837d-f0ab69add143/original.jpeg">
 </div>
</div>У документації сказано, що докер складається з: 
<ul>
 <li>Докер-сервер, який називається Docker Daemon process (dockerd).</li>
 <li>Інтерфейс командного рядка, він CLI (docker).</li>
 <li>REST API, який описує те, як програми можуть "розмовляти" з deamon і давати йому вказівки, що робити.</li>
</ul>Перш, ніж ми перейдемо до подальшого занурення, встановимо докер, тобто встановимо докер демона. На сайті Docker є інструкція по встановленню " <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="nofollow">Docker для Windows</a> ". Цікаво, що Docker має свої системні вимоги. І якщо у Вас, як і у мене, стара Windows, наприклад Windows 7, необхідно використовувати Docker Toolbox. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="233" alt="Перше знайомство з Docker - 5" src="https://cdn.javarush.com/images/article/d174ec4d-c483-49e4-be9b-c685100782b0/original.jpeg">
 </div>
</div>
<h2>Docker Toolbox</h2>Для встановлення Docker на старі машини, що не підходять під системні вимоги. На сайті так і написано "Legacy Desktop Solution". Перейдемо на сторінку " <a href="https://docs.docker.com/toolbox/overview/" target="_blank" rel="nofollow">Docker Toolbox</a> " та скачаємо його. Важить такий набір близько 211 мегабайт. Встановимо в комплектації за замовчуванням, тобто просто покірно погоджуватися з усім, не переставляючи прапори. Після встановлення перевіримо, що все гаразд. Надалі нашим полем бою буде командний рядок. Рекомендую не використовувати командний рядок Windows, тому що з ним можуть бути неочевидні проблеми. Краще використовувати bash shell. На Windows рекомендований спосіб отримання його - встановити собі систему контролю версій <a href="https://git-scm.com/" target="_blank" rel="nofollow">git</a>, все одно вона знадобиться. Тому що "у комплекті" з ним буде і потрібний нам bash. Для цього огляду я використовуватиму саме git bash. Також bash можна поставити разом з <a href="https://www.cygwin.com/" target="_blank" rel="nofollow">CYGWIN</a> . Запустимо bash або git bash. Переконаємося, що у нас встановилася докер машина, вона Docker Machine: <code class=" language-none">docker-machine -version</code> Що таке ця Docker Machine? <a href="https://docs.docker.com/machine/overview/" target="_blank" rel="nofollow">Docker Machine</a> - це утиліта для керування докеризованими хостами (це такі хости, на яких встановлено Docker Engine). Якщо ми виконаємо відразу після встановлення Docket Toolbox перегляд докер-машин за допомогою команди <code class=" language-none">docker-machine ls</code>, то побачимо порожній список: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="97b7c0c8-6d04-4248-bf29-b4b6d187e0f5" data-max-width="452" alt="Перше знайомство з Docker - 6" src="https://cdn.javarush.com/images/article/97b7c0c8-6d04-4248-bf29-b4b6d187e0f5/256.jpeg" style="width: 452px;">
 </div>
</div>Давайте створимо нову машину. Для цього нам знадобиться виконати команду <a href="https://docs.docker.com/machine/reference/create/" target="_blank" rel="nofollow">create</a> : <code class=" language-none">docker-machine create -- driver virtualbox codegym</code>: Ми побачимо лог створення докер машини: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="19d9e92a-b16b-4881-921a-103e366ded6e" data-max-width="591" alt="Перше знайомство з Docker - 7" src="https://cdn.javarush.com/images/article/19d9e92a-b16b-4881-921a-103e366ded6e/512.jpeg" style="width: 591px;">
 </div>
</div>Тут цікаво нам таке. Що за Boot2Docker? Це мінімалістичний дистрибутив Linux для запуску Docker Engine (адже ми розуміємо, що Docker працює завдяки засобам віртуалізації Linux, а в Windows необхідний механізм з'явився тільки починаючи з Windows 10). Цей дистрибутив заснований на дистрибутиві " <a href="https://ru.wikipedia.org/wiki/Tiny_Core_Linux" target="_blank" rel="nofollow">Tiny Core Linux</a> ". Також згадується про VirtualBox VM. Це тому, що ми вказали <code class=" language-none">--driver virtualbox</code>. Було створено нову віртуальну машину в VirtualBox з образу Boot2Docker. Після створення ми можемо запустити VirtualBox (бо VirtualBox встановлюється разом з Docker Toolbox) і побачити створену віртуальну машину для докер машини: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="3954e26e-2132-4a98-81fc-701fe15bb748" data-max-width="766" alt="Перше знайомство з Docker - 8" src="https://cdn.javarush.com/images/article/3954e26e-2132-4a98-81fc-701fe15bb748/512.jpeg" style="width: 766px;">
 </div>
</div>Після створення нам запропонують виконати команду " <a href="https://docs.docker.com/machine/reference/env/" target="_blank" rel="nofollow">docker-machine env</a> ", щоб отримати змінні середовища, які потрібно налаштувати для підключення до докеру машини: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="58d932a5-1cb2-40da-9c93-25bff3388a4f" data-max-width="576" alt="Перше знайомство з Docker - 9" src="https://cdn.javarush.com/images/article/58d932a5-1cb2-40da-9c93-25bff3388a4f/512.jpeg" style="width: 576px;">
 </div>
</div>Після виконання цієї команди за допомогою docker-machine ми підключаємося до віддаленого докеризованого хоста (в даному випадку віртуального, розміщеного на Virtual Box) і можемо виконувати команди docker у себе локально так, ніби виконували їх на віддаленому хості. Для перевірки можемо виконати команду " <a href="https://docs.docker.com/engine/reference/commandline/info/" target="_blank" rel="nofollow">docker info</a> ". У випадку, якщо підключення до докеру машини не встановлено, ми отримаємо помилку. А якщо все добре – інформацію про докер на докер машині. Тепер час розібратися з тим, як взагалі працює докер і як його використовувати. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="bd46187a-12dd-4475-aa26-6f1821580b57" data-max-width="276" alt="Перше знайомство з Docker - 10" src="https://cdn.javarush.com/images/article/bd46187a-12dd-4475-aa26-6f1821580b57/256.jpeg" style="width: 276px;">
 </div>
</div>
<h2>Docker Containers</h2>Отже, ми маємо докер. Що таке взагалі цей докер? Зрозуміти це нам допоможе документація Docker та розділ " <a href="https://docs.docker.com/get-started/" target="_blank" rel="nofollow">Get started</a> ". У вступній частині цього розділу розповідається про концепцію докера ( <a href="https://docs.docker.com/get-started/#docker-concepts" target="_blank" rel="nofollow">Docker Concepts</a> ). Там вказано, що докер — це платформа для розробки, налагодження та запуску програм у контейнерах. Тому головне для докера це контейнери. Навіть якщо ви подивитеся на логотип докера – це кит, який тримає на своїй спині контейнери. Але що таке контейнер? Далі у розділі " <a href="https://docs.docker.com/get-started/#images-and-containers" target="_blank" rel="nofollow">Images and Containers</a> " говориться, що контейнер - це запущений екземпляр Image. А Image - це виконуємо "пакет", який містить все необхідне для програми (код, оточення, бібліотеки, налаштування тощо). Тепер спробуймо це самі. На сайті Docker'<a href="https://docs.docker.com/samples/" target="_blank" rel="nofollow">Docker samples</a> ", в якому є " <a href="https://github.com/docker/labs/blob/master/beginner/chapters/alpine.md" target="_blank" rel="nofollow">Docker for Beginners</a> ". Приклади звідси мені здаються цікавішими. Отже, ми раптом захотіли ознайомитися з <a href="https://www.alpinelinux.org/" target="_blank" rel="nofollow">Alpine Linux</a> і можемо це зробити за допомогою контейнерів докера. Щоб отримати образ, ми повинні його "витягнути" або " витягнути". Тому виконуємо команду <a href="https://docs.docker.com/engine/reference/commandline/pull/" target="_blank" rel="nofollow">docker pull</a> :<code class=" language-none">docker pull apline</code>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1005c868-4bb3-473d-a6c8-ebefb8967f7a" data-max-width="574" alt="Перше знайомство з Docker - 11" src="https://cdn.javarush.com/images/article/1005c868-4bb3-473d-a6c8-ebefb8967f7a/512.jpeg" style="width: 574px;">
 </div>
</div>Як ми бачимо, ми звідкись скачуємо. За замовчуванням докер дивиться на свій репозиторій у мережі <a href="https://hub.docker.com/_/alpine" target="_blank" rel="nofollow">https://hub.docker.com</a> . Після успішного отримання ми можемо перевірити список доступних образів, виконавши команду <a href="https://docs.docker.com/engine/reference/commandline/images/" target="_blank" rel="nofollow">docker images</a> : 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="e926bd47-fe81-4ce9-a190-28c15a90ae3b" data-max-width="516" alt="Перше знайомство з Docker - 12" src="https://cdn.javarush.com/images/article/e926bd47-fe81-4ce9-a190-28c15a90ae3b/512.jpeg" style="width: 516px;">
 </div>
</div>Тепер у нас є образ apline. Так як контейнер - запущений екземпляр image, то давайте запустимо цей образ. Виконаємо запуск контейнера за допомогою команди <code class=" language-none">docker run alpine</code>. Як бачимо, нічого не сталося. Якщо ми виконаємо команду <code class=" language-none">docker ps</code>для виведення всіх активних контейнерів, теж нічого не отримаємо. Але якщо ми виконаємо <code class=" language-none">docker ps -a</code>то побачимо всі контейнери: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="af5a8b1b-f286-4cdf-aeec-f5d750024778" data-max-width="577" alt="Перше знайомство з Docker - 13" src="https://cdn.javarush.com/images/article/af5a8b1b-f286-4cdf-aeec-f5d750024778/512.jpeg" style="width: 577px;">
 </div>
</div>Справа в тому, що ми запустабо докер не в інтерактивному режимі. Тому він виконав команду і зупинився. Команда була – відкриття терміналу. Давайте виконаємо те саме, але в інтерактивному режимі (з прапором <a href="https://docs.docker.com/v17.09/edge/engine/reference/commandline/run/#assign-name-and-allocate-pseudo-tty-name--it" target="_blank" rel="nofollow">-it</a> ): 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1e30cd37-6e3f-46be-ba95-2cd03ba2b218" data-max-width="572" alt="Перше знайомство з Docker - 14" src="https://cdn.javarush.com/images/article/1e30cd37-6e3f-46be-ba95-2cd03ba2b218/512.jpeg" style="width: 572px;">
 </div>
</div> Як видно, подолавши одну помилку і скориставшись підказкою, ми потрапабо на контейнер і можемо в ньому працювати! Щоб вийти з контейнера, не припиняючи його роботу, можна натиснути <code class=" language-none">Ctrl + p + q</code>. Якщо виконати тепер <code class=" language-none">docker ps</code>, то побачимо один активний контейнер. Щоб зайти на вже запущений контейнер, виконаємо команду <a href="https://docs.docker.com/engine/reference/commandline/exec/" target="_blank" rel="nofollow">docker exec</a> : 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2995ede6-f8f2-4f25-8af8-3c99d49d4ec0" data-max-width="534" alt="Перше знайомство з Docker - 15" src="https://cdn.javarush.com/images/article/2995ede6-f8f2-4f25-8af8-3c99d49d4ec0/512.jpeg" style="width: 534px;">
 </div>
</div>Відмінний опис того, як це все відбувається, рекомендую прочитати в описі докер семпла: " <a href="https://github.com/docker/labs/blob/master/beginner/chapters/alpine.md#11-docker-run" target="_blank" rel="nofollow">1.0 Running your first container</a> ". Він мені подобається за те, що там все написано дуже доступно та зрозуміло. Якщо коротко перефразувати, ми підключені за допомогою docker-machine до віртуальної машини, на якій запущений Docker Daemon. За допомогою CLI REST API ми просимо запустити alpine образ. Докер його знаходить і тому не скачує. Докер створює новий контейнер і запускає в цьому контейнері вказану команду. І все це, звісно, ​​добре. Але навіщо це все? І тут нам треба розібратися, як взагалі докер створює image. А створює він їх на основі докерфайлу (dockerfile). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="99047e5d-57d7-462a-b11e-3d9aa9d1c931" data-max-width="319" alt="Перше знайомство з Docker - 16" src="https://cdn.javarush.com/images/article/99047e5d-57d7-462a-b11e-3d9aa9d1c931/256.jpeg" style="width: 319px;">
 </div>
</div>
<h2>Dockerfile</h2>Як сказано в <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="nofollow">Dockerfile reference</a> , докерфайл - це текстовий файл, в якому вказані всі команди для отримання зображення. Насправді всі образи, які ми отримуємо (навіть Alpine, з прикладу вище) створювалися з докерфайлу. Давайте зберемо свій образ із Java додатком. І для початку нам знадобиться це Java додаток. Пропоную скористатися системою складання Gradle, детальніше про яку можна прочитати в короткому огляді: " <a href="https://codegym.cc/groups/posts/2126-kratkoe-znakomstvo-s-gradle" target="_blank" rel="nofollow">Коротке знайомство з Gradle</a> ". Допоможе нам у створенні проекту " <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html" target="_blank" rel="nofollow">Gradle Build init plugin</a> ". Виконаємо створення нової програми Java за допомогою Gradle: <code class=" language-none">gradle init --type java-application</code> Ця команда створює заготівлю Java проекту. Це standalone додаток, а нам хотілося б створити веб-додаток. Видалимо класи App та AppTest (їх згенерував автоматично Gradle Build Init Plugin). Щоб швидко створити веб-додаток скористаємося tutorial'ом від Gradle: " <a href="https://guides.gradle.org/building-java-web-applications/" target="_blank" rel="nofollow">Building Java Web Applications</a> ". Відповідно до tutorial виконаємо: 
<ul>
 <li>Відкриємо білд скрипт build.gradle і поправимо його, згідно з розділом: " <a href="https://guides.gradle.org/building-java-web-applications/#add_a_gradle_build_file" target="_blank" rel="nofollow">Add a Gradle build file</a> ".</li>
 <li>Додамо сторінки в src/main/webapp, як зазначено в розділі " <a href="https://guides.gradle.org/building-java-web-applications/#add_jsp_pages_to_the_demo_application" target="_blank" rel="nofollow">Add JSP pages to the demo application</a> ".</li>
 <li>Додамо клас <code class=" language-none">HelloServlet</code>із вмістом з розділу " <a href="https://guides.gradle.org/building-java-web-applications/#add_a_servlet_and_metadata_to_the_project" target="_blank" rel="nofollow">Add a servlet and metadata to the project</a> ".</li>
</ul>Тут треба бути уважним. Як завжди, у прикладах можуть бути помилки. Тут вона і є: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="53ded331-fab1-4d67-9a78-084b939832e8" data-max-width="559" alt="Перше знайомство з Docker - 17" src="https://cdn.javarush.com/images/article/53ded331-fab1-4d67-9a78-084b939832e8/512.jpeg" style="width: 559px;">
 </div>
</div>Тепер, для перевірки в build.gradle додамо плагін gretty, як зазначено в розділі " <a href="https://guides.gradle.org/building-java-web-applications/#add_the_code_gretty_code_plugin_and_run_the_app" target="_blank" rel="nofollow">Add the gretty plugin and run the app</a> ": 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">plugins <span class="token punctuation"><span class="token punctuation">{</span></span>
    id <span class="token string"><span class="token string">'war'</span></span>
    id <span class="token string"><span class="token string">'org.gretty'</span></span> version <span class="token string"><span class="token string">'2.2.0'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Цікаво, що Gretty не бачить помилку в <code class=" language-none">HelloServlet</code>, яка описана вище. Це доводить, що у різному оточенні додаток себе може по-різному. Gretty може працювати там, де звичайний standalone сервер видасть помилку. Залишилося перевірити, що програма працює правильно. Виконаємо:<code class=" language-none">gradle appRun</code>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="58de8f2d-1840-422a-b2e3-1d074598db6a" data-max-width="589" alt="Перше знайомство з Docker - 18" src="https://cdn.javarush.com/images/article/58de8f2d-1840-422a-b2e3-1d074598db6a/512.jpeg" style="width: 589px;">
 </div>
</div>Якщо все добре, то командою <code class=" language-none">gradle war</code>зберемо архів з розширення war (web archive). За замовчуванням gradle збирає його в каталозі <code class=" language-none">\build\libs</code>. Тепер ми готові написати наш докерфайл. Керуючись " <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="nofollow">Dockerfile reference</a> " створимо докерфайл. Створимо файл під назвою "Dockerfile" в корені нашого Java проекту (там же, де build скрипт). Відкриємо його на редагування. Цей файл має свій формат, описаний у розділі " <a href="https://docs.docker.com/engine/reference/builder/#format" target="_blank" rel="nofollow">Dockerfile reference : Format</a>Будь-який докерфайл починається з інструкції FROM, вказуючи "базовий образ" (base image). Можна сказати, що це батьківський образ, на основі якого ми робимо наш image. Батьківський образ нам вибрати дуже просто. Веб-додатку потрібен веб-сервер. Наприклад, ми можемо використовувати веб-сервер Tomcat.Заходимо на офіційний репозиторій докера, який називається <a href="https://hub.docker.com/" target="_blank" rel="nofollow">docker hub</a> . 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="eb42e750-b5f4-4126-b53e-ad842d352a65" data-max-width="561" alt="Перше знайомство з Docker - 19" src="https://cdn.javarush.com/images/article/eb42e750-b5f4-4126-b53e-ad842d352a65/512.jpeg" style="width: 561px;">
 </div>
</div>Варто також розуміти, що називається образ tomcat. Але крім назви він має тег. Тег – це як версія. Образи томкату різних версій відрізняються тим, яка версія Tomcat використовується, яка версія jre та який базовий образ. Наприклад, ми можемо отримати образ <code class=" language-none">docker pull tomcat:9-jre8-alpine</code> У ньому використовується 9 версія tomcat, jre версії 8 та образ alpine як основа. Це може мати важливу роль, щоб зменшити розмір нашого образу. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ddcf7d14-3343-454f-9b1b-246c04a4f321" data-max-width="523" alt="Перше знайомство з Docker - 20" src="https://cdn.javarush.com/images/article/ddcf7d14-3343-454f-9b1b-246c04a4f321/512.jpeg" style="width: 523px;">
 </div>
</div>Як бачимо, різниця величезна. Якщо ми будуватимемо наш образ на основі tomcata alpine, то ми почнемо всього зі 100 мегабайт, а не з 600. Відповідно, раніше створений докерфайл додамо наступний вміст: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"># Базовый образ<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"наследуемся"</span></span> от него
FROM tomcat<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">9</span></span><span class="token operator"><span class="token operator">-</span></span>jre8<span class="token operator"><span class="token operator">-</span></span>alpine
# Копируем из <span class="token class-name"><span class="token class-name">Build</span></span> <span class="token class-name"><span class="token class-name">Context</span></span>'а собранный web archive в каталог томката
COPY build<span class="token operator"><span class="token operator">/</span></span>libs<span class="token operator"><span class="token operator">/</span></span>docker<span class="token punctuation"><span class="token punctuation">.</span></span>war <span class="token operator"><span class="token operator">/</span></span>usr<span class="token operator"><span class="token operator">/</span></span>local<span class="token operator"><span class="token operator">/</span></span>tomcat<span class="token operator"><span class="token operator">/</span></span>webapps<span class="token operator"><span class="token operator">/</span></span>docker<span class="token punctuation"><span class="token punctuation">.</span></span>war
# Меняем рабочий каталог на томкатовский
WORKDIR <span class="token operator"><span class="token operator">/</span></span>usr<span class="token operator"><span class="token operator">/</span></span>local<span class="token operator"><span class="token operator">/</span></span>tomcat
# Открываем порт <span class="token number"><span class="token number">8080</span></span> для контейнера<span class="token punctuation"><span class="token punctuation">,</span></span> т<span class="token punctuation"><span class="token punctuation">.</span></span>к<span class="token punctuation"><span class="token punctuation">.</span></span> его слушает томкат
EXPOSE <span class="token number"><span class="token number">8080</span></span></code></pre> І тепер виконаємо команду побудови образу: <code class=" language-none">docker build -t jrdocker .</code>. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="89027958-c06a-4ff1-8106-843c5bb31006" data-max-width="475" alt="Перше знайомство з Docker - 21" src="https://cdn.javarush.com/images/article/89027958-c06a-4ff1-8106-843c5bb31006/256.jpeg" style="width: 475px;">
 </div>
</div><code class=" language-none">-t</code>- Це tag, тобто як назвати зібраний образ. Точкою в кінці ми позначаємо, що поточний каталог (каталог, де знаходиться докерфайл і звідки ми запускали команду), додаємо в <code class=" language-none">Build context</code>. <code class=" language-none">Build context</code>— це контекст тих файлів, які доступні для створення докерфайлу. Як видно, ми змогли скопіювати завдяки цьому зібраний war файл у наш образ, каталог веб-сервера. Тепер запустимо наш образ:<code class=" language-none">docker run -d --rm -p 8888:8080 jrdocker</code>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="692a940c-60b8-48d1-8358-775bbba977e2" data-max-width="534" alt="Перше знайомство з Docker - 22" src="https://cdn.javarush.com/images/article/692a940c-60b8-48d1-8358-775bbba977e2/512.jpeg" style="width: 534px;">
 </div>
</div>Щоб зрозуміти, чи запустився сервер, можна подивитися лог з контейнера. Лог можна отримати за допомогою команди docker logs із зазначенням контейнера за його ID або назвою. Наприклад: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="34df505b-d737-4929-a2ac-6178da8163bd" data-max-width="587" alt="Перше знайомство з Docker - 23" src="https://cdn.javarush.com/images/article/34df505b-d737-4929-a2ac-6178da8163bd/512.jpeg" style="width: 587px;">
 </div>
</div>Ну і не забуваємо, що ми на ім'я завжди можемо зайти на запущений контейнер командою: <code class=" language-none">winpty docker exec -it Ім'яКонтейнера sh</code> Тепер лишилося підключитися. Раніше ми вказали <a href="https://docs.docker.com/engine/reference/builder/#expose" target="_blank" rel="nofollow">EXPOSE</a> , тобто зсередини контейнера дозволабо доступ до порту 8080. Коли ж ми запускали сам контейнер, ми вказали тег -p ( <a href="https://docs.docker.com/engine/reference/run/#expose-incoming-ports" target="_blank" rel="nofollow">incoming ports</a> ), тим самим співвіднесли порт 8080 на контейнері (там очікує підключення веб-сервер томкат) з портом 8888 на машині з демоном докер. Як ми пам'ятаємо, демон декер ми запустабо не безпосередньо, а через docker-machine. Тому, ще раз запитаємо дані щодо наших докер машин за допомогою команди docker-machine ls і звернемося на сервер у контейнері: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2d81822d-c286-4bb9-af9d-74cd279e9e75" data-max-width="526" alt="Перше знайомство з Docker - 24" src="https://cdn.javarush.com/images/article/2d81822d-c286-4bb9-af9d-74cd279e9e75/512.jpeg" style="width: 526px;">
 </div>
</div>Таким чином, ми з Вами щойно запустабо свій веб-додаток у докер контейнері! ) Ще хотілося б відзначити наступне. У разі виникнення проблем із доступом слід пам'ятати, що докер машина насамперед це віртуальна машина Virtual BOx. Можливо, проблеми в налаштуваннях мережі віртуальної машини. Робоча конфігурація VMBox може виглядати так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c4bc17af-3daa-4ddb-bdda-7249acf93353" data-max-width="741" alt="Перше знайомство з Docker - 25" src="https://cdn.javarush.com/images/article/c4bc17af-3daa-4ddb-bdda-7249acf93353/512.jpeg" style="width: 741px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="70c4c594-c321-40df-9d67-e3312646f2e1" data-max-width="289" alt="Перше знайомство з Docker - 26" src="https://cdn.javarush.com/images/article/70c4c594-c321-40df-9d67-e3312646f2e1/256.jpeg" style="width: 289px;">
 </div>
</div>
<h2>Шари (layers)</h2>Ми з вами вже розібралися, що образи створюються з докерфайлів і що докерфайли це набір команд. Ще ми розібралися, що докерфайл має батьківський. І що розмір образів різний. Цікаво, що можна переглянути історію того, як збирався образ за допомогою команди <a href="https://docs.docker.com/engine/reference/commandline/history/" target="_blank" rel="nofollow">docker history</a> . Наприклад: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ef8bae0c-670c-4005-a7eb-aad4663f80f1" data-max-width="691" alt="Перше знайомство з Docker - 27" src="https://cdn.javarush.com/images/article/ef8bae0c-670c-4005-a7eb-aad4663f80f1/512.jpeg" style="width: 691px;">
 </div>
</div>Важливо про це сказати для розуміння того, що за своєю суттю кожен образ – це набір образів. Кожна зміна образу (кожна нова команда в докерфайлі) створює новий шар, який має власний ID. Докладніше про шари можна прочитати в документації " <a href="https://docs.docker.com/storage/storagedriver/#images-and-layers" target="_blank" rel="nofollow">Docker: Images and Layers</a> ". Так само дуже рекомендую до ознайомлення статтю на хабрі: " <a href="https://habr.com/ru/post/272145/" target="_blank" rel="nofollow">Образи та контейнери Docker у картинках</a> ". 
<h2>Висновок</h2>Сподіваюся, цей невеликий огляд був достатнім, щоб зацікавити контейнерування. Нижче наведено посилання на додатковий матеріал, який може бути корисним: 
<ul>
 <li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" target="_blank" rel="nofollow">Best practices for writing Dockerfiles</a></li>
 <li><a href="https://community.vscale.io/hc/ru/community/posts/115002400569-%D0%9A%D0%B0%D0%BA-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80-%D0%BD%D0%B0-%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC-%D1%85%D0%BE%D1%81%D1%82%D0%B5-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-Docker-Machine" target="_blank" rel="nofollow">Контейнер на віддаленому хості за допомогою Docker Machine</a></li>
 <li>Стаття на хабрі " <a href="https://habr.com/ru/post/353238/" target="_blank" rel="nofollow">Docker. Початок</a> "</li>
 <li>Стаття на хабрі " <a href="https://habr.com/ru/post/234829/" target="_blank" rel="nofollow">Оптимізація образів Docker</a> ".</li>
 <li>Udemy: " <a href="https://www.udemy.com/topic/docker/?price=price-free&amp;lang=en&amp;sort=popularity" target="_blank" rel="nofollow">Getting Started With Docker</a> "</li>
 <li>Youtube: " <a href="https://www.youtube.com/watch?v=EbEZgdTOHzE&amp;list=PLD5U-C5KK50XMCBkY0U-NLzglcRHzOwAg" target="_blank" rel="nofollow">Docker уроки від А до Я</a> "</li>
 <li><a href="https://www.youtube.com/watch?v=7GLP8_UEBp4" target="_blank" rel="nofollow">Можливості програмного забезпечення Docker</a> [GeekBrains]</li>
</ul>#Viacheslav