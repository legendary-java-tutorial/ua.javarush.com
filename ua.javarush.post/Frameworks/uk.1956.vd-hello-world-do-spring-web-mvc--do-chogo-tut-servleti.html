Від Hello World до Spring Web MVC і до чого тут сервлети
<p>----------------------------------------</p>
Як ми знаємо, успіх Java прийшов саме завдяки еволюції програмного забезпечення, яке прагне в мережу. Тому, і ми візьмемо за основу звичайний консольний додаток " " і зрозуміємо, що йому потрібно, щоб стати з консольної програми мережевим д
<p>----------------------------------------</p>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b723a6bf-6207-4193-aeb3-7ae0b5ed8f90" data-max-width="270" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 1" src="https://cdn.javarush.com/images/article/b723a6bf-6207-4193-aeb3-7ae0b5ed8f90/256.jpeg" style="width: 270px;">
 </div>
</div>
<h2>Вступ</h2>Як ми знаємо, успіх Java прийшов саме завдяки еволюції програмного забезпечення, яке прагне в мережу. Тому, і ми візьмемо за основу звичайний консольний додаток " <strong>Hello World</strong> " і зрозуміємо, що йому потрібно, щоб стати з консольної програми мережевим додатком. Отже, спочатку потрібно створити Java проект. Програмісти люди ліниві. У доісторичні часи, коли одні полювали на мамонтів, інші сиділи і намагалися не заплутатися у різноманітності Java бібліотек, структурах каталогів. Щоб розробник міг керувати процесом створення програми, щоб він зміг просто написати "хочу бібліотеку таку версію 2" придумали спеціальні засоби - системи складання. Дві найвідоміші з них: <a href="https://maven.apache.org/" target="_blank" rel="nofollow">Maven</a> та <a href="https://gradle.org/" target="_blank" rel="nofollow">Gradle</a>. Для цієї статті ми скористаємось Gradle. Якщо раніше нам довелося б самим створити структуру каталогів, то зараз Gradle за допомогою плагіна <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html" target="_blank" rel="nofollow">Gradle Init Plugin</a> дозволяє створити Java проект зі структурою каталогів та базовим Main класом в одну команду: <code class=" language-none">gradle init --type java-application</code> Ця команда виконує ініціалізацію (init) для нас Java-додаток (java-application ) з консольним Hello World. Після завершення в каталозі з'явиться файл <strong>build.gradle</strong> . Це наш <strong>build script</strong> — це такий собі сценарій створення програми з описом того, які дії для цього потрібно виконувати. Відкриємо його та додамо до нього рядок: <code class=" language-none">jar.baseName = 'webproject'</code> Gradle дозволяє виконувати різні дії над проектом і ці дії називаються <a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html#sec:projects_and_tasks" target="_blank" rel="nofollow">tasks</a>. За допомогою виконання команди (task'а) <code class=" language-none">gradle build</code>у каталозі <strong>/build/libs</strong> буде створено JAR файл. І як Ви здогадалися, ім'я йому тепер буде <strong>webproject.jar</strong> . Але якщо виконаємо <code class=" language-none">java -jar ./build/libs/webproject.jar</code>, то отримаємо помилку: <code class=" language-none">no main manifest attribute</code>. Все тому, що для java програми потрібно прикласти якийсь маніфест - це такий опис, як працювати з додатком, як його сприймати. Тоді JVM, яка і буде виконувати Java додаток буде знати, який клас є точкою входу в програму та іншу інформацію (наприклад, classpath). Якщо уважніше придивитися до вмісту build скрипта, то ми побачимо плагіни, що підключаються. Наприклад: <code class=" language-none">apply plugin: 'java'</code> Якщо зайти на сторінку плагіна <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sub:manifest" target="_blank" rel="nofollow">Gradle Java Plugin</a> , то можемо побачити, що ми можемо сконфігурувати маніфест: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">jar <span class="token punctuation"><span class="token punctuation">{</span></span>
    manifest <span class="token punctuation"><span class="token punctuation">{</span></span>
        attributes <span class="token string"><span class="token string">'Main-Class'</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">'App'</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Головний клас, точку входу до програми, для нас згенерував Gradle Init Plugin. І вона навіть вказана у параметрі mainClassName. Але це не підійшло, т.к. цей параметр відноситься до іншого плагіна, <a href="https://docs.gradle.org/current/userguide/application_plugin.html" target="_blank" rel="nofollow">Gradle Application Plugin</a> . Отже, у нас є Java програма, яка виводить Hello World на екран. Java додаток це упаковується у JAR (Java ARchive). Воно просте, консольне, не актуальне. Як же перетворити його на веб-додаток? 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="213" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 2" src="https://cdn.javarush.com/images/article/0210276e-5e74-4175-a25a-a0c69bfb8b3f/original.jpeg">
 </div>
</div>
<h2>Servlet API</h2>Для того щоб Java змогла працювати з мережею ще в далекі часи з'явилася специфікація, звана <strong>Servlet API</strong> . Саме дана специфікація описується клієнт-серверна взаємодія, отримання повідомлення від клієнта (наприклад, браузера) та надсилання відповіді (наприклад, з текстом сторінки). Природно, з того часу багато що змінилося, але суть у тому, щоб Java програма стала веб-додатком використовується Servlet API. Щоб не міркувати голослівно, візьмемо до рук ту саму специфікацію: <a href="http://download.oracle.com/otndocs/jcp/servlet-3_1-fr-eval-spec/index.html" target="_blank" rel="nofollow">JSR-000340 JavaTM Servlet 3.1</a> . Насамперед, нас цікавить " <strong>Chapter 1: Overview</strong> ". У ній описуються основні поняття, які ми маємо усвідомити собі. По-перше, що таке серврлет? У розділі " <strong>1.1 What is a Servlet?</strong> " сказано, що<b>Servlet</b> - це Java компонент, який керується контейнером і який генерує динамічний зміст. Як і інші Java компоненти, сервлет є Java класом, який скомпільований в байт-код і який може бути завантажений у веб-сервер, що використовує технологію Java. Важливо, що сервлети взаємодіють із веб-клієнтом (наприклад, браузером) у рамках парадигми запит/відповідь (request/response), яку реалізує Servlet Container. Виходить, що Servlet'и живуть у якомусь Servlet Container'і. Що це? У розділі " <strong>1.2 What is a Servlet Container?</strong> " сказано, що <strong>Servlet Container</strong>— це деяка частина веб-сервера або сервера програм, яка надає мережеві сервіси, через які надсилаються запити та відповіді надсилаються. Цей Servlet Container керує життєвим циклом сервлетів. Усі Servlet Container'и повинні підтримувати протокол HTTP як мінімум, але можуть підтримувати інші. Наприклад, HTTPS. Також важливо, що саме Servlet Container може накладати на оточення, в якому виконуються сервлети, які пов'язані з безпекою обмеження. Важливо також, що відповідно до " <strong>10.6 Web Application Archive File</strong> " веб-додаток має бути упаковано в WAR (Web ARchive) файл. Тобто тепер нам потрібно видалити наші jar та application плагіни на щось інше. І це – <a href="https://docs.gradle.org/current/userguide/war_plugin.html" target="_blank" rel="nofollow">Gradle WAR plugin</a>. А замість jar.baseName вказати war.baseName Т.к. ми не використовуємо більше jar плагін, то ми видалабо і налаштування manifest. Коли ми запускали JAR - віртуальній машині Джава (JVM) потрібно було через маніфест підказати, як працювати з нашим додатком. Тому що JVM виконувала його. Веб-додаток, зважаючи на все, виконуємо якийсь веб-сервер. Виходить, йому треба якось підказати, як працювати з нашим веб-додатком? І виявляється що так. У веб-застосунків свій, особливий маніфест. Називається він <strong>Deployment Descriptor</strong> . Йому відведено цілий розділ: " <strong>14. Deployment Descriptor</strong> ". Є важливий розділ: " <strong>Chapter 10: Web Applications</strong> ". Він розповідає про те, що являє собою веб-додаток з точки зору Servlet API. Наприклад, у розділі "<strong>10.5 Directory Structure</strong> "вказано, де має бути Deployment Descriptor: <code class=" language-none">/WEB-INF/web.xml</code>. Куди розмістити WEB-INF? Як сказано в Gradle WAR plugin, він додає новий <a href="https://docs.gradle.org/current/userguide/war_plugin.html#sec:war_project_layout" target="_blank" rel="nofollow">layout</a> :. <code class=" language-none">src/main/webapp</code>Тому створимо такий каталог, всередині створимо каталог WEB-INF, а всередині створимо файл web. xml Важливо, щоб каталог називався WEB-INF, а не META-INF! Скопіюємо собі з <strong>прикладу</strong> XML 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f06c92fd-5b73-4558-af50-c84f0bafde97" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 3" src="https://cdn.javarush.com/images/article/f06c92fd-5b73-4558-af50-c84f0bafde97/512.jpeg" style="width: 550px;">
 </div>
</div>Як бачимо, для конфігурації використовується XML документ. XML документ, щоб вважатися коректним (Valid), повинен відповідати якійсь "схемі". Можна вважати це своєрідним інтерфейсом для XML документа. У схемі вказано, які елементи можуть бути у XML документі, якого типу дані можуть задавати елемент, порядок, обов'язковість та інші аспекти. У скопійованому з документації прикладі вказано версію 2.5, а ми хочемо використовувати версію 3.1. Звичайно, специфікація зі зміною версій змінювалася, додавали нові можливості. Тому схему потрібно використовувати не ту, яку використовували для версії 2.5 (web-app_2_5.xsd). Яку схему використовувати для версії 3.1? У цьому нам допоможе документація, розділ " <strong>14.3 Deployment Descriptor</strong> ", у якій зазначено<code class=" language-none">specification is available at http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd</code> Тобто нам треба скрізь замінити посилання на схему на вказану xsd, не забувши поміняти <code class=" language-none">version="2.5"</code>на 3.1, а так само змінити скрізь namespace (xmlns і в xsi:schemaLocation). Вони вказують, у межах якого простору імен ми працюватимемо (якщо дуже просто, то які імена елементів ми можемо використовувати). Якщо відкрити файл схеми, то в targetNamespace буде вказано той самий namespace, який ми повинні вказувати: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b22b4fd2-4a11-4551-a8ff-f785a06b2272" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 4" src="https://cdn.javarush.com/images/article/b22b4fd2-4a11-4551-a8ff-f785a06b2272/512.jpeg" style="width: 550px;">
 </div>
</div>Як ми пам'ятаємо, у Manifest Jar-файлу ми писали, який клас ми хочемо використати. Що ж тут робити? Тут необхідно вказати, який клас сервлета ми хочемо використовувати, коли отримаємо запит від веб-клієнта. Опис можна прочитати у розділі " <strong>14.4 Deployment Descriptor Diagram</strong> ". Виглядати це буде так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="4f4e2698-f0f8-44f6-b483-c4799c28e7bc" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 5" src="https://cdn.javarush.com/images/article/4f4e2698-f0f8-44f6-b483-c4799c28e7bc/512.jpeg" style="width: 550px;">
 </div>
</div>Тут все просто. Оголошується серверлет, а далі робиться його мапінг на деякий шаблон. У разі, на /app. Коли спрацює шаблон, виконання буде запущено метод сервлета. Для краси клас App варто перенести в пакет, не забувши виправити xml конфігурацію. Але це ще не все. App має бути сервлетом. Що це означає бути серврлетом? Це означає, що ми повинні успадковуватися від <strong>HttpServlet</strong> . Приклад можна підглянути у розділі " <strong>8.1.1 @WebServlet</strong> ". Відповідно до нього наш App клас виглядатиме так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServlet</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">App</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">HttpServlet</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getGreeting</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"Hello world."</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doGet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpServletRequest</span></span> request<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">HttpServletResponse</span></span> response<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		response<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setContentType</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"text/html"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
			response<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getWriter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getGreeting</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
			<span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IllegalStateException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>e<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Але наш проект ще не готовий. Тому що ми тепер залежимо від Servlet API версії 3.1. А це означає, що в нашому скрипті build треба вказати залежність від Servlet API. Адже JVM треба знати, що те, що Ви написали в коді правильно, як це використовувати. Як ми пам'ятаємо, специфікація — це лише інтерфейси, які описують, як це все має працювати. А продажі лежать на стороні веб-сервера. Тому без Servlet API буде знаходити потрібну бібліотеку на Maven Central: <a href="https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api/3.1.0" target="_blank" rel="nofollow">javax.servlet-api</a> . І додаємо запис до блоку <a href="https://docs.gradle.org/current/userguide/declaring_dependencies.html" target="_blank" rel="nofollow">dependencies</a> . У Maven репозиторії, як Ви бачабо, вказано наведене. Перед використанням залежності слід вказати scope. У Gradle немає scope з ім'ям "provided", зате там є scope " <a href="https://blog.gradle.org/introducing-compile-only-dependencies" target="_blank" rel="nofollow">compile only</a> ". Тому вкажемо:<code class=" language-none">providedCompile 'javax.servlet:javax.servlet-api:3.1.0'</code> Уф, начебто все? Gradle Build збере наш проект у файл WAR. І що далі з ним робити? Для початку нам потрібний Web Server. У гугле пишемо " <strong>web server java list</strong> " і бачимо список веб-серверів. Виберемо з цього списку, наприклад, <strong>TomCat</strong> . Переходимо на сайт <a href="http://tomcat.apache.org/" target="_blank" rel="nofollow">Apache Tomcat</a> , завантажуємо останню версію (на даний момент 9 версія) у вигляді zip архіву (якщо для Windows). Розпаковуємо в якийсь каталог. Ура, ми маємо веб-сервер. З каталогу веб-сервера в підготовці <strong>bin</strong> виконуємо з командного рядка <strong>catalina</strong> і бачимо доступні опції. Виконаємо:<code class=" language-none">catalina start</code>. Кожен веб-сервер має каталог, за яким веб-сервер стежить. Якщо там з'являється файл веб-застосунку, то веб-сервер починає його в себе встановлювати. Така установка називається розгортанням або деплоєм ( <em><strong>deploy</strong></em> ). Так, саме тому " <strong>deployment descriptor</strong> ". Тобто як потрібно правильно розгорнути програму. У Tomcat такий каталог - <strong>webapps</strong> . Скопіюємо туди war, котрий ми зробабо за допомогою gradle build. Після цього в лозі ми побачимо щось на зразок: <code class=" language-none">Deployment of web application archive [tomcat\webapps\webproject.war] has finished in [время] ms</code> Щоб розуміти ще краще, в каталозі tomcat відредагуємо файл <code class=" language-none">\conf\tomcat-users.xml</code>, додавши наступні рядки: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="5c283d82-21be-4563-bb61-fead9ccca873" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 6" src="https://cdn.javarush.com/images/article/5c283d82-21be-4563-bb61-fead9ccca873/512.jpeg" style="width: 550px;">
 </div>
</div>Тепер перезапускаємо сервер (catalina stop, catalina start) і переходимо за адресаою <code class=" language-none">http://127.0.0.1:8080/manager</code> Тут ми побачимо шляхи всіх програм. Нашому webproject швидше за все дали шлях / webproject. Що це за шлях? У специфікації у розділі " <strong>10.1 Web Applications Within Web Servers</strong> " сказано, що веб-додаток асоціюється з деяким шляхом усередині програми (у разі, це /webproject). Всі запити через цей шлях будуть асоційовані з тим самим ServletContext'ом. Цей шлях ще називається <strong>contextRoot</strong> . А згідно " <strong>10.2 Relationship to ServletContext</strong> " сервлет контейнер співвідносить веб-додаток і ServletContext один до одного. Тобто кожен веб-додаток має свій ServletContext. Що ж таке <strong>ServletContext</strong>? Як говорить специфікація, <strong>ServletContext</strong> - це деякий об'єкт, який надає сервлетам деяке уявлення про додаток, в якому вони виконуються, " <strong>view of the application</strong> ". Докладніше про <strong>Servlet Context</strong> розповідається в розділі 4 специфікації Servlet API. Дивно, що Servlet API у версії 3.1 не вимагає обов'язкової присутності web.xml. Наприклад, можна задати серврлет за допомогою анотацій: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>annotation<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">WebServlet</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServlet</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>servlet<span class="token punctuation"><span class="token punctuation">.</span></span>http<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>io<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@WebServlet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/app2"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">App2</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">HttpServlet</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doGet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpServletRequest</span></span> request<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">HttpServletResponse</span></span> response<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        response<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setContentType</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"text/html"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        response<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getWriter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"app2"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> За темою так само рекомендуються: " <a href="http://javastudy.ru/interview/jee-servlet-api-questions/" target="_blank" rel="nofollow">Співбесіда з Java EE - JEE Servlet API (питання та відповіді)</a> ". Отже, у нас є Servlet - він відповідає за те, яку відповідь видати веб-клієнту. У нас є ServletContainer, який отримує запити від користувача, співвідносить шлях, до якого звернулися, шляхом сервлета і якщо відповідність знайдена - виконує Servlet. Добре. Яке ж місце у цій картині світу займає <a href="https://codegym.cc/groups/posts/476-spring-dlja-lenivihkh-osnovih-bazovihe-koncepcii-i-primerih-s-kodom-chastjh-1" target="_blank">Spring</a> ? 
<h2>Spring Web MVC</h2>Добре, у нас є веб-додаток. Тепер нам потрібно підключити Spring. Як нам це зробити. По-перше, потрібно розібратися з тим, як правильно підключити Spring до проекту. Виявляється, раніше можна було це робити у відповідності з документацією проекту <a href="https://platform.spring.io/platform/" target="_blank" rel="nofollow">Spring platform</a> , але тепер " <strong>The Platform will reach the end of its supported life on 9 April 2019</strong> ", тобто бажано її використовувати, т.к. скоро вона перестане підтримуватись. Єдиний вихід - " <strong>Users of the Platforms are encourage to start using Spring Boot's dependency management</strong> ". Тому перейдемо до документації <strong>Spring Boot</strong>. Уточню, що ми не використовуємо сам Spring Boot, а лише Dependency Management від Spring Boot. Тобто, проект Spring Boot може надавати знання про те, які версії бібліотек потрібно використовувати (у тому числі Spring MVC). Там знайдемо <a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/#managing-dependencies-using-in-isolation" target="_blank" rel="nofollow">3.2. Using Spring Boot's dependency management in isolation</a> . Згідно з документацією в build скрипт додаємо: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">plugins <span class="token punctuation"><span class="token punctuation">{</span></span>
    id <span class="token string"><span class="token string">'org.springframework.boot'</span></span> version <span class="token string"><span class="token string">'2.0.4.RELEASE'</span></span> apply <span class="token boolean"><span class="token boolean">false</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
apply plugin<span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">'io.spring.dependency-management'</span></span></code></pre> і 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencyManagement <span class="token punctuation"><span class="token punctuation">{</span></span>
    imports <span class="token punctuation"><span class="token punctuation">{</span></span>
        mavenBom <span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token punctuation"><span class="token punctuation">.</span></span>gradle<span class="token punctuation"><span class="token punctuation">.</span></span>plugin<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>SpringBootPlugin</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>BOM_COORDINATES
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як бачимо, ми вказали <code class=" language-none">apply false</code>, тобто. не застосовуємо сам Spring Boot, але використовуємо туди управління залежностями. Таке управління залежностями так само називають BOM - " <strong>Bill Of Materials</strong> ". Тепер ми готові підключати сам проект Spring Web MVC. Spring Web MVC є частиною проекту <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/" target="_blank" rel="nofollow">Spring Framework</a> і нас цікавить розділ " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#spring-web" target="_blank" rel="nofollow">Web Servlet</a> ". Додамо залежність у build script: <code class=" language-none">compile 'org.springframework:spring-webmvc'</code>. Як бачимо, ми виставабо scope compile, т.к. веб-сервер не надає нам Spring. Наш проект змушений включати бібліотеку Spring усередину себе. Далі нам важливо прочитати розділ " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-servlet" target="_blank" rel="nofollow">1.2. DispatcherServlet</a> " , де сказано, що <strong>Spring MVC</strong> побудований навколо шаблону " <strong>Front controller</strong>", коли є якийсь центральний сервлет, який надає конфігурацію та делегування іншим компонентам. Dispatcher можна перекласти як диспетчер. Отже, насамперед у web.xml оголошуємо: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="78d99f38-c00f-44b0-b491-9fe218f762b5" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 7" src="https://cdn.javarush.com/images/article/78d99f38-c00f-44b0-b491-9fe218f762b5/512.jpeg" style="width: 550px;">
 </div>
</div>Як бачимо, це насправді звичайний Listener, визначений у специфікації Servlet API. Якщо бути більш точним, то це ServletContextListener, тобто він спрацьовує на ініціалізацію Servlet Context'а для нашого веб-додатку. Далі треба вказати налаштування, яке розповість Spring, де лежить його особливий xml конфіг з налаштуваннями: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="8a7d93ae-b558-407a-a839-e029f91bad32" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 8" src="https://cdn.javarush.com/images/article/8a7d93ae-b558-407a-a839-e029f91bad32/512.jpeg" style="width: 550px;">
 </div>
</div>Як видно, це просто звичайне налаштування, яке зберігається на рівні Servlet Context, але яке буде використане Spring'ом при ініціалізації Application Context. Тепер потрібно оголосити замість всіх сервлетів один єдиний диспетчер, що розподіляє всі інші запити. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="23a68c78-0742-4750-b2ff-c92ccefc4c04" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 9" src="https://cdn.javarush.com/images/article/23a68c78-0742-4750-b2ff-c92ccefc4c04/512.jpeg" style="width: 550px;">
 </div>
</div>І тут жодної магії. Якщо ми подивимося, це HttpServlet, просто в якому Spring виконує багато всього, що робить його фреймворком. Залишилося співвіднести (змапити) певний шаблон url із сервлетом: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="a0ac1ad8-472d-4720-9e79-f6e10018b08f" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 10" src="https://cdn.javarush.com/images/article/a0ac1ad8-472d-4720-9e79-f6e10018b08f/512.jpeg" style="width: 550px;">
 </div>
</div>Все, як ми робабо раніше. Тепер давайте створимо щось, що має показати наш веб-сервер. Наприклад, створимо у нашому WEB-INF підкаталог pages, а там файл hello.jsp. Вміст може бути найпримітивнішим. Наприклад, усередині тегів html тег h1 з текстом " <a href="http://www.learn-html.org/en/Hello,_World!" target="_blank" rel="nofollow">Hello World</a> ". І не забудемо створити файл <code class=" language-none">applicationContext.xml</code>, який ми вказали раніше. Візьмемо приклад із документації Spring: " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-scanning-autodetection" target="_blank" rel="nofollow">1.10.3. Automatically detecting classes and registering bean definitions</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ff786718-ade1-44df-ae2d-c8fc2235f980" data-max-width="550" alt="Від Hello World до Spring Web MVC і до чого тут сервлети - 11" src="https://cdn.javarush.com/images/article/ff786718-ade1-44df-ae2d-c8fc2235f980/512.jpeg" style="width: 550px;">
 </div>
</div>Т.к. ми включаємо таким чином автовизначення, то ми можемо тепер створити 2 класи (вони будуть вважатися Spring Bean'ами через використання спеціальних Spring анотацій), які Spring тепер сам створить і виконає за їх допомогою доналаштування нашого додатку: 
<ol>
 <li>
  <p>Веб-конфігурація для прикладу конфігурування в стилі Java:</p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Configuration</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@EnableWebMvc</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">WebConfig</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">WebMvcConfigurer</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">configureViewResolvers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ViewResolverRegistry</span></span> registry<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">jsp</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/WEB-INF/pages/"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">".jsp"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">configureDefaultServletHandling</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DefaultServletHandlerConfigurer</span></span> configurer<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        configurer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">enable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
  <p>Даний приклад описаний у документації Spring Framework: " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-config" target="_blank" rel="nofollow">1.11. MVC Config</a> ".</p>
  <p>Тут ми реєструємо ViewResolver, який допомагатиме визначити, як знаходитись jsp сторінки. Другий метод забезпечує включення " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-default-servlet-handler" target="_blank" rel="nofollow">Default servlet</a> ".</p>
  <p>Докладніше можна прочитати про це тут: " <a href="http://qaru.site/questions/240071/what-is-the-need-and-use-of-mvcdefault-servlet-handler" target="_blank" rel="nofollow">У чому полягає необхідність та використання default-servlet-handler</a> ".</p></li>
 <li>
  <p>Контролер HelloController для опису мапінгу запитів на певний JSP</p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Controller</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HelloController</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/hello"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">handle</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Model</span></span> model<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"hello"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
  <p>Тут ми використали інструкцію @Controller, описану в документації в розділі " <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-controller" target="_blank" rel="nofollow">1.4. Annotated Controllers</a> ".</p></li>
</ol>Тепер, коли наша програма буде розгорнута, то коли ми надішлемо запит <code class=" language-none">/webproject/hello</code>(де /webproject — це context root), то спочатку відпрацьовуватиме DispatcherServlet. Він, як головний диспетчер, визначить, що ми /* підходить під поточний запит, це DispatcherServlet повинен щось робити. Далі він пройдеться по всіх мапінгах, які знайде. Побачить, що є HelloController з методом handle, який замалений на /hello та виконає його. Цей метод поверне текст "hello". Цей текст отримає ViewResolver, який розповість серверу, де шукати jsp файли, які потрібно відобразити клієнту. Таким чином зрештою клієнт отримає ту саму заповітну сторінку. 
<h2>Висновок</h2>Сподіваюся, зі статті буде зрозуміло, що слово "контекст" це не страшно. Що специфікації, виявляються, дуже корисні. А документація – наш друг, а не ворог. Сподіваюся, буде зрозуміло, на чому заснована робота Spring, як він підключається і до чого тут Servlet API.