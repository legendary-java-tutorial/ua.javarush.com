Частина 1. Введення в SQL
<p>----------------------------------------</p>
Ця стаття відкриває невеликий цикл, присвячений азам взаємодії з і . Багато програм зайняті обробкою та модифікацією інформації, її підтримкою в актуальному стані. Оскільки дані є дуже важливою частиною логіки програм, то під них часто виді
<p>----------------------------------------</p>
<h3>JDBC. Підключення БД та створення консольної Java програми в IntelliJ IDEA</h3>
<h2>Вступ</h2>Ця стаття відкриває невеликий цикл, присвячений азам взаємодії з <strong><em>базами даних (БД) Java</em></strong> і <strong><em>введення в SQL</em></strong> . Багато програм зайняті обробкою та модифікацією інформації, її підтримкою в актуальному стані. Оскільки дані є дуже важливою частиною логіки програм, то під них часто виділяють окреме сховище. Інформація в ньому структурована та підпорядкована спеціальним правилам, щоб забезпечити правильність обробки та зберігання. Доступ до даних та їх зміна здійснюється за допомогою спеціальної мови запитів – SQL (Structured Query Language). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c6be1902-0d88-4e4d-9dbd-3d27facbb34a" data-max-width="710" alt="Частина 1. Введення в SQL - 1" src="https://cdn.javarush.com/images/article/c6be1902-0d88-4e4d-9dbd-3d27facbb34a/512.jpeg" style="width: 710px;">
 </div>
</div><strong>Система управління базами даних</strong> — це програмне забезпечення, яке забезпечує взаємодію різних зовнішніх програм з даними та додаткові служби (журналювання, відновлення, резервне копіювання тощо), у тому числі за допомогою SQL. Тобто програмний прошарок між даними та зовнішніми програмами з ними працюючими. У цій частині відповімо на запитання, що таке SQL, що таке SQL сервер і створимо першу програму для взаємодії з СУБД. 
<h2>Види СУБД</h2><strong>Існує кілька видів СУБД за способом організації зберігання даних:</strong>
<ul>
 <li><strong>Ієрархічні. </strong>Дані організовані як деревоподібної структури. Приклад - файлова система, яка починається з кореня диска і далі приростає гілками різних типів файлів і папок різного ступеня вкладеності.</li>
 <li><strong>Мережеві. </strong>Видозміна ієрархічної, у кожного вузла може бути більше одного з батьків.</li>
 <li><strong>Об'єктно-орієнтовані. </strong>Дані організовані у вигляді класів/об'єктів з їх атрибутами та принципами взаємодії згідно з ОВП.</li>
 <li><strong>Реляційні. </strong>Дані цього виду СУБД організовано у таблицях. Таблиці можуть бути пов'язані один з одним, інформація в них структурована.</li>
</ul>У циклі статей розглядатимемо саме реляційні СУБД (як найпоширеніші) на прикладі H2 і створюватимемо з нуля додаток, що емулює подібність роботи біржі. <em>Питання:</em> Чому не PostgreSQL, MySQL, MSSQL чи Oracle? <em>Відповідь:</em> Щоб не відволікатись на питання встановлення окремого комплексу програм. Подальшого налаштування, створення БД, тонкощів роботи в різних ОС, версій. Для роботи з H2 необхідно зробити мінімум дій. Але нічого не заважає міняти поточну H2 JDBC на реляційну СУБД іншого виробника (змінюється лише рядок адресаи сервера та ім'я класу драйвера). 
<h2>SQL</h2>Зовнішні програми формують запити до СУБД мовою управління даними Structured Query Language. Що таке SQL та чим відрізняється від звичних мов програмування? Однією з особливостей SQL є декларативність. Тобто <strong>SQL — декларативна мова</strong> . Це означає, що, вбиваючи команди, тобто, створюючи запити до SQL-серверу, ми описуємо, що хочемо отримати, а чи не якимось способом. Посилаючи серверу запит <code class=" language-none">SELECT * FROM CUSTOMER</code>(приблизний переклад із SQL російською: <em>«зробити вибірку з таблиці COSTUMER, вибірка складається з усіх рядків таблиця»</em> ), ми отримаємо дані всім користувачам. Зовсім неважливо, як і звідки сервер завантажить і сформує дані, що цікавлять нас. Головне – правильно сформулювати запит. 
<ul>
 <li>Що таке SQL-сервер і як він працює? Взаємодія із СУБД відбувається за клієнт-серверним принципом. Якась зовнішня програма посилає запит як операторів і команд мовою SQL, СУБД його обробляє і надсилає відповідь. Для спрощення приймемо, що SQL Сервер = СУБД.</li>
</ul>Якщо ви вмієте керувати легковим автомобілем однієї марки, ви, швидше за все, без особливих проблем зможете сісти за кермо та інші. Основи водіння скрізь однакові, крім невеликих деталей. Аналогічно і для SQL-серверів різних виробників – у кожного з них своя версія SQL, але вона відповідає заданим стандартам (SQL92, SQL2003 …). Ми будемо використовувати оператори та команди в рамках SQL92. <strong>Основні SQL-оператори поділяють такі групи:</strong>
<ul>
 <li>Data Definition Language ( <strong>DDL</strong> ) - визначення даних. Створення структури БД та її об'єктів;</li>
 <li>Data Manipulation Language( <strong>DML</strong> ) – власне взаємодія з даними: вставка, видалення, зміна та читання;</li>
 <li>Transaction Control Language ( <strong>TCL</strong> ) - управління транзакціями;</li>
 <li>Data Control Language ( <strong>DCL</strong> ) – управління правами доступу до даних та структур БД.</li>
</ul> У циклі статей ми розглянемо перші три групи, особливо приділяючи увагу DML. 
<h2>JDBC</h2>У 80-х роках минулого століття персональні комп'ютери типу PC XT/AT завоювали ринок. Багато в чому це сталося завдяки модульності їхньої конструкції. Це означає, що користувач міг просто змінювати ту чи іншу складову частину свого комп'ютера (процесор, відеокарту, диски тощо). Ця чудова властивість збереглася і понині: ми змінюємо відеокарту та оновлюємо драйвер (іноді він взагалі оновлюється сам, в автоматичному режимі). Найчастіше при таких маніпуляціях нічого поганого не відбувається, і існуючі програми продовжать працювати з системою без переустановки. Аналогічно і для роботи в Java із СУБД. Для стандартизації роботи з SQL-серверами взаємодію із нею можна виконувати через єдину точку — <strong><em>JDBC</em></strong> (Java DataBase Connectivity). Вона є реалізацією пакету<em>java.sql</em> для роботи із СУБД. Виробники всіх популярних SQL-серверів випускають їм драйвери JDBC. Розглянемо схему нижче. Програма використовує екземпляри класів з <em>java.sql</em> . Потім ми надаємо необхідні команди для отримання/модифікації даних. Далі <em>java.sql</em> через <em>jdbc-драйвер</em> взаємодіє із СУБД і повертає нам готовий результат. <img data-id="8098e9c9-e40c-4aad-b7c5-93987199aa61" data-max-width="710" alt="Частина 1. Введення в SQL - 2" src="https://cdn.javarush.com/images/article/8098e9c9-e40c-4aad-b7c5-93987199aa61/512.jpeg" style="width: 710px;"> Для переходу на СУБД іншого виробника часто достатньо змінити JDBC та виконати базові налаштування. Інші частини програми при цьому не змінюються. 
<div class="email-subscription">
 <iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no" data-savepage-key="0-2"></iframe>
</div>
<h2>Перша програма</h2>Приступимо до практичної частини. Створимо Java-проект за допомогою <strong>IDE JetBrains IntelliJ IDEA</strong> . Зауважимо, що редакція Ultimate Edition містить у своєму складі чудовий інструмент для роботи з SQL та БД – <em>Data Grip</em> . Проте, вона платна для більшості користувачів. Тож нам для навчальних цілей залишається використовувати загальнодоступну <em>IntelliJ IDEA Community Edition</em> . Отже: 
<ol>
 <li>Запускаємо IDE та створимо новий проект:<br><img data-id="1d9ddd23-e9f3-4a04-a397-f2f7462d5f8b" data-max-width="271" alt="Частина 1. Введення у SQL - 3" src="https://cdn.javarush.com/images/article/1d9ddd23-e9f3-4a04-a397-f2f7462d5f8b/256.jpeg" style="width: 271px;"></li>
 <br>
 <li>Вибираємо Java-проект, вказуємо версію <em>SDK</em> (у прикладі JDK8, але це не критично):<br><img data-id="625ca635-6541-41aa-953b-8452d8c657bd" data-max-width="710" alt="Частина 1. Введення у SQL - 4" src="https://cdn.javarush.com/images/article/625ca635-6541-41aa-953b-8452d8c657bd/512.jpeg" style="width: 710px;"></li>
 <br>
 <li>На наступному кроці вибираємо в якості типу <em>консольне додаток</em> :<br><img data-id="0103d0df-f123-42e2-8bf2-0d365a05f718" data-max-width="271" alt="Частина 1. Введення у SQL - 5" src="https://cdn.javarush.com/images/article/0103d0df-f123-42e2-8bf2-0d365a05f718/256.jpeg" style="width: 271px;"></li>
 <br>
 <li>Вказуємо <em>ім'я</em> проекту, <em>пакет</em> та його <em>розміщення</em> на диску (я створив спеціально для цього окрему директорію):<br><img data-id="1488a998-fd74-46c2-9cab-6d6eb6a3d373" data-max-width="271" alt="Частина 1. Введення у SQL - 6" src="https://cdn.javarush.com/images/article/1488a998-fd74-46c2-9cab-6d6eb6a3d373/256.jpeg" style="width: 271px;"></li>
 <br>
 <li>Відкладемо на хвабону IDE і завантажимо з <a href="http://www.h2database.com/html/main.html" rel="nofollow" target="_blank">www.h2database.com</a> необхідний <em>JDBC-файл</em> для роботи з <em>СУБД H2</em> (download platform independent ZIP):<br><img data-id="50e7a404-5642-4ef8-b73a-401c46f10cac" data-max-width="710" alt="Частина 1. Введення у SQL - 7" src="https://cdn.javarush.com/images/article/50e7a404-5642-4ef8-b73a-401c46f10cac/512.jpeg" style="width: 710px;"></li>
 <br>
 <li>Заходимо всередину завантаженого файлу (нас цікавить <em>jar-файл</em> шляхом <em>h2\bin</em> , який нам далі знадобиться, скопіюємо його):<br><img data-id="23a3e3f8-3aa0-4e8f-a83d-11fc1dcc5e54" data-max-width="710" alt="Частина 1. Введення у SQL - 8" src="https://cdn.javarush.com/images/article/23a3e3f8-3aa0-4e8f-a83d-11fc1dcc5e54/512.jpeg" style="width: 710px;"></li>
 <br>
 <li>Повертаємося в IDE і створюємо в корені проекту директорії: <strong><em>db</em></strong> , де будуть розміщені файли з даними СУБД; <em><strong>lib</strong></em> – тут JAR-бібліотека JDBC:<br><img data-id="12cb4625-95c1-4ff8-bc32-c6f75bd43c68" data-max-width="710" alt="Частина 1. Введення в SQL-9" src="https://cdn.javarush.com/images/article/12cb4625-95c1-4ff8-bc32-c6f75bd43c68/512.jpeg" style="width: 710px;"></li>
 <br>
 <li>Переносимо в директорію <em>lib</em> jar-файл з кроку <em>6</em> і додамо його в проект як бібліотеку:<br><img data-id="cd622b23-5820-4b51-91da-cad106adbd76" data-max-width="271" alt="Частина 1. Введення у SQL - 10" src="https://cdn.javarush.com/images/article/cd622b23-5820-4b51-91da-cad106adbd76/256.jpeg" style="width: 271px;"></li>
 <br>
 <li>Перейменуємо java-файл в <em>src/sql/demo</em> на <em>StockExchange.java</em> (якщо забули, ми збираємося емулювати просту «біржу»), змінимо його вміст і запустимо:<br><img data-id="992238c7-9aea-4a5e-8444-d993f1c9abdd" data-max-width="710" alt="Частина 1. Введення в SQL - 11" src="https://cdn.javarush.com/images/article/992238c7-9aea-4a5e-8444-d993f1c9abdd/512.jpeg" style="width: 710px;"></li>
</ol> Тепер ми вміємо підключатися до СУБД та відключатися від неї. Кожен крок відбивається у консолі. При першому підключенні до СУБД створюється файл бази даних <strong><em>stockExchange.mv.db</em></strong> . 
<h2>Розбір коду</h2>Власне код: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">package</span></span> <span class="token namespace"><span class="token namespace">sql<span class="token punctuation"><span class="token punctuation">.</span></span>demo</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>sql<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">StockExchangeDB</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token comment"><span class="token comment">// Блок объявления констант</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> DB_URL <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"jdbc:h2:/c:/JavaPrj/SQLDemo/db/stockExchange"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token class-name"><span class="token class-name">DB_Driver</span></span> <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"org.h2.Driver"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token class-name"><span class="token class-name">Class</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">forName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">DB_Driver</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">//Проверяем наличие JDBC драйвера для работы с БД</span></span>
            <span class="token class-name"><span class="token class-name">Connection</span></span> connection <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">DriverManager</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DB_URL<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span><span class="token comment"><span class="token comment">//соединениесБД</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Соединение с СУБД выполнено."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>       <span class="token comment"><span class="token comment">// отключение от БД</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Отключение от СУБД выполнено."</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ClassNotFoundException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// обработка ошибки  Class.forName</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"JDBC драйвер для СУБД не найден!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">SQLException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            e<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">printStackTrace</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span> <span class="token comment"><span class="token comment">// обработка ошибок  DriverManager.getConnection</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Ошибка SQL !"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3>Блок констант:</h3>
<ol>
 <li><strong>DB_Driver</strong> : Тут ми визначабо <em>ім'я</em> драйвера, яке можна дізнатися, наприклад, клацнувши мишею на підключену бібліотеку і розгорнувши її структуру в директорії lib поточного проекту.</li>
 <li><strong>DB_URL</strong> : Адреса нашої бази даних. Складається з даних, розділених двокрапкою:<br></li>
 <li>Протокол = jdbc</li>
 <li>Вендор (виробник/найменування) СУБД = h2</li>
 <li>Розташування СУБД, у разі шлях до файлу (c:/JavaPrj/SQLDemo/db/stockExchange). Для мережевих СУБД тут додатково вказуються імена чи IP адресаи віддалених серверів, TCP/UDP номери портів тощо.</li>
</ol>
<h3>Обробка помилок:</h3>Виклик методів нашого коду може повернути помилки, на які слід звернути увагу. На цьому етапі ми просто інформуємо про них у консолі. Зауважимо, що помилки при роботі з СУБД - це найчастіше <strong>SQLException</strong> . 
<h3>Логіка роботи:</h3>
<ol>
 <li><strong>Class.forName</strong> (DB_Driver) – переконуємось у наявності відповідного JDBC-драйвера (який ми раніше завантажабо та встановабо).</li>
 <li><strong>DriverManager.getConnection</strong> (DB_URL) - встановлюємо з'єднання СУБД. За переданою адресаою, JDBC сама визначить тип і місце розташування нашої СУБД і поверне Connection, який ми можемо використовувати для зв'язку з БД.</li>
 <li><strong>connection.close()</strong> – закриваємо з'єднання з СУБД та завершуємо роботу з програмою.</li>
</ol> У наступній частині циклу ми познайомимося з DDL-операторами та типами SQL-даних, а також створимо початкову структуру нашої БД та наповнимо її таблицями. <a href="https://codegym.cc/groups/posts/1970-chastjh-2-struktura-subd-tablicih-i-tipih-dannihkh-sozdaem-skelet-nashey-bazih-pervihe-sql-koma" target="_blank"><em><strong>Друга частина Третя </strong></em></a> <em><strong><a href="https://codegym.cc/groups/posts/1971-chastjh-3-sozdaem-skelet-nashey-bazih-pervihe-sql-komandih-na-primerakh-javasql" target="_blank">частина</a></strong></em>