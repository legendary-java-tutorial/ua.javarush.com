Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot. Частина 2
<p>----------------------------------------</p>
Отже, в минулому ми навчилися встановлювати базу даних PostgresSQL на комп'ютер, створювати БД в pgAdmin, а також створювати і видаляти в ній таблиці вручну і програмно. У цій частині ми будемо переписувати нашу програму, щоб вона навчилася
<p>----------------------------------------</p>
<a href="https://codegym.cc/groups/posts/2579-dobavljaem-bd-k-restful-servisu-na-spring-boot-chastjh-1" target="_blank" rel="nofollow">Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot. Частина 1</a> <img alt="Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot.  Частина 2 - 1" src="https://codegym-com.translate.goog/images/article/901725c5-bab1-4998-8c30-15a0cf07e866/original.png"> Отже, в минулому ми навчабося встановлювати базу даних PostgresSQL на комп'ютер, створювати БД в pgAdmin, а також створювати і видаляти в ній таблиці вручну і програмно. У цій частині ми будемо переписувати нашу програму, щоб вона навчилася працювати з цією БД та таблицями. Чому ми? Тому що я і сам навчаюсь разом з вами на цьому матеріалі. І далі ми будемо не тільки вирішувати поставлене завдання, а й виправляти помилки, що виникають на ходу, за допомогою порад більш досвідчених програмістів. Так би мовити, вчитимемося працювати в команді ;) Для початку створимо в папці <code class=" language-none"><span>com.codegym.lectures.rest_example</span></code>новий пакет, і назвемо його <code class=" language-none"><span>repository</span></code>. У цьому пакеті створимо новий інтерфейс <code class=" language-none"><span>ClientRepository</span></code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">package</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>repository</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>model<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Client</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>data<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>repository<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">JpaRepository</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">ClientRepository</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">JpaRepository</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Client</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>  <span class="token punctuation"><span class="token punctuation">{</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Цей інтерфейс і буде "чарівним чином" взаємодіяти з нашими базами даних та таблицями. Чому чарівним чином? Тому що його реалізацію нам писати буде не потрібно, а її надасть каркас Spring. Достатньо тільки створити такий інтерфейс, і вже можна скористатися цією «магією». Наступним кроком відредагуємо клас <code class=" language-none"><span>Client</span></code>таким чином: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">package</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>model</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>persistence<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token operator"><span class="token operator">*</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"clients"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Client</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>strategy <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">GenerationType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>IDENTITY<span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"name"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"email"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> email<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"phone"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> phone<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">//… getters and setters</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Все, що ми зробабо в цьому класі — це просто додали деякі інструкції. Пройдемося ними: 
<ul>
 <li><span>@Entity</span> - Вказує, що даний бін (клас) є сутністю.</li>
 <li><span>@Table</span> — вказує на ім'я таблиці, яка відображатиметься у цій сутності.</li>
 <li><span>@Id</span> - id колонки (первинний ключ - значення, яке буде використовуватися для забезпечення унікальності даних в поточній таблиці прим. <a href="https://codegym.cc/users/1013296" target="_blank" rel="nofollow">Andrei</a> )</li>
 <li><span>@Column</span> - вказує на ім'я колонки, яка відображається як сутність.</li>
 <li><span>@GeneratedValue</span> - вказує, що дана властивість буде створюватися відповідно до зазначеної стратегії.</li>
</ul>Імена полів таблиці необов'язково мають збігатися з іменами змінних у класі. Наприклад, якщо ми маємо змінну <code class=" language-none"><span>firstName</span></code>, то поле в таблиці ми назвемо <code class=" language-none"><span>first_name</span></code>. Ці інструкції можна встановлювати як безпосередньо біля полів, так і в їх гетерів. Але якщо ви вибрали один із цих способів, то постарайтеся дотримуватися цього стилю у всій вашій програмі. Я використав перший спосіб, щоб скоротити лістинги. Більш повний список анотацій для роботи з базами даних можна знайти <a href="http://javastudy.ru/spring-data-jpa/annotation-persistence/" target="_blank" rel="nofollow">тут</a> . Тепер перейдемо до класу <code class=" language-none"><span>ClientServiceImpl</span></code>і перепишемо його так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">package</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>service</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>model<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Client</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token punctuation"><span class="token punctuation">.</span></span>rest_example<span class="token punctuation"><span class="token punctuation">.</span></span>repository<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">ClientRepository</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>beans<span class="token punctuation"><span class="token punctuation">.</span></span>factory<span class="token punctuation"><span class="token punctuation">.</span></span>annotation<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Autowired</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>stereotype<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Service</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">java<span class="token punctuation"><span class="token punctuation">.</span></span>util<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">List</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">ClientServiceImpl</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">ClientService</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">ClientRepository</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">create</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Client</span></span> client<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>client<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Client</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>  <span class="token function"><span class="token function">readAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Client</span></span> <span class="token function"><span class="token function">read</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getOne</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Client</span></span> client<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">int</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">existsById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            client<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>client<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>

        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">int</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">existsById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            clientRepository<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">deleteById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як видно з лістингу, все, що ми зробабо, це видалабо вже не потрібні нам рядки: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token comment"><span class="token comment">// Хранабоще клиентов</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">Map</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Integer</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Client</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>  CLIENT_REPOSITORY_MAP <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HashMap</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token comment"><span class="token comment">// Переменная для генерации ID клиента</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">AtomicInteger</span></span> CLIENT_ID_HOLDER <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">AtomicInteger</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Замість них ми оголосабо наш інтерфейс <code class=" language-none"><span>ClientRepository</span></code>, а також помістабо над ним анотацію <span>@Autowired</span> , щоб Spring автоматично додав цю залежність до нашого класу. А також делегували всю роботу цьому інтерфейсу, а точніше його реалізації, яку додасть Spring. Перейдемо до заключного та найцікавішого етапу – тестування нашої програми. Відкриємо програму Postman (як їй користуватися дивіться <a href="https://codegym.cc/groups/posts/2488-obzor-rest-chastjh-3-sozdanie-restful-servisa-na-spring-boot" target="_blank" rel="nofollow">тут</a> ), І надсилаємо GET запит на цю адресау: http://localhost:8080/clients. Отримуємо таку відповідь: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">[</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token string"><span class="token string">"id"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"name"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Vassily Petrov"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"email"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"vpetrov@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"phone"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 322-22-33)"</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token string"><span class="token string">"id"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"name"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Pjotr Vasechkin"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"email"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"pvasechkin@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"phone"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 223-33-22)"</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">]</span></span></code></pre> Надсилаємо POST запит: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token string"><span class="token string">"name"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Amigo"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
  <span class="token string"><span class="token string">"email"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"amigo@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
  <span class="token string"><span class="token string">"phone"</span></span> <span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 746-43-23"</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> І… ловимо наш перший баг у програмі: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token string"><span class="token string">"timestamp"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"2020-03-06T13:21:12.180+0000"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"status"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">500</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"error"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Internal Server Error"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"message"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"could not execute statement; SQL [n/a]; constraint [null]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"path"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"/clients"</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><img alt="Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot.  Частина 2 - 2" src="https://cdn.javarush.com/images/article/c28751b7-95c0-4004-8d66-f1e6e571054c/512.webp"> Переглядаємо логи і виявляємо там таку помилку: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
org.postgresql.util.PSQLException: ОШИБКА: повторяющееся значення ключа нарушает ограничение уникальности "clients_pkey"
  Detail: Ключ "(id)=(1)" уже существует.</code></pre> Посилаємо ще раз той самий POST запит, результат той самий, але з такою відмінністю: <code class=" language-none">Ключ "(id)=(2)" уже существует.</code> Посилаємо втретє цей же запит, і отримуємо Status: 201 Created. Надсилаємо ще раз GET запит, і отримуємо на нього відповідь: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">[</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token string"><span class="token string">"id"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"name"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Vassily Petrov"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"email"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"vpetrov@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"phone"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 322-22-33)"</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token string"><span class="token string">"id"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"name"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Pjotr Vasechkin"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"email"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"pvasechkin@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"phone"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 223-33-22)"</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token string"><span class="token string">"id"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"name"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Amigo"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"email"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"amigo@jr.com"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
        <span class="token string"><span class="token string">"phone"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"+7 (191) 746-43-23"</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">]</span></span></code></pre> Це говорить про те, що наша програма ігнорує той факт, що ця таблиця була попередньо заповнена, і призначає id знову починаючи з одиниці. Що ж, баг — це робочий момент, не варто впадати у відчай, таке буває часто. Тому я звернуся за допомогою до досвідченіших колег: "Шановні колеги, порадьте будь ласка в коментарях як це пофіксувати, щоб програма запрацювала нормально". Допомога не змусила довго чекати, і <a href="https://codegym.cc/users/460666" target="_blank" rel="nofollow">Стас Пасінков</a> підказав мені в коментарях, в який бік потрібно подивитися. Окреме йому за це спасибі! А справа була в тому, що в класі <code class=" language-none">Client</code>я неправильно вказав стратегію для анотації <code class=" language-none">@GeneratedValue(strategy = GenerationType.IDENTITY)</code>біля поля <code class=" language-none">id</code>. <img alt="Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot.  Частина 2 - 3" src="https://cdn.javarush.com/images/article/e33b57bb-eb94-4f50-a904-aaed78dc2768/512.webp"> Ця стратегія підходить для MySQL. Якщо ми працюємо з Oracle або PostrgeSQL, то потрібно встановити іншу стратегію. Докладніше про стратегії для первинних ключів можна почитати <a href="https://easyjava.ru/data/jpa/pervichnye-klyuchi-v-jpa/" target="_blank" rel="nofollow">тут</a> . Я вибрав стратегію GenerationType.SEQUENCE. Для її реалізації нам потрібно буде трохи переписати файл initDB.sql, і, звичайно, анотації поля id класу Client. Переписуємо initDB.sql: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">CREATE TABLE IF NOT <span class="token class-name"><span class="token class-name">EXISTS</span></span> clients
<span class="token punctuation"><span class="token punctuation">(</span></span>
    id    INTEGER <span class="token class-name"><span class="token class-name">PRIMARY</span></span> KEY <span class="token punctuation"><span class="token punctuation">,</span></span>
    name  <span class="token function"><span class="token function">VARCHAR</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">200</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">NOT</span></span> NULL <span class="token punctuation"><span class="token punctuation">,</span></span>
    email <span class="token function"><span class="token function">VARCHAR</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">254</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">NOT</span></span> NULL <span class="token punctuation"><span class="token punctuation">,</span></span>
    phone <span class="token function"><span class="token function">VARCHAR</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">50</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>  <span class="token class-name"><span class="token class-name">NOT</span></span> NULL
<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
CREATE SEQUENCE clients_id_seq START WITH <span class="token number"><span class="token number">3</span></span> INCREMENT <span class="token class-name"><span class="token class-name">BY</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Що змінилося: змінився тип стовпця id нашої таблиці, але це трохи пізніше. Додалася рядок знизу, в якій ми створюємо нову послідовність clients_id_seq, вказуємо, що вона повинна починатися з трійки (бо останній id у файлі populateDB.sql дорівнює 2), і вказуємо, що інкремент має відбуватися на одиницю. Повернемося до типу шпальти id. Тут ми вказали INTEGER, тому що якщо залишити SERIAL, то послідовність створиться автоматично, з тим самим ім'ям clients_id_seq, але починатиметься з одиниці (що й призводило до бага програми). Однак, тепер, якщо ви захочете видалити таблицю, то потрібно буде додатково видалити цю послідовність або вручну через інтерфейс pgAdmin, або через файл .sql за допомогою таких команд: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java">DROP TABLE IF <span class="token class-name"><span class="token class-name">EXISTS</span></span> clients<span class="token punctuation"><span class="token punctuation">;</span></span>
DROP SEQUENCE IF EXISTS clients_id_seq</code></pre> Але якщо ви не використовуєте для початкового заповнення таблиці файл на кшталт populateDB.sql, то для первинного ключа можна використовувати типи SERIAL або BIGSERIAL, і не створювати послідовність вручну, відповідно і видаляти її окремо не доведеться. Докладніше почитати про послідовності можна на сайті оф. <a href="https://www.postgresql.org/docs/9.5/sql-createsequence.html" target="_blank" rel="nofollow">Документації PostgreSQL</a> . Перейдемо до анотацій поля <code class=" language-none">id</code>класу <code class=" language-none">Client</code>і оформимо їх таким чином: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@SequenceGenerator</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"clientsIdSeq"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> sequenceName <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"clients_id_seq"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> allocationSize <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>strategy <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">GenerationType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>SEQUENCE<span class="token punctuation"><span class="token punctuation">,</span></span> generator <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"clientsIdSeq"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Що ми зробабо: встановабо нову інструкцію <code class=" language-none">@SequenceGenerator</code>для створення генератора послідовності, призначабо йому ім'я <code class=" language-none">clientsIdSeq</code>, вказали, що це генератор для послідовності <code class=" language-none">clients_id_seq</code>, і додали атрибут. <code class=" language-none">allocationSize = 1</code> Це необов'язковий атрибут, але якщо ми цього не зробимо, то при запуску програми отримаємо таку помилку: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
org.hibernate.MappingException: The increment size of the [clients_id_seq] sequence is set to [50] in the entity mapping while the associated database sequence increment size is [1]</code></pre> Ось що пише user <a href="https://codegym.cc/users/1013296" target="_blank" rel="nofollow">Andrei</a> з цього приводу в коментарях: <em>allocationSize в першу чергу призначений для скорочення походу hibernate-ом в БД за "новим id". При значенні == 1 - hibernate для кожної нової сутності, перш ніж зберегти її в БД, "збігає" в БД за id. При значенні &gt; 1 (наприклад 5) - hibernate буде звертатися до БД за "новим" id рідше (для прикладу - в 5 разів), при цьому при зверненні hibernate попросить БД зарезервувати цю кількість (у нашому випадку 5) значень. Помилка ж яку ви описали говорить про те, що hibernate хотів би отримати 50 дефолтних id, але ось в БД ви вказали, що готові видавати id для цієї сутності тільки по 1-й</em> . Ще один баг був виловлений користувачем <a href="https://codegym.cc/users/2299415" target="_blank" rel="nofollow">Nikolya Kudryashov</a>: Якщо виконати запит з оригінальної статті http://localhost:8080/clients/1 ,То повернеться помилка: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token string"><span class="token string">"timestamp"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"2020-04-02T19:20:16.073+0000"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"status"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token number"><span class="token number">500</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"error"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Internal Server Error"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"message"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"Type definition error: [simple type, class org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor]; nested exception is com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: com.codegym.lectures.rest_example.model.Client$HibernateProxy$ZA2m7agZ[\"hibernateLazyInitializer\"])"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
    <span class="token string"><span class="token string">"path"</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">"/clients/1"</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ця помилка пов'язана з лінивою ініціалізацією Hibernate, і щоб її позбутися, нам необхідно додати в клас Client додаткову анотацію : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@JsonIgnoreProperties</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token string"><span class="token string">"hibernateLazyInitializer"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"handler"</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span></code></pre> Таким чином: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"clients"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@JsonIgnoreProperties</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">{</span></span><span class="token string"><span class="token string">"hibernateLazyInitializer"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"handler"</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Client</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер запустимо нашу програму (попередньо видаливши таблицю clients з БД, якщо вона залишилася там з минулого разу), і закоментуємо 3 рядки з файлу application.properties: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java">#spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>initialization<span class="token operator"><span class="token operator">-</span></span>mode<span class="token operator"><span class="token operator">=</span></span>ALWAYS
#spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>schema<span class="token operator"><span class="token operator">=</span></span>classpath<span class="token operator"><span class="token operator">*</span></span><span class="token operator"><span class="token operator">:</span></span>database<span class="token operator"><span class="token operator">/</span></span>initDB<span class="token punctuation"><span class="token punctuation">.</span></span>sql
#spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>data<span class="token operator"><span class="token operator">=</span></span>classpath<span class="token operator"><span class="token operator">*</span></span><span class="token operator"><span class="token operator">:</span></span>database<span class="token operator"><span class="token operator">/</span></span>populateDB<span class="token punctuation"><span class="token punctuation">.</span></span>sql</code></pre> Минулого разу ми коментували лише останній рядок, але т.к. ми вже створабо та заповнабо таблицю, то це мені здалося на даний момент більш логічним. Перейдемо до тестування, виконаємо GET, POST, PUT та DELETE запити через Postman і побачимо, що баги зникли, і все працює нормально. Ось і все, робота виконана. Тепер можна підбити короткий підсумок, і розглянути, чого ми навчабося: 
<ul>
 <li>Встановлювати PostgreSQL на комп'ютер</li>
 <li>Створювати бази даних у pgAdmin</li>
 <li>Створювати та видаляти таблиці вручну та програмно</li>
 <li>Заповнювати таблиці через файли .sql</li>
 <li>Трохи познайомабося із «чарівним» інтерфейсом JpaRepository каркасу Spring</li>
 <li>Дізналися про деякі баги, які можуть виникнути під час створення такої програми</li>
 <li>Зрозуміли, що не треба соромитися звертатися за порадою до колег</li>
 <li>Утвердабося на думці, що CodeGym комьюніті - це сила, яка завжди прийде на допомогу ;)</li>
</ul>На цьому поки що можна і закінчити. <a href="https://codegym.cc/welcome" target="_blank" rel="nofollow"><img width="800" height="500" data-id="b6dd1449-ce91-4ba0-9103-8eae760be739" alt="Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot.  Частина 2 - 4" src="https://cdn.javarush.com/images/article/b6dd1449-ce91-4ba0-9103-8eae760be739/1080.jpeg"></a>Дякуємо всім, хто витратив свій час на прочитання цього матеріалу. Буду радий вашим коментарям, зауваженням, доповненням та конструктивній критиці. Можливо, ви запропонуєте більш елегантні рішення цього завдання, які я обіцяю додати в цю статтю за допомогою “ключового слова” UPD, із згадкою про вас як автора, звичайно. Ну і взагалі, пишіть, чи вам сподобалася ця стаття і такий стиль подачі матеріалу, і взагалі, чи варто мені продовжувати писати статті на JR. Ось і доповнення приспіли: UPD1 : user <a href="https://codegym.cc/users/2054381" target="_blank" rel="nofollow">Justinian</a> наполегливо рекомендував мені перейменувати package <code class=" language-none">com.codegym.lectures.rest_example</code>в <code class=" language-none">com.codegym.lectures.rest.example</code>, і назву проекту, щоб не порушувати конвенції іменування Java. UPD2 user <a href="https://codegym.cc/users/1367247" target="_blank" rel="nofollow">Олександр П'янов</a> підказав, що для ініціалізації поля<code class=" language-none">ClientRepository</code>у класі <code class=" language-none">ClientServiceImpl</code>краще використовувати конструктор ніж анотацію <code class=" language-none">@Autowired</code>. Пояснюється це тим, що в окремих випадках можна отримати <code class=" language-none">NullPointerException</code>, і взагалі, це є best practice, і я з ним погоджуся. За логікою, якщо поле є обов'язковим для початкової функціональності об'єкта, краще його інізіалізувати в конструкторі, адже клас без конструктора не збереться в об'єкт, отже, це поле буде проініціалізоване ще на етапі створення об'єкта. Додам фрагмент коду з виправленнями (що на що потрібно замінити): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation"></span></span><s><span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">ClientRepository</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">;</span></span></s><span class="token punctuation"></span><span class="token punctuation"></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">ClientRepository</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ClientServiceImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ClientRepository</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>clientRepository <span class="token operator"><span class="token operator">=</span></span> clientRepository<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><a href="https://codegym.cc/groups/posts/2579-dobavljaem-bd-k-restful-servisu-na-spring-boot-chastjh-1" target="_blank" rel="nofollow">Посилання на першу частину: Додаємо БД PostgreSQL до RESTful сервісу на Spring Boot. Частина 1</a> PS Якщо хтось із вас захоче продовжити розвивати цей навчальний додаток, то я буду радий додати посилання на ваші гайди до цієї статті. Можливо, колись ця програма виросте у щось схоже на справжній бізнес-додаток, роботу над яким ви зможете додати до свого портфоліо. PPS Щодо цієї скромної статті, то я вирішив присвятити цю пробу пера нашим дорогим дівчатам, жінкам та дамам. Хто знає, можливо зараз і не було б у природі ні Java ні CodeGym, ні програмування, якби не ця <a href="https://ru.wikipedia.org/wiki/%D0%9B%D0%B0%D0%B2%D0%BB%D0%B5%D0%B9%D1%81,_%D0%90%D0%B4%D0%B0" target="_blank" rel="nofollow">жінка</a> . Вітаю вас зі святом, дорогі ви наші розумниці! З 8 березня! Будьте щасливі та красиві!