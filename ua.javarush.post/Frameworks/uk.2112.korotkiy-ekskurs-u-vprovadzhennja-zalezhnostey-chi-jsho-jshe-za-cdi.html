Короткий екскурс у впровадження залежностей чи "Що ще за CDI?"
<p>----------------------------------------</p>
Основою, де зараз побудовані найпопулярніші фреймворки, є використання залежностей. Пропоную подивитися, що про це йдеться у специфікації CDI, які базові можливості ми маємо і як ними можна скористатися. Цей маленький огляд хочеться присвят
<p>----------------------------------------</p>
Основою, де зараз побудовані найпопулярніші фреймворки, є використання залежностей. Пропоную подивитися, що про це йдеться у специфікації CDI, які базові можливості ми маємо і як ними можна скористатися. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="19bdac16-6cb6-4b9e-aaac-75cda3a4023d" data-max-width="346" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/19bdac16-6cb6-4b9e-aaac-75cda3a4023d/256.jpeg" style="width: 346px;">
 </div>
</div>
<h2>Вступ</h2>Цей маленький огляд хочеться присвятити таку штуку, як CDI. Що це? CDI – це Contexts and Dependency Injection. Це специфікація Java EE, що описує використання залежностей (Dependency Injection) та контексти. Для інформації можна переглянути на сайт <a href="http://cdi-spec.org/" rel="nofollow" target="_blank">http://cdi-spec.org</a> . Так як CDI - це специфікація (опис того, як воно має працювати, набір інтерфейсів), то для використання нам знадобиться і реалізація. Однією з таких реалізацій є Weld - <a href="http://weld.cdi-spec.org/" target="_blank" rel="nofollow">http://weld.cdi-spec.org/</a> Для управління залежностями та створення проекту скористаємося Maven - <a href="https://maven.apache.org/" target="_blank" rel="nofollow">https://maven.apache.org</a> Отже, у нас встановлений Maven, тепер розбиратимемося відразу на практиці, щоб не розбиратися в абстрактному. Для цього за допомогою Maven створимо проект. Відкриємо командний рядок (у Windows можна за допомогою Win+R викликати вікно "Виконати" і виконати cmd) і попросимо Maven зробити все за нас. Для цього Maven має таке поняття, як архетип: <a href="https://maven.apache.org/archetype/index.html" target="_blank" rel="nofollow">Maven Archetype</a> . 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c8596c05-dbbe-49ef-be8f-765ce31dcc97" data-max-width="263" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/c8596c05-dbbe-49ef-be8f-765ce31dcc97/256.jpeg" style="width: 263px;">
 </div>
</div>Після цього на питаннях " <strong>Choose a number or apply filter</strong> " і " <strong>Choose org.apache.maven.archetypes:maven-archetype-quickstart version</strong> " просто натискаємо Enter. Далі вводимо ідентифікатори проекту, звані GAV (див. <a href="https://maven.apache.org/guides/mini/guide-naming-conventions.html" target="_blank" rel="nofollow">Naming Convention Guide</a> ). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="aafab6d5-dfaa-4a57-9394-1076741b42e8" data-max-width="424" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/aafab6d5-dfaa-4a57-9394-1076741b42e8/256.jpeg" style="width: 424px;">
 </div>
</div>Після успішного створення проекту побачимо напис "BUILD SUCCESS". Тепер ми можемо відкривати наш проект у улюбленій IDE. 
<h2>Додавання CDI у проект</h2>У вступі ми побачабо, що CDI має цікавий сайт — <a href="http://www.cdi-spec.org/" target="_blank" rel="nofollow">http://www.cdi-spec.org/</a> . Там є розділ download, у якому є таблиця, що містить потрібні нам дані: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="7fcebb02-e360-47a8-9ffb-024aa15a0e25" data-max-width="644" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/7fcebb02-e360-47a8-9ffb-024aa15a0e25/512.jpeg" style="width: 644px;">
 </div>
</div>Тут ми можемо побачити, як для Maven описується той факт, що ми використовуємо в проекті API для CDI. API - це application programming interface, тобто програмний інтерфейс. Ми працюємо з інтерфейсом, не переймаючись тим, що і як за цим інтерфейсом працює. API являє собою деякий jar архів, який ми почнемо використовувати у своєму проекті, тобто наш проект починає залежати від цього jar. Отже, CDI API для нашого проекту залежить залежність. У Maven проект описується у файлух POM.xml ( <strong>POM - Project Object Model</strong> ). Залежно описуються в блоці dependencies, в який нам і потрібно додати новий запис: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>javax<span class="token punctuation"><span class="token punctuation">.</span></span>enterprise<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>cdi<span class="token operator"><span class="token operator">-</span></span>api<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">2.0</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Як Ви могли помітити, ми не вказуємо scope із значенням provided. Чому така відмінність? Такий scope означає, що нам залежність надасть хтось. Коли програма працює на Java EE сервері, то це означає, що сервер надасть додатку всі необхідні JEE технології. Ми ж для простоти даного огляду будемо працювати в Java SE оточенні, отже нам ніхто не надасть цієї залежності. Докладніше про Dependency Scope можна прочитати тут: " <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope" target="_blank" rel="nofollow">Dependency Scope</a> ". Добре, у нас є можливість працювати з інтерфейсами. Але нам потрібна й реалізація. Як ми пам'ятаємо, ми будемо використовувати Weld. Цікаво, що всюди наводяться різні залежності. Але ми слідуватимемо документації. Тому, прочитаємо " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/environments.html#_setting_the_classpath" target="_blank" rel="nofollow">18.4.5. Setting the Classpath</a> " і зробимо як там сказано: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>jboss<span class="token punctuation"><span class="token punctuation">.</span></span>weld<span class="token punctuation"><span class="token punctuation">.</span></span>se<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>weld<span class="token operator"><span class="token operator">-</span></span>se<span class="token operator"><span class="token operator">-</span></span>core<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">3.0</span></span><span class="token number"><span class="token number">.5</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>Final<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Важливо, що версії Weld третьої лінійки підтримують CDI 2.0. Отже, ми можемо розраховувати на API цієї версії. Тепер ми готові до написання коду. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="198" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/620224a1-0d37-4e29-89a7-2b29def5a970/original.jpeg">
 </div>
</div>
<h2>Ініціалізація CDI контейнера</h2>CDI – це механізм. Цим механізмом хтось має керувати. Як ми вже прочитали вище, таким управляючим є контейнер. Отже, нам його потрібно створити, сам він у SE оточенні не з'явиться. Допишемо в наш main метод наступне: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">main</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> args<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">SeContainerInitializer</span></span> initializer <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">SeContainerInitializer</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">newInstance</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	initializer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addPackages</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">App</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPackage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">SeContainer</span></span> container <span class="token operator"><span class="token operator">=</span></span> initializer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">initialize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ми створабо CDI контейнер вручну. працюємо у SE оточенні. У звичайних бойових проектах код виконується на сервері, який надає коду різні технології. Відповідно, якщо сервер надає CDI, це означає, що на сервері вже є CDI контейнер і нам не потрібно буде нічого додавати. Але для цілей уроку ми візьмемо SE оточення. Крім того, контейнер він ось наочно і зрозуміло. Навіщо нам контейнер? Контейнер містить у собі біни (CDI beans). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="219" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/14a79670-707c-461b-8531-0d06821624a5/original.jpeg">
 </div>
</div>
<h2>CDI Beans</h2>Отже, біни. Що таке CDI бін? Це Java клас, який відповідає деяким правилам. Ці правила описані в специфікації, у розділі " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/beanscdi.html#_what_kinds_of_classes_are_beans" target="_blank" rel="nofollow">2.2. What kinds of classes are beans?</a> ". Давайте додамо CDI бін у той же пакет, де і клас App: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер ми зможемо викликати цей бін із нашого <code class=" language-none">main</code>методу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Logger</span></span> logger <span class="token operator"><span class="token operator">=</span></span> container<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Logger</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
logger<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Hello, World!"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Як видно, ми не створювали бін за допомогою ключового слова new. Ми попросабо у CDI контейнера: "CDI контейнер. Мені дуже потрібен екземпляр класу Logger, дай мені будь ласка". Такий спосіб називається " <u>Dependency lookup</u> ", тобто пошук залежності. А тепер давайте створимо новий клас: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">DateSource</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Date</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Примітивний клас, що повертає текстове подання дати. Давайте тепер додамо висновок дати повідомлення: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">DateSource</span></span> dateSource<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>dateSource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">" : "</span></span> <span class="token operator"><span class="token operator">+</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> З'явилася цікава інструкція @Inject. Як сказано у розділі " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/injection.html#_injection_points" target="_blank" rel="nofollow">4.1. Injection points</a> " документації cdi weld, з допомогою цієї інструкції ми визначаємо Injection Point. Російською це можна прочитати як "точки застосування". Вони використовуються контейнером CDI, щоб впроваджувати залежності в момент інстанціювання бінів. Як видно, ми не присвоюємо жодних значень полю dateSource (джерело дати). Причиною тому той факт, що CDI контейнер дозволяє всередині CDI бінів (тільки ті біни, які він сам інстанціював, тобто якими він керує) використовувати " <strong>Dependency Injection</strong> ". Це інший спосіб <strong>Inversion of Control</strong>, підходу, коли залежністю управляє хтось інший, а не ми явно створюємо об'єкти. Використання залежностей може бути виконане через метод, конструктор чи поле. Докладніше див. розділ специфікації CDI " <a href="http://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#injection" target="_blank" rel="nofollow">5.5. Dependency injection</a> ". Процедура визначення того, що потрібно впроваджувати, називається typesafe resolution, про що ми і повинні поговорити. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="241" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/7ac4299f-77df-43a3-9b22-717d59cde10d/original.jpeg">
 </div>
</div>
<h2>Дозвіл імені або Typesafe resolution</h2>Як тип впроваджуваного об'єкта використовується інтерфейс, а CDI контейнер сам визначає, яку реалізацію потрібно вибрати. Це корисно з багатьох причин, про які ми поговоримо. Отже, у нас є інтерфейс логера: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Він каже, що якщо ми маємо певний логер, ми можемо передати йому повідомлення і він виконає своє завдання — залогує. Як і куди, в даному випадку цікавити не буде. Створимо тепер реалізацію для логера: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">SystemOutLogger</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">DateSource</span></span> dateSource<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>message<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як видно, це логер, який пише в System.out. Прекрасно. Тепер, наш main метод відпрацює як і раніше. <code class=" language-none">Logger logger = container.select(Logger.class).get();</code> Цей рядок як і раніше отримає логер. І вся краса в тому, що нам достатньо знати інтерфейс, а про реалізацію вже думає за нас CDI контейнер. Припустимо, у нас з'являється друга реалізація, яка має відправляти лог кудись на віддалене сховище: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">NetworkLogger</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Send log message to remote log system"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Якщо зараз запустити наш код без змін, ми отримаємо помилку, т.к. CDI контейнер бачить в інтерфейсу дві реалізації і не може вибрати з них: <code class=" language-none">org.jboss.weld.exceptions.AmbiguousResolutionException: WELD-001335: Ambiguous dependencies for type Logger</code> Що ж робити? Існує кілька доступних варіацій. Найпростіший - анотація <a href="http://docs.jboss.org/cdi/api/2.0/javax/enterprise/inject/Vetoed.html" target="_blank" rel="nofollow">@Vetoed</a> нам CDI біном, щоб CDI контейнер не сприймав цей клас як CDI бін. Але є набагато цікавіший підхід. CDI бін може бути позначений як "альтернатива" за допомогою анотації <code class=" language-none">@Alternative</code>, описаної в розділі " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/injection.html#alternatives" target="_blank" rel="nofollow">4.7. Alternatives</a>" документації по Weld CDI. Що це означає? Це означає, що поки ми явно не скажемо, що потрібно використовувати його, він не буде обраний. Це альтернативний варіант бина. Позначимо бін NetworkLogger як @Alternative і ми побачимо, що код знову виконується і використовується SystemOutLogger Щоб увімкнути альтернативу у нас повинен з'явитися файл <strong>beans.xml</strong> .Може виникнути питання: <a href="https://stackoverflow.com/questions/13056336/cdi-beans-xml-where-do-i-put-you" target="_blank" rel="nofollow">beans.xml, where do I put you? </a>". Тому, розмістимо файл правильно: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="225" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/305f2a94-dcd0-4ede-9175-5333e4072acb/original.jpeg">
 </div>
</div>Як тільки у нас з'являється даний файл, то артефакт з нашим кодом називатиметься " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/ee.html#packaging-and-deployment" target="_blank" rel="nofollow">Explicit bean archive</a> ". Тепер у нас 2 окремі конфігурації: програмна і xml. Проблема в тому, що вони завантажуватимуть однакові дані. Наприклад, визначення бина DataSource буде завантажено 2 разу і за виконання наша програма впаде, т.к. CDI контейнер буде думати про них як про 2 окремі біни (хоча за фактом це один і той же клас, про який CDI контейнер дізнався двічі). Щоб це уникнути, є 2 варіанти: 
<ul>
 <li>прибрати рядок <code class=" language-none">initializer.addPackages(App.class.getPackage())</code>і додати вказівку альтернативи в xml файл:</li>
</ul>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">&lt;</span></span>beans
    xmlns<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span>
    xmlns<span class="token operator"><span class="token operator">:</span></span>xsi<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
    xsi<span class="token operator"><span class="token operator">:</span></span>schemaLocation<span class="token operator"><span class="token operator">=</span></span>"
        http<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>xmlns<span class="token punctuation"><span class="token punctuation">.</span></span>jcp<span class="token punctuation"><span class="token punctuation">.</span></span>org<span class="token operator"><span class="token operator">/</span></span>xml<span class="token operator"><span class="token operator">/</span></span>ns<span class="token operator"><span class="token operator">/</span></span>javaee
        http<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>xmlns<span class="token punctuation"><span class="token punctuation">.</span></span>jcp<span class="token punctuation"><span class="token punctuation">.</span></span>org<span class="token operator"><span class="token operator">/</span></span>xml<span class="token operator"><span class="token operator">/</span></span>ns<span class="token operator"><span class="token operator">/</span></span>javaee<span class="token operator"><span class="token operator">/</span></span>beans_1_1<span class="token punctuation"><span class="token punctuation">.</span></span>xsd"<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>alternatives<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
        <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">ru<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>NetworkLogger</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>alternatives<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>beans<span class="token operator"><span class="token operator">&gt;</span></span></code></pre>
<ul>
 <li>додати до кореневого елемента beans атрибут <code class=" language-none">bean-discovery-mode</code>зі значенням " <strong>none</strong> " і вказати альтернативу програмно:</li>
</ul>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java">initializer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addPackages</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">App</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPackage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
initializer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">selectAlternatives</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">NetworkLogger</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Таким чином, за допомогою альтернативи CDI контейнер може визначати, який бін вибрати. Цікаво, що якщо контейнер CDI знатиме кілька альтернатив для одного і того ж інтерфейсу, то ми можемо підказати йому, вказавши пріоритет за допомогою анотації <code class=" language-none">@Priority</code>(Починаючи з CDI 1.1). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="235" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/841638f3-0bc5-4e7e-bad9-0232c5025691/original.jpeg">
 </div>
</div>
<h2>Кваліфікатори</h2>Окремо варто обговорити таку річ, як кваліфікатори. Кваліфікатор вказується анотацією над біном та уточнюють пошук бина. А тепер докладніше. Цікаво, що будь-який CDI бін у будь-якому випадку має щонайменше один кваліфікатор — <code class=" language-none">@Any</code>. Якщо ми не вказуємо над біном НІ ОДИН кваліфікатор, тоді CDI контейнер сам додає до кваліфікатора <code class=" language-none">@Any</code>ще один кваліфікатор — <code class=" language-none">@Default</code>. Якщо ми хоч щось вкажемо (наприклад, явно вкажемо @Any), то кваліфікатор @Default автоматично не буде доданий. Але вся краса кваліфікаторів у тому, що можна робити свої кваліфікатори. Кваліфікатор майже нічим відрізняється від анотацій, т.к. по суті, це і є просто анотація, написана особливим чином. Наприклад, можна ввести Enum для типу протоколу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">enum</span></span> <span class="token class-name"><span class="token class-name">ProtocolType</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    HTTP<span class="token punctuation"><span class="token punctuation">,</span></span> HTTPS
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Далі можемо зробити кваліфікатор, який враховуватиме цей тип: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Qualifier</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Retention</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>RUNTIME<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Target</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>METHOD<span class="token punctuation"><span class="token punctuation">,</span></span> FIELD<span class="token punctuation"><span class="token punctuation">,</span></span> PARAMETER<span class="token punctuation"><span class="token punctuation">,</span></span> TYPE<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token annotation punctuation"><span class="token annotation punctuation">@interface</span></span> <span class="token class-name"><span class="token class-name">Protocol</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">ProtocolType</span></span> <span class="token function"><span class="token function">value</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Nonbinding</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">comment</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">default</span></span> <span class="token string"><span class="token string">""</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Варто зазначити, що поля, позначені як <code class=" language-none">@Nonbinding</code>впливають визначення кваліфікатора. Тепер треба зазначити кваліфікатор. Вказується він над типом біна (щоб CDI знав, як його визначити) та над Injection Point (з анотацією @Inject, щоб розуміти, який бін шукати для впровадження в цьому місці). Наприклад, ми можемо додати якийсь клас із кваліфікатором. Для простоти для цієї статті зробимо їх усередині NetworkLogger: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">Sender</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> data<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Protocol</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ProtocolType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>HTTP<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HTTPSender</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Sender</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> data<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sended via HTTP"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Protocol</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ProtocolType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>HTTPS<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">HTTPSSender</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Sender</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> data<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sended via HTTPS"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> І тоді коли виконуватимемо Inject, то ми вкажемо кваліфікатор, який впливатиме на те, який саме клас буде використаний: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Protocol</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ProtocolType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>HTTPS<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Sender</span></span> sender<span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Здорово, чи не так?) Здається, що гарно, але незрозуміло навіщо. А тепер подайте наступне: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Protocol</span></span> protocol <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Protocol</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Class</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token operator"><span class="token operator">?</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">Annotation</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">annotationType</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">Protocol</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
	<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ProtocolType</span></span> <span class="token function"><span class="token function">value</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token class-name"><span class="token class-name">String</span></span> value <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"HTTP"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">ProtocolType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">valueOf</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>value<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
container<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">NetworkLogger<span class="token punctuation"><span class="token punctuation">.</span></span>Sender</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> protocol<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">send</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Таким чином, ми можемо перевизначити отримання значення значення так, що воно може обчислюватися динамічно. Наприклад, воно може братися з якихось налаштувань. Тоді ми можемо змінювати реалізацію навіть на льоту, без перекомпілювання чи рестарту програми/сервера. Набагато цікавіше стає, чи не так? ) 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="147" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/47a55e8d-05e8-428d-9c01-49c02fd2042e/original.jpeg">
 </div>
</div>
<h2>Продюсери</h2>Ще однією корисною можливістю CDI є продюсери. Це спеціальні способи (вони відзначені спеціальною інструкцією), які викликаються, коли якийсь бін запитив використання залежності. Докладніше описано в документації, у розділі " <a href="http://docs.jboss.org/weld/reference/latest/en-US/html/beanscdi.html#_producer_methods" target="_blank" rel="nofollow">2.2.3. Producer methods</a> ". Найпростіший приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Produces</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Integer</span></span> <span class="token function"><span class="token function">getRandomNumber</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Random</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">nextInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер при Inject' в поля типу Integer буде викликаний даний метод і з нього буде отримано значення. Тут варто відразу розуміти, що коли ми бачимо ключове слово new, то треба відразу розуміти, що це не CDI бін. Тобто екземпляр класу Random не стане CDI біном лише тому, що він отриманий із чогось, що контролює CDI контейнер (в даному випадку продюсер). 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="245" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/236f2abd-bb45-486a-80d1-95809c8e356f/original.jpeg">
 </div>
</div>
<h2>Interceptors</h2>Інтерцептори - це такі перехоплювачі, що "вклинюються" в роботу. У CDI це зроблено зрозуміло. Погляньмо, як ми можемо зробити логування за допомогою інтерцепторів (або перехоплювачів). Спочатку нам потрібно описати прив'язку до інтерцептора. Як і багато чого, це робиться за допомогою анотацій: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Inherited</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@InterceptorBinding</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Target</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>TYPE<span class="token punctuation"><span class="token punctuation">,</span></span> METHOD<span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Retention</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>RUNTIME<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token annotation punctuation"><span class="token annotation punctuation">@interface</span></span> <span class="token class-name"><span class="token class-name">ConsoleLog</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут головне, що це прив'язка для інтерцептора ( <code class=" language-none">@InterceptorBinding</code>), яка успадковуватиметься при extends ( <code class=" language-none">@InterceptorBinding</code>). Тепер напишемо сам інтерцептор: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Interceptor</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@ConsoleLog</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LogInterceptor</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@AroundInvoke</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Object</span></span> <span class="token function"><span class="token function">log</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">InvocationContext</span></span> ic<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Invocation method: "</span></span> <span class="token operator"><span class="token operator">+</span></span> ic<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMethod</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> ic<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">proceed</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Докладніше про те, як пишуться інтерцептори, можна прочитати у прикладі зі специфікації: " <a href="http://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#_interceptor_example" target="_blank" rel="nofollow">1.3.6. Interceptor example</a> ". Ну, а нам залишилося тільки включити інерцептор. Для цього вказуємо інструкцію біндингу над виконуваним методом: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@ConsoleLog</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span></code></pre> І тепер дуже важлива деталь. Інтерцептори за замовчуванням вимкнені, і їх треба включати за аналогією до альтернатив. Наприклад, у файлі <strong>beans.xml</strong> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>interceptors<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">ru<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>LogInterceptor</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>interceptors<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Як бачите, досить просто. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="142" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/eabe4052-5ad1-4a13-abae-70d7aae641e4/original.jpeg">
 </div>
</div>
<h2>Event &amp; Observers</h2>CDI надає також модель подій і спостерігачів. Тут не так все очевидно, як із інтерцепторами. Отже, Event'ом у цьому випадку може бути абсолютно будь-який клас, для опису нічого особливого не треба. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LogEvent</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token class-name"><span class="token class-name">Date</span></span> date <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Date</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> date<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер подію має хтось чекати: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LogEventListener</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">logEvent</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token annotation punctuation"><span class="token annotation punctuation">@Observes</span></span> <span class="token class-name"><span class="token class-name">LogEvent</span></span> event<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Message Date: "</span></span> <span class="token operator"><span class="token operator">+</span></span> event<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут головне вказати інструкцію @Observes, яка вказує, що це не просто метод, а метод, який має бути викликаний як результат спостереження за подіями типу LogEvent. Ну і тепер нам потрібен той, хто спостерігатиме: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LogObserver</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Event</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">LogEvent</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> event<span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">observe</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">LogEvent</span></span> logEvent<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        event<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">fire</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>logEvent<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У нас є єдиний метод, який буде говорити контейнеру, що сталася подія Event для типу події LogEvent. Тепер залишилося лише використати спостерігач. Наприклад, у NetworkLogger ми можемо додати інжект нашого обсервера: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">LogObserver</span></span> observer<span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> А в методі print ми можемо повідомляти спостерігача про те, що ми маємо нову подію: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	observer<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">observe</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">LogEvent</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Тут важливо знати, що події можна обробляти в одному потоці та кількох. Для асинхронної обробки служить метод <code class=" language-none">.fireAsync</code>(замість .fire) та анотація <code class=" language-none">@ObservesAsync</code>(замість @Observes). Наприклад, якщо всі події виконуються в різних потоках, то якщо 1 потік впаде з Exception, інші зможуть виконати свою роботу для інших подій. Докладніше про події в CDI можна прочитати, як завжди, у специфікації, у розділі " <a href="http://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#events" target="_blank" rel="nofollow">10. Events</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="238" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/a3c5471e-d792-46c7-a313-8443518746bb/original.jpeg">
 </div>
</div>
<h2>Decorators</h2>Як ми бачабо вище, під крилом CDI зібрані різні патерни проектування. І ось ще один – декоратор. Це дуже цікава річ. Давайте поглянемо на такий клас: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Decorator</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">abstract</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">LoggerDecorator</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">String</span></span> ANSI_GREEN <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"\u001B[32m"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> ANSI_RESET <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"\u001B[0m"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Inject</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@Delegate</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Logger</span></span> delegate<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        delegate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">print</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ANSI_GREEN <span class="token operator"><span class="token operator">+</span></span> message <span class="token operator"><span class="token operator">+</span></span> ANSI_RESET<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Оголошуючи його декоратором, ми говоримо, що коли буде використана якась реалізація Logger то буде використовуватися ця "надбудова", яка знає справжню реалізацію, яка зберігається в полі delegate (т.к. воно позначене анотацією) <code class=" language-none">@Delegate</code>. Декоратори можуть бути асоційовані лише з CDI біном, який сам не є інтерцептором і не декоратором. Приклад можна побачити так само у специфікації: " <a href="http://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#_decorator_example" target="_blank" rel="nofollow">1.3.7. Decorator example</a> ". Декоратор, як і інтерцептор, треба вмикати. Наприклад, <strong>beans.xml</strong> : 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>decorators<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
	<span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">ru<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>LoggerDecorator</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>decorators<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Докладніше див. weld reference: " <a href="https://docs.jboss.org/weld/reference/latest/en-US/html/decorators.html" target="_blank" rel="nofollow">Chapter 10. Decorators</a> ". 
<h2>Життєвий цикл</h2>Біни мають свій життєвий цикл. Виглядає він приблизно так: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="fde8f34a-f8ab-4828-ab70-6cde128cc8d9" data-max-width="606" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/fde8f34a-f8ab-4828-ab70-6cde128cc8d9/512.jpeg" style="width: 606px;">
 </div>
</div>Як видно з картинки, ми маємо так звані lifecycle callbacks. Це інструкції, які скажуть CDI контейнеру викликати певні методи певному етапі життєвого циклу бина. Наприклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@PostConstruct</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Inited"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Такий метод буде викликати при інстанціюванні CDI контейнером. Аналогічно буде і з @PreDestroy при знищенні біну, коли він не потрібен. В абревіатурі CDI не дарма є буква C – Context. Біни в CDI є contextual, тобто їх життєвий цикл залежить від контексту, в якому вони існують всередині контейнера CDI. Щоб у цьому краще розбиратися, варто прочитати розділ специфікації " <a href="http://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#lifecycle" target="_blank" rel="nofollow">7. Lifecycle of contextual instances</a> ". Також варто знати, що є життєвий цикл і в самого контейнера, про що можна прочитати в " <a href="https://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#init_events" target="_blank" rel="nofollow">Container lifecycle events</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b9d0c027-5a02-42ae-98e9-f51dec4fa149" data-max-width="260" alt="Короткий екскурс у впровадження залежностей або" src="https://cdn.javarush.com/images/article/b9d0c027-5a02-42ae-98e9-f51dec4fa149/256.jpeg" style="width: 260px;">
 </div>
</div>
<h2>Разом</h2>Вище ми розглянули верхівку айсберга під назвою CDI. CDI є частиною JEE специфікації та використовується в JavaEE оточенні. Ті, хто використовують Spring використовують не CDI, а DI, тобто дещо різні специфікації. Але знаючи і розумію вищезгадане легко можна перебудуватися. Враховуючи, що Spring підтримує інструкції зі світу CDI (ті ж Inject). Додаткові матеріали: 
<ul>
 <li>" <a href="https://blog.akquinet.de/2017/01/04/dont-get-trapped-into-a-memory-leak-using-cdi-instance-injection/" target="_blank" rel="nofollow">DON'T GET TRAPPED INTO A MEMORY LEAK USING CDI INSTANCE INJECTION</a> "</li>
</ul> #Viacheslav