JPA Entities and DB Relationships
<p>----------------------------------------</p>
Доброго часу доби, колеги! Даний матеріал розрахований на тих, хто вже має уявлення про організацію баз даних (далі просто - "Database"), мінімальні знання про те, як працює Object-Relational Mapping (далі просто ), та його реалізація, такі
<p>----------------------------------------</p>
<h2>JPA Entities &amp;&amp; DB Relationships</h2>Доброго часу доби, колеги! 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="cd591fae-ea63-4de4-b17a-da505b9f42de" data-max-width="710" alt="JPA Entities and DB Relationships - 1" src="https://cdn.javarush.com/images/article/cd591fae-ea63-4de4-b17a-da505b9f42de/512.jpeg" style="width: 710px;">
 </div>
</div>Даний матеріал розрахований на тих, хто вже має уявлення про організацію баз даних (далі просто <a href="https://en.wikipedia.org/wiki/Database" target="_blank" rel="nofollow">DB</a> - "Database"), мінімальні знання про те, як працює Object-Relational Mapping (далі просто <a href="https://ru.wikipedia.org/wiki/ORM" target="_blank" rel="nofollow">ORM</a> ), та його реалізація, такі як <a href="https://en.wikipedia.org/wiki/Hibernate_(framework)" target="_blank" rel="nofollow">Hibernate / JPA</a> . Якщо ви не знайомі з цим, раджу почати з <a href="https://en.wikipedia.org/wiki/Java_Database_Connectivity" target="_blank" rel="nofollow">JDBC</a> і лише потім переходити до ORM-моделі. Я попередив, і відповідальність за вашу психіку після прочитання цієї статті без належної підготовки не несу! :) Почнемо розбиратися з усім по порядку. По-перше, ми трохи копнемо в теорію, зовсім чуйна. По-друге, ми розберемося як цей shit зробити у всіх улюблених Java. Також ми напишемо з вами проект-шпаргалку, який закріпить наше розуміння теми і послужить шаблоном <strong>ЯК</strong>треба робити<a href="https://en.wikipedia.org/wiki/Data_mapping" target="_blank" rel="nofollow"> mapping</a> . Отже, <em>Let's do it!</em>
<h3>What is Entity?</h3>Сутність ( <a href="https://www.ibm.com/support/knowledgecenter/en/SSWSR9_11.6.0/com.ibm.mdmhs.overview.doc/entityconcepts.html" target="_blank" rel="nofollow">Entity</a> ) - це якийсь об'єкт із реального життя (наприклад, машина), який має атрибути (двері, <a href="https://www.google.com.ua/search?q=%D0%BA%D0%BE%D0%BB%D1%91%D1%81%D0%B0&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwilw9anwfHdAhUHXSwKHfZTBqEQ_AUIDigB&amp;biw=1920&amp;bih=948#imgrc=7ZYC5HIpJy27dM:" target="_blank" rel="nofollow">КОЛЕСА</a> , двигун). DB Entity: у цьому випадку наша сутність зберігається у DB, все просто. Навіщо і як ми засунули машину в базу даних - розглянемо пізніше. 
<h3>What is DB Relationships?</h3>Давним давно, у тридев'ятому королівстві була створена <a href="https://en.wikipedia.org/wiki/Relational_database" target="_blank" rel="nofollow">реляційна DB</a> . У цьому DB дані представлялися як табличок. Але й <a href="https://www.google.com.ua/search?q=%D0%BE%D1%81%D0%B5%D0%BB+%D0%B8%D0%B7+%D1%88%D1%80%D0%B5%D0%BA%D0%B0&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwjdq_2du_HdAhXBDSwKHROqBtUQ_AUIDigB&amp;biw=1920&amp;bih=948#imgrc=r4mY9BxLSMRi8M:" target="_blank" rel="nofollow">ослу із Шрека</a> було зрозуміло, що треба було зробити механізм взаємозв'язку даних таблиць. У результаті з'явилося 4 DB <a href="https://www.lifewire.com/database-relationships-p2-1019758" target="_blank" rel="nofollow">відносини</a> : 
<ol>
 <li><a href="https://en.wikipedia.org/wiki/One-to-one_(data_model)" target="_blank" rel="nofollow">One-to-One</a></li>
 <li><a href="https://en.wikipedia.org/wiki/One-to-many_(data_model)" target="_blank" rel="nofollow">One-to-Many</a></li>
 <li><a href="https://en.wikipedia.org/wiki/One-to-many_(data_model)" target="_blank" rel="nofollow">Many-to-One</a></li>
 <li><a href="https://en.wikipedia.org/wiki/Many-to-many_(data_model)" target="_blank" rel="nofollow">Many-to-Many</a></li>
</ol> Якщо ви все це бачите вперше, попереджаю ще раз — далі буде гірше: подумайте про те, щоб піти погуляти. Всі ці відносини ми розберемо на прикладі і зрозуміємо різницю між ними. 
<h3>Horror Example</h3>У нас буде один проект у якого буде 5 branches: master, де буде опис проекту, і по 1 branch на кожну DB relationship. У кожній branch'e будуть SQL скрипти створення DB та її заповнення тестовими даними, плюс Entity клас з annotation mapping'ом. Також буде для кожної branch'і Hibernate config файл. Я буду використовувати <a href="http://www.h2database.com/html/main.html" target="_blank" rel="nofollow">H2</a> embeded DB для проекту, щоб не відволікатися на окремі моменти хмарних DB або зовнішніх DB. Перейшовши за посиланням, встановіть H2 DB собі на пилосос. Я опишу кожен крок на 1 branch'e, решта – лише ключові моменти. Наприкінці ми підіб'ємо підсумки. Поїхали. <a href="https://github.com/qThegamEp/ForCodeGymPublication2" target="_blank" rel="nofollow">Це</a> посилання на master branch мого проекту. 
<h3>One-to-One Relationship</h3>Посилання на branch <a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/OneToOne" target="_blank" rel="nofollow">тут</a> . 
<ol>
 <li>
  <p>Потрібно підключити H2 DB до нашого проекту. Тут необхідно підкреслити те, що нам необхідна Ultimate IDEA для зручної роботи з DB та іншими речами. Якщо вона вже у вас є тоді йдемо безпосередньо до підключення DB. Заходимо в tab Database і робимо як на скрині:</p><img data-id="29e56fe7-6f24-4adc-835c-0a02c75fc417" data-max-width="640" alt="JPA Entities and DB Relationships - 2" src="https://cdn.javarush.com/images/article/29e56fe7-6f24-4adc-835c-0a02c75fc417/512.jpeg" style="width: 640px;">
  <p>Далі переходимо до налаштувань DB. Ви можете ввести свої дані, і навіть свою СУБД, повторююсь, H2 DB я використовую для простоти.</p><img data-id="0bed5079-8413-491c-8f8b-503bee351bd9" data-max-width="1092" alt="JPA Entities and DB Relationships - 3" src="https://cdn.javarush.com/images/article/0bed5079-8413-491c-8f8b-503bee351bd9/1080.jpeg" style="width: 1092px;">
  <p>Далі налаштуємо схему. Цей крок не обов'язковий, але бажаний, якщо у вас кілька схем в DB.</p><img data-id="7efa67ac-5f4a-4cdc-ba72-6caab6778f5e" data-max-width="1092" alt="JPA Entities and DB Relationships - 4" src="https://cdn.javarush.com/images/article/7efa67ac-5f4a-4cdc-ba72-6caab6778f5e/1080.jpeg" style="width: 1092px;">
  <p></p>Застосовуємо налаштування, і в результаті у нас має вийти щось на кшталт цього:
  <p></p><img data-id="283319b6-3b5c-4724-a392-a3b9b37eab18" data-max-width="640" alt="JPA Entities and DB Relationships - 5" src="https://cdn.javarush.com/images/article/283319b6-3b5c-4724-a392-a3b9b37eab18/512.jpeg" style="width: 640px;"></li>
 <li>
  <p>Базу даних ми створабо і налаштували доступ до неї з IDEA. Тепер потрібно створити таблички в ній та заповнити якимись даними. Наприклад я візьму дві сутності: Author і Book. У книги може бути автор, може бути кілька авторів, а може й не бути. На цьому прикладі ми створимо усі види зв'язків. Але в цьому пункті - One-to-One relationship. Створимо відповідний скрипт, який <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToOne/src/main/resources/initDB.sql" target="_blank" rel="nofollow">створює DB Tables</a> :</p>
  <pre class=" line-numbers language-sql" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>BOOK<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>BOOK <span class="token punctuation">(</span>
  ID         <span class="token keyword">INTEGER</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  NAME       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  PRINT_YEAR <span class="token keyword">INTEGER</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>   <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> BOOK_PRIMARY_KEY <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>AUTHOR<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>AUTHOR <span class="token punctuation">(</span>
  ID          <span class="token keyword">INTEGER</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  FIRST_NAME  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  SECOND_NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  BOOK_ID     <span class="token keyword">INTEGER</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> AUTHOR_PRIMARY_KEY <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ID<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> BOOK_FOREIGN_KEY <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>BOOK_ID<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> BOOK <span class="token punctuation">(</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
  <p>І виконаємо його:</p><img data-id="98d9ceb7-8764-4ea2-af9d-77e5259a8d28" data-max-width="404" alt="JPA Entities and DB Relationships - 6" src="https://cdn.javarush.com/images/article/98d9ceb7-8764-4ea2-af9d-77e5259a8d28/256.jpeg" style="width: 404px;">
  <p>Результат виконання в консолі:</p><img data-id="280c810e-b996-4b8a-81d1-968a7fb34788" data-max-width="1894" alt="JPA Entities and DB Relationships - 7" src="https://cdn.javarush.com/images/article/280c810e-b996-4b8a-81d1-968a7fb34788/1080.jpeg" style="width: 1894px;">
  <p>Результат у DB:</p><img data-id="4cbd3b7f-8d63-4d35-a2ea-8d9bf4e8e34e" data-max-width="477" alt="JPA Entities and DB Relationships - 8" src="https://cdn.javarush.com/images/article/4cbd3b7f-8d63-4d35-a2ea-8d9bf4e8e34e/256.jpeg" style="width: 477px;"></li>
 <li>
  <p>Погляньмо на діаграму наших таблиць. Для цього ПКМ на нашу DB:</p><img data-id="e0364c77-10cd-4e72-b836-c2781a9e91f0" data-max-width="625" alt="JPA Entities and DB Relationships - 9" src="https://cdn.javarush.com/images/article/e0364c77-10cd-4e72-b836-c2781a9e91f0/512.jpeg" style="width: 625px;">
  <p>Результат:</p><img data-id="0916ef83-005f-401d-86e4-77d7457b6d1b" data-max-width="431" alt="JPA Entities and DB Relationships - 10" src="https://cdn.javarush.com/images/article/0916ef83-005f-401d-86e4-77d7457b6d1b/256.jpeg" style="width: 431px;">
  <p>На <a href="https://en.wikipedia.org/wiki/Unified_Modeling_Language" target="_blank" rel="nofollow">UML</a> діаграмі ми можемо бачити всі primary keys і foreign keys, також бачимо зв'язок наших таблиць.</p></li>
 <li>
  <p>Напишемо <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToOne/src/main/resources/populateDB.sql" target="_blank" rel="nofollow">скрипт який заповнює</a> нашу DB тестовими даними:</p>
  <pre class=" line-numbers language-sql" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>BOOK <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span> PRINT_YEAR<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'First book'</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Second book'</span><span class="token punctuation">,</span> <span class="token number">2011</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Third book'</span><span class="token punctuation">,</span> <span class="token number">2012</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">.</span>AUTHOR <span class="token punctuation">(</span>FIRST_NAME<span class="token punctuation">,</span> SECOND_NAME<span class="token punctuation">,</span> BOOK_ID<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'Pablo'</span><span class="token punctuation">,</span> <span class="token string">'Lambado'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Pazo'</span><span class="token punctuation">,</span> <span class="token string">'Zopa'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'Lika'</span><span class="token punctuation">,</span> <span class="token string">'Vika'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
  <p>Тобто, що виходить? One-to-One relationship потрібна тоді, коли сутність однієї таблиці пов'язана з однією сутністю іншої (або взагалі не пов'язана якщо NOT NULL прибрати у BOOK_ID). У нашому прикладі в однієї книжки ПОВИНЕН бути один автор. Ніяк інакше.</p></li>
 <li>
  <p>Тепер найцікавіше, як зв'язати Java клас із DB сутностями? Дуже просто. Створимо два класи Book та Author. На прикладі я розберу 1 клас і ключові поля зв'язку. Візьму за приклад <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToOne/src/main/java/com/qthegamep/forcodegympublication2/entity/Author.java" target="_blank" rel="nofollow">Author</a> клас:</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@DynamicInsert</span>
<span class="token annotation punctuation">@DynamicUpdate</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"AUTHOR"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Author</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ID"</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"FIRST_NAME"</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"SECOND_NAME"</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> secondName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"BOOK_ID"</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Book</span> book<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></li>
</ol> Розберемося по порядку: 
<ol>
 <li>Усі поля у класі повторюють атрибути DB сутності.</li>
 <li><a href="https://projectlombok.org/features/Data" target="_blank" rel="nofollow">@Data</a> (з <a href="https://projectlombok.org/" target="_blank" rel="nofollow">Lombok'a</a> ) каже, що для кожного поля буде створено геттер і сеттер, буде перевизначено equals, hashcode, і згенерований доString метод.</li>
 <li><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Entity.html" target="_blank" rel="nofollow">@Entity</a> каже, що цей клас - сутність і пов'язаний із сутністю DB.</li>
 <li><a href="https://docs.jboss.org/hibernate/orm/5.2/javadocs/org/hibernate/annotations/DynamicInsert.html" target="_blank" rel="nofollow">@DynamicInsert</a> і <a href="https://docs.jboss.org/hibernate/orm/5.3/javadocs/org/hibernate/annotations/DynamicUpdate.html" target="_blank" rel="nofollow">@DynamicUpdate</a> кажуть, що будуть виконуватися динамічні вставки та оновлення в DB. Це більш глибокі налаштування Hibernate, які стануть вам у нагоді, щоб у вас був ПРАВИЛЬНИЙ батчинг.</li>
 <li><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/Table.html" target="_blank" rel="nofollow">@Table</a> (name = "AUTHOR") пов'язує клас Book із таблицею DB AUTHOR.</li>
 <li><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/Id.html" target="_blank" rel="nofollow">@Id</a> каже, що це поле - primary key.</li>
 <li><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/GeneratedValue.html" target="_blank" rel="nofollow">@GeneratedValue</a> (strategy = GenerationType.IDENTITY) - стратегія генерації primary key.</li>
 <li><a href="https://docs.oracle.com/javaee/5/api/javax/persistence/Column.html" target="_blank" rel="nofollow">@Column</a> (name = "ID", nullable = false) пов'язує поле з атрибутом DB, і каже, що це поле DB може бути null. Це також корисно при генерації таблиць із сутностей. Зворотний процес, тому що ми зараз створюємо наш проект, це потрібно в тестових DB для Unit тестів.</li>
 <li><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/OneToOne.html" target="_blank" rel="nofollow">@OneToOne</a> каже, що це поле є полем відносини One-to-One.</li>
 <li><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/JoinColumn.html" target="_blank" rel="nofollow">@JoinColumn</a> (name = "BOOK_ID", unique = true, nullable = false) - буде створено стовпчик BOOK_ID, який є унікальним і not null.</li>
</ol>На звороті (у класі <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToOne/src/main/java/com/qthegamep/forcodegympublication2/entity/Book.java" target="_blank" rel="nofollow">Book</a> ) нам також потрібно зробити зв'язок One-to-One і вказати поле, по якому відбувається mapping. @OneToOne(mappedBy = "book") - в даному прикладі це поле book класу Author. JPA сам їх зв'яже. З першого погляду може здатися що тут каша з анотацій, але насправді це дуже зручно і з досвідом ви автоматично їх ставитимете, навіть не замислюючись. 
<ol>
 <li value="6">
  <p>Тепер налаштуємо Hibernate. Для цього створимо файл <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToOne/src/main/resources/hibernate.cfg.xml" target="_blank" rel="nofollow">hibernate.cfg.xml</a> :</p>
  <pre class=" line-numbers language-xml" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-xml"><span class="token prolog">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">hibernate-configuration</span> <span class="token name">PUBLIC</span>
        <span class="token string">"-//Hibernate/Hibernate Configuration DTD//EN"</span>
        <span class="token string">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hibernate-configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>session-factory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.dialect<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>org.hibernate.dialect.H2Dialect<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.connection.driver_class<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>org.h2.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.connection.url<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>jdbc:h2:~/db/onetoone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.connection.username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.connection.password<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.hbm2ddl.auto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.show_sql<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.format_sql<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.use_sql_comments<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.generate_statistics<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.jdbc.batch_size<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>50<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.jdbc.fetch_size<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>50<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.order_inserts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.order_updates<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hibernate.jdbc.batch_versioned_data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qthegamep.forcodegympublication2.entity.Book<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapping</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.qthegamep.forcodegympublication2.entity.Author<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>session-factory</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hibernate-configuration</span><span class="token punctuation">&gt;</span></span></code></pre></li>
</ol><a href="https://www.tutorialspoint.com/hibernate/hibernate_configuration.htm" target="_blank" rel="nofollow">Опис властивостей</a> : 
<ol>
 <li>hibernate.dialect — діалект СУБД, яку ми вибрали.</li>
 <li>hibernate.connection.driver_class - Driver клас нашої DB.</li>
 <li>hibernate.connection.url - utl нашої DB. Можна взяти з першого пункту, де налаштовували DB.</li>
 <li>hibernate.connection.username - ім'я користувача DB.</li>
 <li>hibernate.connection.password - пароль користувача DB.</li>
 <li>hibernate.hbm2ddl.auto - налаштування генерації таблиць. Якщо update, то не генерує, якщо вона вже створена, а лише оновлює її.</li>
 <li>hibernate.show_sql – чи показувати запити DB.</li>
 <li>hibernate.format_sql — чи форматувати запити DB. Якщо ні то вони будуть все в один рядок. Рекомендую вмикати.</li>
 <li>hibernate.use_sql_comments - Коментує запити DB. Якщо це Insert пише над запитом коментар що запит типу Insert.</li>
 <li>hibernate.generate_statistics – генерує логи. Рекомендую і рекомендую налаштувати логування по максимуму. Читання логів збільшить ваші шанси правильної роботи з ORM.</li>
 <li>hibernate.jdbc.batch_size - Максимальний розмір батча.</li>
 <li>hibernate.jdbc.fetch_size - Максимальний розмір фетчу.</li>
 <li>hibernate.order_inserts - дозволяє динамічні вставки.</li>
 <li>hibernate.order_updates - дозволяє динамічні оновлення.</li>
 <li>hibernate.jdbc.batch_versioned_data - дозволяє батчинг. Дивіться своєю СУБД: не всі це підтримують.</li>
 <li>mapping class – класи, які є нашими сутностями. Перелічувати треба все.</li>
</ol>
<ol>
 <li value="7">
  <p>Тепер у нас сутність має визначитися. Можемо це перевірити у persistence tab'і:</p><img data-max-width="142" alt="JPA Entities and DB Relationships - 11" src="https://cdn.javarush.com/images/article/4094f366-ca96-4568-9523-efbd252e0642/original.jpeg">
  <p>Результат:</p><img data-id="1e14e004-abb9-4789-b003-aaab47b47ffd" data-max-width="518" alt="JPA Entities and DB Relationships - 12" src="https://cdn.javarush.com/images/article/1e14e004-abb9-4789-b003-aaab47b47ffd/512.jpeg" style="width: 518px;"></li>
 <li>
  <p>Також нам потрібно налаштувати assign data:</p><img data-id="f522aba0-f862-4ea5-8481-bb5083dbdb3f" data-max-width="484" alt="JPA Entities and DB Relationships - 13" src="https://cdn.javarush.com/images/article/f522aba0-f862-4ea5-8481-bb5083dbdb3f/256.jpeg" style="width: 484px;"> <img data-id="31afdbb8-db4d-42a5-b6a7-70a207901ca3" data-max-width="489" alt="JPA Entities and DB Relationships - 14" src="https://cdn.javarush.com/images/article/31afdbb8-db4d-42a5-b6a7-70a207901ca3/256.jpeg" style="width: 489px;">
  <p>Підсумки: Ми зробабо One-to-One mapping. Матеріал є ознайомлювальним, деталі - у повідомленні.</p></li>
</ol>
<h3>One-to-Many Relationship</h3>Посилання на branch <a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/OneToMany" target="_blank" rel="nofollow">тут</a> . Код я більше не викладатиму в статті, тому що вона і так вже занадто велика. Весь код дивимось на GitHub'e. 
<ol>
 <li>
  <p>В результаті виконання <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToMany/src/main/resources/initDB.sql" target="_blank" rel="nofollow">скрипту, що ініціалізує,</a> у нас вийде наступне:</p><img data-id="52429633-2eea-4938-8eb5-39f9bc647e9c" data-max-width="496" alt="JPA Entities and DB Relationships - 15" src="https://cdn.javarush.com/images/article/52429633-2eea-4938-8eb5-39f9bc647e9c/256.jpeg" style="width: 496px;">
  <p>Чи відчуваєте різницю з попередньою таблицею?</p></li>
 <li>
  <p>Діаграма:</p><img data-id="f31cfd4d-6296-47a2-a8e4-eb3d5e3d919c" data-max-width="320" alt="JPA Entities and DB Relationships - 16" src="https://cdn.javarush.com/images/article/f31cfd4d-6296-47a2-a8e4-eb3d5e3d919c/256.jpeg" style="width: 320px;">
  <p>One-to-Many Relationship - у нас в одного автора може бути кілька книг. Лівою сутності відповідає одна чи кілька правої.</p></li>
 <li>
  <p>Відмінність у mapping'e буде в анотаціях та полях:</p>
  <p>В <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToMany/src/main/java/com/qthegamep/forcodegympublication2/entity/Author.java" target="_blank" rel="nofollow">Author</a> класу з'являється поле:</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> mappedBy <span class="token operator">=</span> <span class="token string">"author"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books<span class="token punctuation">;</span></code></pre>
  <p>Воно вже є сетом, оскільки ми можемо мати кілька книг. <a href="https://docs.oracle.com/javaee/6/api/javax/persistence/OneToMany.html" target="_blank" rel="nofollow">@OneToMany</a> говорить про тип відносини. FetchType.Lazy каже, що не потрібно нам підвантажувати весь список книг, якщо це не зазначено в запиті. Також слід сказати, що це поле НЕ МОЖНА додавати в toString, інакше підемо курити StackOverflowError. Про це у мене дбає мій улюблений Lombok:</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token annotation punctuation">@ToString</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token string">"books"</span><span class="token punctuation">)</span></code></pre>
  <p>У класі <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToMany/src/main/java/com/qthegamep/forcodegympublication2/entity/Book.java" target="_blank" rel="nofollow">Book</a> ми робимо зворотний зв'язок (Many-to-One):</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span>
<span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"AUTHOR_ID"</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Author</span> author<span class="token punctuation">;</span></code></pre>
  <p>Тут ми робимо висновок, що One-to-Many є дзеркальним відображенням Many-to-One і навпаки. Слід наголосити, що Hibernate нічого не знає про двонаправлені зв'язки. Для нього це два різні зв'язки: один в один бік, інший — у протилежний.</p></li>
 <li>
  <p>У <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/OneToMany/src/main/resources/hibernate.cfg.xml" target="_blank" rel="nofollow">hibernate.cfg.xml</a> особливо нічого не змінилося.</p></li>
 <li>
  <p>Persistence:</p><img data-id="2a3ea933-7f0a-4ea9-9a80-0e87c6b94f88" data-max-width="519" alt="JPA Entities and DB Relationships - 17" src="https://cdn.javarush.com/images/article/2a3ea933-7f0a-4ea9-9a80-0e87c6b94f88/512.jpeg" style="width: 519px;"></li>
</ol>
<h3>Many-to-One Relationship</h3>Оскільки Many-to-One є дзеркальним відображенням One-to-Many, відмінностей буде небагато. Посилання на branch <a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/ManyToOne" target="_blank" rel="nofollow">тут</a> . 
<ol>
 <li>
  <p>В результаті виконання <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToOne/src/main/resources/initDB.sql" target="_blank" rel="nofollow">скрипту, що ініціалізує,</a> отримаємо результат:</p><img data-id="90a025cd-2a46-4cba-84f7-4841fb78caab" data-max-width="494" alt="JPA Entities and DB Relationships - 18" src="https://cdn.javarush.com/images/article/90a025cd-2a46-4cba-84f7-4841fb78caab/256.jpeg" style="width: 494px;"></li>
 <li>
  <p>Діаграма:</p><img data-id="b4324a9d-e032-45af-aaa1-38af4ccdbe88" data-max-width="392" alt="JPA Entities and DB Relationships - 19" src="https://cdn.javarush.com/images/article/b4324a9d-e032-45af-aaa1-38af4ccdbe88/256.jpeg" style="width: 392px;"></li>
 <li>
  <p>Відмінність у mapping'e буде в анотаціях та полях:</p>
  <p>У класі <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToOne/src/main/java/com/qthegamep/forcodegympublication2/entity/Author.java" target="_blank" rel="nofollow">Author</a> більше немає сета, оскільки він перемістився до <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToOne/src/main/java/com/qthegamep/forcodegympublication2/entity/Book.java" target="_blank" rel="nofollow">Book</a> класу.</p></li>
 <li>
  <p><a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToOne/src/main/resources/hibernate.cfg.xml" target="_blank" rel="nofollow">hibernate.cfg.xml</a></p></li>
 <li>
  <p>Persistence:</p><img data-id="88d730a0-b441-4d95-af33-7008a85ad041" data-max-width="514" alt="JPA Entities and DB Relationships - 20" src="https://cdn.javarush.com/images/article/88d730a0-b441-4d95-af33-7008a85ad041/512.jpeg" style="width: 514px;"></li>
</ol>
<h3>Many-to-Many Relationship</h3>Перейдемо до найцікавішого відношення. Це відношення за всіма правилами пристойності та непристойності створюється через додаткову таблицю. Але ця таблиця не є сутністю. Цікаво, так? Погляньмо на цей shit. Посилання на branch <a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/ManyToMany" target="_blank" rel="nofollow">тут</a> . 
<ol>
 <li>
  <p>Подивіться на <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToMany/src/main/resources/initDB.sql" target="_blank" rel="nofollow">ініціалізуючий скрипт</a> , тут з'являється додаткова таблиця HAS. У нас виходить щось на зразок author-has-book.</p>
  <p>В результаті виконання скрипту ми отримаємо такі таблиці:</p><img data-id="e1c1d73a-0667-45b8-be7f-77ab338fd3e5" data-max-width="486" alt="JPA Entities and DB Relationships - 21" src="https://cdn.javarush.com/images/article/e1c1d73a-0667-45b8-be7f-77ab338fd3e5/256.jpeg" style="width: 486px;"></li>
 <li>
  <p>Діаграма:</p><img data-id="dc1ee1a9-b07b-4c53-a280-b1fa2dcbe968" data-max-width="524" alt="JPA Entities and DB Relationships - 22" src="https://cdn.javarush.com/images/article/dc1ee1a9-b07b-4c53-a280-b1fa2dcbe968/512.jpeg" style="width: 524px;">
  <p>У нашому прикладі виходить, що книга може бути багато автором, і автор може мати багато книг. Вони можуть перетинатися.</p></li>
 <li>
  <p>У класах mapping'a будуть присутні мережі в класах. Але, як я вже сказав, таблиця HAS це не сутність.</p>
  <p>Клас <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToMany/src/main/java/com/qthegamep/forcodegympublication2/entity/Author.java" target="_blank" rel="nofollow">Author</a> :</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@ManyToMany</span>
<span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"HAS"</span><span class="token punctuation">,</span>
        joinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"AUTHOR_ID"</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">"ID"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        inverseJoinColumns <span class="token operator">=</span> <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"BOOK_ID"</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">"ID"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> books<span class="token punctuation">;</span></code></pre>
  <p><a href="https://docs.oracle.com/javaee/6/api/javax/persistence/ManyToMany.html" target="_blank" rel="nofollow">@ ManyToMany</a> - вид відносини.</p>
  <p><a href="https://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html" target="_blank" rel="nofollow">@JoinTable</a> - саме і буде пов'язувати атрибут з додатковою таблицею HAS. У ній ми вказуємо два атрибути, які вказуватимуть на primary keys двох сутностей.</p>
  <p>Клас <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToMany/src/main/java/com/qthegamep/forcodegympublication2/entity/Book.java" target="_blank" rel="nofollow">Book</a> :</p>
  <pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> mappedBy <span class="token operator">=</span> <span class="token string">"books"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Author</span><span class="token punctuation">&gt;</span></span> authors<span class="token punctuation">;</span></code></pre>
  <p>Тут вказуємо FetchType і поле, яким будемо мапитися.</p></li>
 <li>
  <p>Наш <a href="https://github.com/qThegamEp/ForCodeGymPublication2/blob/ManyToMany/src/main/resources/hibernate.cfg.xml" target="_blank" rel="nofollow">hibernate.cfg.xml</a> знову-таки не зазнав змін (я не враховую те, що ми до кожної branch створювали нову DB).</p></li>
 <li>
  <p>Persistence:</p><img data-id="d2e93911-10b7-4963-935f-75c7cea4328e" data-max-width="516" alt="JPA Entities and DB Relationships - 23" src="https://cdn.javarush.com/images/article/d2e93911-10b7-4963-935f-75c7cea4328e/512.jpeg" style="width: 516px;"></li>
</ol>
<h3>Розбір польотів</h3>Отже, ми поверхово розглянули види DB relationships і розібралися, як їх реалізувати в ORM моделі. Ми написали тестовий проект, який демонструє всі зв'язки, і розібралися, як конфігувати hibernate/jpa. Фух. 
<h3>Корисні посилання</h3>
<ul>
 <li>Власне сам <a href="https://github.com/qThegamEp/ForCodeGymPublication2" target="_blank" rel="nofollow">проект</a></li>
 <li><a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/OneToOne" target="_blank" rel="nofollow">One-to-One</a> branch</li>
 <li><a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/OneToMany" target="_blank" rel="nofollow">One-to-Many</a> branch</li>
 <li><a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/ManyToOne" target="_blank" rel="nofollow">Many-to-One</a> branch</li>
 <li><a href="https://github.com/qThegamEp/ForCodeGymPublication2/tree/ManyToMany" target="_blank" rel="nofollow">Many-to-Many</a> branch</li>
 <li><a href="https://www.tech-recipes.com/rx/56738/one-to-one-one-to-many-table-relationships-in-sql-server/" target="_blank" rel="nofollow">Read it</a></li>
 <li><a href="https://code.tutsplus.com/articles/sql-for-beginners-part-3-database-relationships--net-8561" target="_blank" rel="nofollow">And read it</a></li>
</ul> Мої попередні статті: 
<ul>
 <li><a href="https://codegym.cc/groups/posts/594-continuous-integration" target="_blank" rel="nofollow">Continuous Integration</a></li>
 <li><a href="https://codegym.cc/groups/posts/602-codecov" target="_blank" rel="nofollow">Code Coverage</a></li>
 <li><a href="https://codegym.cc/groups/posts/612-markdown" target="_blank" rel="nofollow">Markdown</a></li>
</ul> PS Можуть бути помилки, ВІДЧИП'ЯТКИ в тексті. PPS Автор курив щось дивне під час написання цієї статті. Дякую за увагу!