Додаємо телеграм-бота на проект - "Java-проект від А до Я"
<p>----------------------------------------</p>
Вітаю вас, мої любі друзі. Так-так, саме друзі. Я вже так зрісся з цією серією статей, що ті люди, які регулярно пишуть у коментарях свою подяку та/або показують, що прочитали та зрозуміли матеріал, стали вже близькими. Ми з вами йдемо із д
<p>----------------------------------------</p>
Вітаю вас, мої любі друзі. Так-так, саме друзі. Я вже так зрісся з цією серією статей, що ті люди, які регулярно пишуть у коментарях свою подяку та/або показують, що прочитали та зрозуміли матеріал, стали вже близькими. Ми з вами йдемо із двох сторін до однієї мети. Ви хочете зрозуміти, а я хочу пояснити. І кінцева мета у нас одна - написана програма, яка зрозуміла вам від початку до кінця. Багато про те, що опишу в цій статті ви, можливо, вже чули. Не думаю, що я розповім щось нове та неординарне (але в рамках проекту знати/повторити це необхідно). <img data-max-width="800" data-id="05bf61f9-8d16-4258-8c1e-c6195f1fff2d" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 1" src="https://cdn.javarush.com/images/article/05bf61f9-8d16-4258-8c1e-c6195f1fff2d/800.jpeg" style="width: 800px;">Навесні я писав робота для себе, так що будемо спиратися на його "лекала".
<h2>Пишемо JRTB-2</h2>Робитимемо так само, як <a href="https://codegym.cc/groups/posts/3179-java-proekt-ot-a-do-ja-pishem-proekt-dobavljaem-springboot-i-nastraivaem-ci-process" target="_blank">робабо у статті</a> із завданням <a href="https://github.com/codegymcommunity/codegym-telegrambot/issues/12" rel="nofollow" target="_blank">JRTB-0</a> :
<ol>
 <li>Оновлюємо <span class="text-bold">main</span> гілку в локальному проекті через комбінацію <span class="text-bold">ctrl + t</span> .<img data-max-width="512" data-id="21abf665-94f2-4ad8-8553-a15267510a8e" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 2" src="https://cdn.javarush.com/images/article/21abf665-94f2-4ad8-8553-a15267510a8e/512.jpeg" style="width: 512px;"></li>
 <li>На основі main гілки створюємо:<img data-max-width="512" data-id="dbcaa295-a84a-4dd7-9fe2-67003405210d" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 3" src="https://cdn.javarush.com/images/article/dbcaa295-a84a-4dd7-9fe2-67003405210d/512.jpeg" style="width: 512px;"></li>
 <li>Додаємо бота.</li>
 <li>Створюємо новий коміт з описом зробленого та пушим на гітхаб.</li>
 <li>Створюємо пул-реквест на main гілку і ще раз перевіряємо. Чекаємо, щоб пройшов білд (github actions), мерже в мейн гілку.</li>
 <li>Закриваємо відповідне завдання.</li>
</ol>
<h2>Що таке телеграм-бот</h2>Ми, розробники, можемо подати роботу з телеграм-ботом так: ми використовуємо їх клієнт для роботи з ними. Ми маємо <a href="https://github.com/rubenlagus/TelegramBots" rel="nofollow" target="_blank">готову бібліотеку</a> для роботи. Є набір дій, після яких телеграм-бот знатиме, що він пов'язаний з нашою програмою. А вже всередині програми ми навчимося отримувати листи, команди та якось їх опрацьовувати. Є така річ як <span class="text-bold">команда в телеграм-ботах</span> : вона починається зі сліша "/". Після неї відразу разом пишемо слово, і це буде вважатися командою. Наприклад, є дві команди, які всі мають знати:
<ul>
 <li>/start - початок роботи з ботом;</li>
 <li>/ stop - кінець роботи з ботом.</li>
</ul>Решту ми зробимо самі. Відразу обмовлюся: ми робитимемо саме те й таким способом, яким навчився я. І в роботі з ботом я впевнений, що можна буде зробити краще. І якщо хтось захоче це зробити — я буду радий і всіляко підтримаю цей почин. <em>До речі, найперше, що було б круто, якби мені хтось пояснив, як запрограмувати опис команд через код, а не через налаштування бота в телеграмі. Цього я не навчився. </em> У нас на ресурсі є кілька статей, в яких є опис, як зробити елементарний бот: ми сьогодні зробимо щось схоже. Якщо будуть ще питання, рекомендую швидко пробігтися за <a href="https://codegym.cc/groups/posts/504-sozdanie-telegram-bota-na-java-ot-idei-do-deploja" target="_blank">цією</a> статтею.
<h2>Створюємо бота у BotFather</h2>Щоб підключити бота, спочатку потрібно створити. Телеграма має підхід — створення бота зі своїм унікальним ім'ям. До нього додаватиметься ще токен (великий рядок, який працює як пароль). Я вже створив бота для CodeGym - <span class="text-bold">@codegym_community_bot</span> . Цей робот ще пустий і нічого не вміє. Головне, щоб наприкінці імені було <span class="text-bold">_bot</span>. Щоб показати, як це зробити, я створю бота, на якому ми будемо тестувати наш функціонал. У термінах реальних проектів це буде test environment (тестове оточення). А наш основний буде prod environment (prod — production, тобто реальне оточення, на якому виконуватиметься проект). Звичайно, можна було б додати ще одне оточення — sandbox environment: спільну пісочницю, що змінюється більш доступно всім учасникам розробки. Але це лише ускладнить ситуацію на етапі створення проекту. Поки що створимо ще два боти для test та для sandbox оточення. Перший крок – створити (зареєструвати) бота у самому Телеграмі. Потрібно знайти бота: @BotFather та написати йому команду: <span class="text-bold">/newbot</span><img data-max-width="1080" data-id="da251e55-7d65-405d-8269-eae59ddec3fd" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 4" src="https://cdn.javarush.com/images/article/da251e55-7d65-405d-8269-eae59ddec3fd/1080.jpeg" style="width: 1080px;">Далі нас просять дати ім'я цьому роботу. Так як це бот для тестових завдань, то і ім'я у нього буде відповідне: <span class="text-bold">[TEST] JavarushBot</span><img data-max-width="1080" data-id="cf774e29-d1bd-45ac-be63-4eec1ace7c8b" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 5" src="https://cdn.javarush.com/images/article/cf774e29-d1bd-45ac-be63-4eec1ace7c8b/1080.jpeg" style="width: 1080px;"> Тепер настав час дати унікальне ім'я, за яким його завжди можна буде знайти - його username: <span class="text-bold">test_codegym_community</span><img data-max-width="1080" data-id="bc2012c9-a5fd-409c-9afb-d731c2498ba9" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 6" src="https://cdn.javarush.com/images/article/bc2012c9-a5fd-409c-9afb-d731c2498ba9/1080.jpeg" style="width: 1080px;"> Як я й говорив вище, потрібно додавати суфікс _bot для username, тому пишемо ще раз: <span class="text-bold">test_codegym_community_bot</span><img data-max-width="1080" data-id="fb211e24-7ad5-4826-93ac-131f48bec30b" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 7" src="https://cdn.javarush.com/images/article/fb211e24-7ad5-4826-93ac-131f48bec30b/1080.jpeg" style="width: 1080px;"> І все! Бот створено. Тепер за username і token його можна підключити до нашого проекту. Зрозуміло для безперебійної роботи тестового сервера я не виставлятиму token (по суті це пароль до доступу до бота) цього бота на загальний огляд.
<h2>Підключаємо робота в проект</h2>Ми не підключатимемо бібліотеку як завжди, а відразу скористаємося перевагами нашого скелета — SpringBoot. Він має таку річ, як Starter. Підключивши бібліотеку, за його допомогою можна дати знати SpringBoot'у, що ми хочемо налаштувати проект правильно. Якби ми пішли звичайним шляхом, який описаний у безлічі місць, нам би потрібно було десь створити конфігурацію, в якій було б щось таке: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">ApiContextInitializer</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TelegramBotsApi</span> telegramBotsApi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TelegramBotsApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  telegramBotsApi<span class="token punctuation">.</span><span class="token function">registerBot</span><span class="token punctuation">(</span><span class="token class-name">Bot</span><span class="token punctuation">.</span><span class="token function">getBot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TelegramApiRequestException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Тут створюється об'єкт, з якого можна встановити зв'язок з ботом. У нашому випадку стартер, який ми захочемо підключити, зробить усе за нас десь під капотом (це теж переклад часто використовуваної фрази в IT — under the hood). Ось посилання на <a href="https://github.com/rubenlagus/TelegramBots/tree/master/telegrambots-spring-boot-starter" rel="nofollow" target="_blank">цей стартер</a> . Відразу ж по файлу README.md видно, що це, навіщо і як його використовувати. Щоб його підключити, потрібно просто додати цю залежність до пам'ятника. І все :) Ось потрібна залежність: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>telegram<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>telegrambots<span class="token operator">-</span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">5.0</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span></code></pre> Додаємо її до нашого пам'ятника. Виносимо версію як належить і оновлюємо проект. <img data-max-width="800" data-id="f4f45c30-c562-4961-b5c7-c08d60352a05" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 8" src="https://cdn.javarush.com/images/article/f4f45c30-c562-4961-b5c7-c08d60352a05/800.jpeg" style="width: 800px;">Виходячи з опису, нам потрібно просто створити новий клас, успадкуватись від TelegramLongPollingBot і додати цей клас до Application Context нашого SpringBoot. <em>Application Context – це місце, де зберігаються створені об'єкти для роботи проекту. Щоб додати якийсь клас, потрібно використовувати одну з анотацій: @ Component, @ Service, @ Repository, @ Controller. Або інструкцію @Bean, якщо створюється через спосіб в конфігураційному класі (тобто в класі, який позначений інструкцією Configuration).</em> Я розумію, що все це поки що здається незрозумілим. Але коли ви почнете розумітися, побачите, що нічого складного там немає. Щоб швидко розібратися зі Spring Boot, раджу круту книжку Spring In Action 5th edition. Якщо буде бажання, я можу написати серію статей з цієї книги. Повертаємось назад. У пакеті, в якому лежить JavarushTelegramBotApplication, створюємо пакет <span class="text-bold">bot</span> , в якому лежатиме наш телеграм-бот. Ім'я у нього буде <span class="text-bold">CodeGymTelegramBot</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>bot</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>bots<span class="token punctuation">.</span></span><span class="token class-name">TelegramLongPollingBot</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Telegrambot for Javarush Community from Javarush community.
*/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavarushTelegramBot</span> <span class="token keyword">extends</span> <span class="token class-name">TelegramLongPollingBot</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdateReceived</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Цей клас був абстрактний і потрібно було реалізувати три методи. Поговоримо про них докладніше:
<ul>
 <li><span class="code">onUpdateReceived(Update update)</span> - це і є точка входу, куди надходитимуть повідомлення від користувачів. Звідси йтиме вся нова логіка;</li>
 <li><span class="code">getBotUsername()</span> — тут потрібно додати username нашого бота, до якого з'єднуватимемося;</li>
 <li><span class="code">getBotToken()</span> — а це відповідно токен бота.</li>
</ul>По суті це як логін та пароль до сайту. На даний момент ми не будемо явно записувати це значення. Це називається "захардкодити" (тобто прив'язати якесь приватне значення - як завжди, калька з англійської hard code). Так не варто робити. Ми підемо іншим шляхом – запишемо ці дані в <span class="code">application.properties</span> клас і звідси їх зчитуватимемо. Навіщо це потрібно? Потім, щоб при запуску програми, ми могли ці значення задати ззовні. Це гнучко, правильно. Йдемо у файл src/main/resources/application.properties. Там вигадаємо імена цим змінним. Файли з розширенням .properties зчитуються як структура ключ-значення з роздільником "=", кожна пара це окремий рядок. Тому я вигадав такі змінні:
<ul>
 <li><span class="code">bot.username</span> ;</li>
 <li><span class="code">bot.token</span> .</li>
</ul>Ось так це виглядатиме: <img data-max-width="512" data-id="f49789c6-3378-42d7-9da2-c7e7ec38b72c" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 9" src="https://cdn.javarush.com/images/article/f49789c6-3378-42d7-9da2-c7e7ec38b72c/512.jpeg" style="width: 512px;">У SpringBoot є відмінна анотація - @Value. Якщо її правильно використовувати, вона підтягне нам значення з application.properties файлу. Оновлюємо проект під це: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>bot</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>bots<span class="token punctuation">.</span></span><span class="token class-name">TelegramLongPollingBot</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Telegram bot for Javarush Community from Javarush community.
*/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavarushTelegramBot</span> <span class="token keyword">extends</span> <span class="token class-name">TelegramLongPollingBot</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${bot.username}"</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${bot.token}"</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdateReceived</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> username<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBotToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> token<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Видно, що ми передали в інструкцію значення змінної. І ось коли SpringBoot буде створювати об'єкт нашого робота, то і значення будуть взяті з пропертів (знову калька з англійської – properties). Ми вже майже мету. Потрібно зробити так, щоби бот щось відповідав. Тому оновимо метод <span class="code">onUpdateReceived</span> . Потрібно, щоб ми отримали повідомлення, яке прийшло до боту, і передали його назад. Так ми будемо знати, що робота працює. Для цього ми грубо та швидко напишемо те, що потрібно: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdateReceived</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">hasMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">String</span> message <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> chatId <span class="token operator">=</span> update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">SendMessage</span> sm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       sm<span class="token punctuation">.</span><span class="token function">setChatId</span><span class="token punctuation">(</span>chatId<span class="token punctuation">)</span><span class="token punctuation">;</span>
       sm<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token function">execute</span><span class="token punctuation">(</span>sm<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TelegramApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">//todo add logging to the project.</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Тут все гранично просто: ми перевіряємо, що повідомлення реально існує, тому витягуємо саме повідомлення ( <span class="code">message</span> ) і чат ( <span class="code">чатId</span> ), в якому йде листування. Далі ми створюємо об'єкт для відправлення повідомлення <span class="code">SendMessage</span> , передаємо в нього саме повідомлення і чат чата - тобто те, що відправити боту і куди. Цього нам уже вистачає. Далі запускаємо main метод у клас <span class="code">JavarushTelegramBotApplication</span> і шукаємо нашого бота в Телеграмі: <img data-max-width="1080" data-id="0e5175c2-2cea-4294-b6d8-2d7b42e5d0ec" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 10" src="https://cdn.javarush.com/images/article/0e5175c2-2cea-4294-b6d8-2d7b42e5d0ec/1080.jpeg" style="width: 1080px;">З логів бачимо, що бот запустився. Значить, настав час йти в Телеграм і написати боту: <img data-max-width="512" data-id="1bed4559-f9bf-43e5-b4b8-dcdd4eb4a2ed" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 11" src="https://cdn.javarush.com/images/article/1bed4559-f9bf-43e5-b4b8-dcdd4eb4a2ed/512.jpeg" style="width: 512px;">Натискаємо почати і нам відразу ж надходить відповідь: <img data-max-width="512" data-id="392c2361-b04e-411e-8750-44ff8ac05b56" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 12" src="https://cdn.javarush.com/images/article/392c2361-b04e-411e-8750-44ff8ac05b56/512.jpeg" style="width: 512px;">Напишемо ще якусь лабуду, щоб перевірити:<img data-max-width="512" data-id="42578b38-d572-40a1-8c58-b56c9848dba3" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 13" src="https://cdn.javarush.com/images/article/42578b38-d572-40a1-8c58-b56c9848dba3/512.jpeg" style="width: 512px;">І все, на цьому моменті можна сказати, що завдання наше JRTB-2 завершено. Тут поки що особливо тестів не напишеш, тож залишимо все як є. Далі потрібно створити новий комміт: <img data-max-width="512" data-id="fab24536-9f78-4d76-87aa-94662b19ad7b" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 14" src="https://cdn.javarush.com/images/article/fab24536-9f78-4d76-87aa-94662b19ad7b/512.jpeg" style="width: 512px;">Зверніть увагу на ім'я комміта: знову загострюю вашу увагу на цьому. Коміт спочатку містить ім'я завдання, а потім вже детальніший опис, що зроблено. Натискаємо <span class="text-bold">Commit and Push ...</span> і підтверджуємо, ще раз натиснувши <span class="text-bold">Push</span> : <img data-max-width="512" data-id="bb41a8e6-2dee-4b14-be36-460e23b60ace" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 15" src="https://cdn.javarush.com/images/article/bb41a8e6-2dee-4b14-be36-460e23b60ace/512.jpeg" style="width: 512px;">Переходимо в <a href="https://github.com/codegymcommunity/codegym-telegrambot" rel="nofollow" target="_blank">наш проект</a> . Як і раніше, GitHub вже побачив нову гілку та пропонує створити пул-реквест на main. Не чинимо опір і створюємо його: <img data-max-width="800" data-id="75880a98-5812-49e7-bc02-09d2d4fb5ff5" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 16" src="https://cdn.javarush.com/images/article/75880a98-5812-49e7-bc02-09d2d4fb5ff5/800.jpeg" style="width: 800px;">Вже як зазвичай вибрали лейбу, проект і призначабо її на мене. Наприкінці натискаємо Create Pull Request. Трохи зачекаємо, доки пройде білд — і все, пул-реквест готовий до злиття:<img data-max-width="800" data-id="f63be8c4-31ec-47fb-af9b-dc621e0f3489" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 17" src="https://cdn.javarush.com/images/article/f63be8c4-31ec-47fb-af9b-dc621e0f3489/800.jpeg" style="width: 800px;">
<h2>Версіонування</h2>Я якось упустив момент, що нам потрібно вести версіонування. Для цього зробимо ще кілька змін у нашій гілці. Заходимо назад до IDEA і дивимося на версію проекту у пам'ятнику: <img data-max-width="512" data-id="5637da0d-2fe8-4d59-8674-f1790d03a305" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 18" src="https://cdn.javarush.com/images/article/5637da0d-2fe8-4d59-8674-f1790d03a305/512.jpeg" style="width: 512px;">Варто версія <span class="text-bold">0.0.1-SNAPSHOT</span> . Це чергова версія. А ми почнемо з того, що оновлюватимемо версію проекту з кожним новим вирішеним завданням. Поки ми не вийшли в MVP, версія йтиме з суфіксом -SNAPSHOT. Якою буде схема версіонування? <span class="text-bold">XYZ-SNAPSHOT</span> Де:
<ul>
 <li>X - мажорне оновлення версії, часто містить проблеми зі зворотною сумісністю з попередньою версією;</li>
 <li>Y — невеликі зміни, повністю сумісні з попередньою версією;</li>
 <li>Z - лічильник дефектів, які ми знайшли і відремонтували.</li>
</ul>Тому у нас буде перша версія - <span class="text-bold">0.1.0-SNAPSHOT</span> - тобто, у нас не було ще мажорних оновлень, всього потроху, і ми ще не вийшли в MVP, тому є суфікс -SNAPSHOT. Змінюємо в пам'ятці цю справу: <img data-max-width="800" data-id="44e2a45c-6291-4fdf-bda5-042e6a7ba595" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 19" src="https://cdn.javarush.com/images/article/44e2a45c-6291-4fdf-bda5-042e6a7ba595/800.jpeg" style="width: 800px;">Йдемо у файл RELEASE_NOTES, де описуватимемо зміни проекту з кожною новою версією: <img data-max-width="800" data-id="138e13d9-499b-45d4-a2e7-e20d81cdf3a5" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 20" src="https://cdn.javarush.com/images/article/138e13d9-499b-45d4-a2e7-e20d81cdf3a5/800.jpeg" style="width: 800px;">Наш перший запис. Тепер при кожному наступному оновленні версії тут описуватимемо що саме сталося. Робимо коміт цієї справи, пишемо опис: <span class="text-bold">JRTB-2: updated project version and added to RELEASE_NOTES</span> Все точно так, як і раніше. Чекаємо, поки білд пройде, і ми зможемо смердити наші зміни. Тільки тут буде дещо інакше. Я хочу зробити так, щоб кожне завдання в main гілці було окремим коммітом, тому просто натиснути в пул-реквест<span class="text-bold">Merge pull request</span> нам не підійде. У гіті є опція git squash, яка збирає всі комміти на один і мержить. Вибираємо цю опцію: <img data-max-width="800" data-id="24112b77-07f4-4eb6-b649-5faf70bcf2d6" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 21" src="https://cdn.javarush.com/images/article/24112b77-07f4-4eb6-b649-5faf70bcf2d6/800.jpeg" style="width: 800px;">Натискаємо Squash and Merge, і нам пропонують ще відредагувати повідомлення, яке буде в результаті: <img data-max-width="800" data-id="a583cdfc-9d42-4f03-b956-feeda0294423" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 22" src="https://cdn.javarush.com/images/article/a583cdfc-9d42-4f03-b956-feeda0294423/800.jpeg" style="width: 800px;">Дуже зручно та головне, що потрібне. До речі, на бітбакеті такої фічі я не бачив = / Підтверджуємо мерж. Залишилася зовсім небагато - перекласти завдання в статус Done у нас у дошці, написати коментар з посиланням на пул-реквест і закрити його: <img data-max-width="800" data-id="d04861f7-8bc2-45c1-b589-6c9b328c2afb" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 23" src="https://cdn.javarush.com/images/article/d04861f7-8bc2-45c1-b589-6c9b328c2afb/800.jpeg" style="width: 800px;">Наша дошка тепер виглядає так:<img data-max-width="800" data-id="9a32e01a-6370-4fae-b8a5-ba7203aa5c89" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 24" src="https://cdn.javarush.com/images/article/9a32e01a-6370-4fae-b8a5-ba7203aa5c89/800.jpeg" style="width: 800px;">
<h2>Висновок</h2>Сьогодні ми крок за кроком створабо телеграм-бота та впровадабо його у наш SpringBoot проект. Робот працює, дає відповіді. Зробабо відразу ж доступ до даних робота через проперти. Далі більше: робитимемо великий шматок – виконувати <a href="https://github.com/codegymcommunity/codegym-telegrambot/issues/3" rel="nofollow" target="_blank">JRTB-3</a> – додавання Command Pattern для нашого проекту. Ох, ще один нюанс. Я ж казав, що не публікуватиму token, щоб ним не скористалися. Але так як я писав статтю вже ближче до півночі і після робочого дня, то вийшло, що я виклав-таки в репозиторій токен, що діє, а сказала мені про це GitGuardian в листі:<img data-max-width="512" data-id="573a85c7-ed5f-4f7a-84b4-daf515eedb33" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 25" src="https://cdn.javarush.com/images/article/573a85c7-ed5f-4f7a-84b4-daf515eedb33/512.jpeg" style="width: 512px;">Дякую їм за це! Що ж тепер робити? Видалити з гіта вже не вийде, тому що навіть якщо я накачу новий коміт вже без цього токена, він все одно залишиться в старому. А видаляти та відкочувати назад коміт я не хочу. Тому я пішов і деактивував токен у згаданого BotFather. Тепер токен є, але він уже недійсний. Підписуйтесь на <a href="https://github.com/romankh3" rel="nofollow" target="_blank">мій аккаунт гітхаб</a> , щоб раніше публікації статті побачити весь код по ній. Дякую всім за читання, до зустрічі.<a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="&quot;Java-проект від А до Я&quot;: додаємо телеграм-бота на проект - 26" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>