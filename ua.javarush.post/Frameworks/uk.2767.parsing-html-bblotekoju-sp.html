Парсинг html бібліотекою jsoup
<p>----------------------------------------</p>
Отже, ми хочемо отримати конкретну інформацію з сайту. Покроково розберемо, як це зробити. Для початку нам потрібно отримати об'єкт . Це уявлення нашої html сторінки. У Soup є кілька способів перетворити сайт на об'єкт . Soup сам підключаєт
<p>----------------------------------------</p>
Отже, ми хочемо отримати конкретну інформацію з сайту. Покроково розберемо, як це зробити. <img width="800" height="500" data-id="ada5448a-5249-41c0-9627-e3a3edf2c76f" alt="Парсинг html бібліотекою súp - 1" src="https://cdn.javarush.com/images/article/ada5448a-5249-41c0-9627-e3a3edf2c76f/1080.jpeg">Для початку нам потрібно отримати об'єкт <code class=" language-none">Document</code>. Це уявлення нашої html сторінки. У Soup є кілька способів перетворити сайт на об'єкт <code class=" language-none">Document</code>. <strong>Підключитись до сервера</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Document</span></span> document <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Jsoup</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">connect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"https://hh.ru/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Soup сам підключається до сайту. Цей спосіб найпростіший, але він годиться тільки для тестування. Є більш зручні та гнучкі http клієнти. Також майте на увазі, яким би http клієнтом ви не користувалися, додавайте в запит заголовок <code class=" language-none">User-Agent</code>із значенням наприклад <code class=" language-none">Chrome/81.0.4044.138</code>. За цим заголовком сервер визначає з якого пристрою ви підключабося. Без цього заголовка сервер вважає вас роботом і може забанити. <strong>З файлу</strong> ;
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">File</span></span> file <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">File</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"hh-test.html"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">Document</span></span> document <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Jsoup</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">parse</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"UTF-8"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"hh.ru"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Це основний спосіб отримання об'єкта <code class=" language-none">Document</code>. Останній аргумент <code class=" language-none">"hh.ru"</code>– базовий URI. Це потрібно для створення абсолютних посилань із відносних, які є на сайті. <strong>З рядка</strong>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">String</span></span> html <span class="token operator"><span class="token operator">=</span></span>
                <span class="token string"><span class="token string">"&lt;html&gt;                                                                       "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"    &lt;head&gt;                                                                   "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;title href=\"hh.ru/vacancy?home\"&gt;                                  "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            Работа в Москве, поиск персонала и публикация вакансий - hh.ru   "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;/title&gt;                                                             "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"    &lt;/head&gt;                                                                  "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"    &lt;body&gt;                                                                   "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;div class=\"header main\"&gt;                                          "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            &lt;h1&gt;Работа найдется для каждого&lt;/h1&gt;                             "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            &lt;div&gt;Поиск вакансий&lt;/div&gt;                                        "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;/div&gt;                                                               "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;div class=\"content\"&gt;                                              "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            &lt;div&gt;Вакансии дня&lt;/div&gt;                                          "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            &lt;div id=\"123\"&gt;Компании дня&lt;/div&gt;                               "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"            &lt;div&gt;Работа из дома&lt;/div&gt;                                        "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"        &lt;/div&gt;                                                               "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"    &lt;/body&gt;                                                                  "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"&lt;/html&gt;                                                                      "</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token class-name"><span class="token class-name">Document</span></span> document <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Jsoup</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">parse</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>html<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"hh.ru"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Далі я демонструватиму бібліотеку на цьому html, який представляє спрощений сайт. Основне завдання при парсингу - отримати потрібний тег <strong>. </strong>Робити ми це будемо за допомогою методу <code class=" language-none">select</code>. Зауважте, що він завжди повертає список тегів. Якщо теги не знайдені, список буде порожнім. В аргумент методу потрібно передати css селектор, яким шукаються теги. На селекторах я зупинюся докладніше, бо вся робота зводиться до написання правильного селектора. Зазвичай, нам потрібно скласти його так, щоб він повертав один тег. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> h1 <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"h1"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>h1<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати теги теги <code class=" language-none">h1</code> Висновок: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
&lt;h1&gt;Работа найдется для каждого&lt;/h1&gt;</code></pre>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> titleElem <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"head &gt; title"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати теги <code class=" language-none">title</code>. Знак <code class=" language-none">&gt;</code>вибирає теги, <code class=" language-none">title</code>вкладені в тег<code class=" language-none">head</code>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> divs <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"body &gt; div"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати теги <code class=" language-none">div</code>вкладені в<code class=" language-none">body</code>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> firstDiv <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"body &gt; div:nth-child(1)"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати перший тег <code class=" language-none">div</code>вкладений у <code class=" language-none">body</code>. Отримувати тег за порядковим номером поганий спосіб, тому що його становище на сайті може змінитися. Найкраще визначити тег за абсолютними параметрами. Такими параметрами є атрибути <code class=" language-none">class</code>та<code class=" language-none">id</code>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> contentElem <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"body &gt; div.content"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати тег <code class=" language-none">div</code>c класом "content", вкладений у<code class=" language-none">body</code>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> idElem <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"#123"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати теги c id "123" 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> divHeader <span class="token operator"><span class="token operator">=</span></span> document<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"body &gt; div.header.main :not(h1)"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Отримати теги <code class=" language-none">div</code>c класом "header" та "main", вкладені у <code class=" language-none">body</code>, але без тегів <code class=" language-none">h1</code> Висновок: 
<pre class=" language-none" tabindex="0"><code class=" language-none">
&lt;div&gt;
 Поиск вакансий
&lt;/div&gt;</code></pre><strong>Методи Elements</strong> Коли ми отримали список, <code class=" language-none">Elements</code>можна отримати дані з нього. Нагадаю, зазвичай селектором шукається один тег, тобто. у <code class=" language-none">Elements</code>має бути розмір 1. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">elements<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> кількість знайдених тегів 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">elements<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> отримати перший тег зі списку знайдених 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">elements<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">text</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> текст вкладений у тег 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">elements<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">attr</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"href"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> значення атрибуту "href" 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">elements<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">outerHtml</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> рядкове представлення тега Якщо вам потрібно швидко отримати селектор елемента - у браузері відкрийте панель розробника (f12), натисніть правою кнопкою елемент, "переглянути код", натисніть правою кнопкою тег, далі "Copy" "Copy selector". Такий селектор буде оптимальним, але для швидкого результату цілком підходить. <strong>Висновок</strong> Це основи роботи з бібліотекою Soup. Але цього цілком достатньо, щоб парсити сайти. Для впевненої роботи вам потрібна лише практика написання селекторів у реальних сайтах. Ps Ця бібліотека використовується для вирішення великого завдання на 38 рівні.<img width="800" height="500" data-id="a5f2979f-2492-41d2-ab93-775c4d21d101" alt="Парсинг html бібліотекою súp - 1" src="https://cdn.javarush.com/images/article/a5f2979f-2492-41d2-ab93-775c4d21d101/1080.jpeg"><a href="https://codegym.cc/welcome" target="_blank" rel="nofollow"><img width="800" height="500" data-id="05127839-f8fd-4bd8-9322-716da1f7ae8c" alt="Парсинг html бібліотекою súp - 3" src="https://cdn.javarush.com/images/article/05127839-f8fd-4bd8-9322-716da1f7ae8c/1080.jpeg"></a><strong></strong>