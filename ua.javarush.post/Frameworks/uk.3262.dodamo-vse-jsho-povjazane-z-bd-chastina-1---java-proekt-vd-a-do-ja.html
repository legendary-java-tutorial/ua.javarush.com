Додаємо все, що пов'язане із БД. (Частина 1) - "Java-проект від А до Я"
<p>----------------------------------------</p>
Крок за кроком ми йдемо до нашої мети. Сьогодні нам потрібно вирішити виконати багато завдань: Тому сідайте зручніше: буде лонгрід. Ми вже навчилися за допомогою docker та docker-compose. Це було нелегко, і тих, у кого це вдалося зробити, в
<p>----------------------------------------</p>
Крок за кроком ми йдемо до нашої мети. <img data-max-width="800" data-id="06c2b289-0c7f-4e27-ae5c-f7468f2359e7" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 1" src="https://cdn.javarush.com/images/article/06c2b289-0c7f-4e27-ae5c-f7468f2359e7/800.jpeg" style="width: 800px;">Сьогодні нам потрібно вирішити виконати багато завдань:
<ol>
 <li>Додати Flyway. Тут же налаштуємо розгортання БД для проекту.</li>
 <li>Додати схему БД.</li>
 <li>Додати шар репозиторію.</li>
 <li>Додати команду статистики бота.</li>
 <li>Написати тести, зрештою.</li>
</ol>Тому сідайте зручніше: буде лонгрід. Ми вже навчабося <span class="text-bold">деплоїти наш додаток</span> за допомогою docker та docker-compose. Це було нелегко, і тих, у кого це вдалося зробити, вітаю. Якщо будуть якісь питання щодо реалізації - можете подивитися на код у цьому <a href="https://t.me/romankh3/36" rel="nofollow" target="_blank">пулл-реквесті</a> .
<h2>Додаємо Flyway</h2>Щоб додати Flyway, потрібно мати базу даних, яку ми додамо як ще один сервіс у docker-compose. <a href="https://codegym.cc/groups/posts/3241-java-proekt-ot-a-do-ja-realizuem-razvertihvanie-prilozhenija" target="_blank">Минулого разу</a> я говорив, що в docker-compose є секція services, яка якраз і відповідає за додавання та управління якоюсь інфраструктурою — тобто набором додатків/баз даних/месенджерів тощо.
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Я вже говорив про те, <a href="https://codegym.cc/groups/posts/3157-java-proekt-ot-a-do-ja-springboot--flyway" target="_blank">що таке Flyway і як його додати до SpringBoot додаток</a> . Раджу освіжити інформацію у пам'яті перед прочитанням цієї статті. Також можна почитати <a href="https://github.com/codegymcommunity/springboot-flyway-demo/blob/master/README.md" rel="nofollow" target="_blank">README.md</a> файл проекту з демонстрацією статті про Flyway+SpringBoot.</td>
   </tr>
  </tbody>
 </table>
</div>Перше, що ми робимо – оновлюємо нашу main гілку в проекті (git pull) і створюємо нову з назвою нашого завдання – STEP_5_JRTB-1 (git checkout -b STEP_5_JRTB-1). Нагадаю: ми перейменували гілки, щоб відсортувати послідовність виконання завдань у проекті можна було лише за назвою. Це дозволить швидко переходити від одного кроку до іншого. Наразі можна спокійно працювати. Нам потрібно додати три залежності: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>flywaydb<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>flyway<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>runtime<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>jpa<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span></code></pre> Перша залежність відповідає за додавання до проекту FlyWay, друга додає нам можливість підключатися до MySQL бд. Третя – SpringBoot starter, який запускає всю магію використання БД у Spring. І ще додамо ломбок, щоб не писати гетери та сеттери: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>optional<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>optional<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span></code></pre> Тепер нам потрібна база для розробки. Ми будемо створювати її поки що ( <em>поки я краще не придумав</em> ) як окремий файл docker-compose і окремий файл для application.properties. Є така річ у розробці (і у Spring екосистемі зокрема) як профілі. Залежно від профілю запускаються різні налаштування для роботи. Думаю, у майбутньому ми об'єднаємо docker-compose в один файл і зробимо так, щоб для розробки запускалася лише одна база даних на тих налаштуваннях, які нам потрібні. На даний момент зробимо так:
<ol>
 <li>Створимо файл у корені проекту docker-compose-test.yml, у якому запускатиметься лише база даних із власними налаштуваннями.</li>
 <li>Створимо файл application-test.properties з налаштуваннями, які відповідають настройкам у файлі docker-compose-test.yml.</li>
</ol>Для роботи з MySQL я взяв офіційний образ з <a href="https://hub.docker.com/_/mysql" rel="nofollow" target="_blank">DockerHub</a> : <img data-max-width="512" data-id="637cbcf9-ec2c-4be2-b249-efa916a6bc33" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 2" src="https://cdn.javarush.com/images/article/637cbcf9-ec2c-4be2-b249-efa916a6bc33/512.jpeg" style="width: 512px;">Швидко перегорнувши, знайшов потрібні змінні: <span class="code">MYSQL_DATABASE</span> - ім'я БД <span class="code">MYSQL_USER</span> - ім'я користувача БД <span class="code">MYSQL_PASSWORD</span> - пароль користувача БД І те, як їх потрібно правильно записати: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">jrtb<span class="token operator">-</span>db<span class="token operator">:</span>
   image<span class="token operator">:</span> mysql
   restart<span class="token operator">:</span> always
   container_name<span class="token operator">:</span> dev<span class="token operator">-</span>jrtb<span class="token operator">-</span>db
   ports<span class="token operator">:</span>
     <span class="token operator">-</span> <span class="token string">"3306:3306"</span>
   environment<span class="token operator">:</span>
     MYSQL_DATABASE<span class="token operator">:</span> <span class="token string">"dev_jrtb_db"</span>
     MYSQL_USER<span class="token operator">:</span> root
     MYSQL_PASSWORD<span class="token operator">:</span> root</code></pre> Після цього створюю в корені проекту docker-compose-test.yml: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">version<span class="token operator">:</span> <span class="token string">'3.1'</span>

services<span class="token operator">:</span>
 jrtb<span class="token operator">-</span>db<span class="token operator">:</span>
   image<span class="token operator">:</span> mysql
   restart<span class="token operator">:</span> always
   container_name<span class="token operator">:</span> dev<span class="token operator">-</span>jrtb<span class="token operator">-</span>db
   ports<span class="token operator">:</span>
     <span class="token operator">-</span> <span class="token string">"3306:3306"</span>
   environment<span class="token operator">:</span>
     MYSQL_DATABASE<span class="token operator">:</span> <span class="token string">"dev_jrtb_db"</span>
     MYSQL_USER<span class="token operator">:</span> root
     MYSQL_PASSWORD<span class="token operator">:</span> root</code></pre> Щоб запустити цей файл для роботи з docker-compose, потрібно використовувати в запиті прапор <span class="text-bold">-f</span> . Це означає, що буде надано ім'я файлу, який запускається, а не взятий стандартний docker-compose.yml. Тому запит буде виглядати так: <span class="text-bold">docker-compose -f docker-compose-test.yml up -d</span> Виходить, спочатку ми говоримо, який взяти файл ( <span class="text-bold">-f docker-compose-test.yml</span> ), а потім говоримо, що потрібно підняти сервіси і зробити це в daemon режимі ( <span class="text-bold">up-d</span> ) - тобто так, щоб процес працював поза сесією терміналу, в якому цю команду запустабо. Запускаємо та пробуємо підключитися до БД, щоб переконатися, що вона піднялася і нею можна користуватися. Для цього відкриваємо знайомий нам MySQL Workbench (<a href="https://codegym.cc/groups/posts/2989-java-proekt-ot-a-do-ja-razbiraem-bazih-dannihkh-i-jazihk-sql-chastjh-4--proverka-domashnego-zad" target="_blank">ось тут ми говорабо про це</a> ) і створюємо нове з'єднання: <img data-max-width="800" data-id="820efb09-f50a-4162-98ec-d573b274c32d" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 3" src="https://cdn.javarush.com/images/article/820efb09-f50a-4162-98ec-d573b274c32d/800.jpeg" style="width: 800px;">Нам потрібно заповнити такі поля:
<ul>
 <li>Connection name - ім'я з'єднання - як варіант, DEV_JRTB_DB;</li>
 <li>Hostname — тут адресаа, на якій розгорнуто БД. У нашому випадку все залишиться, як і було: <span class="text-bold">127.0.0.1</span> , ну чи localhost;</li>
 <li>username – тут буде root, як у нас записано у docker-compose;</li>
 <li>password - також root.</li>
</ul>Після цього необхідно перевірити, чи буде з'єднання. Для цього натискаємо <span class="text-bold">Test Connection</span> : <img data-max-width="800" data-id="47bc0771-1f79-4780-bc13-8f5758e6a9b7" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 4" src="https://cdn.javarush.com/images/article/47bc0771-1f79-4780-bc13-8f5758e6a9b7/800.jpeg" style="width: 800px;">У результаті отримуємо: Failed to Connect to MySQL… Чому? Заходимо до терміналу і дивимося, що сталося з докер-контейнером. Напишемо в терміналі: <img data-max-width="800" data-id="39fa940e-9ff0-4ad6-b1ef-030decc04013" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 5" src="https://cdn.javarush.com/images/article/39fa940e-9ff0-4ad6-b1ef-030decc04013/800.jpeg" style="width: 800px;">Бачимо, що термінал створено 59 хвабон тому, а перезапуск був 55 секунд... чому? Незрозуміло, чи потрібно дивитися логи. Заходимо в терміналі в корінь проекту та запустити наступну команду: <span class="text-bold">docker-compose -f docker-compose-test.yml logs</span>
<details>
 <summary>Отримуємо:</summary>
 <p></p>
 <div class="terminal">
  dev-jrtb-db | 2021-02-28 10:14:28+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:28+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:28+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:28+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:29+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:29+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:29+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:30+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:30+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:30+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:30+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:32+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:32+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:32+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:32+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:34+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:34+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:34+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:37+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:37+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:37+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:37+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:44+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:44+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD dev-jrtb-db | 2021-02-28 10:14:58+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:58+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 10:14:58+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 10:14:58+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified dev-jrtb-db | You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD
 </div>
 <p></p>
</details> Тепер зрозуміло, що БД так і не запустилася із нашими налаштуваннями. Помилка одна і та ж, тому вичленуємо її з листа: 
<div class="terminal">
 2021-02-28 11:03:37+00:00 [ERROR] [Entrypoint]: Database не знижується і password option не specified dev-jrtb-db | Вам потрібна одна з MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD
</div> Тобто йому потрібно визначити пароль для root користувача – головного користувача. Добре, зараз ми оновимо наш файл: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">version<span class="token operator">:</span> <span class="token string">'3.1'</span>

services<span class="token operator">:</span>
 jrtb<span class="token operator">-</span>db<span class="token operator">:</span>
   image<span class="token operator">:</span> mysql
   restart<span class="token operator">:</span> always
   container_name<span class="token operator">:</span> dev<span class="token operator">-</span>jrtb<span class="token operator">-</span>db
   ports<span class="token operator">:</span>
     <span class="token operator">-</span> <span class="token string">"3306:3306"</span>
   environment<span class="token operator">:</span>
     MYSQL_DATABASE<span class="token operator">:</span> <span class="token string">"dev_jrtb_db"</span>
     MYSQL_ROOT_PASSWORD<span class="token operator">:</span> root</code></pre> Ми прибрали ті змінні за користувача та пароль та додали тільки пароль для рутовского користувача. Це означає, що для користувача root тепер буде пароль root. Принаймні ми так припускаємо. Зараз запустимо і подивимося, що буде: <span class="text-bold">docker-compose -f docker-compose-test.yml up -d</span> І одразу подивимося, що кажуть нам логі: <span class="text-bold">docker-compose -f docker-compose-test.yml logs</span>
<details>
 <summary>Дивимося:</summary>
 <p></p>
 <div class="terminal">
  Attaching to dev-jrtb-db dev-jrtb-db | 2021-02-28 11:20:40+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 11:20:41+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql' dev-jrtb-db | 2021-02-28 11:20:41+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.23-1debian10 started. dev-jrtb-db | 2021-02-28 11:20:41+00:00 [Note] [Entrypoint]: Initializing database files dev-jrtb-db | 2021-02-28T11:20:41.083803Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.23) initializing of server in progress as process 43 dev-jrtb-db | 2021-02-28T11:20:41.088457Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. dev-jrtb-db | 2021-02-28T11:20:41.447990Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. dev-jrtb-db | 2021-02-28T11:20:42.672093Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option. dev-jrtb-db | 2021-02-28 11:20:45+00:00 [Note] [Entrypoint]: Database files initialized dev-jrtb-db | 2021-02-28 11:20:45+00:00 [Note] [Entrypoint]: Starting temporary server dev-jrtb-db | 2021-02-28T11:20:45.893664Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.23) starting as process 88 dev-jrtb-db | 2021-02-28T11:20:45.921695Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. dev-jrtb-db | 2021-02-28T11:20:46.088339Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. dev-jrtb-db | 2021-02-28T11:20:46.207499Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: /var/run/mysqld/mysqlx.sock dev-jrtb-db | 2021-02-28T11:20:46.369170Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed. dev-jrtb-db | 2021-02-28T11:20:46.369357Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel. dev-jrtb-db | 2021-02-28T11:20:46.371501Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location '/var/run/mysqld' in the path is accessible to all OS users. Consider choosing a different directory. dev-jrtb-db | 2021-02-28T11:20:46.402227Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.23' socket: '/var/run/mysqld/mysqld.sock' port: 0 MySQL Community Server - GPL. dev-jrtb-db | 2021-02-28 11:20:46+00:00 [Note] [Entrypoint]: Temporary server started. dev-jrtb-db | Warning: Unable to load '/usr/share/zoneinfo/iso3166.tab' as time zone. Skipping it. dev-jrtb-db | Warning: Unable to load '/usr/share/zoneinfo/leap-seconds.list' as time zone. Skipping it. dev-jrtb-db | Warning: Unable to load '/usr/share/zoneinfo/zone.tab' as time zone. Skipping it. dev-jrtb-db | Warning: Unable to load '/usr/share/zoneinfo/zone1970.tab' as time zone. Skipping it. dev-jrtb-db | 2021-02-28 11:20:49+00:00 [Note] [Entrypoint]: Creating database dev_jrtb_db dev-jrtb-db | dev-jrtb-db | 2021-02-28 11:20:49+00:00 [Note] [Entrypoint]: Stopping temporary server dev-jrtb-db | 2021-02-28T11:20:49.187996Z 11 [System] [MY-013172] [Server] Received SHUTDOWN from user root. Shutting down mysqld (Version: 8.0.23). dev-jrtb-db | 2021-02-28T11:20:50.925075Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.0.23) MySQL Community Server - GPL. dev-jrtb-db | 2021-02-28 11:20:51+00:00 [Note] [Entrypoint]: Temporary server stopped dev-jrtb-db | dev-jrtb-db | 2021-02-28 11:20:51+00:00 [Note] [Entrypoint]: MySQL init process done. Ready for start up. dev-jrtb-db | dev-jrtb-db | 2021-02-28T11:20:51.420058Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.23) starting as process 1 dev-jrtb-db | 2021-02-28T11:20:51.427384Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. dev-jrtb-db | 2021-02-28T11:20:51.577244Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. dev-jrtb-db | 2021-02-28T11:20:51.677659Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: '::' port: 33060, socket: /var/run/mysqld/mysqlx.sock dev-jrtb-db | 2021-02-28T11:20:51.787156Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed. dev-jrtb-db | 2021-02-28T11:20:51.787325Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel. dev-jrtb-db | 2021-02-28T11:20:51.789742Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location '/var/run/mysqld' in the path is accessible to all OS users. Consider choosing a different directory. dev-jrtb-db | 2021-02-28T11:20:51.812100Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.23' socket: '/var/run/mysqld/mysqld.sock' port: 3306 MySQL Community Server - GPL.
 </div>
 <p></p>
</details> Помилок начебто вже немає, тому можна дивитися, чи буде доступ. Але, на жаль, доступу знову немає… Нічого: далі розбиратимемося! <img data-max-width="800" data-id="7ef67a2a-0954-4898-aa44-51c359ff5b2e" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 6" src="https://cdn.javarush.com/images/article/7ef67a2a-0954-4898-aa44-51c359ff5b2e/800.jpeg" style="width: 800px;">Щоб завершити роботу docker-compose та видалити всі контейнери, потрібно написати: <span class="text-bold">docker-compose -f docker-compose-test.yml down</span> Тут ми вказали файл, яким потрібно зробити видалення. Що робити? Будемо гуглити: може, комусь вдалося зробити краще. Найпростіший запит: “example of mysql in docker-compose” допомагає знайти <a href="https://medium.com/@chrischuck35/how-to-create-a-mysql-instance-with-docker-compose-1598f3cc1bee" rel="nofollow" target="_blank">посилання</a> на medium ресурс. Там наводять такий приклад: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">version<span class="token operator">:</span> <span class="token string">'3.3'</span>
services<span class="token operator">:</span>
 db<span class="token operator">:</span>
   image<span class="token operator">:</span> mysql<span class="token operator">:</span><span class="token number">5.7</span>
   restart<span class="token operator">:</span> always
   environment<span class="token operator">:</span>
     MYSQL_DATABASE<span class="token operator">:</span> <span class="token string">'db'</span>
     # <span class="token class-name">So</span> you don't have <span class="token keyword">to</span> <span class="token namespace">use</span> root<span class="token punctuation">,</span> but you can <span class="token keyword">if</span> you like
     MYSQL_USER<span class="token operator">:</span> <span class="token string">'user'</span>
     # <span class="token class-name">You</span> can use whatever password you like
     MYSQL_PASSWORD<span class="token operator">:</span> <span class="token string">'password'</span>
     # <span class="token class-name">Password</span> <span class="token keyword">for</span> root access
     MYSQL_ROOT_PASSWORD<span class="token operator">:</span> <span class="token string">'password'</span>
   ports<span class="token operator">:</span>
     # <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Port</span> exposed<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">MySQL</span> <span class="token class-name">Port</span> running inside container<span class="token punctuation">&gt;</span></span>
     <span class="token operator">-</span> <span class="token string">'3306:3306'</span>
   expose<span class="token operator">:</span>
     # <span class="token class-name">Opens</span> port <span class="token number">3306</span> on the container
     <span class="token operator">-</span> <span class="token string">'3306'</span>
     # <span class="token class-name">Where</span> our data will be persisted
   volumes<span class="token operator">:</span>
     <span class="token operator">-</span> my<span class="token operator">-</span>db<span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>mysql
# <span class="token class-name">Names</span> our volume
volumes<span class="token operator">:</span>
 my<span class="token operator">-</span>db<span class="token operator">:</span></code></pre> Адаптуємо його під наші потреби та отримуємо: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">version<span class="token operator">:</span> <span class="token string">'3.1'</span>

services<span class="token operator">:</span>
 jrtb<span class="token operator">-</span>db<span class="token operator">:</span>
   image<span class="token operator">:</span> mysql<span class="token operator">:</span><span class="token number">5.7</span>
   restart<span class="token operator">:</span> always
   environment<span class="token operator">:</span>
     MYSQL_DATABASE<span class="token operator">:</span> <span class="token string">'dev_jrtb_db'</span>
     # <span class="token class-name">So</span> you don't have <span class="token keyword">to</span> <span class="token namespace">use</span> root<span class="token punctuation">,</span> but you can <span class="token keyword">if</span> you like
     MYSQL_USER<span class="token operator">:</span> <span class="token string">'dev_jrtb_db_user'</span>
     # <span class="token class-name">You</span> can use whatever password you like
     MYSQL_PASSWORD<span class="token operator">:</span> <span class="token string">'dev_jrtb_db_password'</span>
     # <span class="token class-name">Password</span> <span class="token keyword">for</span> root access
     MYSQL_ROOT_PASSWORD<span class="token operator">:</span> <span class="token string">'root'</span>
   ports<span class="token operator">:</span>
     # <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Port</span> exposed<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token generics"><span class="token punctuation">&lt;</span> <span class="token class-name">MySQL</span> <span class="token class-name">Port</span> running inside container<span class="token punctuation">&gt;</span></span>
     <span class="token operator">-</span> <span class="token string">'3306:3306'</span>
   expose<span class="token operator">:</span>
       # <span class="token class-name">Opens</span> port <span class="token number">3306</span> on the container
       <span class="token operator">-</span> <span class="token string">'3306'</span></code></pre> Запускаємо цей варіант вже відомою командою: <span class="text-bold">docker-compose -f docker-compose-test.yml up -d</span> Намагаємося ще раз отримати доступ до бази даних через MySQLWorkBench: <img data-max-width="800" data-id="9ab2bfa8-7b30-41a4-9da3-343e992eee20" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 7" src="https://cdn.javarush.com/images/article/9ab2bfa8-7b30-41a4-9da3-343e992eee20/800.jpeg" style="width: 800px;">Нарешті з'явився доступ. Але тепер цікаво, що вплинуло на це. Я грішу на цю частину: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java">expose<span class="token operator">:</span>
   # <span class="token class-name">Opens</span> port <span class="token number">3306</span> on the container
   <span class="token operator">-</span> <span class="token string">'3306'</span></code></pre> Перевірити легко: без цього нічого не повинно працювати :D. Перевіримо: видалимо цю частину, перезапустимо docker-compose: <span class="text-bold">docker-compose -f docker-compose-test.yml down </span> <span class="text-bold">docker-compose -f docker-compose-test.yml up</span> Намагаємося зайти в БД через workbench: все зайшло. Тоді єдиний варіант – це версія БД. Тут чітко зазначено 5.7, тобто, якщо поміняти її на останню, не має працювати. Перезапустив — і справді не працює... <img data-max-width="800" data-id="9826a212-8d1e-4c5a-b625-d036508dfa8a" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 8" src="https://cdn.javarush.com/images/article/9826a212-8d1e-4c5a-b625-d036508dfa8a/800.jpeg" style="width: 800px;">Мабуть, якісь проблеми у них з докером на останній версії. Ну гаразд, не біда. Таке часто трапляється із безкоштовним програмним забезпеченням. Будемо використовувати версію 5.7. Подивимося, чи є база даних, яка нам потрібна – dev_jrtb_db. Для цього запустимо Query в MySQL Workbench команду <span class="text-bold">SHOW DATABASES</span> :<img data-max-width="800" data-id="f2a910b4-8e20-4d73-9926-a1b1003c4970" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 9" src="https://cdn.javarush.com/images/article/f2a910b4-8e20-4d73-9926-a1b1003c4970/800.jpeg" style="width: 800px;">Так, у висновку вона є. Добре, можна рухатися далі. Далі додамо нашу першу міграцію. На основі завдань зі статті <a href="https://codegym.cc/groups/posts/3170-java-proekt-ot-a-do-ja-planirovanie-proekta-semjh-raz-otmerjh--odin-raz-otrezhjh" target="_blank">"Планування проекту: сім разів відміряй - один раз відріж"</a> створимо нашу першу таблицю tg_user. Всі міграції будуть у папці <span class="text-bold">projectDir/src/main/resources/db/migration</span> , а ім'я буде таке: <span class="text-bold">V00001__add_tg_user_table.sql</span> . Чому саме в тій папці і таке ім'я описував у статті про Spring + flyway. Ось як виглядатиме наша перша міграція: <span class="text-bold">V00001__add_tg_user_table.sql:</span>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span> ensure that the table <span class="token keyword">with</span> <span class="token keyword">this</span> name is removed before creating a <span class="token keyword">new</span> one<span class="token punctuation">.</span>
DROP TABLE IF <span class="token class-name">EXISTS</span> tg_user<span class="token punctuation">;</span>

<span class="token operator">--</span> <span class="token class-name">Create</span> tg_user table
CREATE <span class="token class-name">TABLE</span> tg_user <span class="token punctuation">(</span>
   chat_id <span class="token function">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   active BOOLEAN
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> Тобто, тут просто ми створюємо таблицю користувача, який має лише ID-шник чату (унікальний елемент, який може бути використаний для роботи як ID у таблиці) та його стан — активний або неактивний. Так, у разі зупинки робота інформація про підписку залишиться, і її можна буде використовувати, якщо роботом знову захочуть скористатися. Іншої інформації про користувача поки що не потрібно. Тепер головне питання: а як це перевірити? Потрібно запустити наш додаток. Поки що в основному файлі docker-compose.yml немає зв'язку з БД, а ще нам потрібно навчитися налагоджувати додаток разом з базою даних. Тому запустимо програму з Intellij IDEA. Для перевірки цього нам потрібно буде запустити наш головний метод у JavarushTelegramBotApplication. Щоб розділити роботу з деплою та тестування, ми будемо використовувати інший файл із пропертями.<span class="text-bold">application-test.properties</span> . За допомогою цього шаблону ми даємо Spring'у зрозуміти, що цей файл використовуватиметься для профілю <span class="text-bold">test</span> . Коли ми не вказуємо профіль, використовується профіль за промовчанням (перевірте це в логах при запуску SpringBoot: у перших рядках про це буде написано). Ось так він виглядатиме: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"># <span class="token class-name">MySQL</span> configurations<span class="token operator">:</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>dev_jrtb_db
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>dev_jrtb_db_user
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span>dev_jrtb_db_password
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>

# <span class="token class-name">TelegramBot</span> configurations<span class="token operator">:</span>
bot<span class="token punctuation">.</span>username<span class="token operator">=</span>tes
bot<span class="token punctuation">.</span>token<span class="token operator">=</span><span class="token number">1375780501</span><span class="token operator">:</span><span class="token class-name">AAE4A6Rz0BSnIGzeu896OjQnjzsMEG6_uso</span></code></pre> А основний <span class="text-bold">application.properties</span> виглядатиме трохи інакше: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"># <span class="token class-name">MySQL</span> configurations<span class="token operator">:</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>jrtb<span class="token operator">-</span>db<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>jrtb_db
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>jrtb_db_user
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span>jrtb_db_password
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>

# <span class="token class-name">TelegramBot</span> configurations<span class="token operator">:</span>
bot<span class="token punctuation">.</span>username<span class="token operator">=</span>test<span class="token punctuation">.</span>codegym_community_bot
bot<span class="token punctuation">.</span>token<span class="token operator">=</span><span class="token number">1375780501</span><span class="token operator">:</span><span class="token class-name">AAE4A6Rz0BSnIGzeu896OjQnjzsMEG6_uso</span></code></pre> Істотна різниця знаходиться в полі <span class="code">spring.datasource.url:</span> у профілі test у нас URL на <span class="code">localhost</span> . Тобто очікується, що програма буде запускатися поза докером, що правда, тому що при налагодженні ми запускатимемо в Intellij IDEA наш проект і чекатимемо, що у нас буде доступ до БД з локальної машини. А ось в application.properties URL вже вказана інша — <span class="code">jrtb-db</span>. Це буде ім'я нашої бази даних у docker-compose, і таким чином наша програма в докері зможе достукатися до бази даних. Чому? Тому вони запустяться в рамках одного docker-compose і знатимуть один про одного таким чином. Це потрібно, щоб ми мали одну закриту інфраструктуру для проекту. Але як запустити профіль під час запуску? Для цього можна налаштувати запуск основного методу в Intellij IDEA. Для цього є <span class="text-bold">Edit Configurations</span> : переходимо в головний клас JavarushTelegramBotApplication, натискаємо на зелену стрілочку навпроти оголошення <span class="code">main</span> методу та вибираємо <span class="text-bold">Modify Run Configuration</span> :<img data-max-width="1080" data-id="861c00fc-01dc-4fb7-a1ec-77439b45d352" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 10" src="https://cdn.javarush.com/images/article/861c00fc-01dc-4fb7-a1ec-77439b45d352/1080.jpeg" style="width: 1080px;">Вводимо необхідні змінні та налаштовуємо профіль. У Intellij IDEA дещо змінився інтерфейс цього конфігураційного вікна, тому я раджу всім оновити IDEA до останньої версії, щоб ми бачабо однакову картинку: У полі Environment variables нам потрібно додати змінні імені та токена бота за таким шаблоном: ім'я1_переменной= <img data-max-width="800" data-id="29b8852c-716b-494f-b326-b4dac383e7a5" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 11" src="https://cdn.javarush.com/images/article/29b8852c-716b-494f-b326-b4dac383e7a5/800.jpeg" style="width: 800px;">значення1 <span class="text-bold">;</span> ім'я2_переменной <span class="code">=</span> . Тобто ключ = значення розділені крапкою з комою. У нашому випадку це буде так: <span class="text-bold">bot.token=1375780501:AAHLzsf4WhcjSdPguDwtggRS1IMu5l8;bot.username=codegym_community_bot</span> (у вас буде інше ім'я та токен для бота ) Далі вибираємо в кнопці <span class="text-bold">Modify options</span> поле <span class="text-bold">Add</span><img data-max-width="800" data-id="5d426bc7-7b8f-48c5-adf7-05d845c9f7dc" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 12" src="https://cdn.javarush.com/images/article/5d426bc7-7b8f-48c5-adf7-05d845c9f7dc/800.jpeg" style="width: 800px;"><span class="text-bold">-Dspring.profiles.active=test</span> - це скаже SpringBoot, що потрібно використовувати профіль test, а значить і проперти будуть взяті з application-test.properties. У результаті це буде виглядати так: <img data-max-width="800" data-id="95b48452-c42b-477c-a19a-c0cf3693a7b8" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 13" src="https://cdn.javarush.com/images/article/95b48452-c42b-477c-a19a-c0cf3693a7b8/800.jpeg" style="width: 800px;">Тепер запускаємо нашу тестову базу даних: <span class="text-bold">docker-compose -f docker-compose-test.yml up</span> Причому саме так, щоб без приставки -d, щоб у терміналі відразу було видно логи, якщо такі знадобляться. І останній крок – просто запустити main метод. Якщо ви зробите так само, як я описав, в результаті отримаєте: <img data-max-width="1080" data-id="d9efa03c-681e-44a0-9992-5adb79a8d1e4" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 14" src="https://cdn.javarush.com/images/article/d9efa03c-681e-44a0-9992-5adb79a8d1e4/1080.jpeg" style="width: 1080px;">Другим рядком логів буде опис, що запрацював test профіль. Заходимо через MySQLWorkbench і запускаємо дві команди, щоб перевірити, що міграція накотилася і все працює (хоча це і видно з логів запуску програми, але перевірити варто):
<ol>
 <li>use dev_jrtb_db;</li>
 <li>show tables;</li>
</ol>Результат: <img data-max-width="800" data-id="6f637044-3e19-4a19-ae02-87da5c5a1d55" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 15" src="https://cdn.javarush.com/images/article/6f637044-3e19-4a19-ae02-87da5c5a1d55/800.jpeg" style="width: 800px;">Як ми очікували, вийшло дві таблиці. Перша — технічна для обліку міграцій, друга наша таблиця для користувачів Телеграма. Все: Flyway разом з базою даних додано. Тепер нові міграції будуть йти як олією. Найскладніше - це перше налаштування та запуск процесу. <a href="https://codegym.cc/groups/posts/3264-java-proekt-ot-a-do-ja-dobavljaem-vse-chto-svjazano-s-bd-chastjh-2" target="_blank">Продовжуємо</a> - завершуємо роботу над цим глобальним завданням: додаємо бази даних у docker-compose.yml, додаємо Repository шар, статистику для робота, пишемо та оновлюємо тести та документацію.<a href="https://codegym.cc/login/signup" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="&quot;Java-проект від А до Я&quot;: Додаємо все, що пов'язане з БД.  Частина 1 - 15" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>