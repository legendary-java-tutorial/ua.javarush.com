Вступ до SpotBugs: інструмент для статичного аналізу коду
<p>----------------------------------------</p>
Розробники гостро потребують того, щоб хтось перевіряв їхній код. Особливо це стосується розробників-початківців. Але іноді перевірка чужого коду займає дуже багато часу, та й заняття це нудне. Однак ігнорувати цей аспект розробки не можна,
<p>----------------------------------------</p>
Розробники гостро потребують того, щоб хтось перевіряв їхній код. Особливо це стосується розробників-початківців. Але іноді перевірка чужого коду займає дуже багато часу, та й заняття це нудне. Однак ігнорувати цей аспект розробки не можна, адже він безпосередньо впливає на якість продукту та й на якість вас як розробника в цілому. <img data-max-width="800" data-id="a7cc2c65-0a1b-4677-abcb-89cd3e4f1681" alt="Вступ до SpotBugs: інструмент для статичного аналізу коду - 1" src="https://cdn.javarush.com/images/article/a7cc2c65-0a1b-4677-abcb-89cd3e4f1681/800.jpeg" style="width: 800px;">Тому рев'ю коду обов'язкова частина розробки. Щоб полегшити це завдання, використовуються різні засоби <span class="text-bold">статичного аналізу коду</span> . Про один із них ми поговоримо сьогодні. Для початку уточнимо один момент. У нас вже є Java-компілятор, який перевіряє код, то в чому ж його відмінність від статичного аналізу? <span class="text-bold">Статичний аналіз</span>перевіряє байт-код Java (компільовані файли з розширенням .class) на наявність шаблонних помилок, тоді як компілятор<span class="text-bold"> Java</span>лише перевіряє вихідний код наявність синтаксичних помилок. Такі засоби допомагають знаходити погані рішення, код, що не використовується, неефективні рішення, можливі помилки і т.д. Вони полегшують життя ревьюєрів коду і дозволяють відловлювати те, що вони можуть пропустити або не врахувати під час перевірки. Якщо ви зовсім новачок і ще не працюєте в компанії на проекті, дані інструменти вам будуть особливо корисні, оскільки вони будуть висвітлювати недоліки вашого коду, і ви їх підсвідомо запам'ятовуватимете, щоб у майбутньому не допускати повтору. Ну а згодом ви самі зможете стати крутим ревьюєром, оскільки миттєво помічатимете всі недоліки коду. Сьогодні проведемо невеликий огляд статичного аналізатора <span class="text-bold">SpotBugs</span> . <img data-max-width="512" data-id="b3842d00-0c9b-4ed5-be17-b381116a3219" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 2" src="https://cdn.javarush.com/images/article/b3842d00-0c9b-4ed5-be17-b381116a3219/512.jpeg" style="width: 512px;"><a href="https://spotbugs.github.io/" rel="nofollow" target="_blank">SpotBugs</a>- Це інструмент, який дозволяє досліджувати код для пошуку можливих проблем. Він здійснює статичний аналіз, переглядаючи код, щоб знайти певні <a href="https://codegym.cc/groups/posts/2622-chto-takoe-antipatternih-razbiraem-primerih-chastjh-1" target="_blank">антипатерни</a> , які можуть викликати проблеми (наприклад, низьку продуктивність). Інструмент, який виконує ці перевірки автоматично, при кожній зміні врятує код від поступового погіршення. Якщо не налаштувати цей процес, непомітно для всіх, якийсь момент може стати занадто пізно, адже код міститиме сотні попереджень.
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>Для коректної роботи SpotBugs необхідно використовувати Java версії 8 та вище.</td>
   </tr>
  </tbody>
 </table>
</div>Цей інструмент називають наступником (спадкоємцем) загальновідомого статичного аналізатора <a href="https://codegym.cc/groups/posts/1424-findbugs-pomogaet-uznatjh-java-luchshe" target="_blank">FindBugs</a> . <span class="text-bold">SpotBugs</span> можна в інтеграції з:
<ul>
 <li>Ant</li>
 <li>Maven</li>
 <li>Gradle</li>
 <li>Eclipse</li>
</ul>Також можливе використання через <a href="https://spotbugs.readthedocs.io/en/stable/installing.html" rel="nofollow" target="_blank">скачування та встановлення двійкового дистрибутива</a> . Ми з вами скористаємося підключенням через <a href="https://codegym.cc/groups/posts/3119-java-proekt-ot-a-do-ja-vse-chto-vih-khoteli-znatjh-o-maven" target="_blank">Maven</a> . Додаємо до Maven: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>spotbugs<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spotbugs<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.2</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
     <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>spotbugs<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spotbugs<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">4.2</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span></code></pre> Також у розділі плагінів додаємо: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>project<span class="token operator">-</span>info<span class="token operator">-</span>reports<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.8</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span></code></pre>
<h2>Основні команди SpotBugs</h2>Ну а тепер давайте розглянемо основні команди для SpotBugs, що викликаються або через консоль Мавена: <img data-max-width="1080" data-id="82b5df52-26a6-4184-a762-1c1efe364a67" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 3" src="https://cdn.javarush.com/images/article/82b5df52-26a6-4184-a762-1c1efe364a67/1080.jpeg" style="width: 1080px;">(щоб викликати консоль, потрібно натиснути на значок <span class="code"><span class="text-bold"><em>m</em></span></span> ), або через термінал idea:<img data-max-width="512" data-id="b6e696f1-4714-497a-957e-829b5ec8d5cd" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 4" src="https://cdn.javarush.com/images/article/b6e696f1-4714-497a-957e-829b5ec8d5cd/512.jpeg" style="width: 512px;">
<h3>1. mvn spotbugs:help</h3>Відображає довідкову інформацію для інтерфейсу користувача командного рядка <span class="text-bold">SpotBugs</span> . Приклад результату виклику: <img data-max-width="800" data-id="d62faf80-6339-4e95-a770-591f836e4b5e" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 5" src="https://cdn.javarush.com/images/article/d62faf80-6339-4e95-a770-591f836e4b5e/800.jpeg" style="width: 800px;">Як ми бачимо, якщо запустити команду: <span class="text-bold">mvn spotbugs:help -Ddetail=true -Dgoal=&lt;goal-name&gt;</span> можна дізнатися докладніше про налаштування мети. Або запустити: <span class="text-bold">mvn spotbugs:help -Ddetail=true</span> і дізнатися докладніше про всі чотири цілі. Наприклад, я запустив <span class="text-bold">mvn spotbugs:help -Ddetail=true -Dgoal=help</span> і отримав такий опис:<img data-max-width="800" data-id="f680c4d5-1068-41bb-ba26-8266b2c2ac29" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 6" src="https://cdn.javarush.com/images/article/f680c4d5-1068-41bb-ba26-8266b2c2ac29/800.jpeg" style="width: 800px;">
<h3>2. mvn spotbugs:check</h3>Ця команда запускає аналіз і повідомляє про невдалу збірку, якщо виявляє будь-які помилки зі спектру <span class="text-bold">spotbugs</span> . Приклад результату запуску команди: <img data-max-width="1080" data-id="2e5bdead-0074-4b5e-9afd-e0a0fb6660d3" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 7" src="https://cdn.javarush.com/images/article/2e5bdead-0074-4b5e-9afd-e0a0fb6660d3/1080.jpeg" style="width: 1080px;">Тут ми бачимо, як spotbugs лається на всі знайдені недоліки програми (знайдений поганий код).
<h3>3. mvn spotbugs:spotbugs</h3>Ця команда аналізує цільовий проект за допомогою SpotBugs. Без запуску цієї команди, команда відображення результатів практично буде марна, т.к. вона й здійснює сам аналіз. Після запуску цієї команди створюється файл <span class="text-bold">spotbugsXml.xml</span> , в якому лежать результати аналізу для подальшого відображення. Також слід зазначити, що запуск команди <span class="text-bold">mvn spotbugs: spotbugs</span> сам по собі нічого не дасть: спочатку потрібно запустити стандартну команду для компіляції проекту <span class="text-bold">mvn clean compile</span> , і тільки після неї команду для аналізу проекту. Попередня розглянута команда, <span class="text-bold">mvn spotbugs:check</span> , також аналізує та створює файл <span class="text-bold">spotbugsXml.xml</span> , але на відміну від <span class="text-bold">mvn spotbugs:spotbugs</span>вона ще показує результат аналізу на нижній панелі. Для аналізу таким шляхом також спершу потрібно запустити <span class="text-bold">mvn clean compile</span> , а потім — <span class="text-bold">mvn spotbugs:check</span> .
<h3>4. mvn spotbugs:gui</h3>Мабуть, ця команда найцікавіша: вона запускає графічний інтерфейс SpotBugs для перевірки результатів аналізу, в якому ви можете докладно розглянути, які недоліки є у вашому коді та де вони знаходяться. Але, як я згадав вище, для правильної відпрацювання цієї команди необхідний файл <span class="text-bold">spotbugsXml.xml</span> у папці <span class="text-bold">target</span> , який створюється після описаних вище маніпуляцій. При запуску цієї команди отримуємо наступне графічне відображення: <img data-max-width="1080" data-id="06b46836-ec18-4320-98c9-1421ca263ee9" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 8" src="https://cdn.javarush.com/images/article/06b46836-ec18-4320-98c9-1421ca263ee9/1080.jpeg" style="width: 1080px;">Тут ви можете налаштовувати фільтрацію на ім'я класу, групувати за категоріями поганого коду і так далі. Можливі недоліки поділяються на типи, які у свою чергу поділяються на докладні конкретні шаблони помилок (400+).
<h2>Типи помилок</h2>Давайте розглянемо докладніше можливі типи помилок:
<ul>
 <li>
  <p><span class="text-bold">Bad practice</span></p>
  <p>Порушення рекомендованої практики написання коду.</p></li>
 <li>
  <p><span class="text-bold">Correctness</span></p>
  <p>Ймовірна помилка коду, що призводить до того, що код відповідає задуму розробника. Допомагає досягти низького рівня хибних спрацьовувань.</p></li>
 <li>
  <p><span class="text-bold">Experimental</span></p>
  <p>Даний архетип описує експериментальні та не повністю перевірені шаблони помилок (довіряти зауваженням з даним типом помилки слід з великою обережністю).</p></li>
 <li>
  <p><span class="text-bold">Internationalization</span></p>
  <p>Тип визначає недоліки коду, пов'язані з інтернаціоналізацією та локалізацією.</p></li>
 <li>
  <p><span class="text-bold">Malicious code vulnerability</span></p>
  <p>Даний тип говорить про те, що ваш код вразливий для атак з боку ненадійного коду.</p></li>
 <li>
  <p><span class="text-bold">Multithreaded correctness</span></p>
  <p>Тип описує недоліки коду, пов'язані з потоками, блокуванням.</p></li>
 <li>
  <p><span class="text-bold">Bogus random noise</span></p>
  <p>Даний тип призначений для використання як контроль в експериментах з інтелектуального аналізу даних, а не для пошуку реальних помилок у програмному забезпеченні.</p></li>
 <li>
  <p><span class="text-bold">Performance</span></p>
  <p>Архетип говорить про те, що ваш код не обов'язково невірний, але може бути неефективним і потребує певної оптимізації.</p></li>
 <li>
  <p><span class="text-bold">Security</span></p>
  <p>Ймовірно, ви використовуєте ненадійний вхідний функціонал, у якого можуть бути уразливості, дірки у системи безпеки, допустимі для використання віддалено.</p></li>
 <li>
  <p><span class="text-bold">Dodgy code</span></p>
  <p>Під даний тип потрапляє код, який вводить в оману, є аномальним або написаний таким чином, що призводить до помилок.</p></li>
</ul>Повний докладний опис помилок ви можете знайти у <a href="https://spotbugs.readthedocs.io/en/stable/bugDescriptions.html" rel="nofollow" target="_blank">цій документації</a> .<img data-max-width="512" data-id="76bdf426-e681-48a6-9e6e-70b46954a469" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 9" src="https://cdn.javarush.com/images/article/76bdf426-e681-48a6-9e6e-70b46954a469/512.jpeg" style="width: 512px;">
<h2>Файли фільтрів</h2>Для вилову шаблонів "поганого коду" в <span class="text-bold">SpotBugs</span> використовуються фільтри. По суті, фільтр зіставляє екземпляри помилок по набору критеріїв. Власне, ви можете складати власні варіації шаблонів поганого коду, які потрібно відловити <span class="text-bold">SpotBugs</span> (створити кастомні файли фільтра). Також за допомогою даних файлів фільтрів можна задавати помилки, які потрібно виключати під час перевірки. Можливо, у вас у проекті щось вважатиметься хорошим рішенням, що за умовчанням фіксується в аналізаторі як погана практика. Файл фільтра — це XML-документ з <span class="text-bold">FindBugsFilter</span> елементом верхнього рівня, який має кілька дочірніх елементів <span class="text-bold">Match</span> . Кожен елемент <span class="text-bold">Match</span>є предикатом, який застосовується до згенерованих екземплярів помилок. Докладніше про створення файлу фільтра можна почитати <a href="https://spotbugs.readthedocs.io/en/stable/filter.html#introduction-to-filter-files" rel="nofollow" target="_blank">в цій документації</a> .<a href="https://codegym.cc/login/signup" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="Введення в SpotBugs: інструмент для статичного аналізу коду - 10" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>