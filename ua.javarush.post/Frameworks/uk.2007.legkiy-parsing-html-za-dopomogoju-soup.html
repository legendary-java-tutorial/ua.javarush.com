Легкий парсинг HTML за допомогою jsoup
<p>----------------------------------------</p>
Можливо, коли-небудь вам буде необхідно отримати інформацію з будь-якого сайту або HTML-документа у своєму додатку, і я без зайвих слів скажу, що використання бібліотеки soup спростить ваше завдання. Як мовиться на , súp - це Java-бібліотек
<p>----------------------------------------</p>
Можливо, коли-небудь вам буде необхідно отримати інформацію з будь-якого сайту або HTML-документа у своєму додатку, і я без зайвих слів скажу, що використання бібліотеки soup спростить ваше завдання. <img data-id="acb0dda6-fe7c-4c4a-b421-cc6d617bc46e" data-max-width="850" alt="" src="https://cdn.javarush.com/images/article/acb0dda6-fe7c-4c4a-b421-cc6d617bc46e/800.jpeg" style="width: 850px;">Як мовиться на <a href="https://en.wikipedia.org/wiki/Jsoup" target="_blank" rel="nofollow">wiki</a> , súp - це Java-бібліотека з відкритим вихідним кодом, призначена для аналізу, вилучення та управління даними, що зберігаються в документах HTML. 
<h2>Швидкий старт</h2>Бібліотеку можна завантажити у вигляді jar файлу та помістити в проект, а також підключити за допомогою Maven/Gradle. Посилання на офіційний сайт залишу наприкінці статті: там ви зможете знайти актуальну версію бібліотеки. У прикладі використовуватимемо підключення через Maven. Додамо залежність: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">&lt;</span></span>​dependency​<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token operator"><span class="token operator">&lt;</span></span>​groupId<span class="token operator"><span class="token operator">&gt;</span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>jsoup<span class="token operator"><span class="token operator">&lt;</span></span>​<span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token operator"><span class="token operator">&lt;</span></span>​artifactId<span class="token operator"><span class="token operator">&gt;</span></span>jsoup<span class="token operator"><span class="token operator">&lt;</span></span>​<span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token operator"><span class="token operator">&lt;</span></span>​version<span class="token operator"><span class="token operator">&gt;</span></span><span class="token number"><span class="token number">1.11</span></span><span class="token number"><span class="token number">.3</span></span><span class="token operator"><span class="token operator">&lt;</span></span>​<span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span>​<span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre>
<h2>Використання</h2>Насамперед вам необхідно отримати екземпляр класу <code class=" language-none">Document</code>з org.jsoup.nodes.Document із зазначенням на джерело для розбору. Їм може бути як локальний файл, і посилання. Для прикладу, в даній статті ми будемо використовувати сайт yandex.ru і спробуємо отримати їх актуальну стрічку новин: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Document</span></span> doc <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Jsoup</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">connect</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"https://yandex.ru/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">userAgent</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Chrome/4.0.249.0 Safari/532.5"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">referrer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"http://www.google.com"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
                <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre><code class=" language-none">User Agent</code>є ідентифікатором, який повідомляється відвідуваному сайту. На багатьох сайтах він є найважливішим критерієм для антиспам фільтра. <code class=" language-none">Referrer</code>містить URL-адресау запиту. Метод <code class=" language-none">get()</code>викликає оброблюваний виняток IOException, тому ми можемо обернути все в <code class=" language-none">try/catch</code>блок, або просто перекинути його далі за допомогою <code class=" language-none">throws</code>. На даний момент ми отримали вихідний код цієї сторінки. При необхідності бібліотека soup сама може відновити пошкоджені елементи. Тепер нам залишається лише звузити пошук до окремого блоку. Метод<code class=" language-none">select()</code>має велику вибірку у використанні: він дозволяє шукати елементи за тегом, атрибутами, класом та іншими параметрами. Багато сучасних браузери підтримують можливість швидкого пошуку вихідного коду обраного елемента. Нехитрими маніпуляціями ми знаходимо вихідний код потрібного нам елемента і отримуємо <code class=" language-none">div</code>блок із зазначеним класом, його ми і будемо використовувати для вибірки. <img data-id="05376f33-1c9f-40d0-b07c-202f7fbfc212" data-max-width="1008" alt="Легкий парсинг HTML за допомогою soup - 1" src="https://cdn.javarush.com/images/article/05376f33-1c9f-40d0-b07c-202f7fbfc212/800.jpeg" style="width: 1008px;">Скористайтеся класом <code class=" language-none">Elements</code>з org.jsoup.select.Elements для вибору всіх елементів з нашого вибраного блоку. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Elements</span></span> listNews <span class="token operator"><span class="token operator">=</span></span> doc<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"div#tabnews_newsc.content-tabs__items.content-tabs__items_active_true"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Зараз ми маємо щось на зразок цього: <img data-id="dd7a8edd-f791-49a9-8983-a8bf33f91a00" data-max-width="1453" alt="Легкий парсинг HTML за допомогою soup - 2" src="https://cdn.javarush.com/images/article/dd7a8edd-f791-49a9-8983-a8bf33f91a00/1080.jpeg" style="width: 1453px;">Тепер нам залишається лише використовувати невеликий цикл для пробору всіх елементів: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">for</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Element</span></span> element <span class="token operator"><span class="token operator">:</span></span> listNews<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"a"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
            <span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>element<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">text</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Метод <code class=" language-none">text()</code>дозволяє відкинути код розмітки та залишає лише поєднання тексту для всіх вхідних елементів. Результат виконання буде такий: <img data-id="5830d2a6-5677-4f39-a518-be52b1e724de" data-max-width="511" alt="Легкий парсинг HTML за допомогою soup - 3" src="https://cdn.javarush.com/images/article/5830d2a6-5677-4f39-a518-be52b1e724de/256.jpeg" style="width: 511px;">Неважко помітити, що реальна кількість отриманих рядків не відповідає фактичному відображенню на сторінці. У цьому й полягають підводні камені. Якщо подивитися вихідний код розмітки, можна помітити, що остання новина змінюється анімаційно з певним інтервалом часу. Частина таких "камінців" вирішується додатковою вибіркою, і тестами. Може виявитися так, що перші п'ять елементів будуть містити потрібну нам інформацію, а на шостому елементі буде лише порожній рядок, що заскриптується. Буває і таке, що блоки не володітимуть будь-якими ідентифікаторами, тоді є можливість прямо вказати за допомогою методу<code class=" language-none">get(int index)</code>на номер позиції елемента, що розглядається. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">System</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>out<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">println</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>listNews<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">select</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"a"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">text</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre>
<h2>Висновок</h2>У цьому прикладі показана лише мала частина того, на що здатний soup. Не варто скасовувати той факт, що сайти нерідко оновлюються, змінюючи структуру коду розмітки, так що при роботі з парсингом потрібно бути готовим адаптуватися до змін. Більше інформації та актуальну версію ви можете отримати на офіційному сайті <a href="https://jsoup.org/" target="_blank" rel="nofollow">soup.org</a> , детальніше почитати про класи та методи можна за посиланням <a href="https://o7planning.org/ru/10399/jsoup-java-html-parser-tutorial" target="_blank" rel="nofollow">o7planning.org</a> . Залишу посилання на мій <a href="https://github.com/Pianzin?tab=repositories" target="_blank" rel="nofollow">github</a> , на момент написання статті там знаходиться кілька Telegram-ботів, які використовують Soup для отримання та видачі інформації.