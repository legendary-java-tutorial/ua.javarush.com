Збереження файлів у додаток та даних про них на БД
<p>----------------------------------------</p>
Давай уявімо, що ти працюєш над своїм веб-додатком. У своїх статтях я розглядаю окремі шматочки цієї мозаїки, як-от: Чим ці теми корисні? А тим, що ці приклади дуже близькі до роботи над реальними проектами, і промацати ці теми буде дуже ко
<p>----------------------------------------</p>
<img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 1" src="https://cdn.javarush.com/images/article/7684bcd1-f565-4884-89ac-a26df969e65a/original.jpeg"> Давай уявімо, що ти працюєш над своїм веб-додатком. У своїх статтях я розглядаю окремі шматочки цієї мозаїки, як-от: 
<ul>
 <li><a href="https://codegym.cc/groups/posts/2414-integracionnoe-testirovanie-bd-s-pomojshjhju-mariadb-dlja-podmenih-mysql" target="_blank">Інтеграційне тестування БД за допомогою MariaDB для заміни MySql</a></li>
 <li><a href="https://codegym.cc/groups/posts/2436-realizacija-muljhtijazihchnosti-prilozhenija" target="_blank">Реалізація мультимовності програми</a></li>
</ul>Чим ці теми корисні? А тим, що ці приклади дуже близькі до роботи над реальними проектами, і промацати ці теми буде дуже корисним для тебе. Сьогодні ми візьмемо наступний шматочок даної мозаїки - роботу з файлуми, тому що в наш час вже й не зустріти сайту, який не взаємодіє з ними (наприклад, всякі там веб-шопи, соцмережі і так далі). Огляд буде проводитись на прикладі методів <span class="text-bold">upload/download/delete</span> , зберігати ми будемо в папку (в resource) у нашому додатку, щоб не ускладнювати. <img data-max-width="450" alt="Збереження файлів у додаток та даних про них на БД - 2" src="https://cdn.javarush.com/images/article/1579a969-bdf3-4aa3-8753-7bd460c2b045/original.jpeg">Задум полягає в тому, що ми зберігатимемо, крім самого файлу в нашому так званому file storage (сховищі), сутність з інформацією про наш файл (size, name і т.д.) у нашу БД — попередньо створену таблицю. Тобто при завантаженні файлу нам ця сутність дуже знадобиться, та й при delete про неї не можна жодним чином забувати. Пробіжимось поглядом по цій таблиці: <img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 3" src="https://cdn.javarush.com/images/article/8b53c204-7815-4d69-8a45-10052b705e0e/original.jpeg">І давайте вже як дорослі поставимо на id AUTO_INCREMENT, для автогенерування індефікатора на рівні БД. Спочатку поглянемо на нашу структуру: <img data-max-width="300" alt="Збереження файлів у додаток та даних про них на БД - 4" src="https://cdn.javarush.com/images/article/6de35712-07fe-4d4f-afed-88ba27358494/original.jpeg">Сутність під продемонстровану вище таблицю: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>toBuilder <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Getter</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@ToString</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> size<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> key<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">LocalDate</span></span> uploadDate<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h2>Upload</h2>Дивимося контролер: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@RestController</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@RequestMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/file"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">FileController</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">FileService</span></span> fileService<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@PostMapping</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">FileInfo</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token annotation punctuation"><span class="token annotation punctuation">@RequestParam</span></span> <span class="token class-name"><span class="token class-name">MultipartFile</span></span> attachment<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>attachment<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">HttpStatus</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>CREATED<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpStatus</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>BAD_REQUEST<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> З цікавого: 9 - Приймаємо файл у вигляді <code class=" language-none">MultipartFile</code>. Можна приймати і у вигляді масиву байтів, але цей варіант мені подобається більше, тому що ми можемо <code class=" language-none">MultipartFile</code>витягувати різні властивості переданого файлу. 10 - 14 - обертаємо наші дії в <code class=" language-none">try catch</code>, щоб якщо на нижчому рівні виникне виняток, ми його прокинули вище та відправабо 400 помилку відповіддю. Далі рівень сервісу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">FileService</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">MultipartFile</span></span> resource<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Дивимося реалізацію: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">FileServiceImpl</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">FileService</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">FileDAO</span></span> fileDAO<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">FileManager</span></span> fileManager<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Transactional</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rollbackFor <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">MultipartFile</span></span> resource<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">String</span></span> key <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">generateKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">FileInfo</span></span> createdFile <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getOriginalFilename</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">key</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>key<span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       createdFile <span class="token operator"><span class="token operator">=</span></span> fileDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">create</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>createdFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       fileManager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token keyword"><span class="token keyword">return</span></span> createdFile<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 8 - у разі падіння IOException, всі наші збереження в БД відкотяться. 11 - генеруємо ключ, який буде унікальним для файлу, коли він буде збережений (навіть якщо будуть сейвитися два файли з однаковими іменами, плутанини не виникне). 12 - будуємо сутність для збереження у БД. 17 - заганяємо суть з інформацією в БД. 18 — зберігаємо файл із хешованим ім'ям. 20 - повертаємо створену сутність <code class=" language-none">FileInfo</code>, але зі згенерованим id в БД (про це піде трохи нижче) і датою створення. Метод генерації ключа до файлу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">generateKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">DigestUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">md5Hex</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">+</span></span> <span class="token class-name"><span class="token class-name">LocalDateTime</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">now</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут ми хешуємо ім'я + дата створення, що забезпечить нам унікальність. Інтерфейс dao шару: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">FileDAO</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">create</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">FileInfo</span></span> file<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Його імплементація: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Repository</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">FileDAOImpl</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">FileDAO</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> CREATE_FILE <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"INSERT INTO files_info(file_name, file_size, file_key, upload_date) VALUES (?, ?, ?, ?)"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">JdbcTemplate</span></span> jdbcTemplate<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">create</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> file<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">LocalDate</span></span> uploadDate <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">LocalDate</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">now</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">GeneratedKeyHolder</span></span> keyHolder <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">GeneratedKeyHolder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       jdbcTemplate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>x <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token class-name"><span class="token class-name">PreparedStatement</span></span> preparedStatement <span class="token operator"><span class="token operator">=</span></span> x<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">prepareStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>CREATE_FILE<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Statement</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>RETURN_GENERATED_KEYS<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           preparedStatement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           preparedStatement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setLong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           preparedStatement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           preparedStatement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">4</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Date</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">valueOf</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>uploadDate<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
           <span class="token keyword"><span class="token keyword">return</span></span> preparedStatement<span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> keyHolder<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

       <span class="token keyword"><span class="token keyword">return</span></span> file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toBuilder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">id</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>keyHolder<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">longValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">uploadDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>uploadDate<span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 11 - створюємо дату яку і збережемо. 12 - 21 - зберігаємо сутність, але більш складним шляхом, з явним створенням об'єкта <code class=" language-none">PreparedStatement</code>, щоб можна було витягнути згенерований id (він його витягує не окремим запитом, а у вигляді метаданих у відповідь). 22 - 26 - добудовуємо нашу багатостраждальну сутність і віддаємо нагору (насправді він його не добудовує, а створює новий об'єкт, заповнюючи передані поля та копіюючи решту з початкового). Давайте подивимося, як будуть зберігатися наші файли в <code class=" language-none">FileManager</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">byte</span></span><span class="token punctuation"><span class="token punctuation">[</span></span><span class="token punctuation"><span class="token punctuation">]</span></span> resource<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> keyName<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">Path</span></span> path <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Paths</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DIRECTORY_PATH<span class="token punctuation"><span class="token punctuation">,</span></span> keyName<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Path</span></span> file <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>path<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">FileOutputStream</span></span> stream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       stream <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileOutputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       stream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">write</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">finally</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       stream<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 1 - приймаємо файл у вигляді масиву байтів та окремо ім'я, під яким він буде збережений (наш згенерований ключ). 2 - 3 - створюємо шлях (а в дорозі прописуємо шлях плюс наш ключ) та файл по ньому. 6 - 7 - створюємо потік і пишемо туди наші байти (і обертаємо це все добро <code class=" language-none">try-finally</code>щоб бути впевненими, що потік точно закриється). Тим не менш, багато методів можуть нам викинути IOException. У такому разі, завдяки прописаному в шапці методу прокидання, ми прокинемо його в контролер і надамо 400 статус. Давайте протестуємо всю цю справу в Postman: <img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 5" src="https://cdn.javarush.com/images/article/5de83ca8-5179-4f19-8b5a-fe45b25b9859/original.jpeg">Як бачимо, все відмінно, відповідь 201, відповідь JSON прийшов у вигляді нашої сутності, що зберігається в БД, і якщо заглянемо в наше сховище: БД: <img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 6" src="https://cdn.javarush.com/images/article/881e3d68-6f40-44e5-b6d6-bae453bcdd26/original.jpeg">побачимо, що у нас з'явилося нове значення. (=*;*=) 
<h2>Download</h2>Controller: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>path <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"/{id}"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> produces <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">MediaType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>APPLICATION_OCTET_STREAM_VALUE<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Resource</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token annotation punctuation"><span class="token annotation punctuation">@PathVariable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">FileInfo</span></span> foundFile <span class="token operator"><span class="token operator">=</span></span> fileService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">Resource</span></span> resource <span class="token operator"><span class="token operator">=</span></span> fileService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>foundFile<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">ok</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">header</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Content-Disposition"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"attachment; filename="</span></span> <span class="token operator"><span class="token operator">+</span></span> foundFile<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">body</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpStatus</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>NOT_FOUND<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Так само обертаємо <code class=" language-none">try-catch</code>і у випадку IOException відправляємо 404 статус відповіді (не знайдено). 4 - витягаємо з БД прилеглу сутність FileInfo. 5 - по ключу з сутності завантажуємо файл 6-8 - відправляємо назад файл, при цьому додавши в хедер ім'я файлу (знову ж таки, отримане з сутності з інформацією про файл). Давайте подивимося глибше. Інтерфейс сервісу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Resource</span></span> <span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Реалізація: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Resource</span></span> <span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> fileManager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Transactional</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>readOnly <span class="token operator"><span class="token operator">=</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> fileDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут особливо цікавого нічого немає: метод пошуку сутності по id та завантаження файлу, хіба що 46 - помічаємо, що транзакція у нас для читання. Рівень dao: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Імплементація: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> FIND_FILE_BY_ID <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"SELECT id, file_name, file_size, file_key, upload_date FROM files_info WHERE id = ?"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> <span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> jdbcTemplate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">queryForObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>FIND_FILE_BY_ID<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token function"><span class="token function">rowMapper</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">RowMapper</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">FileInfo</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">rowMapper</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">return</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">,</span></span> rowNum<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">-&gt;</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">id</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getLong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"file_name"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getLong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"file_size"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">key</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"file_key"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">uploadDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getObject</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"upload_date"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">LocalDate</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 4 — пошук id з використанням <code class=" language-none">jdbcTemplate</code>і <code class=" language-none">RowMapper</code>. 8 - 15 - реалізація <code class=" language-none">RowMapper</code>для нашого конкретного випадку, для зіставлення даних із БД та полів моделі. Йдемо в <code class=" language-none">FileManager</code>і дивимося, як завантажується наш файл: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Resource</span></span> <span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">Path</span></span> path <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Paths</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DIRECTORY_PATH <span class="token operator"><span class="token operator">+</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Resource</span></span> resource <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">UrlResource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>path<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">toUri</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exists</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">||</span></span> resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isReadable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> resource<span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">else</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Повертаємо файл у вигляді об'єкта <code class=" language-none">Resource</code>, а шукатимемо по ключу. 3 - створюємо <code class=" language-none">Resource</code>по дорозі + ключ. 4 - 8 - перевіряємо, що файл по заданому шляху не порожній і читаємо. Якщо все ОК, повертаємо його, а якщо ні, прокидаємо IOException нагору. Перевіряємо наш метод у Postman: <img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 7" src="https://cdn.javarush.com/images/article/931e2732-e166-46b3-8f30-361e203f8815/original.jpeg">Як бачимо, він відпрацював на ОК)) 
<h2>Delete</h2>
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@DeleteMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>value <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"/{id}"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Void</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token annotation punctuation"><span class="token annotation punctuation">@PathVariable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       fileService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpStatus</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>OK<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">IOException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResponseEntity</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpStatus</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>NOT_FOUND<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут нічого особливого: також повертаємо 404 у разі невдачі за допомогою <code class=" language-none">try-catch</code>. Інтерфейс сервісу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Implementation: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Transactional</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>rollbackFor <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span><span class="token class-name"><span class="token class-name">IOException</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">}</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">FileInfo</span></span> file <span class="token operator"><span class="token operator">=</span></span> fileDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   fileDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   fileManager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 1 — також відкат зміни даних (видалення) при падінні IOException. 5 - видаляємо інформацію про файл із БД. 6 - видаляємо сам файл із нашого "сховища". Інтерфейс dao: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Реалізація: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">String</span></span> DELETE_FILE_BY_ID <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"DELETE FROM files_info WHERE id = ?"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   jdbcTemplate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DELETE_FILE_BY_ID<span class="token punctuation"><span class="token punctuation">,</span></span> fileId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Нічого такого просто delete. Видалення файлу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">Path</span></span> path <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Paths</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>DIRECTORY_PATH <span class="token operator"><span class="token operator">+</span></span> key<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>path<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Юзаєм у Postman: <img data-max-width="650" alt="Збереження файлів у додаток та даних про них на БД - 8" src="https://cdn.javarush.com/images/article/40a0caa1-e30f-4cd2-ae54-6e5cc93bd5b2/original.jpeg">Дивимося у сховище: <img data-max-width="350" alt="Збереження файлів у додаток та даних про них на БД - 9" src="https://cdn.javarush.com/images/article/ded6a3ec-dda4-42cf-a815-4f15b4c30823/original.jpeg">Пусто :) Тепер у БД: <img data-max-width="550" alt="Збереження файлів у додаток та даних про них на БД - 10" src="https://cdn.javarush.com/images/article/216eb83e-a8b0-4a52-b3b2-8bba20c18140/original.jpeg">Бачимо, що все good)) <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="b1e8a312-867d-4e79-9c52-a1be697b2095" class="img-fluid" alt="Збереження файлів у додаток та даних про них на БД - 11" src="https://cdn.javarush.com/images/article/b1e8a312-867d-4e79-9c52-a1be697b2095/1024.jpeg" style="width: 1024px;"></a>
<h2>Test</h2>Давайте спробуємо написати тест під наш <code class=" language-none">FileManager</code>. Спочатку поглянемо на структуру тестової частини: <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="350" alt="Збереження файлів у додаток та даних про них на БД - 12" src="https://cdn.javarush.com/images/article/3bb1af34-d531-4971-93bb-35bdee8aa202/original.jpeg"></a>mockFile.txt — це файл, за допомогою якого ми тестуватимемо наші операції з file storage. testFileStorage буде заміною нашого сховища. <code class=" language-none">FileManagerTest</code>: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">FileManagerTest</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">MultipartFile</span></span> multipartFile<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">FileManager</span></span> manager<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span> file<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@BeforeClass</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">prepareTestData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       file <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">FileInfo</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">id</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">9L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">key</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">38975L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">uploadDate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">LocalDate</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">now</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       multipartFile <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">MockMultipartFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"mockFile"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"txt"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>
               <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileInputStream</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"src/test/resources/mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       manager <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FileManager</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут бачимо завдання тестових даних. Тест збереження файлу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">uploadTest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">ReflectionTestUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setField</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>manager<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"DIRECTORY_PATH"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"src/test/resources/testFileStorage/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   manager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">upload</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>multipartFile<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getBytes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">Path</span></span> checkFile <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Paths</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"src/test/resources/testFileStorage/mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exists</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isRegularFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">size</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEqualTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>multipartFile<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getSize</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 3 - за допомогою тестової рефлексії змінюємо нашу константу в сервісі для завдання шляху збереження файлу. 5 - викликаємо метод, що перевіряється. 7 - 10 - перевіряємо правильність виконання збереження. 11 - видаляємо збережений файл (ми не повинні залишити жодних слідів). 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">downloadTest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">ReflectionTestUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setField</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>manager<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"DIRECTORY_PATH"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"src/test/resources/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">Resource</span></span> resource <span class="token operator"><span class="token operator">=</span></span> manager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">download</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getFilename</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEqualTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exists</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тест завантаження файлу: 3 - знову ж таки, міняємо шлях для нашого <code class=" language-none">FileManager</code>. 5 - юзаєм метод, що перевіряється. 7 - 9 - перевіряємо результат виконання. Тест видалення файлу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">deleteTest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token class-name"><span class="token class-name">Path</span></span> checkFile <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Paths</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"src/test/resources/testFileStorage/mockFile.txt"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">exists</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isRegularFile</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">ReflectionTestUtils</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setField</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>manager<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"DIRECTORY_PATH"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"src/test/resources/testFileStorage/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   manager<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">delete</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>file<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Files</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">notExists</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>checkFile<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 9 - 3 - 4 - задаємо шлях і створюємо файл. 5 - 6 - перевіряємо його існування. 9 - використовуємо метод, що перевіряється. 77 - перевіряємо, що об'єкта вже немає. І дивимося, що там у нас залежно: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependencies<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>spring<span class="token operator"><span class="token operator">-</span></span>boot<span class="token operator"><span class="token operator">-</span></span>starter<span class="token operator"><span class="token operator">-</span></span>data<span class="token operator"><span class="token operator">-</span></span>jdbc<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>spring<span class="token operator"><span class="token operator">-</span></span>boot<span class="token operator"><span class="token operator">-</span></span>starter<span class="token operator"><span class="token operator">-</span></span>web<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>spring<span class="token operator"><span class="token operator">-</span></span>boot<span class="token operator"><span class="token operator">-</span></span>starter<span class="token operator"><span class="token operator">-</span></span>test<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>scope<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>test<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>scope<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>exclusions<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
           <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>exclusion<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
               <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>junit<span class="token punctuation"><span class="token punctuation">.</span></span>vintage<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
               <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>junit<span class="token operator"><span class="token operator">-</span></span>vintage<span class="token operator"><span class="token operator">-</span></span>engine<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
           <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>exclusion<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>exclusions<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>projectlombok<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>lombok<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">1.18</span></span><span class="token number"><span class="token number">.10</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>scope<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>provided<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>scope<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>mysql<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>mysql<span class="token operator"><span class="token operator">-</span></span>connector<span class="token operator"><span class="token operator">-</span></span>java<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">8.0</span></span><span class="token number"><span class="token number">.18</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>commons<span class="token operator"><span class="token operator">-</span></span>codec<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>commons<span class="token operator"><span class="token operator">-</span></span>codec<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">1.9</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>junit<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>junit<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">4.13</span></span><span class="token operator"><span class="token operator">-</span></span>rc<span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">2</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
       <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>scope<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>test<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>scope<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependencies<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> На цьому у мене сьогодні все))