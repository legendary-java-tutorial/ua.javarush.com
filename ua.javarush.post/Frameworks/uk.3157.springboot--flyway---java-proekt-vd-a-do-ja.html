SpringBoot + Flyway - "Java-проект від А до Я"
<p>----------------------------------------</p>
Мінімальна кількість теорії, як ви любите))) Підсумкове порівняння Flyway/Liquibase опускаємо на невизначений час і переходимо до суті. А то й так він уже затягнувся. Щоб двічі не описувати Flyway, вирішив його одразу додавати до нашого май
<p>----------------------------------------</p>
<em>Стаття із серії про створення Java-проекту (посилання на інші матеріали – наприкінці). Її мета — аналіз ключових технологій, результат — написання телеграм-бота. У цій частині пробуємо запустити SpringBoot і до нього – Flyway. </em> Мінімальна кількість теорії, як ви любите))) Підсумкове порівняння Flyway/Liquibase опускаємо на невизначений час і переходимо до суті. А то й так він уже затягнувся. Щоб двічі не описувати Flyway, вирішив його одразу додавати до нашого майбутнього проекту JRTB.<img data-max-width="800" data-id="10982e53-5c2b-4cd8-a8db-e2fdc7244188" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 1" src="https://cdn.javarush.com/images/article/10982e53-5c2b-4cd8-a8db-e2fdc7244188/800.jpeg" style="width: 800px;">
<h3>Що в рамках цього потрібно зробити?</h3>
<ol>
 <li>Запустити SpringBoot додаток на базі Maven.</li>
 <li>Додати туди Flyway: добре, що вони легко інтегруються.</li>
 <li>Додати схему таблиць, які у нас у прикладі бази даних.</li>
</ol>Таким чином ми навчимося працювати з Flyway. Чому окремим проектом, а не одразу в наш JRTB? Тому що пізніше будь-хто, хто захоче зрозуміти, як це зробити, матиме проект із прикладом та статтю, яка описує роботу з нею. Ну, що ж, поїхали!
<h2>Що таке flyway</h2>Щоб щось використати, потрібно спочатку з'ясувати, що це таке і навіщо. <span class="text-bold">Flyway</span> — інструмент для контролю версії бази даних. Слова відомі, але якось розуміння не додалося, так? Спробуємо описати проблему, яку вирішує flyway. Допустимо, у нас є проект. Як і все у нашому світі, він не досконалий, тому спланувати та скласти остаточну версію проекту не вийшло. Щоразу з'являються ті чи інші невраховані нюанси. Проект у своїй роботі використовує БД. Зрозуміло, за зміни проекту може змінитися і структура бази даних. Допустимо, ми додаємо нове поле для однієї з сутностей нашого проекту. Як це зробити?
<ol>
 <li>Додати це поле до нашої сутності, оновити все, щоб бізнес логіка працювала.</li>
 <li>Оновити базу даних. Єдиний можливий спосіб зробити це вручну. Для цього потрібно зайти та прописати необхідний SQL скрипт.</li>
</ol>З другого пункту виникає багато питань:
<ol type="a">
 <li>а якщо у нас не одне місце, де ми розгортаємо наш проект, то це у кожному з них треба робити?</li>
 <li>а якщо ми захочемо повернутися назад, як ми дізнаємося, в якому стані зараз знаходиться структура БД?</li>
 <li>як ми будемо впевнені, що зміна БД пройшла успішно?</li>
 <li>Як отримати можливість відстежити всі зміни БД, які пройшли на проекті?</li>
</ol>Якщо робити руками, то відповіді будуть не найкращі. Щоб уникнути всіх цих труднощів, можна скористатися інструментом для міграції БД. Одним із таких і є Flyway. У чому полягає його робота? У рамках проекту ми зберігаємо окремі SQL файли (так звані міграції), які зберігають у собі все те, що ми робимо з БД за один раз. Всі міграції йдуть строго в певному порядку, що дозволяє відстежити зміни в структурі та даних БД (часто за допомогою міграції додають тестові дані до проекту, щоб при розгортанні його на якийсь сервер він уже мав якісь значення, за допомогою яких можна тестувати проект). Після того, як пройдуть тести, під час складання проекту запускаються міграції. Вони з'єднуються з базою даних та проводять міграції. Якщо міграції вже були проведені на цій базі даних, то flyway їх просто пропустить (у нього в БД в окремій таблиці зберігаються дані про міграції, про їхній стан, що допомагає керувати ними), а якщо якась міграція пройшла неуспішно, то складання проекту та його монтування (деплою) на сервер зупиняться. Я постарався описати якнайдокладніше. Якщо все ще не до кінця зрозуміло — не біда: на практиці прийде і розуміння.
<h2>Запускаємо SpringBoot + Flyway</h2>
<h3>Що таке Spring Boot</h3>А що ж таке запускаємо? Щоб зрозуміти, що і навіщо ми робимо, потрібно визначитися з тим, що таке SpringBoot. Спочатку швидко поговоримо (ну дуже швидко) про <span class="text-bold">Spring</span> . На даний момент це де-факто промисловий стандарт у розробці серверних програм на Java. Стандарт чого? Як вам це пояснити. Spring - це скелет програми, на який ми потім накидаємо "м'ясо" - нашу бізнес-логіку. За допомогою спрингу (тут і далі використовуватиму цю кальку, щоб не витрачати час на перемикання мови :D )) Спрінг дає нам старт, з якого ми починаємо все робити. Він <s>багатоликий</s> багатомодульний:
<ol>
 <li>Хочеш працювати з базою даних? Хочеш із реляційною? Хочеш із нереляційною? Ось, будь ласка, у нас є Spring Data.</li>
 <li>Хочеш працювати з http запитами? Ось тобі, будь ласка, Spring Web (Spring MVC).</li>
 <li>Тобі потрібний контейнер для всіх об'єктів в одному місці? Ось Spring Core.</li>
 <li>Потрібно налаштувати безпеку на проекті та так, щоб були різні ролі та субординація? Spring Security.</li>
 <li>Ти тільки подумав про те, що добре мати таку штуку, так виявиться, що у Спрінга вже є те, що тобі потрібно, і воно швидко і легко інтегрується.</li>
</ol>Тому можна сказати, що це не просто фреймворк (така велика бібліотека), а вже ціла екосистема, яка розвивається шаленими темпами. Щоб зрозуміти, що являє собою Spring Core, тобто база, до якої підключаються модулі, раджу подивитися <a href="https://www.youtube.com/watch?v=rd6wxPzXQvo&amp;t=4178s" rel="nofollow" target="_blank">живе демо</a> зі створення власного фреймворку. Веде його Євген Борисов, дуже крутий чувак в області Java та спрингу. Виконайте все те, що він зробив, і робота спрингу вам стане більш зрозумілою. SpringBoot, у свою чергу, це вершина всього того, що у них є. Магія чистої води. Мінімум налаштувань для того, щоб зробити перший запуск програми. Зрозуміло, це не дасть вам розуміння, як ним користуватися та що потрібно робити. Але перед тим, як кидатися в глибину розробки, потрібно подивитися на все з висоти пташиного польоту.
<h3>Запускаємо SpringBoot</h3>Оскільки ми вже зналися на тому, що таке мавен, давайте створимо новий проект для наших потреб. Для цього просто потрібно перейти на сайт, спеціально створений для цієї справи. Називається він <a href="https://start.spring.io/" rel="nofollow" target="_blank">Spring Initializr</a> . <img data-max-width="1024" data-id="6c7e470c-dd6d-4f7f-ac1d-03988f1b02d6" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 2" src="https://cdn.javarush.com/images/article/6c7e470c-dd6d-4f7f-ac1d-03988f1b02d6/1024.jpeg" style="width: 1024px;">Тут потрібно заповнити та вибрати необхідне:
<ol>
 <li>Інструмент зі збирання проекту - gradle або maven. Як бачите, про Ant вже й не згадують. Це хороша підказка про те, яким засобам складання варто приділити час.</li>
 <li>Мова, якою можна писати - java, kotlin, groovy. Тут все просто: всі вони JVM подібні та спокійно запускають Java код. До речі, варто подивитись і на Котлін. Груві вже відверто став нецікавим (був час, коли на груві переходабо, але він швидко пройшов).</li>
 <li>Версію спрингу… Тут треба розуміти, що версії головної частини спрингу та його модулів узгоджені.</li>
 <li>Дані щодо проекту. Я вже описував ці речі.</li>
 <li>Вибираємо, в який архів буде збиратися - Jar чи War.</li>
 <li>Ну і версію джави нашої коханої. А то останнім часом розлучилося цих версій... багато) То чекали роками, а тепер по дві на рік.</li>
</ol>У нашому випадку будемо публікувати цей проект в організації <a href="https://github.com/codegymcommunity" rel="nofollow" target="_blank">CodeGym Community</a> , тому дані про проект будуть відповідні:
<ol>
 <li>Maven - не дарма ж ми говорабо з вами про це раніше.</li>
 <li>Java - наша рідна :D</li>
 <li>Версію візьмемо 2.2.11. Чому не найновішу? Тому що чим новіший, тим більше шансів, що там можуть бути якісь косяки. Для нас не принципово, яка саме версія, а більш стара буде надійнішою. Тому обираємо 2.2.11.</li>
 <li>Group: <span class="text-bold">com.github.codegymcommunity</span></li>
 <li>Artifact: <span class="text-bold">springboot-flyway-demo</span></li>
 <li>Name: <span class="text-bold">SpringBoot + Flyway Demo</span></li>
 <li>Description: <span class="text-bold">Project demonstrates integration між SpringBoot and Flyway</span> . (Так, вміння писати документацію – це важлива частина розробки:))</li>
 <li>Package name: <span class="text-bold">com.github.codegymcommunity.springbootflywaydemo</span> . Тут за нас відразу ж створять базовий пакет із класом, який запустить наш додаток.</li>
 <li>Packaging: <span class="text-bold">Jar</span></li>
 <li>Java: 8. Не будемо йти попереду паровоза і візьмемо стару добру вісімку. Чому не 11? А навіщо? Для нашого прикладу не бачу сенсу.</li>
</ol><img data-max-width="800" data-id="5246a501-4cd3-4676-b7c1-daa40095db02" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 3" src="https://cdn.javarush.com/images/article/5246a501-4cd3-4676-b7c1-daa40095db02/800.jpeg" style="width: 800px;">А тепер додамо модулі. Нам потрібно знайти інтеграцію із Flyway. Можна ще додати щось пов'язане з MySQL та Spring Data. Додамо ще ломбок (це дуже потрібна річ, просто повірте поки що :D)) Для цієї справи натискаємо на <span class="text-bold">ADD DEPENDENCIES</span> … і виберемо все, що потрібно: <img data-max-width="1080" data-id="698cd505-dfd6-4f98-82a4-91b30a594ded" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 4" src="https://cdn.javarush.com/images/article/698cd505-dfd6-4f98-82a4-91b30a594ded/1080.jpeg" style="width: 1080px;">Ось так додамо Flyway. <img data-max-width="1080" data-id="750b5a4d-6ffd-4884-bc93-f5bb7beaed38" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 5" src="https://cdn.javarush.com/images/article/750b5a4d-6ffd-4884-bc93-f5bb7beaed38/1080.jpeg" style="width: 1080px;">Ломбок... І так далі. У підсумку отримаємо: <img data-max-width="800" data-id="c607ca61-d95c-4eb4-9cd7-e60c3419e889" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 6" src="https://cdn.javarush.com/images/article/c607ca61-d95c-4eb4-9cd7-e60c3419e889/800.jpeg" style="width: 800px;">Хух… заповнабо все)) Тепер тиснемо <span class="text-bold">GENERATE…</span> і все — архів зі згенерованим проектом готовий:) Там ще є така крута штука як <span class="text-bold">SHARE…</span> , яка дає вам посилання на сторінку, яку ви щойно заповнабо. Тобто <a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.2.11.RELEASE&amp;packaging=jar&amp;jvmVersion=1.8&amp;groupId=com.github.codegymcommunity&amp;artifactId=springboot-flyway-demo&amp;name=SpringBoot%20%2B%20Flyway%20Demo&amp;description=Project%20demonstrates%20integration%20between%20SpringBoot%20and%20Flyway.&amp;packageName=com.github.codegymcommunity.springbootflywaydemo&amp;dependencies=lombok,mysql,flyway,data-jpa" rel="nofollow" target="_blank">ось та, яку я генерував</a>. І навіть якщо у вас щось піде не так, завжди можна буде перевірити на засланні. Далі нам потрібно прив'язати створений проект до репозиторію гіт, тому клонуємо створений проект <a href="https://github.com/template-repository/template-repository" rel="nofollow" target="_blank">springboot-flyway-demo</a> і качаємо його через IDEA. Для цього потрібно відкрити ідею і вибрати <span class="text-bold">File -&gt; New -&gt; Project from Existing Sources…</span> : <img data-max-width="1024" data-id="4d8f6a79-a80e-4511-afb9-a03b4fa6e665" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 7" src="https://cdn.javarush.com/images/article/4d8f6a79-a80e-4511-afb9-a03b4fa6e665/1024.jpeg" style="width: 1024px;">Тепер додаємо URL і натискаємо <span class="text-bold">Clone</span> . Наступним кроком потрібно перенести нутрощі згенерованого проекту всередину того, що ми клонували. Заплутав? Зараз покажу. Розархівував і отримав такий набір файлів: <img data-max-width="800" data-id="ba6a8d83-6598-4351-a088-afd454e11516" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 8" src="https://cdn.javarush.com/images/article/ba6a8d83-6598-4351-a088-afd454e11516/800.jpeg" style="width: 800px;">Ось їх потрібно перенести в клонований проект. Як і в минулій статті, додамо pom.xml як проект:<img data-max-width="512" data-id="0042e996-a164-4d0c-b5f4-1a7f9d5f0913" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 9" src="https://cdn.javarush.com/images/article/0042e996-a164-4d0c-b5f4-1a7f9d5f0913/512.jpeg" style="width: 512px;">Тепер нам цікаво подивитися, що нам згенерували. Якщо відкрити всі папки в src і далі, то буде видно звичайну ієрархію в рамках проектів, яку ми розбирали <a href="https://codegym.cc/groups/posts/3119-java-proekt-ot-a-do-ja-vse-chto-vih-khoteli-znatjh-o-maven" target="_blank">в попередній статті</a> . Хто не читав – почитайте! <img data-max-width="512" data-id="41d9959c-cf9a-4822-89da-f73bc6d8363d" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 10" src="https://cdn.javarush.com/images/article/41d9959c-cf9a-4822-89da-f73bc6d8363d/512.jpeg" style="width: 512px;">Видно, що у нас є Application клас, і за допомогою нього запуститься наш SpringBoot додаток. Завдяки плагіну в мавені для SpringBoot, у нас з'явився потрібний нам таск для мавену, а саме spring-boot:run. Де ми можемо знайти цю інформацію? Праворуч, відкривши плашку Maven і наш проект: <img data-max-width="512" data-id="ae997f33-00de-4c77-92ad-38ce59acc96b" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 11" src="https://cdn.javarush.com/images/article/ae997f33-00de-4c77-92ad-38ce59acc96b/512.jpeg" style="width: 512px;">Буде помилка, і її так ми не зможемо прочитати, побачимо щось таке: <img data-max-width="1080" data-id="489e0f24-a8f5-4273-968f-bc50c4030830" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 12" src="https://cdn.javarush.com/images/article/489e0f24-a8f5-4273-968f-bc50c4030830/1080.jpeg" style="width: 1080px;">Щоб отримати більше інформації, для швидкості ми можемо запустити main метод Application класі: <img data-max-width="800" data-id="02a2408a-4eb2-4c2c-8646-d2eb4c18e75c" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 13" src="https://cdn.javarush.com/images/article/02a2408a-4eb2-4c2c-8646-d2eb4c18e75c/800.jpeg" style="width: 800px;">І тоді вже побачимо реальну причину:<img data-max-width="1080" data-id="39a661fd-61ab-4125-a8b3-67c2b6253ea4" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 14" src="https://cdn.javarush.com/images/article/39a661fd-61ab-4125-a8b3-67c2b6253ea4/1080.jpeg" style="width: 1080px;">Тут уже інформації більше і можна з нею щось робити. Що не так? У нас є залежності, пов'язані з БД, і тому потрібно надати налаштування для підключення до неї. Для цієї справи гугли, знаходимо, що потрібно додати наступні конфігурації в application.properties: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java">spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>flyway_demo_db
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span></code></pre> Запускаємо ще раз main метод і отримуємо: <img data-max-width="1080" data-id="aaaa0ee4-7790-4c60-892c-2d94577adad2" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 15" src="https://cdn.javarush.com/images/article/aaaa0ee4-7790-4c60-892c-2d94577adad2/1080.jpeg" style="width: 1080px;">Тепер потрібно додати хоча б одну міграцію. Щоб правильно скласти міграцію, потрібно взяти наступний шаблон: <span class="code">V&lt;VERSION&gt;__&lt;NAME&gt;.sql</span> Керуючись ним, створимо файл міграції з ім'ям <span class="text-bold">V00001__Create_country_table.sql</span> у відповідній папці: <span class="text-bold">/src/main/resources/db.migration/</span> . У ньому створимо таблицю country. Скрипт візьмемо з <a href="https://codegym.cc/groups/posts/2957-java-proekt-ot-a-do-ja-razbiraem-bazih-dannihkh-i-jazihk-sql-chastjh-2" target="_blank">другої статті про БД</a> . <img data-max-width="1080" data-id="800b2f5e-f7dd-49ab-9992-a77d437e3cce" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 16" src="https://cdn.javarush.com/images/article/800b2f5e-f7dd-49ab-9992-a77d437e3cce/1080.jpeg" style="width: 1080px;">Перед запуском зайдемо та створимо БД для роботи: flyway_demo_db. Зробимо це через MysqlWorkbench: <img data-max-width="1080" data-id="035bd6fb-4e11-4cee-9238-0b28da78ebfd" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 17" src="https://cdn.javarush.com/images/article/035bd6fb-4e11-4cee-9238-0b28da78ebfd/1080.jpeg" style="width: 1080px;">Тепер можна запустити ще раз main метод: <img data-max-width="1080" data-id="0c3f684e-2710-472a-bc02-2ada5b58e7e9" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 18" src="https://cdn.javarush.com/images/article/0c3f684e-2710-472a-bc02-2ada5b58e7e9/1080.jpeg" style="width: 1080px;">Все вийшло, але так як у нас нічого ще немає в проекті, він закінчив роботу. Однак видно з логів (що таке логи — <a href="https://codegym.cc/groups/posts/2388#discussion" target="_blank">ось почитайте</a>), що:
<ol>
 <li>Успішно підключабося до БД.</li>
 <li>Пройшла валідація міграції і з нею все прибл.</li>
 <li>Flyway створив таблицю для керування міграціями.</li>
 <li>І те, що розпочала міграція 00001 — створення country пройшло успішно.</li>
</ol>Щоб це перевірити, можна сходити і подивитися, що робиться у БД. Так що зайдемо на наш MySQL сервер і подивимося, що там із таблицями в бд flyway_demo_db: <span class="text-bold">$USE flyway_demo_db; $ SHOW TABLES; </span><img data-max-width="1024" data-id="9e9c928a-fddd-4d7d-b6d2-aca9ee36b2d1" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 19" src="https://cdn.javarush.com/images/article/9e9c928a-fddd-4d7d-b6d2-aca9ee36b2d1/1024.jpeg" style="width: 1024px;">Як і очікував, пройшла міграція, під час якої створилася таблиця country і з'явилася таблиця flyway_schema_history, яка зберігає інформацію про міграціям. Підемо далі і подивимося які там є записи (і чи взагалі вони є). <span class="text-bold">$SELECT * FROM flyway_schema_history; </span><img data-max-width="1024" data-id="f2602d4b-22d4-429b-96e3-43f0de11e710" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 20" src="https://cdn.javarush.com/images/article/f2602d4b-22d4-429b-96e3-43f0de11e710/1024.jpeg" style="width: 1024px;">Ось і запис, один-єдиний. У ній багато цікавих даних. Версія, опис міграції, який тип SQL (і, можливо, ще XML), ім'я самого скрипта, чексума (<em>це щось типу hashcode, з якого перевіряється, змінилася чи ні міграція. Робиться це на випадок, якщо ми провели міграцію в БД і потім її поправабо: робити цього не можна, всі редагування вносяться тільки за допомогою нової міграції і щоб цього не було, чек сума стежить за цим), ім'я sql користувача, дата обробки міграції, час</em> на виконання та результат (успішно чи не успішно). Міграція, написана один раз, не повинна бути змінена у майбутньому. Навіть якщо у ній є дефект. Усі зміни відбуваються лише за допомогою нової міграції. Це дуже важливо. Щоб показати, що буде, давайте трохи змінимо наш скрипт і спробуємо запустити його знову. Додамо до нашої міграції один запис у таблицю country: <img data-max-width="1080" data-id="89f91cfe-3c9c-4715-8446-3289acb2a0a8" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 21" src="https://cdn.javarush.com/images/article/89f91cfe-3c9c-4715-8446-3289acb2a0a8/1080.jpeg" style="width: 1080px;">і запустимо main метод і ось що отримаємо:<img data-max-width="1080" data-id="564653d5-9145-4d3b-a12c-dca0b6b3e443" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 22" src="https://cdn.javarush.com/images/article/564653d5-9145-4d3b-a12c-dca0b6b3e443/1080.jpeg" style="width: 1080px;">Як я і очікував, flyway розпізнав, що скрипт був змінений і не провів міграцію. У деяких випадках дійсно буває необхідно запустити оновлену міграцію і щоб flyway це пропустив, потрібно видалити запис у таблиці flyway_schema_history і вже після цього накотити оновлену міграцію. Це не нормальна поведінка і так не має бути, але знати про такий спосіб вирішення проблеми також потрібно. Розібралися з першою міграцією. Тепер хотілося б додати ще одну міграцію, з даними про країни, як було у статті про БД: файл <span class="text-bold">V00002__Add_test_data_to_country.sql</span><img data-max-width="1080" data-id="86cd9ab4-4c11-4bb5-a113-51db21e678a9" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 23" src="https://cdn.javarush.com/images/article/86cd9ab4-4c11-4bb5-a113-51db21e678a9/1080.jpeg" style="width: 1080px;"> І знову запустимо main метод:<img data-max-width="1080" data-id="7f8d8fa6-fd73-4004-b2d7-160d5e7de3dc" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 24" src="https://cdn.javarush.com/images/article/7f8d8fa6-fd73-4004-b2d7-160d5e7de3dc/1080.jpeg" style="width: 1080px;">З логів видно, що перед запуском міграції БД була у версії 00001, тому запустяться всі міграції після цієї версії. Далі запустилася версія 00002 і пройшла успішно. Перевіримо, чи вже вірите мені, що три записи в country будуть вже перебувають у БД?)) Я б перевірив, тому пруф: <img data-max-width="256" data-id="6806330f-aa25-46b8-a184-dfed4a7c59eb" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 25" src="https://cdn.javarush.com/images/article/6806330f-aa25-46b8-a184-dfed4a7c59eb/256.jpeg" style="width: 256px;">Ось якось так. Якщо запустити ще раз проект, то flyway просто пропустить накочування міграцій, оскільки база даних повністю відповідає потрібній версії.
<h2>Висновок</h2>Цього разу ми навчабося сяк-так розуміти і використовувати інструмент для міграції БД у зв'язці зі SpringBoot. Ця інформація потрібна для розуміння того, що таке інструмент контролю версій баз даних на прикладі Flyway. Друзі, вихідники проекту, який я показав, <a href="https://github.com/codegymcommunity/springboot-flyway-demo" rel="nofollow" target="_blank">опубліковані в нашій організації на гітхабі</a> . Якщо вам подобається приклад, <a href="https://github.com/codegymcommunity/springboot-flyway-demo/stargazers" rel="nofollow" target="_blank">ставте йому зірку</a> , і я розумітиму, що моя робота корисна і її реально варто продовжувати. Традиційно пропоную підписатися на <a href="https://github.com/romankh3" rel="nofollow" target="_blank">мій гітхаб акаунт</a>. Через нього я веду всю свою роботу з open source і всі ті демо-проекти, які незмінно супроводжують мої статті. Дякую всім за прочитання. Наступного разу вже писатимемо наш додаток. Буде ще в майбутньому необхідна теорія з докеру, але ми її розбавимо практикою.
<h3>Корисні посилання</h3>Сьогодні не так вже й багато корисних посилань. Зверніть увагу на відео Євгена, воно дійсно варте того!
<ol>
 <li><a href="https://start.spring.io/" rel="nofollow" target="_blank">Сайт для створення проектів на спрингу</a></li>
 <li><a href="https://www.youtube.com/watch?v=rd6wxPzXQvo&amp;t=4178s" rel="nofollow" target="_blank">Євген Борисов - Spring-будівельник</a></li>
 <li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto-execute-flyway-database-migrations-on-startup" rel="nofollow" target="_blank">Документація у спрингу по Flyway</a></li>
</ol><a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="&quot;Java-проект від А до Я&quot;: SpringBoot + Flyway - 26" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>