Розбираємо бази даних та мову SQL. (Частина 4 - перевірка домашнього завдання) - "Java-проект від А до Я"
<p>----------------------------------------</p>
Попередні статті та розбір домашнього завдання за базами даних: , , . Всім, у кого вистачило терпіння та витримки, усім, хто йде зі мною вже четверту статтю, ви молодці. Як кажуть, дорогу здолає той, хто йде. Цього тижня вийде заключна стат
<p>----------------------------------------</p>
<em>Стаття із серії про створення Java-проекту (посилання на інші матеріали – наприкінці). Її мета — аналіз ключових технологій, результат — написання телеграм-бота. </em> Попередні статті та розбір домашнього завдання за базами даних: <a href="https://codegym.cc/groups/posts/2946-java-proekt-ot-a-do-ja-razbiraem-bazih-dannihkh-i-jazihk-sql" target="_blank">1</a> , <a href="https://codegym.cc/groups/posts/2957-java-proekt-ot-a-do-ja-razbiraem-bazih-dannihkh-i-jazihk-sql-chastjh-2" target="_blank">2</a> , <a href="https://codegym.cc/groups/posts/2977-java-proekt-ot-a-do-ja-razbiraem-bazih-dannihkh-i-jazihk-sql-chastjh-3" target="_blank">3</a> . Всім, у кого вистачило терпіння та витримки, усім, хто йде зі мною вже четверту статтю, ви молодці. Як кажуть, дорогу здолає той, хто йде. Цього тижня вийде заключна стаття про Бази Даних, в якій ми поговоримо про <span class="text-bold">типи зв'язків</span> та <span class="text-bold">джоїни (з'єднання)</span>. Але перед тим, як ми розберемося з новою інформацією — перевіримо домашнє завдання… Я прям училкою почував себе. Не серчайте на мене: педагогічної освіти в мене немає, маємо, що маємо. Оскільки минулого тижня докладна перевірка ДЗ зайняла левову частку матеріалу, я вирішив розбити розбір будинку та огляд нового матеріалу на дві частини.<img data-max-width="800" data-id="c7682c6d-1845-459f-8237-7fc50379cfa4" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання." src="https://cdn.javarush.com/images/article/c7682c6d-1845-459f-8237-7fc50379cfa4/800.jpeg" style="width: 800px;">
<h2>Власне, розбір будинку</h2>Я безперечно радий тому, що знаходяться люди, які роблять ДЗ і говорять про це. Це здорово! Я максимально впевнений, що просто прочитати без закріплення знань це шлях у нікуди. Тому всі, хто зробив чи намагався зробити, — респект. Нагадаю умови завдань:
<ol>
 <li>Розібратися з оператором <span class="text-bold">HAVING</span> та написати приклад запиту для таблиць з нашого прикладу. Якщо потрібно додати якісь поля чи ще значень, щоб було наочніше, додавайте. Хто хоче — пишіть у коментарях свій приклад рішення — то я його ще й перевірити зможу, якщо встигну.</li>
 <li>Встановити MySQL Workbench для роботи з базою даних через UI. Я думаю, що ми вже досить практикувалися з консолі. Підключитись до БД. Якщо ви використовуєте щось інше для роботи з БД — сміливо скипайте це завдання. Тут і далі я використовуватиму тільки MySQL Workbench.</li>
 <li>Написати запити на отримання за нашими даними:
  <ol type="a">
   <li>найменш/багато чисельної країни;</li>
   <li>середня кількість жителів країни;</li>
   <li>середня кількість жителів у країнах, чиї імена закінчуються на “a”;</li>
   <li>кількість країн, у яких населення більше чотирьох мільйонів;</li>
   <li>відсортувати країни щодо зменшення кількості мешканців;</li>
   <li>відсортувати країни на ім'я в натуральному порядку.</li>
  </ol></li>
</ol>
<h2>Поговоримо про HAVING</h2>Знання оператора Having може допомогти вам пройти не одну співбесіду, де будуть завдання SQL. Тому зрозуміти його дуже важливо. Так вийшло, що використовувати умови для агрегуючих функцій (SUM, MIN, MAX, AVG) не можна. До того ж HAVING використовують для полів, які групуються. Що це означає? Наприклад, якщо ми хочемо отримати країни, де середня кількість мешканців у містах більше 50 000 мешканців, без використання HAVING нам не обійтися. Як я розумію, зроблено це тому, що агрегація відбувається вже після того, як виконається оператор WHERE і не можна додати до нього значення агрегації, які будуть підраховані пізніше. Навіть якщо поки що мої думки не сильно додають розуміння, можна просто прийняти це як факт і йти з ним. У програмуванні часто виходить так, що якщо раптом щось незрозуміло, це цілком може означати, що мозок просто ще не переварив це. Переспіть із цією думкою, і наступного дня все стане ясніше.
<h2>Установка MySQL Workbench</h2>Тут і далі я використовуватиму саме Workbench для запитів. Покажу, що потрібно для встановлення та створення з'єднання з базою даних. Це продукт від Oracle, тому потрібно просто піти на їхній сайт і вибрати потрібну версію та операційну систему. Для цього перейдемо за <a href="https://dev.mysql.com/downloads/workbench/" rel="nofollow" target="_blank">цим посиланням</a> : <img data-max-width="512" data-id="9250d12f-036d-42f1-a891-58eacd5efa7f" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 2" src="https://cdn.javarush.com/images/article/9250d12f-036d-42f1-a891-58eacd5efa7f/512.jpeg" style="width: 512px;">Тут ви можете вибрати саме ту операційну систему, яка вам потрібна. Натискаємо <span class="text-bold">Download</span> , але замість завантаження ми побачимо таке вікно: <img data-max-width="512" data-id="74d39365-6006-4469-a951-4f16653bf0f4" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 3" src="https://cdn.javarush.com/images/article/74d39365-6006-4469-a951-4f16653bf0f4/512.jpeg" style="width: 512px;">Не губимося, просто шукаємо кнопку з назвою <span class="text-bold">No thanks, just start my download</span> , і почнеться скачування. Для чого вони це роблять? Напевно, щоби більше реєструвалося у них, нам це не важливо. Після успішного завантаження запускаємо інсталяційний файл. На MacOS це виглядає так:<img data-max-width="512" data-id="3398db83-cc01-4756-9732-9b18ef324b28" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 4" src="https://cdn.javarush.com/images/article/3398db83-cc01-4756-9732-9b18ef324b28/512.jpeg" style="width: 512px;">Просто переносимо значок - і все, встановлення завершено. Вже не так складно, як установка самого MySQL, правда? Або вже просто звикли і стали досвідченішими;) Друга частина цього завдання — встановити з'єднання з нашою базою даних. Що для цього потрібно? Натискаємо плюсик поряд з MySQL Connections: <img data-max-width="512" data-id="fae68696-9884-4bf2-b1c4-6d85066bff6b" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 5" src="https://cdn.javarush.com/images/article/fae68696-9884-4bf2-b1c4-6d85066bff6b/512.jpeg" style="width: 512px;">У вікні, що з'явилося, вводимо необхідні дані:
<ul>
 <li><span class="text-bold">Connection Name</span> – ім'я нашого з'єднання. Пишіть максимально зрозумілі імена, щоб потім не було проблем із ідентифікацією. Я цьому з'єднанню даю ім'я <span class="text-bold">JRTB_DB</span> ;</li>
 <li><span class="text-bold">Hostname</span> вже буде заданий як локальний <span class="text-bold">127.0.0.1</span> (він же localhost). У нашому випадку нічого міняти не потрібно, тому що БД встановлена ​​на комп'ютері, а от якщо БД десь в іншому місці, то і хост (ip тієї машини, на якій запущена БД), відповідно, потрібно змінити;</li>
 <li><span class="text-bold">Username</span> - також за необхідності можна ставити свого користувача. Якщо ви не додавали нічого в цьому ключі, залиште його незмінним;</li>
 <li><span class="text-bold">Password</span> — натискаємо <span class="text-bold">Store in Keychain</span> і задаємо саме пароль, який ви задавали у себе. Я залишив все по-простому – <span class="text-bold">root</span> .</li>
</ul>Щоб перевірити, чи буде з'єднання, натискаємо <span class="text-bold">Test Connection</span> : <img data-max-width="512" data-id="00b6c846-3a75-4f29-bc5d-f55bad1505b5" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 6" src="https://cdn.javarush.com/images/article/00b6c846-3a75-4f29-bc5d-f55bad1505b5/512.jpeg" style="width: 512px;">Ну і якщо все зроблено було правильно, результат не забариться: <img data-max-width="512" data-id="78bc380b-66be-49cc-bf65-cfe4681bf53a" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 7" src="https://cdn.javarush.com/images/article/78bc380b-66be-49cc-bf65-cfe4681bf53a/512.jpeg" style="width: 512px;">Тепер у нас є збережене з'єднання в БД, і не потрібно буде щоразу створювати з'єднання, заповнювати ім'я та пароль. І буде виглядати це щастя ось так: <img data-max-width="512" data-id="eae68182-d0d9-4e75-8e16-cd63ee977c53" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 8" src="https://cdn.javarush.com/images/article/eae68182-d0d9-4e75-8e16-cd63ee977c53/512.jpeg" style="width: 512px;">Заходимо в створене з'єднання і бачимо вікно для запитів. Щоб бути впевненим, що все правильно, перевіримо список баз даних, зайдемо в нашу та отримаємо всі дані про міста: <img data-max-width="800" data-id="af150939-ff1c-48d2-b15e-b7c8c239e00a" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 9" src="https://cdn.javarush.com/images/article/af150939-ff1c-48d2-b15e-b7c8c239e00a/800.jpeg" style="width: 800px;">Причому тут ми отримуємо картбланш на те, що нам потрібно. Перша секція відповідає за скрипт, який ми запроваджуємо. Далі, у <span class="text-bold">Result Grid</span> , ми бачимо результат останньої операції у скрипті. А в <span class="text-bold">Action Output</span>показаний список операцій та його результат. Дуже корисна річ, хочу я вам сказати: за її допомогою можна стежити за швидкістю виконання певних скриптів. Чому це важливо? Одна з найпоширеніших проблем у швидкості виконання завдань у додатку — швидкість виконання запитів у БД. Тут їх можна буде швидко та зручно перевірити руками.
<h2>Пишемо необхідні запити</h2>У нас лише 7 запитів, які потрібно виконати, поїхали!
<h3>
 <ol>
  <li>Отримати найчисленнішу країну. Тут можна піти хитро і кількома маршрутами:</li>
 </ol></h3>
<h4>
 <ul>
  <li>За даними таблиці country</li>
 </ul></h4>Тоді необхідно просто відсортувати наш запит щодо населення та взяти лише один запис. Для цієї справи в кінці скрипту потрібно додати оператор <span class="text-bold">LIMIT</span> та вказати необхідну кількість: <span class="text-bold">$ SELECT * FROM country ORDER BY population DESC LIMIT 1;</span><img data-max-width="800" data-id="99a6c791-8b5f-4b3f-aeff-4ca690cc60cf" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 10" src="https://cdn.javarush.com/images/article/99a6c791-8b5f-4b3f-aeff-4ca690cc60cf/800.jpeg" style="width: 800px;">
<h4>
 <ul>
  <li>За даними таблиці city</li>
 </ul></h4>Тут все цікавіше, тому що запит буде складнішим, але й цікавішим. Так як ми ще не маємо поняття про джоїни, можемо отримати тільки ID-шник країни: <span class="text-bold">$ SELECT country_id, SUM(population) </span><img data-max-width="800" data-id="df4aa113-e17d-4e34-a020-992555c071bf" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 11" src="https://cdn.javarush.com/images/article/df4aa113-e17d-4e34-a020-992555c071bf/800.jpeg" style="width: 800px;">Тут ми зробабо прикольну річ — зібрали суму населення всіх відомих міст у кожній країні, відсортували за цією сумою та взяли перший елемент. Ну як, здорово? Я ось у захваті :D Після такого одразу відчуваєш себе гуру запитів… (ненадовго, звичайно)
<h3>
 <ol start="2">
  <li>Отримати найменшу країну. Тут можна піти хитро і кількома маршрутами</li>
 </ol></h3>У цьому випадку все буде так само. Різниця лише в тому, що сортуватиме назад — і все. Тому просто пишу запити:
<h4>
 <ul>
  <li>За даними таблиці city</li>
 </ul></h4><span class="text-bold">$ SELECT country_id, SUM(population) FROM city GROUP BY country_id ORDER BY SUM(population) LIMIT 1;</span>
<h4>
 <ul>
  <li>За даними таблиці country</li>
 </ul></h4><span class="text-bold">$ SELECT * FROM country ORDER BY population LIMIT 1; </span> А результат уже подивіться самі!
<h3>
 <ol start="3">
  <li>Середня кількість жителів країни</li>
 </ol></h3>Ось знову ТЗ стоїть якось не точно, начебто писав менеджер... Чому я так вирішив? Тому що неясно, у якій таблиці працювати. Але це нормально: завдань, в яких буде одразу все зрозуміло та ясно, просто не буває. Тому потрібно уважно вчитуватись у завдання, і якщо є питання — одразу задавати їх! Це так, ремарк. З урахуванням даних, які є у нас у БД, шукатимемо за даними із міст. Для цього пишемо наступний запит: <span class="text-bold">SELECT country_id, AVG(population) FROM city GROUP BY country_id; </span><img data-max-width="800" data-id="bf4d178f-f905-4dde-96a5-8a3cf326f389" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 12" src="https://cdn.javarush.com/images/article/bf4d178f-f905-4dde-96a5-8a3cf326f389/800.jpeg" style="width: 800px;">Тут все просто: ми використовуємо функцію AVG та групуємо наші записи міст країнами.
<h3>
 <ol start="4">
  <li>Середня кількість жителів у країнах, чиї імена закінчуються на “a”</li>
 </ol></h3>Тут буде невелика зміна на запит. Потрібно додати фільтрацію за іменами, перш ніж ми будемо робити угруповання. Роблю я будинки, як і всі студенти, перед публікацією цієї статті, і розумію, що без джоїнів це завдання не вирішити. Чому? Тому що, крім ID-шника країни, нам потрібно ще отримати його ім'я. А це не можна зробити без з'єднання двох таблиць в один запис. Тому я зроблю це завдання, звичайно, але це мій косяк…))) Хотів придумати завдання з використанням LIKE в запиті…) $ SELECT ci <span class="text-bold">. co.id WHERE co.name LIKE "%a" GROUP BY country_id;</span><img data-max-width="800" data-id="b35ae8df-ab6a-45f6-8e3e-eb0d3d4946f6" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 13" src="https://cdn.javarush.com/images/article/b35ae8df-ab6a-45f6-8e3e-eb0d3d4946f6/800.jpeg" style="width: 800px;">Що тут сталося? Спочатку ми з'єднали записи з таблиці city і country за зовнішнім ключем country_id, відфільтрували за іменами країн, щоб вони закінчувалися на “a”, і потім групували по country_id.
<h3>
 <ol start="5">
  <li>Кількість країн, у яких населення більше чотирьох мільйонів</li>
 </ol></h3>Тут потрібно просто використовувати функцію COUNT і додати фільтрацію на населення: <span class="text-bold">$ SELECT COUNT(*) from country WHERE population &gt; 4000000; </span> В результаті дізнаємося, що таких країн 3. Чи це правильно? Так, лише Молдова не проходить цей рубіж.
<h3>
 <ol start="6">
  <li>Відсортувати країни щодо зменшення кількості мешканців</li>
 </ol></h3>Щоб зробити це потрібно використовувати вже відомий нам оператор ORDER BY. Але врахуйте, що за умовчанням сортування йде у натуральному порядку. Для чисел це означає, що сортується за зростанням, для рядків — що з перших символів. Якщо нам потрібне сортування за спаданням, нам потрібен зворотний від натурального: <span class="text-bold">$ SELECT * FROM country ORDER BY population DESC;</span><img data-max-width="800" data-id="8c56e15d-e010-4d05-8f3e-8cd6f1a2616e" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 14" src="https://cdn.javarush.com/images/article/8c56e15d-e010-4d05-8f3e-8cd6f1a2616e/800.jpeg" style="width: 800px;">
<h3>
 <ol start="7">
  <li>Відсортувати країни за назвою в натуральному порядку</li>
 </ol></h3>Ось тут нам і знадобляться знання того, що таке натуральний порядок. Так як він за промовчанням, для нас це простіше простого: <span class="text-bold">$ SELECT * FROM country ORDER BY name;</span><img data-max-width="800" data-id="1a073589-9eaa-4e25-ad10-2b6fcbd8e9f9" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 15" src="https://cdn.javarush.com/images/article/1a073589-9eaa-4e25-ad10-2b6fcbd8e9f9/800.jpeg" style="width: 800px;"><a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="a27b7388-7969-4bc1-92e2-b779b65c64cf" alt="&quot;Java-проект від А до Я&quot;: розбираємо бази даних та мову SQL.  Частина 4 - перевірка домашнього завдання - 16" src="https://cdn.javarush.com/images/article/a27b7388-7969-4bc1-92e2-b779b65c64cf/1080.jpeg" style="width: 1080px;"></a>
<h4>Замість виведення</h4>Так уже вийшло, що розмір рішення домашнього завдання вийде дуже великий, тому ми зробимо виняток: я публікую цю статтю з перевіркою, а в п'ятницю опублікую новий матеріал зі зв'язками та джоїнами. Дякую всім за прочитання. До п'ятниці! 
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>