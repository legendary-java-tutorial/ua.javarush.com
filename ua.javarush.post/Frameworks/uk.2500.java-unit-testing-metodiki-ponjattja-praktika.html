Java Unit Testing: методики, поняття, практика
<p>----------------------------------------</p>
Сьогодні і не зустрінеш програми, не обвішані тестами, тому ця тема буде як ніколи актуальна для розробників-початківців: без тестів — нікуди. На правах реклами запропонуватиму переглянути мої минулі статті. У деяких із них зачіпаються тест
<p>----------------------------------------</p>
Сьогодні і не зустрінеш програми, не обвішані тестами, тому ця тема буде як ніколи актуальна для розробників-початківців: без тестів — нікуди. На правах реклами запропонуватиму переглянути мої минулі статті. У деяких із них зачіпаються тести (та й так статті будуть дуже корисні): 
<ol>
 <li><a href="https://codegym.cc/groups/posts/2414-integracionnoe-testirovanie-bd-s-pomojshjhju-mariadb-dlja-podmenih-mysql" target="_blank">Інтеграційне тестування БД за допомогою MariaDB для заміни MySql</a></li>
 <li><a href="https://codegym.cc/groups/posts/2436-realizacija-muljhtijazihchnosti-prilozhenija" target="_blank">Реалізація мультимовності програми</a></li>
 <li><a href="https://codegym.cc/groups/posts/2476-sokhranenie-faylov-v-prilozhenie-i-dannihkh-o-nikh-na-bd" target="_blank">Збереження файлів у додаток та даних про них на БД</a></li>
</ol>Розглянемо, які види тестування використовують у принципі, а потім детально вивчимо все, що потрібно знати про юніт-тестування. 
<h2>Види тестування</h2>Що таке тест? Як говорить Вікі: « <span class="text-bold">Тест</span> або <span class="text-bold">випробування</span> - спосіб вивчення глибинних процесів діяльності системи за допомогою приміщення системи в різні ситуації та відстеження доступних спостереженню змін у ній». Іншими словами, це перевірка правильності роботи нашої системи у тих чи інших ситуаціях. <img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 2" src="https://cdn.javarush.com/images/article/fb94b93f-ca8a-4da3-8b14-40999ea7fbf3/original.jpeg">Що ж, побачимо, які взагалі є види тестування: 
<ol>
 <li>
  <p><span class=" text-bold">Модульне тестування (unit testing) – тести, завдання яких перевірити кожен модуль системи окремо. Бажано, щоб це були мінімально поділені шматочки системи, наприклад, модулі.</span></p>
  <p></p></li>
 <li>
  <p><span class="text-bold">Системне тестування</span> (system testing) — тест високого рівня перевірки роботи більшого шматка програми чи системи загалом.</p></li>
 <li>
  <p><span class="text-bold">Регресійне тестування</span> (regression testing) — тестування, яке використовується для перевірки того, чи не впливають нові фічі або виправлені баги на існуючий функціонал програми та чи не з'являються старі баги.</p></li>
 <li>
  <p><span class="text-bold">Функціональне тестування (functional testing</span> ) - перевірка відповідності частини додатку вимогам, заявленим у специфікаціях, юзерстор і т.д.</p>
  <p>Види функціонального тестування:</p>
  <ul>
   <li><span class="text-bold">тест «білої скриньки» (white box)</span> на відповідність частини додатку вимогам із знанням внутрішньої реалізації системи;</li>
   <li><span class="text-bold">тест «чорної скриньки» (black box)</span> на відповідність частини додатку вимогам без знання внутрішньої реалізації системи.</li>
  </ul></li>
 <li><span class="text-bold">Тестування продуктивності</span> (performance testing) — вид тестів, які пишуться визначення швидкості відпрацювання системи чи її частини під певним навантаженням.</li>
 <li><span class="text-bold">Тестування</span> навантаження (load testing) — тести, призначені для перевірки стійкості системи при стандартних навантаженнях і для знаходження максимально можливого піку, при якому додаток працює коректно.</li>
 <li><span class="text-bold">Стрес-тестування</span> (stress testing) — вид тестування, призначений для перевірки працездатності програми при нестандартних навантаженнях і визначення максимально можливого піку, при якому система не впаде.</li>
 <li><span class="text-bold">Тестування безпеки</span> (security testing) – тести, що використовуються для перевірки безпеки системи (від атак хакерів, вірусів, несанкціонованого доступу до конфіденційних даних та інших радощів життя).</li>
 <li><span class="text-bold">Тестування локалізації (localization testing</span> ) - це тести локалізації для програми.</li>
 <li><span class="text-bold">Юзабіліті тестування</span> (usability testing) - вид тестування, спрямований на перевірку зручності використання, зрозумілості, привабливості та навчання для користувачів.</li> Це все звучить добре, але як воно відбувається на практиці? Все просто: використовується піраміда тестування Майка Кона: <img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 4" src="https://cdn.javarush.com/images/article/a166ce03-22ed-4303-a7bf-9a52af158a7f/original.jpeg">Це спрощений варіант піраміди: зараз її ділять більш дрібні деталі. Але сьогодні ми не перекручуватимемося і розглянемо найпростіший варіант. 
 <ol>
  <li>
   <p><span class="text-bold">Unit</span> — модульні тести, що застосовуються в різних шарах програми, що тестують найменшу логіку прикладної програми: наприклад, клас, але найчастіше — метод. Ці тести зазвичай намагаються максимально ізолювати від зовнішньої логіки, тобто створити ілюзію того, що решта програми працює в стандартному режимі.</p>
   <p>Даних тестів завжди має бути багато (більше, ніж інших видів), так як вони тестують маленькі шматочки і дуже легковагі, що не їсти багато ресурсів (під ресурсами я маю на увазі оперативну пам'ять і час).</p></li>
  <li>
   <p><span class="text-bold">Integration</span> – інтеграційне тестування. Воно перевіряє більші шматочки системи, тобто це або об'єднання кількох шматочків логіки (кілька методів чи класів), або коректність роботи із зовнішнім компонентом. Цих тестів зазвичай менше, ніж Unit, оскільки вони важкі.</p>
   <p>Як приклад інтеграційних тестів можна розглянути <a href="https://codegym.cc/groups/posts/2414-integracionnoe-testirovanie-bd-s-pomojshjhju-mariadb-dlja-podmenih-mysql" target="_blank">з'єднання з базою даних та перевірку правильного відпрацювання методів, що працюють з нею</a> .</p></li>
  <li>
   <p><span class="text-bold">UI</span> — тести, які перевіряють роботу інтерфейсу користувача. Вони торкаються логіки на всіх рівнях програми, через що їх ще називають наскрізними. Їх як правило в рази менше, так вони найбільш важковагові і повинні перевіряти найнеобхідніші шляхи, що використовуються.</p>
   <p>На малюнку вище бачимо співвідношення площ різних частин трикутника: приблизно така сама пропорція зберігається у кількості цих тестів у реальній роботі.</p>
   <p>Сьогодні докладно розглянемо найвикористаніші тести — юніт-тести, тому що вміти ними користуватися на базовому рівні повинні всі Java-розробники, що поважають себе.</p></li>
 </ol><a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-id="52f65e08-486c-48ae-9a50-6189336ea648" data-max-width="1080" alt="Все про Unit testing: методики, поняття, практика - 5" src="https://cdn.javarush.com/images/article/52f65e08-486c-48ae-9a50-6189336ea648/1080.jpeg" style="width: 1080px;"></a>
 <h2>Ключові поняття юніт-тестування</h2><span class="text-bold">Покриття тестів</span> (Code Coverage) – одна з головних оцінок якості тестування програми. Це відсоток коду, який був покритий тестами (0-100%). На практиці багато хто женеться за цим відсотком, з чим я не згоден, тому що починається навішування тестів там, де вони не потрібні. Наприклад, у нас у сервісі є стандартні CRUD (create/get/update/delete) операції без додаткової логіки. Ці методи - суто посередники, що делегують роботу шару, що працює з репозиторієм. У цій ситуації нам нема чого тестувати: хіба те, що викликає цей метод — метод дао, але це не серйозно. Для оцінки покриття тестами зазвичай використовують додаткові інструменти: JaCoCo, Cobertura, Clover, Emma і т.д. Для більш детального вивчення даного питання на пару придатних статей: 
 <ul>
  <li>матеріал про Code Coverage на <a href="https://codegym.cc/groups/posts/602-codecov" target="_blank">CodeGym</a> і на <a href="https://habr.com/ru/post/345774/" rel="nofollow" target="_blank">Хабрі</a> ;</li>
  <li><a href="https://habr.com/ru/post/279535/" rel="nofollow" target="_blank">фундаментальна теорія тестування</a> .</li>
 </ul><span class="text-bold">TDD (Test-driven development)</span> – розробка через тестування. У рамках цього підходу насамперед пишеться тест, який перевірятиме певний код. Виходить тестування чорної скриньки: ми знаємо, що є на вході і знаємо, що має вийти на виході. Це дозволяє уникнути дублювання коду. Розробка через тестування починається з проектування та розробки тестів для кожної невеликої функціональності програми. У підході TDD, по-перше, розробляється тест, який визначає та перевіряє, що робитиме код. Основна мета TDD - зробити код більш зрозумілим, простим і без помилок. <img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 6" src="https://cdn.javarush.com/images/article/ff9e2bc1-433f-4b8f-9db0-66836910aaf9/original.jpeg">Підхід складається з таких складових: 
 <ol>
  <li>Пишемо наш тест.</li>
  <li>Запускаємо тест, пройшов він чи ні (бачимо, що все червоне не психуємо: так і має бути).</li>
  <li>Додаємо код, який має задовольнити цей тест (запускаємо тест).</li>
  <li>Виконуємо рефакторинг коду.</li>
 </ol>Виходячи з того, що модульні тести є найменшими елементами піраміди автоматизації тестування, TDD заснований на них. За допомогою модульних тестів ми можемо перевірити бізнес-логіку будь-якого класу. <span class="text-bold">BDD (Behavior-driven development)</span> – розробка через поведінку. Цей підхід ґрунтується на TDD. Якщо говорити точніше, він використовує написані зрозумілою мовою приклади (як правило англійською), які ілюструють поведінку системи для всіх, хто бере участь у розробці. Не заглиблюватимемося в даний термін, оскільки він в основному зачіпає тестувальників та бізнес-аналітиків. <span class="text-bold">Тестовий сценарій (Test Case)</span> — сценарій, що описує кроки, конкретні умови та параметри, необхідні для перевірки реалізації коду, що тестується. <span class="text-bold">Фікстури (Fixture)</span>— стан середовища тестування, який необхідний успішного виконання випробуваного методу. Це заздалегідь заданий набір об'єктів та його поведінки у умовах. 
 <h2>Етапи тестування</h2>Тест складається із трьох етапів: 
 <ol>
  <li>Завдання тестованих даних (фікстур).</li>
  <li>Використання тестованого коду (виклик тестованого методу).</li>
  <li>Перевірка результатів та звірка з очікуваними.</li>
 </ol><img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 7" src="https://cdn.javarush.com/images/article/ed89764c-1c59-4397-8a3e-cd4dd8f6bf6f/original.jpeg">Щоб забезпечити модульність тесту, потрібно ізолюватися від інших верств програми. Зробити це можна за допомогою заглушок, моків та шпигунів. <span class="text-bold">Мок</span> (Mock) — об'єкти, які налаштовуються (наприклад, специфічно для кожного тесту) і дозволяють задати очікування викликів методів у вигляді відповідей, які ми плануємо отримати. Перевірки відповідності очікуванням проводяться через виклики до об'єктів Mock. <span class="text-bold">Заглушки</span> (Stub) — забезпечують жорстку відповідь на виклики під час тестування. Також вони можуть зберігати інформацію про дзвінок (наприклад, параметри або кількість цих дзвінків). Такі іноді називають своїм терміном - шпигун ( <span class="text-bold">Spy</span> ). Іноді ці терміни <span class="text-bold">stubs</span> та <span class="text-bold">mock</span>плутають: різниця в тому, що стаб нічого не перевіряє, а лише імітує заданий стан. А мок — це об'єкт, який має очікування. Наприклад, що даний метод класу повинен бути викликаний кілька разів. Іншими словами, ваш тест ніколи не зламається через «стаб», а ось через мок може. 
 <h2>Середовище тестування</h2>Отже, тепер ближчий до справи. Для Java доступно кілька серед тестування (фреймворків). Найпопулярніші з них - JUnit та TestNG. Для нашого огляду ми використовуємо: <img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 8" src="https://cdn.javarush.com/images/article/f742fdeb-9f27-441e-b37a-40f2455e5723/original.jpeg">JUnit тест є методом, що міститься в класі, який використовується тільки для тестування. Клас зазвичай називається так само, як і клас, який він тестує з +Test в кінці. Наприклад, CarService→ CarServiceTest. Система складання Maven автоматично включає такі класи у тестову область. Насправді цей клас і називається тестовим. Трохи пройдемося за базовими інструкціями: <span class="text-bold">@Test</span> - визначення даного методу як тестований (по суті - метод, позначений цією інструкцією і є модульний тест). <span class="text-bold">@Before</span>— позначається метод, який виконуватиметься перед кожним тестом. Наприклад, заповнення тестових даних класу, читання вхідних даних тощо. д. <span class="text-bold">@After</span> — ставиться над методом, який викликатиме після кожного тесту (чистка даних, відновлення дефолтних значень). <span class="text-bold">@ BeforeClass</span> - ставиться над способом - аналог @ Before. Але цей метод викликається лише один раз перед усіма тестами для даного класу і тому має бути статичним. Він використовується для виконання більш важких операцій, наприклад підйом тестової БД. <span class="text-bold">@AfterClass</span> - протилежність @BeforeClass: виконується один раз для даного класу, але виконується після всіх тестів. Використовується, наприклад, очищення постійних ресурсів чи відключення від БД. <span class="text-bold">@Ignore</span>— зазначає, що метод нижче відключений і ігноруватиметься під час загального прогону тестів. Використовується в різних випадках, наприклад, якщо змінабо базовий метод і не встигли переробити тест. У разі ще бажано додати опис — @Ignore("Some description"). <span class="text-bold">@ Test</span> (expected = Exception.class) – використовується для негативних тестів. Це тести, які перевіряють, як поводиться метод у разі помилки, тобто тест очікує, що метод викине деякий виняток. Такий метод позначається інструкцією @Test, але із зазначенням помилки для вилову. <span class="text-bold">@ Test (timeout = 100)</span> - перевіряє, що метод виконується не більше ніж 100 мілісекунд. <span class="text-bold">@Mock</span>- використовується над полем клас для завдання даного об'єкта моком (це не з Junit бібліотеки, а з Mockito), і якщо нам буде необхідно, ми поставимо поведінку мока в конкретній ситуації, безпосередньо в методі тесту. <span class="text-bold">@RunWith(MockitoJUnitRunner.class)</span> - метод ставиться над класом. Він і є кнопкою для прогону тестів у ньому. Runner можуть бути різними: наприклад, є такі: MockitoJUnitRunner, JUnitPlatform, SpringRunner і т. д.). У JUnit 5 інструкцію @RunWith замінабо більш потужною інструкцією @ExtendWith. Погляньмо на деякі методи порівняння результатів: 
 <ul>
  <li><code class=" language-none"><span class="text-bold">assertEquals(Object expecteds, Object actuals)</span></code>— перевіряє, чи рівні об'єкти, що передаються.</li>
  <li><code class=" language-none"><span class="text-bold">assertTrue(boolean flag)</span></code>- Перевіряє, чи повертає передане значення - true.</li>
  <li><code class=" language-none"><span class="text-bold">assertFalse(boolean flag)</span></code>- Перевіряє, чи повертає передане значення - false.</li>
  <li><code class=" language-none"><span class="text-bold">assertNull(Object object)</span></code>– перевіряє, чи об'єкт є нульовим (null).</li>
  <li><code class=" language-none"><span class="text-bold">assertSame(Object firstObject, Object secondObject)</span></code>- Перевіряє, чи посилаються передані значення на один і той же об'єкт.</li>
  <li><code class=" language-none"><span class="text-bold">assertThat(T t, Matcher&lt;T&gt; matcher)</span></code>- Перевіряє, чи задовольняє t умові, вказаній у matcher.</li>
 </ul>Ще є корисна форма порівняння з асертий - <code class=" language-none"><span class="text-bold">assertThat(firstObject).isEqualTo(secondObject)</span></code> Тут я розповів про базові методи, тому що інші - це різні варіації наведених вище. 
 <h2>Практика тестування</h2>А тепер розглянемо наведений вище матеріал на конкретному прикладі. Тестуватимемо метод для сервісу — update. Розглядати шар дао не будемо, тому що він у нас дефолтний. Додамо стартер для тестів: 
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>spring<span class="token operator"><span class="token operator">-</span></span>boot<span class="token operator"><span class="token operator">-</span></span>starter<span class="token operator"><span class="token operator">-</span></span>test<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">2.2</span></span><span class="token number"><span class="token number">.2</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>RELEASE<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
   <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>scope<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>test<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>scope<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Отже, клас сервісу: 
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">RobotServiceImpl</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">RobotService</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">final</span></span> <span class="token class-name"><span class="token class-name">RobotDAO</span></span> robotDAO<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Robot</span></span> <span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Robot</span></span> robot<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       <span class="token class-name"><span class="token class-name">Robot</span></span> found <span class="token operator"><span class="token operator">=</span></span> robotDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
       <span class="token keyword"><span class="token keyword">return</span></span> robotDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Robot</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">id</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>id<span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">:</span></span> found<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">cpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">:</span></span> found<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">producer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProducer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">?</span></span> robot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProducer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">:</span></span> found<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProducer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 8 - витягуємо об'єкт, що оновлюється з БД 9-14 - створюємо об'єкт через білдер, якщо в об'єкті, що приходить, є поле - задаємо його, якщо ні - залишаємо те, що є в БД І дивимося наш тест: 
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@RunWith</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">MockitoJUnitRunner</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">RobotServiceImplTest</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token annotation punctuation"><span class="token annotation punctuation">@Mock</span></span>
   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">RobotDAO</span></span> robotDAO<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">RobotServiceImpl</span></span> robotService<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">Robot</span></span> testRobot<span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@BeforeClass</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">prepareTestData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       testRobot <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Robot</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">id</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">123L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"testRobotMolly"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">cpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Intel Core i7-9700K"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">producer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"China"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
               <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span>

   <span class="token annotation punctuation"><span class="token annotation punctuation">@Before</span></span>
   <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
       robotService <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">RobotServiceImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robotDAO<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> 1 - наш Runner 4 - ізолюємо сервіс від шару дао, підставляючи мок 11 - задаємо для класу тестову сутність (ту, яку ми будемо юзати в якості хом'ячка, що випробуваний) 22 - задаємо об'єкт сервісу, який ми і будемо тестувати 
 <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">updateTest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
   <span class="token function"><span class="token function">when</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robotDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findById</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">any</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">thenReturn</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>testRobot<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">when</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robotDAO<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">any</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Robot</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">then</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">returnsFirstArg</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token class-name"><span class="token class-name">Robot</span></span> robotForUpdate <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Robot</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">builder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Vally"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">cpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"AMD Ryzen 7 2700X"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
           <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">build</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token class-name"><span class="token class-name">Robot</span></span> resultRobot <span class="token operator"><span class="token operator">=</span></span> robotService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">update</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">123L</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> robotForUpdate<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

   <span class="token function"><span class="token function">assertNotNull</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultRobot<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertSame</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>testRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertThat</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isEqualTo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robotForUpdate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>robotForUpdate<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCpu</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
   <span class="token function"><span class="token function">assertEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProducer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span>testRobot<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getProducer</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут ми бачимо чіткий поділ тесту на три частини: 3-9 - завдання фікстур 11 - виконання тестованої частини 13-17 - перевірка результатів Детальніше: 3-4 - задаємо поведінку для мока дао 5 - задаємо екземпляр, який ми будемо апдейтувати поверх нашого стандартного 11 - використовуємо метод і беремо результуючий екземпляр 13 - перевіряємо, що він не нуль 14 - звіряємо айді результату і задані аргументи методу 15 - перевіряємо, чи оновилося ім'я 16 - дивимося результат по cpu 17 - так як в екземплярі для оновлення поле, воно має залишитися тим самим, перевіряємо це. <img data-max-width="650" alt="Все про Unit testing: методики, поняття, практика - 9" src="https://cdn.javarush.com/images/article/b8157308-05a2-47e7-a144-14f6b7552543/original.jpeg">Запускаємо: <img data-max-width="450" alt="Все про Unit testing: методики, поняття, практика - 10" src="https://cdn.javarush.com/images/article/18f17d92-890c-4390-adc9-1aa644e1c613/original.jpeg">Тест зелений, можна видихати)) <span class="text-bold">Отже, підіб'ємо підсумки:</span>тестування покращує якість коду та робить процес розробки більш гнучким та надійним. Уявіть собі, скільки сил ми витратимо при зміні дизайну програмного забезпечення з сотнями файлів класів. Коли ми маємо модульні тести, написані для всіх цих класів, ми можемо впевнено провести рефакторинг. І найголовніше – це допомагає нам легко знаходити помилки під час розробки. Гайз, на цьому у мене сьогодні все: сипемо лайки, пишемо коментарі))) <img data-max-width="648" alt="Все про Unit testing: методики, поняття, практика - 11" src="https://cdn.javarush.com/images/article/78583b9a-e6c6-4a20-9aa1-cc118aa7dc34/original.jpeg">
</ol>