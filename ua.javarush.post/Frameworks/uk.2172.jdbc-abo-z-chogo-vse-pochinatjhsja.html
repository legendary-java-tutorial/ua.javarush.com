JDBC або з чого все починається
<p>----------------------------------------</p>
У світі без зберігання даних ніяк. І історія роботи з базами даних розпочалася вже дуже давно, з появи JDBC. Пропоную згадати те, без чого не обходься жоден сучасний фреймворк, побудований поверх JDBC. Крім того, навіть працюючи з ними часо
<p>----------------------------------------</p>
У світі без зберігання даних ніяк. І історія роботи з базами даних розпочалася вже дуже давно, з появи JDBC. Пропоную згадати те, без чого не обходься жоден сучасний фреймворк, побудований поверх JDBC. Крім того, навіть працюючи з ними часом може знадобитися можливість "повернутися до коріння". Сподіваюся, огляд допоможе як вступне слово або щось освіжити в пам'яті. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="243" alt="JDBC або з чого все починається." src="https://cdn.javarush.com/images/article/369dbb2a-2fef-4c08-8f37-9bae3f21121d/original.jpeg">
 </div>
</div>
<h2>Вступ</h2>Одна з основних цілей мови програмування - зберігання та обробка інформації. Щоб краще зрозуміти роботу зберігання даних, варто трохи часу виділити на теорію та архітектуру додатків. Наприклад, можна ознайомитися з літературою, а саме з книгою " <a href="https://goo.gl/aB3WLm" target="_blank" rel="nofollow">Software Architect's Handbook: Become a successful software architect by implementing effective arch...</a> " авторства Joseph Ingeno. Як сказано, є певний Data Tier або "Шар даних". Він включає місце зберігання даних (наприклад, SQL базу даних) і засоби для роботи зі сховищем даних (наприклад, JDBC, про яке і піде мова). Також на сайті Microsoft є стаття: " <a href="https://docs.microsoft.com/ru-ru/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design" target="_blank" rel="nofollow">Проектування рівня збереження інфраструктури</a>" у якій описується архітектурне рішення виділення з Data Tier додаткового шару — Persistence Layer. У разі Data Tier — це рівень зберігання самих даних, тоді як Persistence Layer — це певний рівень абстракції до роботи з даними зі сховища з рівня Data Tier. До рівня Persistence Layer можна віднести шаблон "DAO" або різні ORM. Але ORM - це тема окремої розмови. Як Ви могли вже зрозуміти, спочатку з'явився Data Tier. Ще з часів JDK 1.1 у Java світі з'явився JDBC (Java DataBase Connectivity - з'єднання з базами даних на Java) Це стандарт взаємодії Java-додатків з різними СУБД, реалізований у вигляді пакетів java.sql і javax.sql, що входять до складу Java SE: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="44cc9e7c-7cc4-4300-a112-3eff003d1ec4" data-max-width="597" alt="JDBC або з чого все починається - 2" src="https://cdn.javarush.com/images/article/44cc9e7c-7cc4-4300-a112-3eff003d1ec4/512.jpeg" style="width: 597px;">
 </div>
</div>Даний стандарт описаний специфікацією " <a href="http://download.oracle.com/otn-pub/jcp/jdbc-4_1-mrel-spec/jdbc4.1-fr-spec.pdf" target="_blank" rel="nofollow">JSR 221 JDBC 4.1 API</a> ". Ця специфікація розповідає нам про те, що JDBC API надає програмний доступ до реляційних баз даних із програм, написаних на Java. Так само розповідає про те, що JDBC API є частиною платформи Java і тому входить в Java SE і Java EE. JDBC API представлений двома пакетами: java.sql та javax.sql. Давайте з ними і познайомимося. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="224" alt="JDBC або з чого все починається - 3" src="https://cdn.javarush.com/images/article/2bd75bae-b172-4253-8267-7e92c84b7578/original.jpeg">
 </div>
</div>
<h2>Початок роботи</h2>Щоб зрозуміти, що таке взагалі JDBC API нам знадобиться Java додаток. Найзручніше скористатися однією із систем складання проектів. Наприклад, скористаємось <a href="https://gradle.org/install/" target="_blank" rel="nofollow">Gradle</a> . Докладніше про Gradle можна прочитати в невеликому огляді: " <a href="https://codegym.cc/groups/posts/2126-kratkoe-znakomstvo-s-gradle" target="_blank" rel="nofollow">Коротке знайомство з Gradle</a> ". Спочатку ініціалізуємо новий Gradle проект. Так як функціональність Gradle реалізується через плагіни, то для ініціалізації нам потрібно скористатися " <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html" target="_blank" rel="nofollow">Gradle Build Init Plugin</a> ": 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">gradle init <span class="token operator"><span class="token operator">--</span></span>type java<span class="token operator"><span class="token operator">-</span></span>application</code></pre> Відкриємо після цього білд скрипт - файл <strong>build.gradle</strong> , де описується наш проект і те, як з ним потрібно працювати. Нас цікавить блок " <strong>dependencies</strong> ", де описуються залежності - тобто ті бібліотеки/фреймворки/api, без яких ми не можемо працювати і від яких залежимо. За замовчуванням ми побачимо щось на кшталт: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token comment"><span class="token comment">// This dependency is found on compile classpath of this component and consumers.</span></span>
    implementation <span class="token string"><span class="token string">'com.google.guava:guava:26.0-jre'</span></span>
    <span class="token comment"><span class="token comment">// Use JUnit test framework</span></span>
    testImplementation <span class="token string"><span class="token string">'junit:junit:4.12'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Чому ми тут це бачимо? Це залежності нашого проекту, який нам згенерував автоматично Gradle під час створення проекту. А так само тому, що guava - це окрема бібліотека, що не входить у комплект з Java SE. JUnit так само не входить у комплект із Java SE. Але JDBC у нас є "з коробки", тобто входить до складу Java SE. Виходить, JDBC у нас є. Чудово. Що ж нам ще треба? Є така чудова схема: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="580edb2f-3ef8-4a06-abcc-54f9321cba8b" data-max-width="441" alt="JDBC або з чого все починається." src="https://cdn.javarush.com/images/article/580edb2f-3ef8-4a06-abcc-54f9321cba8b/256.jpeg" style="width: 441px;">
 </div>
</div>Як ми бачимо, і це логічно, база даних є зовнішнім компонентом, якого немає спочатку Java SE. Це пояснюється просто - існує безліч баз даних і працювати ви можете захотіти з будь-якої. Наприклад, є PostgreSQL, Oracle, MySQL, H2. Кожна з цих баз даних постачається окремою компанією, яка називається постачальниками баз даних або database vendors. Кожна база даних написана якоюсь своєю мовою програмування (не обов'язково Java). Щоб з базою даних можна було працювати з Java програми, постачальник бази даних пише особливий драйвер, який є свого образу адаптером. Такі JDBC сумісні (тобто які мають JDBC драйвер) ще називають "JDBC-Compliant Database". Тут можна здійснити аналогію з комп'ютерними пристроями. Наприклад, у блокноті є кнопка "Друк". Щоразу коли ви її натискаєте програма повідомляє операційну систему, що додаток блокнот хоче надрукувати. І маєте принтер. Щоб навчити розмовляти одночасно вашу операційну систему з принтером Canon або HP, знадобляться різні драйвери. Але для Вас, як користувача, нічого не зміниться. Ви, як і раніше, натискатимете одну і ту ж кнопку. Так само і з JDBC. Ви виконуєте той самий код, просто "під капотом" можуть працювати різні бази даних. Думаю тут дуже зрозумілий підхід. Кожен такий JDBC драйвер – це деякий артефакт, бібліотека, jar файл. Він і є залежністю для нашого проекту. Наприклад, ми можемо вибрати базу даних " Щоб навчити розмовляти одночасно вашу операційну систему з принтером Canon або HP, знадобляться різні драйвери. Але для Вас, як користувача, нічого не зміниться. Ви, як і раніше, натискатимете одну і ту ж кнопку. Так само і з JDBC. Ви виконуєте той самий код, просто "під капотом" можуть працювати різні бази даних. Думаю тут дуже зрозумілий підхід. Кожен такий JDBC драйвер – це деякий артефакт, бібліотека, jar файл. Він і є залежністю для нашого проекту. Наприклад, ми можемо вибрати базу даних " Щоб навчити розмовляти одночасно вашу операційну систему з принтером Canon або HP, знадобляться різні драйвери. Але для Вас, як користувача, нічого не зміниться. Ви, як і раніше, натискатимете одну і ту ж кнопку. Так само і з JDBC. Ви виконуєте той самий код, просто "під капотом" можуть працювати різні бази даних. Думаю тут дуже зрозумілий підхід. Кожен такий JDBC драйвер – це деякий артефакт, бібліотека, jar файл. Він і є залежністю для нашого проекту. Наприклад, ми можемо вибрати базу даних " Кожен такий JDBC драйвер – це деякий артефакт, бібліотека, jar файл. Він і є залежністю для нашого проекту. Наприклад, ми можемо вибрати базу даних " Кожен такий JDBC драйвер – це деякий артефакт, бібліотека, jar файл. Він і є залежністю для нашого проекту. Наприклад, ми можемо вибрати базу даних "<a href="http://www.h2database.com/html/cheatSheet.html" target="_blank" rel="nofollow">H2 Database</a> і тоді нам треба додати залежність наступним чином: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    implementation <span class="token string"><span class="token string">'com.h2database:h2:1.4.197'</span></span></code></pre> Те, як знайти залежність і як її описати вказано на офіційних сайтах постачальника БД або на <a href="https://mvnrepository.com/repos/central" target="_blank" rel="nofollow">Maven Central</a> . JDBC драйвер не є базою даних, як ви зрозуміли. А лише є провідником до неї. Але є таке поняття, як " <a href="http://www.h2database.com/html/features.html#in_memory_databases" target="_blank" rel="nofollow">In memory databases</a> ". Це такі бази даних, які існують у пам'яті на час життя вашої програми. Зазвичай це часто використовують для тестування або для навчальних цілей. Це дозволяє не ставити окремий сервер баз даних на машині. Що нам дуже підійде для знайомств з JDBC. Ось і готова наша пісочниця, і ми приступаємо. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="9a5233ae-4a8d-4cff-a6b4-b96ff5cc65ae" data-max-width="284" alt="JDBC або з чого все починається - 5" src="https://cdn.javarush.com/images/article/9a5233ae-4a8d-4cff-a6b4-b96ff5cc65ae/256.jpeg" style="width: 284px;">
 </div>
</div>
<h2>Connection</h2>Отже, ми маємо JDBC драйвер, є JDBC API. Як ми пам'ятаємо, JDBC розшифровується як Java DataBase Connectivity. Тому все починається з Connectivity - можливості встановлювати підключення. А підключення – це Connection. Звернемося знову до тексту <a href="http://download.oracle.com/otn-pub/jcp/jdbc-4_1-mrel-spec/jdbc4.1-fr-spec.pdf" target="_blank" rel="nofollow">специфікації JDBC</a> і подивимося на зміст. У розділі " <strong>CHAPTER 4 Overview</strong> " (overview - огляд) звернемося до розділу " <strong>4.1 Establishing a Connection</strong> " (встановлення з'єднання) сказано, що є два способу підключення до БД: 
<ul>
 <li>Через DriverManager</li>
 <li>Через DataSource</li>
</ul>Розберемося з DriverManager'ом. Як сказано, DriverManager дозволяє підключитися до бази даних за вказаною URL, а також завантажує JDBC Driver'и, який він знайшов у CLASSPATH (а раніше, до JDBC 4.0 завантажувати клас драйвера треба було самостійно). Для з'єднання з БД є окремий розділ "CHAPTER 9 Connections". Нас цікавить, як отримати з'єднання через DriverManager, тому нам цікавий розділ "9.3 The DriverManager Class". У ньому зазначено, як ми можемо отримати доступ до БД: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Connection</span></span> con <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">DriverManager</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>url<span class="token punctuation"><span class="token punctuation">,</span></span> user<span class="token punctuation"><span class="token punctuation">,</span></span> passwd<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Параметри можна взяти із сайту обраної нами бази даних. У нашому випадку це H2 - " <a href="http://www.h2database.com/html/cheatSheet.html" target="_blank" rel="nofollow">H2 Cheat Sheet</a> ". Перейдемо до підготовленого Gradle'ом класу AppTest. Він містить тести JUnit. JUnit тест - це метод, який позначений інструкцією <code class=" language-none">@Test</code>. Юніт тести є темою даного огляду, тому просто обмежимося розумінням те, що це описані певним чином методи, мета яких щось протестувати. Відповідно до специфікації JDBC та сайту H2 перевіримо, що ми отримали підключення до БД. Напишемо метод отримання підключення: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Connection</span></span> <span class="token function"><span class="token function">getNewConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> url <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"jdbc:h2:mem:test"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> user <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"sa"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> passwd <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"sa"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> <span class="token class-name"><span class="token class-name">DriverManager</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>url<span class="token punctuation"><span class="token punctuation">,</span></span> user<span class="token punctuation"><span class="token punctuation">,</span></span> passwd<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер напишемо тест для цього методу, який перевірить, що підключення справді встановлюється: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldGetJdbcConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Connection</span></span> connection <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getNewConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isValid</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
		<span class="token function"><span class="token function">assertFalse</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isClosed</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Даний тест при виконанні перевірить, що отримане підключення є валідним (коректно створеним) і що воно не закрите. Завдяки використанню конструкції <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html" target="_blank" rel="nofollow">try-with-resources</a> ми звільнимо ресурси після того, як вони нам більше не потрібні. Це вбереже нас від "провислих" з'єднань та витоків пам'яті. Так як будь-які дії з БД вимагають підключення, то давайте для інших тестових методів, помічених @ Test, забезпечимо на початку тесту Connection, який ми звільнимо після тесту. Для цього нам знадобиться дві анотації: @Before та @After Додамо до класу AppTest нове поле, яке зберігатиме JDBC підключення для тестів: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">static</span></span> <span class="token class-name"><span class="token class-name">Connection</span></span> connection<span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> І додамо нові методи: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Before</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">init</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	connection <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getNewConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@After</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">close</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер будь-якому тестовому методу гарантується наявність JDBC connection і він не повинен щоразу сам його створювати. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="200" alt="JDBC або з чого все починається - 6" src="https://cdn.javarush.com/images/article/91db5db3-2308-4d78-ae35-aced4ef73f8c/original.jpeg">
 </div>
</div>
<h2>Statements</h2>Далі нас цікавить держава або вирази. Вони описані у документації у розділі " <strong>CHAPTER 13 Statements</strong> " . По-перше, там сказано, що існує кілька типів чи видів statement'ів: 
<ul>
 <li>Statement: SQL вираз, який не містить параметрів</li>
 <li>PreparedStatement : Підготовлений SQL вираз, що містить вхідні параметри</li>
 <li>CallableStatement : SQL вираз із можливістю отримати повертається значення зі збережених процедур (SQL Stored Procedures).</li>
</ul>Отже, маючи підключення, ми можемо в рамках цього підключення виконати запит. Тому, логічно, що екземпляр виразу SQL спочатку ми отримуємо з Connection. Почати потрібно із створення таблиці. Опишемо запит створення таблиці у вигляді змінної типу String. Як це зробити? Скористаємося якимось навчальним керівництвом, на кшталт " <a href="http://www.sqltutorial.org/sql-create-table/" target="_blank" rel="nofollow">sqltutorial.org</a> ", " <a href="https://sqlbolt.com/lesson/creating_tables" target="_blank" rel="nofollow">sqlbolt.com</a> ", " <a href="http://www.postgresqltutorial.com/postgresql-create-table/" target="_blank" rel="nofollow">postgresqltutorial.com</a> ", " <a href="https://www.codecademy.com/learn/learn-sql" target="_blank" rel="nofollow">codecademy.com</a> ". Скористайтеся прикладом з курсу SQL на <a href="https://www.khanacademy.org/computing/computer-programming/sql/sql-basics/pt/creating-a-table-and-inserting-data" target="_blank" rel="nofollow">khanacademy.org</a> . Додамо метод виконання вираження у БД: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> <span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> query<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Statement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token comment"><span class="token comment">// Для Insert, Update, Delete</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> result <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> result<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Додамо метод створення тестової таблиці з використанням минулого методу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">createCustomerTable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> customerTableQuery <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"CREATE TABLE customers "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"(id INTEGER PRIMARY KEY, name TEXT, age INTEGER)"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> customerEntryQuery <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"INSERT INTO customers "</span></span> <span class="token operator"><span class="token operator">+</span></span>
                <span class="token string"><span class="token string">"VALUES (73, 'Brian', 33)"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>customerTableQuery<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>customerEntryQuery<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер протестуємо це: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldCreateCustomerTable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token function"><span class="token function">createCustomerTable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SELECT * FROM customers"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер давайте виконаємо запит, та ще й із параметром: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldSelectData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 	<span class="token function"><span class="token function">createCustomerTable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 	<span class="token class-name"><span class="token class-name">String</span></span> query <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"SELECT * FROM customers WHERE name = ?"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">PreparedStatement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">prepareStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Brian"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">boolean</span></span> hasResult <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>hasResult<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> JDBC не підтримує іменовані параметри для PreparedStatement, тому самі параметри вказуються питаннями, а вказуючи значення, ми вказуємо індекс питання (починаючи з 1, а не з нуля). В останньому тесті ми отримали true як ознаку того, чи є результат. Але як наведено результат запиту в JDBC API? А представлений він як ResultSet. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="250" alt="JDBC або з чого все починається - 7" src="https://cdn.javarush.com/images/article/8fb69684-bfcd-4d0e-a2b8-25ea9d0a709c/original.jpeg">
 </div>
</div>
<h2>ResultSet</h2>Поняття ResultSet описано у специфікації JDBC API у розділі "CHAPTER 15 Result Sets". Перш за все там сказано, що ResultSet надає методи для отримання та маніпуляції результатами виконаних запитів. Тобто якщо метод execute повернув нам true, то ми можемо отримати і ResultSet. Давайте винесемо виклик методу createCustomerTable() метод init, який відзначений як @Before. Тепер доопрацюємо наш тест shouldSelectData: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldSelectData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> query <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"SELECT * FROM customers WHERE name = ?"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">PreparedStatement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">prepareStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"Brian"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">boolean</span></span> hasResult <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>hasResult<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token comment"><span class="token comment">// Обработаем результат</span></span>
	<span class="token class-name"><span class="token class-name">ResultSet</span></span> resultSet <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResultSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> age <span class="token operator"><span class="token operator">=</span></span> resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"age"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">assertEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">33</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> age<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут слід зазначити, що next - це спосіб, який рухає так званий "курсор". Курсор ResultSet вказує на деякий рядок. Таким чином, щоб рахувати рядок, на нього потрібно цей курсор встановити. Коли курсор переміщається, метод переміщення курсора повертає true, якщо курсор валідний (правильний, коректний), тобто вказує на дані. Якщо повертає false, то даних немає, тобто курсор не вказує на дані. Якщо спробувати отримати дані з невалідним курсором, ми отримаємо помилку: No data is available Ще цікаво, що через ResultSet можна оновлювати або навіть вставляти рядки: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldInsertInResultSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Statement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ResultSet</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>TYPE_SCROLL_SENSITIVE<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">ResultSet</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>CONCUR_UPDATABLE<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">ResultSet</span></span> resultSet <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeQuery</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SELECT * FROM customers"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">moveToInsertRow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">updateLong</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"id"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">3L</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">updateString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"name"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"John"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">updateInt</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"age"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token number"><span class="token number">18</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">insertRow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">moveToCurrentRow</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h2>RowSet</h2>JDBC окрім ResultSet вводить таке поняття, як RowSet. Докладніше можна прочитати тут: " <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/rowset.html" target="_blank" rel="nofollow">JDBC Basics: Using RowSet Objects</a> ". Існують різні варіації використання. Наприклад, найпростіший випадок може виглядати так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldUseRowSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
 	<span class="token class-name"><span class="token class-name">JdbcRowSet</span></span> jdbcRs <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">JdbcRowSetImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>connection<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 	jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setCommand</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SELECT * FROM customers"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> name <span class="token operator"><span class="token operator">=</span></span> jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"name"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">assertEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Brian"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> name<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як видно, RowSet схожий на симбіоз statement (ми вказали через нього command) і виконали command. Через нього ж ми керуємо курсором (викликаючи метод next) і з нього отримуємо дані. Цікавим є не тільки такий підхід, а й можливі реалізації. Наприклад, CachedRowSet. Він є "відключеним" (тобто не використовує постійне підключення до БД) і вимагає явного синхронізації з БД: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">CachedRowSet</span></span> jdbcRsCached <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CachedRowSetImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
jdbcRsCached<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">acceptChanges</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>connection<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Докладніше можна прочитати в tutorial на сайті Oracle: " <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/cachedrowset.html" target="_blank" rel="nofollow">Using CachedRowSetObjects</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="94060f13-dab0-4210-b9e5-370cc4c03bf6" data-max-width="304" alt="JDBC або з чого все починається - 8" src="https://cdn.javarush.com/images/article/94060f13-dab0-4210-b9e5-370cc4c03bf6/256.jpeg" style="width: 304px;">
 </div>
</div>
<h2>Metadata</h2>Окрім запитів, підключення до БД (тобто екземпляр класу Connection) надає доступ до метаданих - даних про те, як налаштована та як влаштована наша база даних. Але спочатку озвучимо кілька ключових моментів: URL підключення до нашої БД: "jdbc:h2:mem:test". test – це назва нашої бази даних. Для JDBC API це каталог. І назва буде у верхньому регістрі, тобто TEST. Схема за замовчуванням ( <a href="http://www.h2database.com/html/grammar.html#set_schema" target="_blank" rel="nofollow">Default schema</a>) для H2 - PUBLIC. Тепер, напишемо тест, який показує всі таблиці користувача. Чому користувацькі? Тому що в базах даних є не тільки користувацькі (ті, які ми самі створабо за допомогою create table виразів), а й системні таблиці. Вони необхідні для зберігання системної інформації про структуру БД. У кожній БД такі системні таблиці можуть зберігатися по-різному. Наприклад, в H2 вони зберігаються у схемі " <a href="http://www.h2database.com/html/systemtables.html" target="_blank" rel="nofollow">INFORMATION_SCHEMA</a> ". Цікаво, що INFORMATION SCHEMA є загальним підходом, але Oracle пішли іншим шляхом. Докладніше можна прочитати тут: " <a href="http://www.sql-tutorial.ru/ru/book_information_schema_and_oracle.html" target="_blank" rel="nofollow">INFORMATION_SCHEMA і Oracle</a> ". Напишемо тест, який отримує метадані за таблицями користувача: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shoudGetMetadata</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token comment"><span class="token comment">// У нас URL = "jdbc:h2:mem:test", где test - название БД</span></span>
	<span class="token comment"><span class="token comment">// Название БД = catalog</span></span>
	<span class="token class-name"><span class="token class-name">DatabaseMetaData</span></span> metaData <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMetaData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">ResultSet</span></span> result <span class="token operator"><span class="token operator">=</span></span> metaData<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getTables</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"TEST"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"PUBLIC"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"%"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> tables <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ArrayList</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">while</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		tables<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">add</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">+</span></span> <span class="token string"><span class="token string">"."</span></span> <span class="token operator"><span class="token operator">+</span></span> result<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getString</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">3</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>tables<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">contains</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"PUBLIC.CUSTOMERS"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="783c4154-aa44-41f9-babf-64a35b76c027" data-max-width="812" alt="JDBC або з чого все починається." src="https://cdn.javarush.com/images/article/783c4154-aa44-41f9-babf-64a35b76c027/800.jpeg" style="width: 812px;">
 </div>
</div>
<h2>Пул підключень</h2>Пулу підключень у специфікації JDBC відведено розділ "Chapter 11 Connection Pooling". У ньому ж дається головне обґрунтування необхідності пулу підключень. Кожен Coonection – це фізичне підключення до БД. Його створення та закриття - досить "дорога" робота. JDBC надає лише API для пулу з'єднань. Тому вибір реалізації залишається за нами. Наприклад, до таких реалізацій відноситься <a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="nofollow">HikariCP</a> . Відповідно, нам знадобиться додати пул до нас залежно від проекту: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    implementation <span class="token string"><span class="token string">'com.h2database:h2:1.4.197'</span></span>
    implementation <span class="token string"><span class="token string">'com.zaxxer:HikariCP:3.3.1'</span></span>
    testImplementation <span class="token string"><span class="token string">'junit:junit:4.12'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тепер треба якось цей пул задіяти. Для цього потрібно виконати ініціалізацію джерела даних, він також може бути виконаний з Datasource: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">DataSource</span></span> <span class="token function"><span class="token function">getDatasource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">HikariConfig</span></span> config <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HikariConfig</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	config<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sa"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	config<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setPassword</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sa"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	config<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setJdbcUrl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"jdbc:h2:mem:test"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">DataSource</span></span> ds <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">HikariDataSource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>config<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">return</span></span> ds<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> І напишемо тест на отримання підключення з пулу: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldGetConnectionFromDataSource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">DataSource</span></span> datasource <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getDatasource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Connection</span></span> con <span class="token operator"><span class="token operator">=</span></span> datasource<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>con<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isValid</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">1</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="3a5d6d7f-da70-4c4a-b3f4-6952f5bda7ba" data-max-width="303" alt="JDBC або з чого все починається - 10" src="https://cdn.javarush.com/images/article/3a5d6d7f-da70-4c4a-b3f4-6952f5bda7ba/256.jpeg" style="width: 303px;">
 </div>
</div>
<h2>Транзакції</h2>Один із найцікавіших моментів, пов'язаних з JDBC – це транзакції. У специфікації JDBC їм відведено розділ "CHAPTER 10 Transactions". Насамперед варто зрозуміти, що ж таке транзакція. Транзакція — це група логічно об'єднаних послідовних операцій із роботі з даними, оброблювана чи отменяемая цілком. Коли починається транзакція під час використання JDBC? Як свідчить специфікація, це безпосередньо вирішує JDBC Driver. Але зазвичай, нова транзакція починається тоді, коли поточний SQL вираз (SQL statement) вимагатиме транзакцію і транзакції ще створено. Коли закінчується транзакція? Це регулюється атрибутом автокомміту (auto-commit). Якщо автокомміт увімкнено, то транзакція буде завершена після того, як SQL вираз буде "виконано". Що таке "виконано" залежить від типу SQL виразу: 
<ul>
 <li>Data Manipulation Language, він же DML (Insert, Update, Delete) <br>
   Транзакція завершується як тільки завершилося виконання дії</li>Select Statements 
 <br>
  Транзакція завершується тоді, коли ResultSet буде закрито ( <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html#close--" target="_blank" rel="nofollow">ResultSet#close</a> ) 
 <li>CallableStatement і вирази, що повертають кілька результатів <br>
   Коли всі асоційовані ResultSets будуть закриті і всі вихідні дані отримані (включаючи кількість апдейтів)</li>
</ul>Так поводиться саме JDBC API. Як завжди, напишемо на це тест: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldCommitTransaction</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setAutoCommit</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> query <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"INSERT INTO customers VALUES (1, 'Max', 20)"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>query<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">commit</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">Statement</span></span> statement <span class="token operator"><span class="token operator">=</span></span> connection<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
 	statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SELECT * FROM customers"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">ResultSet</span></span> resultSet <span class="token operator"><span class="token operator">=</span></span> statement<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getResultSet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> count <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">while</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>resultSet<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		count<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token function"><span class="token function">assertEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> count<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Все просто. Але це так, поки що у нас лише одна транзакція. А що робити, коли їх дещо? Потрібно їх ізолювати один від одного. Тому поговоримо про рівні ізоляції транзакції і як з ними справляється JDBC. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="aca63374-0e45-4a69-be8b-27f1c52cbe4a" data-max-width="363" alt="JDBC або з чого все починається - 11" src="https://cdn.javarush.com/images/article/aca63374-0e45-4a69-be8b-27f1c52cbe4a/256.jpeg" style="width: 363px;">
 </div>
</div>
<h2>Рівні ізоляції</h2>Відкриємо підрозділ "10.2 Transaction Isolation Levels" специфікації JDBC. Тут перш ніж далі рухатися хочеться сумніватися про таку штуку, як ACID. ACID визначає вимоги до транзакційної системи. 
<ul>
 <li>Atomicity(Атомарність): <br>
   Ніяка транзакція не буде зафіксована в системі частково. Будуть або виконані її підоперації, або виконано жодної.</li>
 <li>Consistency(Узгодженість): <br>
   Кожна успішна транзакція за визначенням фіксує лише допустимі результати.</li>
 <li>Isolation(Ізольованість): <br>
   Під час виконання транзакції паралельні транзакції не повинні впливати на її результат.</li>
 <li>Durability(Довговічність): <br>
   Якщо транзакція успішно завершена, зроблені в ній зміни не будуть скасовані через будь-який збій.</li>
</ul>Говорячи про рівні ізоляції транзакції, ми говоримо саме про вимогу "Isolation". Ізольованість - вимога "дорогою", тому в реальних БД існують режими, що не повністю ізолюють транзакцію (рівні ізольованості Repeatable Read і нижче). На вікіпедії є відмінне пояснення того, які проблеми можуть виникати під час роботи з транзакціями. Докладніше варто прочитати тут: " <a href="https://ru.wikipedia.org/wiki/%D0%A3%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C_%D0%B8%D0%B7%D0%BE%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D1%82%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%B9#%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B_%D0%BF%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D1%81_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC_%D1%82%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%B9" target="_blank" rel="nofollow">Проблеми паралельного доступу з використанням транзакцій</a> ". Перш ніж ми напишемо наш тест, давайте трохи змінимо наш Gradle Build Script: додамо блок із properties, тобто з налаштуваннями нашого проекту: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">ext <span class="token punctuation"><span class="token punctuation">{</span></span>
    h2Version <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">'1.3.176'</span></span> <span class="token comment"><span class="token comment">// 1.4.177</span></span>
    hikariVersion <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">'3.3.1'</span></span>
    junitVersion <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">'4.12'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Далі, використовуємо це у версіях: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    implementation <span class="token string"><span class="token string">"com.h2database:h2:${h2Version}"</span></span>
    implementation <span class="token string"><span class="token string">"com.zaxxer:HikariCP:${hikariVersion}"</span></span>
    testImplementation <span class="token string"><span class="token string">"junit:junit:${junitVersion}"</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ви могли помітити, що версія h2 стала нижчою. Пізніше ми побачимо навіщо. Отже, як застосовувати рівні ізольованості? Давайте подивимося відразу невеликий практичний приклад: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Test</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">shouldGetReadUncommited</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">SQLException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
	<span class="token class-name"><span class="token class-name">Connection</span></span> first <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getNewConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token function"><span class="token function">assertTrue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>first<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getMetaData</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">supportsTransactionIsolationLevel</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Connection</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>TRANSACTION_READ_UNCOMMITTED<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	first<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setTransactionIsolation</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Connection</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>TRANSACTION_READ_UNCOMMITTED<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	first<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setAutoCommit</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token comment"><span class="token comment">// Транзакиця на подключение. Поэтому первая транзакция с ReadUncommited вносит изменения</span></span>
	<span class="token class-name"><span class="token class-name">String</span></span> insertQuery <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"INSERT INTO customers VALUES (5, 'Max', 15)"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	first<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">createStatement</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">executeUpdate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>insertQuery<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token comment"><span class="token comment">// Вторая транзакция пытается их увидеть</span></span>
	<span class="token keyword"><span class="token keyword">int</span></span> rowCount <span class="token operator"><span class="token operator">=</span></span> <span class="token number"><span class="token number">0</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token class-name"><span class="token class-name">JdbcRowSet</span></span> jdbcRs <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">JdbcRowSetImpl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">getNewConnection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setCommand</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"SELECT * FROM customers"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">execute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token keyword"><span class="token keyword">while</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>jdbcRs<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">next</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
		rowCount<span class="token operator"><span class="token operator">++</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
	<span class="token punctuation"><span class="token punctuation">}</span></span>
	<span class="token function"><span class="token function">assertEquals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token number"><span class="token number">2</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> rowCount<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Цікаво, що цей тест може впасти на вендорі, який не підтримує TRANSACTION_READ_UNCOMMITTED (наприклад, SQLite або HSQL). А ще рівень транзакції може просто не спрацювати. Чи пам'ятаєте ми вказували версію драйвера H2 Database? Якщо ми піднімемо її до h2Version = '1.4.177' і вище, то READ UNCOMMITTED перестане працювати, хоча код ми не змінювали. Це ще раз доводить, що вибір вендора та версії драйвера - це не просто літери, від цього насправді залежатиме те, як виконуватимуться ваші запити. Про те, як виправити цю поведінку у версії 1.4.177 і як це не працює у версіях вище можна прочитати тут: " <a href="https://github.com/h2database/h2database/issues/216" target="_blank" rel="nofollow">Support READ UNCOMMITTED isolation level in MVStore mode</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="131" alt="JDBC або з чого все починається - 12" src="https://cdn.javarush.com/images/article/6f38f710-4c47-47b0-8002-09b8cfe19cff/original.jpeg">
 </div>
</div>
<h2>Підсумок</h2>Як бачимо, JDBC — це потужний інструмент Java для роботи з базами даних. Сподіваюся, цей невеликий огляд допоможе стати для Вас відправною точкою або допоможе освіжити в пам'яті щось. Ну і на закуску трохи додаткових матеріалів: 
<ul>
 <li>Вогняна доповідь: " <a href="https://www.youtube.com/watch?v=5ZjhNTM8XU8" target="_blank" rel="nofollow">Transactions: myths, surprises and opportunities</a> " від Martin Kleppmann</li>
 <li>Юрій Ткач: " <a href="https://www.youtube.com/watch?v=4PKZRQAtf38&amp;t=90s" target="_blank" rel="nofollow">JPA. Транзакції</a> "</li>
 <li>Юрик Ткач: " <a href="https://www.youtube.com/watch?v=aje9gtFEyC4" target="_blank" rel="nofollow">JDBC - Java для тестувальників</a> "</li>
 <li>Безкоштовний курс на Udemy: " <a href="https://www.udemy.com/how-to-connect-java-jdbc-to-mysql" target="_blank" rel="nofollow">JDBC and MySQL</a> "</li>
 <li>" <a href="https://www.ibm.com/developerworks/ru/library/dm-0802tiwary/index.html" target="_blank" rel="nofollow">Обробка об'єктів CallableStatement</a> "</li>
 <li>IBM Developer: " <a href="https://developer.ibm.com/articles/j-5things10/" target="_blank" rel="nofollow">Java Database Connectivity</a> "</li>
 <li>IBM Knowledge Center: " <a href="https://www.ibm.com/support/knowledgecenter/en/ssw_ibm_i_71/rzaha/jdbcgets.htm" target="_blank" rel="nofollow">Getting started with JDBC</a> "</li>
</ul> #Viacheslav 
<div class="email-subscription">
 <iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no" data-savepage-key="0-2"></iframe>
</div>