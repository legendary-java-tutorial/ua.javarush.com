Проблеми з продуктивністю SQL, що виникають через "непотрібну, але обов'язкову роботу"
<p>----------------------------------------</p>
загальне уявлення про бази даних та SQL, невеликий практичний досвід роботи із СУБД. Ймовірно, найважливіше, чого тільки можна навчитися для написання ефективних SQL-запитів – це індексація. Однак на другому місці, з дуже невеликим відстава
<p>----------------------------------------</p>
<em>Рівень необхідних знань для розуміння стати:</em> загальне уявлення про бази даних та SQL, невеликий практичний досвід роботи із СУБД. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="27633b8c-93c9-4dc9-9304-24013bc9feb4" data-max-width="600" alt="Проблеми з продуктивністю SQL, що виникають через" src="https://cdn.javarush.com/images/article/27633b8c-93c9-4dc9-9304-24013bc9feb4/512.jpeg" style="width: 600px;">
 </div>
</div> Ймовірно, найважливіше, чого тільки можна навчитися для написання ефективних SQL-запитів – це індексація. Однак на другому місці, з дуже невеликим відставанням, йде знання про те, що безліч SQL-клієнтів вимагають від бази даних виконання маси <strong>"непотрібної, але обов'язкової роботи"</strong> . Повторюйте за мною: 
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td align="center">Непотрібна, але обов'язкова робота</td>
   </tr>
  </tbody>
 </table>
</div>Що ж таке "непотрібна, але обов'язкова робота"? Як підказує нам, Капітан Очевидність, вона: 
<h3>Непотрібна</h3>Нехай нашому клієнтському додатку необхідні такі дані: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="788c09f3-a7d0-4cfa-b74d-9e9067f9a226" data-max-width="450" alt="Проблеми з продуктивністю SQL, що виникають через" src="https://cdn.javarush.com/images/article/788c09f3-a7d0-4cfa-b74d-9e9067f9a226/256.jpeg" style="width: 450px;">
 </div>
</div>Нічого незвичайного. Ми працюємо з базою даних фільмів (наприклад, <a href="https://www.jooq.org/sakila" target="_blank">базою даних Sakila</a> ) і хочемо відображати користувачам назву та рейтинг усіх фільмів. Потрібний результат може дати наступний запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name">SELECT</span> title<span class="token punctuation">,</span> rating
FROM film</code></pre> Однак наш додаток (або наш ORM), замість цього, виконує такий запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java">SELECT <span class="token operator">*</span>
FROM film</code></pre> Що ми отримуємо в результаті? Вгадайте. Ми отримуємо масу марної інформації: 
<center>
 <img data-id="361ac3dd-0a6f-44f6-8fb5-afde7d960560" data-max-width="1000" alt="Проблеми з продуктивністю SQL, що виникають через" src="https://cdn.javarush.com/images/article/361ac3dd-0a6f-44f6-8fb5-afde7d960560/800.jpeg" style="width: 1000px;">
</center>Справа тут навіть видніється якийсь складний JSON, що завантажується: 
<ul>
 <li>з диску</li>
 <li>у кеш</li>
 <li>по дротах</li>
 <li>на згадку про клієнта</li>
 <li>і, нарешті, викидається [через непотрібність]</li>
</ul>Так, ми викидаємо більшу частину цієї інформації. Усі виконані для отримання цієї інформації дії виявабося абсолютно марними. Правда? Щоправда. 
<h3>Обов'язкова</h3>А тепер – найгірше. Хоча оптимізатори зараз вміють чимало, ці дії є обов'язковими для бази даних. База даних ніяк не може дізнатися, що клієнтському додатку 95% цих даних не потрібно. І це лише найпростіший приклад. Уявіть собі з'єднання кількох таблиць... Ну і що, скажете ви, бази даних же швидкі? Дозвольте просвітити вас про деякі речі, про які ви, мабуть, не замислювалися. Звичайно, час виконання окремого запиту ні на що не впливає. Гаразд, він виповнився в півтора рази повільніше, але ж ми це переживемо, правда? Заради зручності? Іноді це так. Але якщо жертвувати продуктивністю заради зручності <em>завжди</em>, ці дрібниці почнуть накопичуватися. Йтиметься вже не про продуктивність (швидкість виконання окремих запитів), а про пропускну спроможність (часу відгуку системи) і тоді почнуться неабиякі проблеми, вирішити які не так вже й просто. Тоді ви й втратите масштабованість. Погляньмо на плани виконання, в даному випадку, СУБД Oracle: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>         <span class="token operator">|</span> <span class="token class-name">Name</span> <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span> <span class="token class-name">Bytes</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT  <span class="token operator">|</span>      <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>   <span class="token number">166</span>K<span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  TABLE ACCESS FULL<span class="token operator">|</span> FILM <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span>   <span class="token number">166</span>K<span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></code></pre> порівняно з: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>         <span class="token operator">|</span> <span class="token class-name">Name</span> <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span> <span class="token class-name">Bytes</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT  <span class="token operator">|</span>      <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">20000</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  TABLE ACCESS FULL<span class="token operator">|</span> FILM <span class="token operator">|</span>  <span class="token number">1000</span> <span class="token operator">|</span> <span class="token number">20000</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></code></pre> При виконанні запиту SELECT * замість SELECT title rating використовується в 8 разів більше пам'яті в базі даних. Нічого несподіваного, правда? Ми знали, що так буде. Але все одно ми погоджуємося з цим для багатьох наших запитів, у яких усі ці дані нам просто не потрібні. Ми створюємо для бази даних <strong>непотрібну, але обов'язкову роботу</strong> , яка все накопичується та накопичується. Ми використовуємо у 8 разів більше пам'яті, ніж потрібно (множник змінюватиметься, звичайно). А між тим, на всіх інших етапах (дискове введення/виведення, передача даних по мережі, споживання пам'яті клієнтом) проблеми точно ті ж, але я їх пропущу, а погляну, натомість, на... 
<h3>Використання індексів</h3>Більшість баз даних, на сьогодні, вже гідно оцінабо концепцію <a href="https://blog.jooq.org/2015/04/28/do-not-think-that-one-second-is-fast-for-query-execution/" target="_blank">покриваючих індексів</a> (covering indexes). Покриваючий індекс – сам собою не є якимось особливим видом індексу. Але він може виявитися "особливим індексом" для конкретного запиту або "випадково", або тому, що так було задумано. Розглянемо наступний запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java">SELECT <span class="token operator">*</span>
FROM actor
WHERE last_name LIKE <span class="token string">'A%'</span></code></pre> Нічого несподіваного щодо його виконання не видно. Це найпростіший запит. Перегляд діапазону за індексом, доступ до таблиці – і готове: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>                   <span class="token operator">|</span> <span class="token class-name">Name</span>                <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT            <span class="token operator">|</span>                     <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  TABLE ACCESS BY INDEX ROWID<span class="token operator">|</span> ACTOR               <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">2</span> <span class="token operator">|</span>   INDEX RANGE SCAN          <span class="token operator">|</span> IDX_ACTOR_LAST_NAME <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></code></pre> Гарний план, чи не так? Ну, якщо нам правда було потрібно ось це, то ні: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="419549b7-2353-4838-bfde-6d82c9fd9551" data-max-width="300" alt="Проблеми з продуктивністю SQL, що виникають через" src="https://cdn.javarush.com/images/article/419549b7-2353-4838-bfde-6d82c9fd9551/256.jpeg" style="width: 300px;">
 </div>
</div>Очевидно, що ми даремно витрачаємо пам'ять тощо. Давайте розглянемо такий запит як альтернативний варіант: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">SELECT</span> first_name<span class="token punctuation">,</span> last_name
FROM actor
WHERE last_name LIKE <span class="token string">'A%'</span></code></pre> Його план такий: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>        <span class="token operator">|</span> <span class="token class-name">Name</span>            <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT <span class="token operator">|</span>                 <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  INDEX RANGE SCAN<span class="token operator">|</span> IDX_ACTOR_NAMES <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></code></pre> Нам вдалося повністю виключити доступ до таблиці, завдяки наявності індексу, що задовольняє всі потреби нашого запиту... покриває індексу. Чи це важливо? Ще й як! Цей підхід дозволяє прискорити деякі запити на порядок (або сповільнити їх на порядок, коли індекс перестає бути покривальним після зміни). Індексами, що покривають, можна скористатися не завжди. За індекси доводиться платити і додавати занадто багато їх не слід. Але в даному випадку все очевидно. Давайте оцінимо продуктивність: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">SET SERVEROUTPUT ON
DECLARE
  v_ts TIMESTAMP<span class="token punctuation">;</span>
  v_repeat CONSTANT NUMBER <span class="token operator">:</span><span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
BEGIN
  v_ts <span class="token operator">:</span><span class="token operator">=</span> SYSTIMESTAMP<span class="token punctuation">;</span>

  FOR i IN <span class="token number">1.</span><span class="token punctuation">.</span>v_repeat LOOP
    FOR rec IN <span class="token punctuation">(</span>
      <span class="token operator">--</span> Наихудший вариант запита<span class="token operator">:</span> перерасход памяти ПЛЮС доступ к таблице
      SELECT <span class="token operator">*</span>
      FROM actor
      WHERE last_name LIKE <span class="token string">'A%'</span>
    <span class="token punctuation">)</span> <span class="token class-name">LOOP</span>
      NULL<span class="token punctuation">;</span>
    <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>
  <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>

  dbms_output<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span><span class="token string">'Оператор 1 : '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>SYSTIMESTAMP <span class="token operator">-</span> v_ts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_ts <span class="token operator">:</span><span class="token operator">=</span> SYSTIMESTAMP<span class="token punctuation">;</span>

  FOR i IN <span class="token number">1.</span><span class="token punctuation">.</span>v_repeat LOOP
    FOR rec IN <span class="token punctuation">(</span>
      <span class="token operator">--</span> Улучшенный запит<span class="token punctuation">,</span> но все равно с доступом к таблице
      SELECT <span class="token comment">/*+INDEX(actor(last_name))*/</span>
        first_name<span class="token punctuation">,</span> last_name
      FROM actor
      WHERE last_name LIKE <span class="token string">'A%'</span>
    <span class="token punctuation">)</span> <span class="token class-name">LOOP</span>
      NULL<span class="token punctuation">;</span>
    <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>
  <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>

  dbms_output<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span><span class="token string">'Оператор 2 : '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>SYSTIMESTAMP <span class="token operator">-</span> v_ts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v_ts <span class="token operator">:</span><span class="token operator">=</span> SYSTIMESTAMP<span class="token punctuation">;</span>

  FOR i IN <span class="token number">1.</span><span class="token punctuation">.</span>v_repeat LOOP
    FOR rec IN <span class="token punctuation">(</span>
      <span class="token operator">--</span> Оптимальный запит<span class="token operator">:</span> покрывающий индекс
      SELECT <span class="token comment">/*+INDEX(actor(last_name, first_name))*/</span>
        first_name<span class="token punctuation">,</span> last_name
      FROM actor
      WHERE last_name LIKE <span class="token string">'A%'</span>
    <span class="token punctuation">)</span> <span class="token class-name">LOOP</span>
      NULL<span class="token punctuation">;</span>
    <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>
  <span class="token class-name">END</span> LOOP<span class="token punctuation">;</span>

  dbms_output<span class="token punctuation">.</span><span class="token function">put_line</span><span class="token punctuation">(</span><span class="token string">'Оператор 3 : '</span> <span class="token operator">||</span> <span class="token punctuation">(</span>SYSTIMESTAMP <span class="token operator">-</span> v_ts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
END<span class="token punctuation">;</span>
<span class="token operator">/</span></code></pre>
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>
     <p>В результаті отримуємо:</p><br>
     <p>Оператор 1: +000000000 00:00:02.479000000</p>
     <p>Оператор 2 : +000000000 00:00:02.261000000</p>
     <p>Оператор 3 : +000000000 00:00:01.857000000</p></td>
   </tr>
  </tbody>
 </table>
</div>Зверніть увагу, що в таблиці actor всього 4 стовпці, так що різниця в продуктивності між операторами 1 і 2 не така вже й велика, але все ж таки значна. Зауважу також, що я скористався підказками оптимізатора Oracle, щоб оптимізатор вибирав конкретний індекс для запиту. Оператор 3 – безперечний переможець нашого забігу. Його продуктивність набагато краща, адже йдеться про виключно простий запит. Знову ж таки, коли ми пишемо SELECT *, то створюємо для бази даних <strong>непотрібну, але обов'язкову роботу</strong>вона не може оптимізувати. Вона не вибере індекс, що покриває, тому що у нього трохи вище накладні витрати, ніж у обраного їй індексу LAST_NAME, і, крім іншого, їй доводиться все одно звертатися до таблиці для вилучення нікому не потрібного стовпця LAST_UPDATE, наприклад. Але що глибше ми аналізуємо SELECT *, то гірше виявляються справи. Поговоримо про... 
<h3>SQL-перетворення</h3>Оптимізатори демонструють такі хороші результати тому, що перетворюють SQL-запити ( <a href="https://www.youtube.com/watch?v=wTPGW1PNy_Y" target="_blank">у своєму недавньому виступі на конференції Voxxed Days у Цюріху я розповідав, як це працює</a> ). Наприклад, існує надзвичайно потужне перетворення "виключення JOIN". Розглянемо наступне допоміжне уявлення, яке нам довелося створити, щоб не поєднувати всі ці таблиці щоразу вручну: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java">CREATE VIEW v_customer AS
SELECT
  c<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> c<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
  a<span class="token punctuation">.</span>address<span class="token punctuation">,</span> ci<span class="token punctuation">.</span>city<span class="token punctuation">,</span> co<span class="token punctuation">.</span>country
FROM customer c
JOIN address a USING <span class="token punctuation">(</span>address_id<span class="token punctuation">)</span>
JOIN city ci USING <span class="token punctuation">(</span>city_id<span class="token punctuation">)</span>
JOIN country co USING <span class="token punctuation">(</span>country_id<span class="token punctuation">)</span></code></pre> Це уявлення просто виконує все "...-до-одному" з'єднання між таблицею покупців CUSTOMER і різними таблицями частин їх адресаи. Дякую тобі, нормалізація. Уявіть, що, попрацювавши трохи з цим уявленням, ми до нього звикли і забули про таблиці, що лежать в його основі. І тепер ми виконуємо наступний запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java">SELECT <span class="token operator">*</span>
FROM v_customer</code></pre> Ми отримуємо в його результаті вельми значний план: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>            <span class="token operator">|</span> <span class="token class-name">Name</span>     <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span> <span class="token class-name">Bytes</span> <span class="token operator">|</span> <span class="token class-name">Cost</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT     <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">47920</span> <span class="token operator">|</span>   <span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  HASH JOIN           <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">47920</span> <span class="token operator">|</span>   <span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span>   TABLE ACCESS FULL  <span class="token operator">|</span> COUNTRY  <span class="token operator">|</span>   <span class="token number">109</span> <span class="token operator">|</span>  <span class="token number">1526</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">3</span> <span class="token operator">|</span>   HASH JOIN          <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">39534</span> <span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">4</span> <span class="token operator">|</span>    TABLE ACCESS FULL <span class="token operator">|</span> CITY     <span class="token operator">|</span>   <span class="token number">600</span> <span class="token operator">|</span> <span class="token number">10800</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">5</span> <span class="token operator">|</span>    HASH JOIN         <span class="token operator">|</span>          <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">28752</span> <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">6</span> <span class="token operator">|</span>     TABLE ACCESS FULL<span class="token operator">|</span> CUSTOMER <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">11381</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">7</span> <span class="token operator">|</span>     TABLE ACCESS FULL<span class="token operator">|</span> ADDRESS  <span class="token operator">|</span>   <span class="token number">603</span> <span class="token operator">|</span> <span class="token number">17487</span> <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></code></pre> Ну звичайно. База даних виконує всі ці з'єднання та повні перегляди таблиць, оскільки саме це ми і наказали їй зробити – витягти всі ці дані. Тепер, знову ж таки, уявіть собі, що насправді все, що нам було потрібно – це: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="250" alt="Проблеми з продуктивністю SQL, що виникають через" src="https://cdn.javarush.com/images/article/41f8d8a0-a2f1-4a1c-a979-f4d8eb5684c5/original.jpeg">
 </div>
</div>Що, серйозно, так? Тепер ви починаєте розуміти, про що я говорю. Але уявіть, що ми дечому навчабося на минулих помилках, і виконуємо такий, більш оптимальний запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name">SELECT</span> first_name<span class="token punctuation">,</span> last_name
FROM v_customer</code></pre> Тепер перевіримо, що вийшло! 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span> <span class="token class-name">Id</span>  <span class="token operator">|</span> <span class="token class-name">Operation</span>          <span class="token operator">|</span> <span class="token class-name">Name</span>        <span class="token operator">|</span> <span class="token class-name">Rows</span>  <span class="token operator">|</span> <span class="token class-name">Bytes</span> <span class="token operator">|</span> <span class="token class-name">Cost</span>  <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> SELECT STATEMENT   <span class="token operator">|</span>             <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">16173</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  NESTED LOOPS      <span class="token operator">|</span>             <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">16173</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span>   TABLE ACCESS FULL<span class="token operator">|</span> CUSTOMER    <span class="token operator">|</span>   <span class="token number">599</span> <span class="token operator">|</span> <span class="token number">11381</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">3</span> <span class="token operator">|</span>   INDEX UNIQUE SCAN<span class="token operator">|</span> SYS_C007120 <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span></code></pre><em>Разючі</em> зміни на краще у плані виконання. З'єднання були виключені, оскільки оптимізатор тепер може переконатися в їхній <strong>марності</strong>а якщо він здатний у цьому переконатися (а ви не зробабо цю роботу обов'язковою шляхом вибору *), то може і просто не робити всю цю роботу. Чому це так у цьому випадку? Зовнішній ключ CUSTOMER.ADDRESS_ID до первинного ключа ADDRESS.ADDRESS_ID гарантує рівно одне значення останнього, а значить і те, що операція JOIN буде з'єднанням типу "...-до одного", яке не збільшує і не зменшує кількість рядків. А якщо якихось рядків ми взагалі не вибираємо і не просимо, то ніякого сенсу взагалі їх завантажувати немає. Видалення JOIN, ймовірно, взагалі не вплине результат запиту. Бази даних роблять таке постійно. Можна виконати наступний запит на майже будь-якій базі даних: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span> <span class="token class-name">Oracle</span>
SELECT CASE <span class="token class-name">WHEN</span> EXISTS <span class="token punctuation">(</span>
  SELECT <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span> <span class="token class-name">FROM</span> dual
<span class="token punctuation">)</span> THEN <span class="token number">1</span> ELSE <span class="token number">0</span> END
FROM dual

<span class="token operator">--</span> Более адекватные диалекты SQL<span class="token punctuation">,</span> например<span class="token punctuation">,</span> <span class="token class-name">PostgreSQL</span>
<span class="token class-name">SELECT</span> EXISTS <span class="token punctuation">(</span>SELECT <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre> В даному випадку ви могли б очікувати на генерацію арифметичного виключення, як при виконанні наступного запиту: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">SELECT <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span> FROM dual</code></pre>
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>
     <p>Вийшло:</p><br>
     <p>ORA-01476: divisor is equal to zero</p></td>
   </tr>
  </tbody>
 </table>
</div>Але це не відбувається. Оптимізатор (або навіть синтаксичний аналізатор) може переконатися, що жодні елементи списку вибірки в предикаті EXISTS (SELECT ..) не змінять результату запиту, так що необхідності виконувати його немає. Ось так! 
<h3>Тим часом...</h3>Одна з неприємних проблем ORM полягає в тому, що в них так зручно писати запити SELECT *. Власне, наприклад, у HQL/JPQL вони взагалі використовуються за умовчанням. Можна взагалі опустити пропозицію SELECT, адже ми збираємося витягувати всю сутність цілком, правда? Наприклад: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">FROM v_customer</code></pre> Наприклад, <a href="https://vladmihalcea.com/2016/09/13/the-best-way-to-handle-the-lazyinitializationexception/" target="_blank">Влад Міхалче (Vlad Mihalcea), експерт та прихильник розробки за допомогою бібліотеки Hibernate</a>рекомендує використовувати [уточнені] запити практично завжди, коли ви впевнені, що не хочете зберегти будь-які зміни після вилучення. ORM сильно полегшують вирішення завдання збереження графів об'єктів. Примітка: Збереження. Завдання власне модифікації графів об'єктів та збереження змін нерозривно пов'язані. Але якщо робити цього ви не збираєтеся, то навіщо турбувати себе вилученням сутності? Чому не написати [уточнений] запит? Давайте чітко розберемося: з погляду продуктивності, написання запиту, спеціально підігнаного під ваш конкретний сценарій використання, свідомо краще за будь-який інший варіант. Можливо, вам байдуже, оскільки ваш набір даних невеликий і це не має значення. Чудово. Але коли, зрештою, вам знадобиться масштабованість, то перепроектувати свої програми під використання запитів замість імперативного обходу графа сутностей виявиться дуже непросто. А у вас буде чим зайнятися і без цього. 
<h3>Підрахунок рядків для з'ясування наявності чогось</h3>Один із випадків найжахливішого розбазарювання ресурсів – виконання запитів COUNT(*) просто, щоб дізнатися, чи є щось у базі даних. Наприклад, нам потрібно дізнатися, чи є у даного користувача взагалі замовлення. І ми виконуємо запит: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
FROM orders
<span class="token class-name">WHERE</span> user_id <span class="token operator">=</span> <span class="token operator">:</span>user_id</code></pre> Елементарно. Якщо COUNT = 0, замовлень немає. Інакше – є. Продуктивність виявиться не такою вже поганою, адже у нас, напевно, є індекс по стовпцю ORDERS.USER_ID. Але як ви вважаєте, яка буде продуктивність вищенаведеного запиту в порівнянні з наступним варіантом: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token operator">--</span> <span class="token class-name">Oracle</span>
SELECT CASE <span class="token class-name">WHEN</span> EXISTS <span class="token punctuation">(</span>
  SELECT <span class="token operator">*</span>
  FROM orders
  <span class="token class-name">WHERE</span> user_id <span class="token operator">=</span> <span class="token operator">:</span>user_id
<span class="token punctuation">)</span> THEN <span class="token number">1</span> ELSE <span class="token number">0</span> END
FROM dual

<span class="token operator">--</span> Более адекватные диалекты SQL<span class="token punctuation">,</span> например<span class="token punctuation">,</span> <span class="token class-name">PostgreSQL</span>
<span class="token class-name">SELECT</span> EXISTS <span class="token punctuation">(</span>
  SELECT <span class="token operator">*</span>
  FROM orders
  <span class="token class-name">WHERE</span> user_id <span class="token operator">=</span> <span class="token operator">:</span>user_id
<span class="token punctuation">)</span></code></pre> Не потрібно бути семи п'ядей на лобі, щоб зрозуміти, що справжній предикат існування припинить пошук додаткових рядків відразу після виявлення <em>першої ж</em> . Тож якщо результат виявиться "замовлень немає", то швидкість буде порівнянною. Якщо ж, однак, результат буде "так, замовлення є", то у разі, коли не треба вважати точну кількість, відповідь буде отримана <em>набагато</em> швидше. Адже точна кількість нас і не цікавить. Тим не менш, ми наказали базі даних обчислити його ( <strong>непотрібна робота</strong> ), а база даних не знає, що ми ігноруємо всі результати більше 1 ( <strong>обов'язкова робота</strong> ). Звичайно, було б набагато гірше, якби для досягнення тих же результатів ми викликали list.size() для колекції, що підтримується JPA. <a href="https://blog.jooq.org/2016/09/14/avoid-using-count-in-sql-when-you-could-use-exists/" target="_blank"> Я вже писав про це у своєму блозі раніше, і проводив порівняльне тестування обох варіантів на р...</a>
<h2>Висновок</h2>Ця стаття викладає очевидні речі. Не примушуйте базу даних виконувати <strong>непотрібну, але обов'язкову роботу</strong> . Вона <strong>непотрібна</strong> , оскільки, відповідно до наявних вимог, ви знаєте, що певну конкретну частину роботи виконувати не потрібно. Тим не менш, ви кажете базі даних зробити її. Вона є обов'язковою, оскільки база даних ніяк не може переконатися, що ця робота <strong>непотрібна</strong> . Ця інформація є лише у клієнта та недоступна серверу. Отже, базі даних доводиться її виконувати. Стаття була присвячена SELECT *, переважно тому, що це такий зручний об'єкт для розгляду. Але це стосується не лише баз даних. Це стосується всіх розподілених алгоритмів, у яких клієнт вказує серверу виконувати <strong>непотрібну, але обов'язкову роботу</strong>. Скільки <strong>N+1</strong> задач зустрічається у вашому середньостатистичному AngularJS-додатку, в яких UI організовує цикл за отриманим від сервісу результатом A, викликаючи сервіс B кілька разів, замість того, щоб запакувати всі звернення до B в єдиний виклик? Це явище, що дуже часто зустрічається. Рішення завжди одне й те саме. Чим більше інформації ви надаєте виконує ваші команди сутності, тим швидше вона (теоретично) ці команди виконує. Напишіть оптимальні запити. Завжди. Вся ваша система буде вдячна вам за це. <em><a href="https://blog.jooq.org/2017/03/08/many-sql-performance-problems-stem-from-unnecessary-mandatory-work/" target="_blank">Оригінал статті</a></em>
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <th>Що ще почитати?</th>
   </tr>
   <tr>
    <td>
     <p><a href="https://codegym.cc/groups/posts/244-vopros-otvet-kak-v-java-praviljhno-konvertirovatjh-string-v-int--" target="_blank">Питання-відповідь: як у Java правильно конвертувати String в int?</a></p>
     <p><a href="https://codegym.cc/groups/posts/234-luchshie-knigi-dlja-podgotovki-k-ehkzamenu-ocajp8-1z0-808-po-java-8" target="_blank">Кращі книги для підготовки до іспиту OCAJP8 (1Z0-808) з Java 8</a></p>
     <p><a href="https://codegym.cc/groups/posts/72-kak-praviljhno-nachatjh-razrabotku-pod-subd-oracle" target="_blank">Як правильно розпочати розробку під СУБД Oracle</a></p></td>
   </tr>
  </tbody>
 </table>
</div>