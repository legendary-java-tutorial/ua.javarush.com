Знайомство з EJB
<p>----------------------------------------</p>
У цій статті розглянемо EJB – Enterprise JavaBeans. Ця технологія є частиною специфікації Java EE. Ми торкнемося таких питань, як: А ще – напишемо невеликий HelloWorld додаток з використанням EJB та сервлетів. Ця стаття виявиться корисною д
<p>----------------------------------------</p>
У цій статті розглянемо EJB – Enterprise JavaBeans. Ця технологія є частиною специфікації Java EE. Ми торкнемося таких питань, як: 
<ul>
 <li>що таке EJB;</li>
 <li>якою є історія виникнення EJB;</li>
 <li>які є типи EJB.</li>
</ul>А ще – напишемо невеликий HelloWorld додаток з використанням EJB та сервлетів. <img data-max-width="800" data-id="767c81e1-5829-44bb-b34c-2e76840cf74d" class="img-fluid" alt="Знайомство з EJB-1" src="https://cdn.javarush.com/images/article/767c81e1-5829-44bb-b34c-2e76840cf74d/800.jpeg" style="width: 800px;">Ця стаття виявиться корисною для читачів, які освоїлися в Java SE і починають вивчення Java EE. Для повноцінного розуміння практичної частини цієї статті рекомендується спершу ознайомитися із статтею " <a href="https://codegym.cc/groups/posts/2640-nastroyka-lokaljhnogo-okruzhenija-dlja-java-ee-razrabotki" target="_blank">Налаштування локального оточення</a> ". 
<h2>Коротка історія EJB</h2>У далекому 1996 році, коли автору цієї статті було 5 років, Java вже мала популярність серед розробників. Причиною тому були доброзичливі API, автоматичне складання сміття, і т.д. Java широко використовувалася в системах, що відповідали за бекенд. Однак, незважаючи на всі принади мови, програмісти того часу потребували певного функціоналу, ще не реалізованого в JDK. Такими потребами були: 
<ul>
 <li>забезпечення персистентності даних;</li>
 <li>цілісність транзакцій</li>
 <li>конкурентний доступ до даних (управління багатопоточністю);</li>
 <li>і, швидше за все, ще щось.</li>
</ul>Усе це призводило до природного зростання популяції доморощених, самописних, закритих бібліотек. Іншими словами, кожен реалізовував свої потреби як міг. Так тривало доти, доки IBM у 1997 році не виступила з гаслом: "Всі повинні реалізовувати свої потреби однаково", і не випустила специфікації Enterprise Java Bean (EJB). Саме вона дозволила уніфікувати процес розробки та взяти рішення типових проблем (описаних вище як потреби) на бік фреймворку. Компанія Sun займалася адаптацією дітища IBM протягом 2 років, і в 1999 випустила специфікацію EJB 1.0. Так з'явилася на світ технологія, про яку далі йтиметься у прикладнішому ключі. 
<h2>Що таке EJB</h2>EJB у певному сенсі — збірний термін, який в залежності від контексту може мати на увазі під собою або саму технологію Enterprise JavaBeans загалом, або деякий конкретний програмний компонент (бін) Enterprise JavaBean, який є частиною технології EJB. Визначення EJB як технології наводиться на вікіпедії: Enterprise JavaBeans (також часто використовується у вигляді абревіатури EJB) - специфікація технології написання та підтримки серверних компонентів, що містять бізнес-логіку. Є частиною Java EE. Ця технологія зазвичай застосовується, коли бізнес-логіка вимагає щонайменше один з наступних сервісів, а часто всі з них: 
<ul>
 <li>підтримка безпеки даних (persistence): дані повинні бути в безпеці навіть після зупинки програми. Найчастіше досягається з використанням бази даних;</li>
 <li>підтримка розподілених транзакцій;</li>
 <li>підтримка паралельної зміни даних та багатопоточність;</li>
 <li>підтримка подій;</li>
 <li>підтримка іменування та каталогів (JNDI);</li>
 <li>безпека та обмеження доступу до даних;</li>
 <li>підтримка автоматизованої установки на сервер додатків;</li>
 <li>віддалений доступ.</li>
</ul>Перераховані вище сервіси — це безперечна перевага технології EJB. Ще однією такою перевагою є те, що все перераховане вище працює з коробки, відразу ж. Тобто. програмісту не треба думати про підтримку розподілених транзакцій. Програмістові потрібно думати тільки про бізнес-логіку, яку він намагається реалізувати. EJB як деякий конкретний програмний компонент - це Java-клас з однією або декількома анотаціями зі специфікації EJB, який містить деяку бізнес логіку програми. Інструкції зі специфікації EJB наділяють позначений клас певними повноваженнями, силами, суперздібностями. Докладніше про це читайте нижче. 
<h2>Типи EJB</h2>Резюмуємо. EJB - це звичайний Java клас, відзначений однією зі спеціальних анотацій. Такі класи називають бінами. Залежно від того, якою анотацією відзначений клас, він буде представником того чи іншого типу EJB (бінів). Є три основні типи бінів: 
<ul>
 <li>Message Driven Beans (біни, керовані повідомленнями);</li>
 <li>Entity Beans (об'єктні біни) – визначені у специфікації JPA (Java Persistence API) та використовуються для зберігання даних;</li>
 <li>Session Beans (сесійні біни).</li>
</ul>Останні (сесійні біни) поділяються на кілька підвидів: 
<ul>
 <li>stateless (без стану);</li>
 <li>stateful (за допомогою поточного стану сесії);</li>
 <li>singleton (один об'єкт на всю програму; починаючи з версії EJB 3.1).</li>
</ul><img data-max-width="800" data-id="cf934e31-21bb-45ff-808c-8e5f35f39451" class="img-fluid" alt="Знайомство з EJB - 2" src="https://cdn.javarush.com/images/article/cf934e31-21bb-45ff-808c-8e5f35f39451/800.jpeg" style="width: 800px;">Нижче розглянемо кожен тип бінів докладніше. 
<h2>Session Beans</h2>Session Beans, або сесійні біни – певний вид бінів. Вони інкапсулюють у собі бізнес-логіку, яку клієнт може програмно викликати через виклик методів цього бина. Виклик методу може виконати: 
<ul>
 <li>локально, іншим класом у тій же JVM, як і сесійний бін;</li>
 <li>віддалено, через мережу, з іншої JVM, за допомогою технології Java RMI (Remote Method Invocation).</li>
</ul>Слово «сесійний» передбачає, що бін доступний лише тимчасово виконання певної завдання сервером і безповоротно знищується у разі аварії чи зупинки сервера. Життєвий цикл екземпляра сесійного бина управляється EJB контейнером (докладніше про EJB контейнери можна почитати у <a href="https://codegym.cc/groups/posts/2648-znakomstvo-s-ejb" rel="nofollow" target="_blank">першій лекції циклу</a> ). <span class="text-bold">Сесійні біни без стану (stateless)</span>не зберігають інформацію про свій стан. Компонент такого типу можна використовувати різними клієнтами. Stateless біни використовуються для реалізації бізнес-процесів, які можна завершити за одну операцію. Наприклад, перевірка кредитної історії клієнтів. Оскільки один екземпляр біна може бути використаний різними клієнтами, розробник повинен забезпечити безпечний доступ до даних біна. Створити бін такого типу (втім, як і решта всіх сесійних бін) досить просто. Це звичайний Java-клас з інструкцією <code class=" language-none">@Stateless</code>. Наведемо приклад нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Stateless</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Stateless</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">StatelessEjbExample</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">sayHi</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"Hi, I'm Stateless EJB!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><span class="text-bold">Сесійні біни з підтримкою поточного стану сесії (Stateful)</span> зберігають інформацію про свій стан між зверненнями до нього від одного й того самого клієнта та завершують своє існування за явним запитом від клієнта. Досягається це за рахунок того, що статеві біни унікальні для кожного клієнта. Приклад завдання, за яке може відповідати такий тип бінів, - підтримка в актуальному стані кошика покупок в інтернет-магазині для кожного користувача. Життєвим циклом цих бінів управляє контейнер EJB. Ці біни також знищуються, коли клієнт завершує свою роботу. Подібні біни теж досить просто творити. Це Java клас, позначений інструкцією <code class=" language-none">Stateful</code>. Приклад нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Stateful</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Stateful</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">StatefulEjbExample</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">sayHi</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"Hi, I,m Stateful EJB"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><span class="text-bold">Сесійні біни одинаки (singleton)</span> ініціюються один раз за час існування програми та існують весь час "життя" програми. Такі біни розробляються для ситуацій, у яких один стан має бути поділений між усіма клієнтами. Подібно до stateless бінам, в бінах одиночках розробнику необхідно стежити за організацією потокобезпечного середовища всередині бина. Наведемо приклад Singleton Біна, який також простий у створенні як і його побратими, про які йшлося вище. Неважко здогадатися, що це Java-клас з інструкцією <code class=" language-none">@Singleton</code>. Однак у разі необхідно бути уважним. Є дві інструкції, ідентичні за синтаксисом, але різні за призначенням і розташовані в різних пакетах: 
<ul>
 <li>javax.ejb.Singleton</li>
 <li>javax.inject.Singleton</li>
</ul>Для створення EJB необхідно використовувати інструкцію з пакета <code class=" language-none">javax.ejb</code>. Приклад нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Singleton</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Singleton</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">SingletonEjbExample</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">sayHi</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"Hi, I'm Singleton EJB!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h2>Message Driven Beans</h2>Message Driven Beans, або MDB, або біни керовані повідомленнями, подібно до сеансових бін реалізують деяку бізнес-логіку. Але, на відміну від своїх родичів, у MDB є одна важлива відмінність. Клієнти ніколи не викликають методи MDB безпосередньо. Такі біни найчастіше виступають у ролі слухачів JMS (Java Message Service) повідомлень і є для організації асинхронного обміну повідомленнями між частинами системи. Прикладом такого повідомлення є запит на доставку товарних запасів від автоматизованої системи роздрібної торгівлі до системи управління поставками. Нижче наведемо приклад MDB Біна. На відміну від сесійних бінів, його створення трохи цікавіше: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>annotation<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Resource</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">MessageDriven</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">MessageDrivenContext</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>jms<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">JMSException</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>jms<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Message</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>jms<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">MessageListener</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>jms<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">TextMessage</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@MessageDriven</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>mappedName <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"jms/TestQueue"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MessageDrivenEjbExample</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">MessageListener</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Resource</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">MessageDrivenContext</span></span> messageDrivenContext<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">onMessage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Message</span></span> message<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">try</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>message <span class="token keyword"><span class="token keyword">instanceof</span></span> <span class="token class-name"><span class="token class-name">TextMessage</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
                <span class="token class-name"><span class="token class-name">TextMessage</span></span> msg <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">TextMessage</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> message<span class="token punctuation"><span class="token punctuation">;</span></span>
                msg<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getText</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
            <span class="token punctuation"><span class="token punctuation">}</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span> <span class="token keyword"><span class="token keyword">catch</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">JMSException</span></span> e<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
            messageDrivenContext<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setRollbackOnly</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Анотація <code class=" language-none">MessageDriven</code>робить наш клас MDB біном. Усередині анотації за допомогою JNDI (читайте про JNDI <a href="https://codegym.cc/groups/posts/2650-ispoljhzovanie-jndi-v-java" target="_blank">тут</a> ) визначається ім'я JMS розсилки, слухачем якої стає наш клас. Крім цього, наш клас реалізує інтерфейс <code class=" language-none">MessageListener</code>та його метод <code class=" language-none">onMessage</code>. Даний метод буде викликаний, коли прийде деяке повідомлення із черги/розсилки з ім'ям, визначеним усередині анотації <code class=" language-none">MessageDriven</code>. 
<h2>Entity beans</h2>Частиною технології EJB є JPA специфікація. JPA, або Java Persistence API – це специфікація, яка забезпечує об'єктно-реляційне відображення (ORM – Object-Relational Mapping) Java об'єктів (Entity бінів) та надає API для збереження, отримання та управління такими об'єктами. JPA дозволяє подавати дані з БД у вигляді Java-об'єктів, а також зберігати Java-об'єкти у вигляді записів у базі даних. У ролі подібного об'єкта може виступати не кожен клас, а саме Entity біни. Entity Bean - це Java клас, який відображає деяку таблицю в базі даних. Відображення (мапінг) досягається за рахунок використання спеціальних анотацій. З їхньою допомогою здійснюється зіставлення Java-класу з таблицею у базі даних, і навіть зіставлення полів Java-класу з полями таблиці БД. Наведемо приклад Entity Біна, 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span> <span class="token comment"><span class="token comment">// Делает данный класс Entity бином</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"employee"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token comment"><span class="token comment">// "Связывает" данный класс с таблицей employee в БД</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Employee</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">Serializable</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span> <span class="token comment"><span class="token comment">// Говорит о том, что поле ниже является первичным ключом</span></span>
    <span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>strategy <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">GenerationType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>AUTO<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token comment"><span class="token comment">// Определяет тип генерации значений первичного ключа</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"name"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token comment"><span class="token comment">// "Связывает" поле ниже с полем name в таблице employee в БД</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Column</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>name<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"age"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token comment"><span class="token comment">// "Связывает" поле ниже с полем age в таблице employee в БД</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">int</span></span> age<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">// getters and setters...</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Варто зазначити, що цей тип бінів має сенс вивчати лише у контексті вивчення специфікації JPA. 
<h2>Пишемо додаток: EJB HelloWorld</h2>У цьому розділі ми напишемо невелику Java EE HelloWorld програму, яку розгорнемо на сервері GlassFish. Перед прочитанням цієї статті настійно рекомендується прочитати <a href="http://docs.google.com/document/d/1QDwY8JkdKFtmN-HTi8rYpn5XELlZF1lKDUwXhxBHYqA/edit" rel="nofollow" target="_blank">статтю про налаштування локального оточення</a> . 
<ol>
 <li>
  <p>Створюємо новий Maven проект у IntelliJ IDEA.</p>
  <p><em>File -&gt; New -&gt; Project...</em></p><img data-max-width="800" data-id="7e8ba8dd-434d-4f94-b95e-7c95afd643c3" class="img-fluid" alt="Знайомство з EJB - 3" src="https://cdn.javarush.com/images/article/7e8ba8dd-434d-4f94-b95e-7c95afd643c3/800.jpeg" style="width: 800px;"></li>
 <li>
  <p>Натискаємо <em>Next</em> .</p></li>
 <li>
  <p>Заповнюємо параметри Maven проекту:</p><img data-max-width="800" data-id="d4686d74-452a-4feb-9460-6d7583e859fd" class="img-fluid" alt="Знайомство з EJB - 4" src="https://cdn.javarush.com/images/article/d4686d74-452a-4feb-9460-6d7583e859fd/800.jpeg" style="width: 800px;"></li>
 <li>
  <p>Натискаємо <em>Finish</em></p></li>
 <li>
  <p>Проект створено та має таку структуру:</p><img data-max-width="512" data-id="4ea75761-dbb5-4762-aded-193573e10179" class="img-fluid" alt="Знайомство з EJB-5" src="https://cdn.javarush.com/images/article/4ea75761-dbb5-4762-aded-193573e10179/512.jpeg" style="width: 512px;"></li>
</ol> Файл pom.xml виглядає так: <img data-max-width="800" data-id="48fc0e23-dcd8-4310-8ca8-7a81e80ece00" class="img-fluid" alt="Знайомство з EJB-6" src="https://cdn.javarush.com/images/article/48fc0e23-dcd8-4310-8ca8-7a81e80ece00/800.jpeg" style="width: 800px;">Насамперед нам необхідно додати залежність від Java EE API, а також вказати упаковку нашого проекту у вигляді архіву веб-додатку (war). Щоб зробити це, необхідно привести код pom.xml до такого вигляду: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">?</span></span>xml version<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"1.0"</span></span> encoding<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"UTF-8"</span></span><span class="token operator"><span class="token operator">?</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span>project xmlns<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"http://maven.apache.org/POM/4.0.0"</span></span>
         xmlns<span class="token operator"><span class="token operator">:</span></span>xsi<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
         xsi<span class="token operator"><span class="token operator">:</span></span>schemaLocation<span class="token operator"><span class="token operator">=</span></span><span class="token string"><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span><span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>modelVersion<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">4.0</span></span><span class="token number"><span class="token number">.0</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>modelVersion<span class="token operator"><span class="token operator">&gt;</span></span>

    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>com<span class="token punctuation"><span class="token punctuation">.</span></span>codegym<span class="token punctuation"><span class="token punctuation">.</span></span>lectures<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>ejb_demo<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">1.0</span></span><span class="token operator"><span class="token operator">-</span></span>SNAPSHOT<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>packaging<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>war<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>packaging<span class="token operator"><span class="token operator">&gt;</span></span>

    <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependencies<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
        <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
            <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>javax<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
            <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>javaee<span class="token operator"><span class="token operator">-</span></span>api<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
            <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">7.0</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
        <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span>
    <span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependencies<span class="token operator"><span class="token operator">&gt;</span></span>

<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>project<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Далі можна розпочинати Java-код. Наш додаток буде найпростішим. У нас буде 1 сервлет та 1 EJB. Це буде сесійний бін без збереження стану (stateless). Усередині EJB ми визначимо лише один метод, який повертатиме рядок “Hello World”. Насамперед створимо пакет <code class=" language-none">com.codegym.lectures</code>. Потім, усередині пакету <code class=" language-none">com.codegym.lectures</code>, створимо наш бін – DemoEJB. Код біна наведено нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">import</span></span> <span class="token namespace"><span class="token namespace">javax<span class="token punctuation"><span class="token punctuation">.</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span><span class="token class-name"><span class="token class-name">Stateless</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Stateless</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">DemoEJB</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
    <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">helloWorld</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"Hello world!"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як було сказано раніше, все досить просто. Наш наступний крок — створити сервлет, який передаватиме значення з EJB як відповідь на HTTP-запит. Варто зазначити, що сервлети не належать до теми цієї статті, але для демонстрації EJB все ж таки доведеться їх використовувати. Для цього створимо новий сервлет <code class=" language-none">DemoServlet</code>у тому пакеті, що і EJB. Його код нижче: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@WebServlet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/helloWorld"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">DemoServlet</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">HttpServlet</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@EJB</span></span>
    <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">DemoEJB</span></span> ejb<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
    <span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">doGet</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpServletRequest</span></span> req<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">HttpServletResponse</span></span> resp<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">ServletException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">IOException</span></span> <span class="token punctuation"><span class="token punctuation">{</span></span>
        resp<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getWriter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">write</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>ejb<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">helloWorld</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Наведемо невеликі коментарі до коду. Анотація <code class=" language-none">@WebServlet("/helloWorld")</code>— визначає наш клас як сервлет, який оброблятиме HTTP запити на ендпоінт <code class=" language-none">/helloWorld</code>. У нашого класу є одне поле <code class=" language-none">DemoEJB ejb</code>. Це наш бін, визначений раніше. Анотація над полем класу <code class=" language-none">@EJB</code>здійснює ін'єкцію залежності (DI). Тобто. Змінна ejb автоматично ініціалізується новим екземпляром, коли це буде потрібно. Наш клас є спадкоємцем HttpServlet і перевизначає один із методів суперкласу - <code class=" language-none">doGet</code>. Даний метод обробляє HTTP GET запити і приймає два параметри - <code class=" language-none">HttpServletRequest</code>і <code class=" language-none">HttpServletResponse</code>. <code class=" language-none">HttpServletRequest</code>служить для отримання інформації про запит, що надійшов HTTP. <code class=" language-none">HttpServletResponse</code>необхідний формування відповіді запит. Всередині методу ми отримуємо об'єкт <code class=" language-none">PrintWriter</code>у об'єкта відповіді (<code class=" language-none">HttpServletResponse</code>), за допомогою методу <code class=" language-none">getWriter()</code>. Далі ми можемо записати в отриманий об'єкт деяке значення за допомогою методу <code class=" language-none">write</code>. Чим, власне, ми і користуємося, записуючи в об'єкт <code class=" language-none">PrintWriter</code>-а значення, отримане з визначеного нами EJB (значення - рядок "Hello World!"). Дане значення клієнт, який надіслав HTTP-запит, отримає як відповідь на свій запит. Наступним кроком є ​​запуск програми на Java EE сервері GlassFish. Для цього створимо нову конфігурацію, як описано в <a href="https://docs.google.com/document/d/1QDwY8JkdKFtmN-HTi8rYpn5XELlZF1lKDUwXhxBHYqA/edit#heading=h.z2bmeimxq2iu" rel="nofollow" target="_blank">статті про налаштування локального оточення</a> . Нижче скрін готової конфігурації для поточного проекту. Переконайтеся, що у вас встановлено сервер GlassFish перед запуском: <img data-max-width="800" data-id="ba932522-60ef-4bc5-9544-8f683a1219ff" class="img-fluid" alt="Знайомство з EJB-7" src="https://cdn.javarush.com/images/article/ba932522-60ef-4bc5-9544-8f683a1219ff/800.jpeg" style="width: 800px;">Після створення конфігурації запуску - запускаємо програму за допомогою меню <em>Run -&gt; Run 'ejb_demo'</em> або за допомогою хоткею<em>Shift+F10</em> . Після запуску можна побачити його логи: <img data-max-width="1024" data-id="1ed6b5e2-2596-4581-8099-dd2959f7d57e" class="img-fluid" alt="Знайомство з EJB-8" src="https://cdn.javarush.com/images/article/1ed6b5e2-2596-4581-8099-dd2959f7d57e/1024.jpeg" style="width: 1024px;">А також браузер, що відкрився: <img data-max-width="512" data-id="c061b985-7eec-4ef2-a3d8-e1160a4f5a01" class="img-fluid" alt="Знайомство з EJB-9" src="https://cdn.javarush.com/images/article/c061b985-7eec-4ef2-a3d8-e1160a4f5a01/512.jpeg" style="width: 512px;">Все це говорить про те, що додаток працює, як замислювалося. <a href="https://codegym.cc/welcome" target="_blank"><img id="click_banner1_articles" data-max-width="1024" data-id="ed350f27-d35c-4950-92d8-418a400c2c55" class="img-fluid" alt="Знайомство з EJB-10" src="https://cdn.javarush.com/images/article/ed350f27-d35c-4950-92d8-418a400c2c55/1024.jpeg" style="width: 1024px;"></a>
<h2>Висновок</h2>У цій статті ми знайомабося з EJB – Enterprise JavaBeans. Розглянули такі питання, як: 
<ul>
 <li>Що таке EJB?</li>
 <li>Історія EJB</li>
 <li>Різні типи EJB</li>
</ul>Згадаймо, що EJB бувають таких типів: 
<ul>
 <li>Message Driven Beans (біни, керовані повідомленнями);</li>
 <li>Entity Beans (об'єктні біни) - визначені в специфікації JPA (Java Persistence API) entities та використовуються для зберігання даних;</li>
 <li>Session Beans (сесійні біни): 
  <ul>
   <li>stateless (без стану)</li>
   <li>stateful (за допомогою поточного стану сесії)</li>
   <li>singleton (один об'єкт на всю програму; починаючи з версії EJB 3.1)</li>
  </ul></li>
</ul>А також ми написали невелику HelloWorld програму з використанням EJB. Як ДЗ ти можеш повторити практичну частину цієї статті самостійно. А потім додати в свою програму ще два сервлети, які будуть використовувати stateful і singleton бини для отримання значення.