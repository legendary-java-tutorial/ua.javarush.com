Коротке знайомство з Gradle
<p>----------------------------------------</p>
Темою цього огляду буде система автоматичного складання Gradle. Англійською системи збірки називаються . Навіщо це взагалі потрібно? Ручне складання проектів на Java досить трудомісткий процес. Потрібно правильно вказати потрібні проекту бі
<p>----------------------------------------</p>
<h2>Вступ</h2>Темою цього огляду буде система автоматичного складання Gradle. Англійською системи збірки називаються <strong>Build Tools</strong> . <img data-id="afbc5974-563b-41dd-a72e-250d2b9ed91e" data-max-width="850" alt="Коротке знайомство з Gradle - 1" src="https://cdn.javarush.com/images/article/afbc5974-563b-41dd-a72e-250d2b9ed91e/800.jpeg" style="width: 850px;">Навіщо це взагалі потрібно? Ручне складання проектів на Java досить трудомісткий процес. Потрібно правильно вказати потрібні проекту бібліотеки та фреймворки, від яких проект залежить. Тут можна прочитати чудову статтю на хабрі: <a href="https://habr.com/post/125210/" target="_blank" rel="nofollow">Робота з Java в командному рядку</a>Рано чи пізно ви почнете створювати якісь скрипти для автоматизації цього процесу. А тепер уявіть, що так роблять усі розробники по всьому світу і кожен пише заново те, що хтось уже написав для свого проекту. збирання проектів, які автоматизують цей процес, крім того, дозволяють з одного боку зібрати Вам проект так, як Ви цього хочете, з іншого боку надають вам більш-менш стандартизовані кошти Альтернативою Gradle є система автоматичного збирання Maven. різні, а з іншого боку мають і низку подібностей.На цю тему на сайті Gradle є матеріал: <a href="https://guides.gradle.org/migrating-from-maven/" target="_blank" rel="nofollow">Migrating from Maven to Gradle</a>Як сказано в цьому посібнику, Gradle і Maven мають різницю у погляді на те, як збирати проект. Gradle заснований на графі завдань (task), які можуть залежати один від одного. Завдання виконують якусь роботу. фаз (phase), до яких приєднуються певні "мети" (goals).В цих goals і виконується якась робота. Однак, при таких різних підходах обидві системи складання слідують одній угоді і управління залежностями відбувається схоже. Щоб почати використовувати Gradle необхідно його завантажити У google або yandex вводимо "Gradle Build Tool" і в перших результатах бачимо офіційний сайт: <a href="https://gradle.org/" target="_blank" rel="nofollow">https://gradle.org</a> На головній сторінці Gradle є посилання з текстом "Docs", яка веде на <a href="https://docs.gradle.org/current/userguide/userguide.html" target="_blank" rel="nofollow">документацію Gradle</a>. Для початку нам потрібно встановити (Install) Gradle, тому нам цікавий розділ документації " <a href="https://docs.gradle.org/current/userguide/installation.html" target="_blank" rel="nofollow">Installing Gradle</a> ". Існує безліч способів установки, у тому числі спосіб "по-старому", тобто. вручну (" <a href="https://docs.gradle.org/current/userguide/installation.html#installing_manually" target="_blank" rel="nofollow">Installing manually</a> "). Завантажуємо згідно інструкції файл типу " <strong>binary-only</strong> ", який матиме назву виду gradle-5.1.1-bin.zip. Далі розпаковуємо архів і налаштовуємо змінне середовище оточення PATH згідно з інструкцією. Головне, після виконання інструкції команда <code class=" language-none">gradle -v</code>показує версію Gradle. Може виникнути проблема з тим, що для визначення розташування система знайде Gradle не там, де Ви хочете. Тому на Windows можна виконати (на *nix є свої аналоги): <code class=" language-none">for %i in (gradle.bat) do @echo. %~$PATH:i</code> Тепер, мабуть, можна розпочинати знайомство. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="04d69ad0-4f3f-4651-ad66-62bd6cdf33c0" data-max-width="336" alt="Коротке знайомство з Gradle - 2" src="https://cdn.javarush.com/images/article/04d69ad0-4f3f-4651-ad66-62bd6cdf33c0/256.jpeg" style="width: 336px;">
 </div>
</div>
<h2>Ініціалізація проекту Gradle</h2>Відразу хочеться відзначити, що Gradle - це для виконання завдань, званих <strong>task</strong> (я називатиму їх тягами). Таски надаються різними плагінами ( <strong>plugins</strong> ). Детальніше про плагіни раджу прочитати в офіційній документації: " <a href="https://docs.gradle.org/current/userguide/plugins.html" target="_blank" rel="nofollow">Using Gradle Plugins</a> ". Є набір "Core Plugins", які завжди, коли встановлений Gradle. Є різні категорії цих плагінів, але нас цікавить категорія " <a href="https://docs.gradle.org/current/userguide/plugin_reference.html#utility" target="_blank" rel="nofollow">Utility</a> ". У цьому наборі є плагін " <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html" target="_blank" rel="nofollow">Build Init Plugin</a> ", який надає таски для ініціалізації (Initialization) Gradle проекту. Нас цікавить створення типу проекту: " <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html#sec:javaapplication_" target="_blank" rel="nofollow">java-application</a> ". Виконаємо Gradle таск: <code class=" language-none">gradle init --type java-application</code> Відповімо принагідно на деякі питання, наприклад про те, що ми хочемо використовувати Groovy DSL (стандартна мова опису завдань для Gradle) та фреймворк тестування JUnit (про це ми поговоримо в іншому огляді). Після створення ми отримаємо наступний набір файлів: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="237" alt="Коротке знайомство з Gradle - 3" src="https://cdn.javarush.com/images/article/b45eb10d-f1ba-4b64-805f-f4fee4e972d6/original.jpeg">
 </div>
</div>По-перше, після ініціалізації ми отримуємо налаштований на нашу версію Gradle спеціальний враппер – це такий спеціальний скрипт. Про нього докладніше раджу прочитати в офіційній документації - <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html" target="_blank" rel="nofollow">The Gradle Wrapper</a> . По-друге, бачимо Gradle Build Script – файл build.gradle. Це головний файл, в якому описується те, які бібліотеки та фреймворки використовує наш проект, які плагіни потрібно підключити до проекту та описує різні таски. Докладніше про цей файл раджу прочитати в офіційній документації: " <a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="nofollow">Build Script Basics</a> ". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="189" alt="Коротке знайомство з Gradle - 4" src="https://cdn.javarush.com/images/article/0255e737-65fe-46d4-963b-6d00d43c9660/original.jpeg">
 </div>
</div>
<h2>Plugins та Tasks</h2>Якщо подивитися зараз на вміст Build Script, то побачимо секцію plugins: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">plugins <span class="token punctuation"><span class="token punctuation">{</span></span>
    id <span class="token string"><span class="token string">'java'</span></span>
    id <span class="token string"><span class="token string">'application'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Це ті самі плагіни, про які ми говорабо раніше. А якщо є плагіни, то є й завдання, які нам тепер доступні. Ми можемо виконати команду gradle tasks та побачити, що ми зараз можемо зробити з проектом: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2ae2cca9-a5a8-460f-8908-4da768bc303f" data-max-width="671" alt="Коротке знайомство з Gradle - 5" src="https://cdn.javarush.com/images/article/2ae2cca9-a5a8-460f-8908-4da768bc303f/512.jpeg" style="width: 671px;">
 </div>
</div>Наприклад, виконавши <code class=" language-none">gradle run</code>ми запустимо main клас нашого java програми: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="cece9b1b-aa2a-44a7-8a15-a84b25b08c12" data-max-width="370" alt="Коротке знайомство з Gradle - 6" src="https://cdn.javarush.com/images/article/cece9b1b-aa2a-44a7-8a15-a84b25b08c12/256.jpeg" style="width: 370px;">
 </div>
</div>Як ми бачимо, знизу написано так само. <code class=" language-none">2 actionable tasks: 1 executed, 1 up-to-date</code> Що це означає? Це означає, що було виконано 2 тяга: Причому 1 справді виконаний, а не виконувався, т.к. він up-to-date, тобто стан актуальний і нічого виконано не було. Ми можемо виконати так званий Dry Run: <code class=" language-none">gradle run -m</code> Виконаємо цю команду, ми побачимо, які будуть виконані таски, щоб виконати таск run: 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="233" alt="Коротке знайомство з Gradle - 7" src="https://cdn.javarush.com/images/article/83ec6123-0a03-42a7-a10c-74ae439ebe41/original.jpeg">
 </div>
</div>Як ми бачимо, всього було виконано цілих 4 завдання: перш ніж виконався run він виконав залежно від таск classes. Тас classes сам має 2 залежності і тому він виконав ще й compileJava і processResources. Коли ми виконуємо завдання, ми можемо виконати її з переглядом певного рівня логів (рівень логування визначає, наскільки важливі повідомлення хочемо бачити). Наприклад, ми можемо виконати <code class=" language-none">gradle run -i</code>. Це нам буде показувати зокрема інформаційні повідомлення виду: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token class-name"><span class="token class-name">Task</span></span> <span class="token operator"><span class="token operator">:</span></span>classes UP<span class="token operator"><span class="token operator">-</span></span>TO<span class="token operator"><span class="token operator">-</span></span>DATE
<span class="token class-name"><span class="token class-name">Skipping</span></span> task <span class="token string"><span class="token string">':classes'</span></span> as it has no actions<span class="token punctuation"><span class="token punctuation">.</span></span></code></pre> Докладніше про логування в Gradle раджу звернутися до офіційної документації: " <a href="https://docs.gradle.org/current/userguide/logging.html" target="_blank" rel="nofollow">Gradle Logging</a> ". Як бачимо, таск classes був пропущений, оскільки він <strong>UP-TO-DATE</strong> , тобто стан актуальне, нічого робити треба, тому дій був (no actions). Це через те, що за замовчуванням у Gradle є " <strong>Up-to-date checks</strong> " або так званий інкрементальний білд. Докладніше про цей механізм можна почитати в документації Gradle: " <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks" target="_blank" rel="nofollow">Up-to-date checks (AKA Incremental Build)</a> ". Але цей механізм можна вимкнути, виконавши таск із зазначенням прапора --rerun-tasks. Наприклад, <code class=" language-none">gradle run --rerun-tasks</code>. Тоді ми побачимо: <strong>2 actionable tasks: 2 executed</strong> Як бачимо, кількість виконаних тягів враховує лише перший рівень графа, тобто сам таск run і ті таски, яких він безпосередньо залежить, тобто classes. Таски, від яких залежить classes тут не рахуються (хоча вони і виконуються, коли виконується таск classes). Про завдання також слід прочитати: 
<ul>
 <li>" <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:adding_dependencies_to_tasks" target="_blank" rel="nofollow">Authoring Tasks</a> ": Визначає створення своїх завдань.</li>
 <li>" <a href="https://guides.gradle.org/writing-gradle-tasks/" target="_blank" rel="nofollow">Writing Custom Gradle Tasks</a> ": Посібник step by step зі створення завдань.</li>
 <li>" <a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" target="_blank" rel="nofollow">Build Script Basics</a> ": Основа для завдань та їх використання.</li>
</ul>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="b7a55e21-2b4c-4868-bf58-4162f1dc23f2" data-max-width="361" alt="Коротке знайомство з Gradle - 8" src="https://cdn.javarush.com/images/article/b7a55e21-2b4c-4868-bf58-4162f1dc23f2/256.jpeg" style="width: 361px;">
 </div>
</div>
<h2>Dependencies</h2>Однією з головних завдань будь-якої системи збирання є управління залежностями, тобто тим, які бібліотеки/фреймворки потрібні нашому проекту. Система складання повинна забезпечити їх наявність у потрібний момент та належним чином зібрати кінцевий артефакт нашої програми. За замовчуванням після gradle init для java-application ми побачимо наступний вміст у білд-скрипті: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class="  language-java">dependencies <span class="token punctuation"><span class="token punctuation">{</span></span>
    implementation <span class="token string"><span class="token string">'com.google.guava:guava:26.0-jre'</span></span>
    testImplementation <span class="token string"><span class="token string">'junit:junit:4.12'</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Тут одразу зрозуміло, що ми підключаємо. Але без певного розуміння незрозуміло, що за впровадження і випробуваннявиконання? Тут треба знову звернутися до документації Gradle, благо документація у Gradle написана чудово. Називається це " <a href="https://docs.gradle.org/current/userguide/managing_dependency_configurations.html" target="_blank" rel="nofollow">Managing Dependency Configurations</a> ". Як сказано у документації, кожна залежність оголошується з деяким scope - областю, у межах якої ця залежність буде доступна. Цей скоуп (scope) і визначається деякою конфігурацією (configuration), кожна з яких має унікальне ім'я. Також цікаво, що безліч Gradle плагінів додають передзадані конфігурації. Щоб дізнатися, які у нас конфігурації можна виконати: <code class=" language-none">gradle --console plain dependencies</code> Таким чином ми побачимо список усіх доступних конфігурацій і залежностей, що відносяться до них. Ми можемо відфільтрувати цей список так, щоб бачити лише доступні конфігурації: <code class=" language-none">gradle --console plain dependencies | find " - "</code> Як же зрозуміти, що нам використовувати? Тут трохи доведеться почитати. Т.к. ми використовуємо плагін "Java", то почнемо з його документації та розділу " <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_plugin_and_dependency_management" target="_blank" rel="nofollow">Dependency management</a> ". Тут бачимо, що була конфігурація (він же скоуп), звана " compile " і позначала " залежність, необхідна під час компіляції " . Але потім його замінабо (англ. Superseded) на implementation. Докладніше про заміну можна прочитати в розділі " <a href="https://docs.gradle.org/current/userguide/java_library_plugin.html#sec:java_library_separation" target="_blank" rel="nofollow">API and implementation separation</a>Виходить, ця залежність буде на "compile classpath". Але іноді ми хочемо, щоб наша залежність була включена до підсумкового артефакту. Навіщо? Наприклад, у нас буде виконуваний jar, який повинен сам у собі містити все необхідне. Що ж тоді нам По-перше, такої підтримки "з коробки" (тобто за замовчуванням, без будь-яких додаткових дій) немає, пояснюється це тим, що кожен хоче архів зібрати по своєму, а Gradle намагається бути мінімалістичним. використовувати jar архіви на classpath (без додаткових маніпуляцій у коді), тому що це так не працює (Докладніше див. " <a href="https://docs.oracle.com/javase/tutorial/deployment/jar/downman.html" target="_blank" rel="nofollow">Oracle: Adding Classes to the</a> File Class's JAR"). 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">jar <span class="token punctuation"><span class="token punctuation">{</span></span>
    manifest <span class="token punctuation"><span class="token punctuation">{</span></span>
        attributes <span class="token string"><span class="token string">'Main-Class'</span></span><span class="token operator"><span class="token operator">:</span></span> <span class="token string"><span class="token string">'jrgradle.App'</span></span>
    <span class="token punctuation"><span class="token punctuation">}</span></span>
    from configurations<span class="token punctuation"><span class="token punctuation">.</span></span>compileClasspath<span class="token punctuation"><span class="token punctuation">.</span></span>collect <span class="token punctuation"><span class="token punctuation">{</span></span> it<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">isDirectory</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">?</span></span> it <span class="token operator"><span class="token operator">:</span></span> <span class="token function"><span class="token function">zipTree</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>it<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> У налаштуваннях таска jar ми вказуємо те, що буде додано в маніфест jar-файлу (див. " <a href="https://docs.oracle.com/javase/tutorial/deployment/jar/appman.html" target="_blank" rel="nofollow">Oracle: Setting an Application's Entry Point</a> "). А далі ми кажемо, що всі залежності, які були потрібні для компіляції, ми їх включимо в jar. Альтернативою може послужити використання плагіна " <a href="https://imperceptiblethoughts.com/shadow/getting-started/#default-java-groovy-tasks" target="_blank" rel="nofollow">Gradle Shadow Plugin</a> ". Може здатися складним, але інші плагіни можуть спрощувати життя. Наприклад, при створенні веб-програми (на відміну від звичайної програми, що виконується) ми будемо використовувати особливий плагін - " <a href="https://docs.gradle.org/current/userguide/war_plugin.html#sec:war_default_settings" target="_blank" rel="nofollow">Gradle War Plugin</a>", який має іншу поведінку і там життя наше буде простіше (всі потрібні залежності будуть складені в окремий особливий каталог самим плагіном. Така робота регламентується тим, як мають бути влаштовані веб-додатки. Але це вже зовсім інша історія)". 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-max-width="243" alt="Коротке знайомство з Gradle - 9" src="https://cdn.javarush.com/images/article/140b1f88-309a-4b55-ba85-6832f0302abf/original.jpeg">
 </div>
</div>
<h2>Підсумки</h2><strong>Gradle</strong> – є відмінним вибором як системи складання проектів. Підтвердженням цього є те, що його використовують розробники таких відомих проектів як Spring та Hibernate. Вище були розглянуті лише базові речі. За ними прихований мільйон особливостей та можливостей, які з'являються у розробників. Gradle також підтримує створення багатомодульних проектів, що не розглянуто в даному огляді, але є відмінний tutorial у самого Gradle: <a href="https://guides.gradle.org/creating-multi-project-builds/" target="_blank" rel="nofollow">Creating Multi-project Builds</a>Сподіваюся, цей огляд також продемонстрував, що документація у Gradle написана на 5+ і по ній легко можна знайти потрібне, якщо розуміти, куди приблизно дивитися. А це прийде, коли розумієш основи. Крім того, у Gradle шикарні tutorial. хочеться невеликим списком того, що ще можна подивитися по Gradle: 
<ul>
 <li><a href="https://gradle.org/training/" target="_blank" rel="nofollow">Gradle Training</a> (Часто безкоштовні).</li>
 <li><a href="https://www.udacity.com/course/gradle-for-android-and-java--ud867" target="_blank" rel="nofollow">Gradle for Android and Java</a></li>
 <li><a href="https://guides.gradle.org/building-java-web-applications/#add_a_gradle_build_file" target="_blank" rel="nofollow">Building Java Web Applications</a></li>
 <li><a href="https://www.youtube.com/watch?v=NZJTYPLb0iE" target="_blank" rel="nofollow">Євген Борисов - Power of Gradle (2013)</a></li>
</ul><a href="https://www.youtube.com/watch?v=NZJTYPLb0iE" target="_blank" rel="nofollow">
 <div class="row justify-content-center jr-image-wrap">
  <div class="col-12 col-sm-10 col-md-8">
   <img data-id="7bb0d406-1166-498e-ace6-dbdda54fcc0c" data-max-width="474" alt="Коротке знайомство з Gradle - 10" src="https://cdn.javarush.com/images/article/7bb0d406-1166-498e-ace6-dbdda54fcc0c/256.jpeg" style="width: 474px;">
  </div>
 </div></a> #Viacheslav