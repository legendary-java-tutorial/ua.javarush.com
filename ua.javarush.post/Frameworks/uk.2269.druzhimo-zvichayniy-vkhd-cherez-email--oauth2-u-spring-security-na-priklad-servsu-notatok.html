Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток
<p>----------------------------------------</p>
Під час написання своєї програми зіткнулася з відсутністю виразних статей, як зробити так, щоб користувач реєструвався і через email, і через соціальні мережі. Були добрі туторіали з налаштування класичної форми входу. Були хороші туторіали
<p>----------------------------------------</p>
Під час написання своєї програми зіткнулася з відсутністю виразних статей, як зробити так, щоб користувач реєструвався і через email, і через соціальні мережі. Були добрі туторіали з налаштування класичної форми входу. Були хороші туторіали по <a href="https://habr.com/ru/company/mailru/blog/115163/" target="_blank" rel="nofollow">OAuth2</a> . Як подружити два способи інформації було злочинно мало. У процесі пошуків удалося вивести працездатне рішення. Воно не претендує на істину в останній інстанції, проте виконує свою функцію. У цій статті я покажу, як з нуля продати сервіс для зберігання нотаток з такою конфігурацією Spring Security. <img data-id="577d43a9-09fe-4e7a-8da2-82d0c2bf9f7f" data-max-width="850" alt="Дружимо звичайний вхід через email і OAuth2 в Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/577d43a9-09fe-4e7a-8da2-82d0c2bf9f7f/800.jpeg" style="width: 850px;"><strong>Примітка:</strong>добре, якщо читач пройшов хоча б пару туторіалів по Spring, тому що увага акцентуватиметься тільки на Spring Security, без детальних пояснень репозиторіїв, контролерів тощо. Інакше і так чимала стаття вийшла б гігантською. <strong>Зміст</strong>
<ol>
 <li><a href="https://codegym.cc/groups/posts/2269#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0">Створення проекту</a></li>
 <li><a href="https://codegym.cc/groups/posts/2269#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D1%83%D1%89%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9-%D0%B8-%D0%BB%D0%BE%D0%B3%D0%B8%D0%BA%D0%B8-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">Створення сутностей та логіки додатку</a></li>
 <ol>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%A1%D1%83%D1%89%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Сутності</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%A0%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B8">Репозиторії</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%9A%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80%D1%8B">Контролери</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%A1%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D1%8B">Сторінки</a></li>
 </ol>
 <li><a href="https://codegym.cc/groups/posts/2269#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-Spring-Security-%D0%B4%D0%BB%D1%8F-%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D0%B2%D1%85%D0%BE%D0%B4%D0%B0">Налаштування Spring Security для класичного входу</a></li>
 <ol>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%B0%D1%8F-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-SecurityConfig">Основна конфігурація SecurityConfig</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%9A%D0%B0%D1%81%D1%82%D0%BE%D0%BC%D0%BD%D1%8B%D0%B9-%D0%B2%D1%85%D0%BE%D0%B4-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">Кастомний вхід користувача</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%A3%D1%81%D0%BE%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D1%81%D1%82%D0%B2%D1%83%D0%B5%D0%BC-%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80">Удосконалимо контролер</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA">Запуск</a></li>
 </ol>
 <li><a href="https://codegym.cc/groups/posts/2269#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-OAuth2-%D0%BD%D0%B0-%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D0%B5-Google-%D0%B2-Spring-Security">Налаштування OAuth2 на прикладі Google у Spring Security</a></li>
 <ol>
  <li><a href="https://codegym.cc/groups/posts/2269#%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%B0-%D0%B8-application-properties">Конфігурація фільтра та application.properties</a><a></a></li><a> </a>
  <li><a></a><a href="https://codegym.cc/groups/posts/2269#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2-Google-Cloud-Platform">Основні моменти реєстрації програми Google Cloud Platform</a></li>
  <li><a href="https://codegym.cc/groups/posts/2269#CustomUserInfoTokenServices">CustomUserInfoTokenServices</a></li>
 </ol>
 <li><a href="https://codegym.cc/groups/posts/2269#%D0%98%D1%82%D0%BE%D0%B3%D0%BE%D0%B2%D1%8B%D0%B9-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0">Підсумковий запуск проекту</a></li>
</ol>
<h2 id="створення-проекта">Створення проекту</h2>Ідемо на <a href="https://start.spring.io/" target="_blank" rel="nofollow">start.spring.io</a> та формуємо основу проекту: 
<ul>
 <li>Web - запуск програми на вбудованому Tomcat, url-порівняння тощо;</li>
 <li>JPA - зв'язок з базою даних;</li>
 <li>Mustache - шаблонизатор, що використовується для генерації веб-сторінок;</li>
 <li>Security – захист програми. Те, навіщо ця стаття й створювалася.</li>
</ul>Завантажуємо архів, що вийшов, і розпаковуємо в потрібній вам папці. Запускаємо його до IDE. Ви можете вибирати БД на власний розсуд. Як базу даних для проекту я використовую MySQL, тому до файлу pom.xml до блоку &lt;dependencies&gt; додаю наступну залежність: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
     <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>mysql<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
     <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>mysql<span class="token operator"><span class="token operator">-</span></span>connector<span class="token operator"><span class="token operator">-</span></span>java<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
     <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">5.1</span></span><span class="token number"><span class="token number">.34</span></span><span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Конфігурація application.properties наразі наступна: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>url<span class="token operator"><span class="token operator">=</span></span>jdbc<span class="token operator"><span class="token operator">:</span></span>mysql<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>localhost<span class="token operator"><span class="token operator">:</span></span><span class="token number"><span class="token number">3306</span></span><span class="token operator"><span class="token operator">/</span></span>springsectut<span class="token operator"><span class="token operator">?</span></span>createDatabaseIfNotExist<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token operator"><span class="token operator">&amp;</span></span>useSSL<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token operator"><span class="token operator">&amp;</span></span>autoReconnect<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token operator"><span class="token operator">&amp;</span></span>useLegacyDatetimeCode<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">false</span></span><span class="token operator"><span class="token operator">&amp;</span></span>serverTimezone<span class="token operator"><span class="token operator">=</span></span>UTC<span class="token operator"><span class="token operator">&amp;</span></span>useUnicode<span class="token operator"><span class="token operator">=</span></span>yes<span class="token operator"><span class="token operator">&amp;</span></span>characterEncoding<span class="token operator"><span class="token operator">=</span></span>UTF<span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">8</span></span>
spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>driver<span class="token operator"><span class="token operator">-</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token operator"><span class="token operator">-</span></span>name<span class="token operator"><span class="token operator">=</span></span><span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">com<span class="token punctuation"><span class="token punctuation">.</span></span>mysql<span class="token punctuation"><span class="token punctuation">.</span></span>jdbc<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>Driver</span></span>
spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>username<span class="token operator"><span class="token operator">=</span></span>yourUsername
spring<span class="token punctuation"><span class="token punctuation">.</span></span>datasource<span class="token punctuation"><span class="token punctuation">.</span></span>password<span class="token operator"><span class="token operator">=</span></span>yourPassword

spring<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>generate<span class="token operator"><span class="token operator">-</span></span>ddl<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span>
spring<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>hibernate<span class="token punctuation"><span class="token punctuation">.</span></span>ddl<span class="token operator"><span class="token operator">-</span></span>auto<span class="token operator"><span class="token operator">=</span></span>update

spring<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>properties<span class="token punctuation"><span class="token punctuation">.</span></span>connection<span class="token punctuation"><span class="token punctuation">.</span></span>characterEncoding<span class="token operator"><span class="token operator">=</span></span>utf<span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">8</span></span>
<span class="token class-name"><span class="token namespace"></span><span class="token class-name"><span class="token namespace"><span class="token namespace">spring<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>properties<span class="token punctuation"><span class="token punctuation">.</span></span>connection<span class="token punctuation"><span class="token punctuation">.</span></span></span><span class="token punctuation"></span></span>CharSet</span></span><span class="token operator"><span class="token operator">=</span></span>utf<span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">8</span></span>
spring<span class="token punctuation"><span class="token punctuation">.</span></span>jpa<span class="token punctuation"><span class="token punctuation">.</span></span>properties<span class="token punctuation"><span class="token punctuation">.</span></span>connection<span class="token punctuation"><span class="token punctuation">.</span></span>useUnicode<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span>

spring<span class="token punctuation"><span class="token punctuation">.</span></span>mustache<span class="token punctuation"><span class="token punctuation">.</span></span>expose<span class="token operator"><span class="token operator">-</span></span>request<span class="token operator"><span class="token operator">-</span></span>attributes<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span></code></pre>
<h2 id="створення-сущностей-и-логики-програми">Створення сутностей та логіки додатку</h2>
<h3 id="Сущности">Сутності</h3>Створимо пакет <code class=" language-none">entities</code>, який помістимо сутності бази даних. Користувач описуватиметься класом <code class=" language-none">User</code>, що реалізує інтерфейс <code class=" language-none">UserDetails</code>, що знадобиться для конфігурації Spring Security. У користувача буде id, username (як його виступає email), пароль, ім'я, роль, прапор активності, ім'я та email облікового запису Google ( <code class=" language-none">googleName</code>і <code class=" language-none">googleUsername</code>). 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"user"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">User</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">UserDetails</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>strategy <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">GenerationType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>AUTO<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> username<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> password<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> active<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> googleName<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> googleUsername<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@ElementCollection</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>targetClass <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">Role</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> fetch <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">FetchType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>EAGER<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@CollectionTable</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"user_role"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> joinColumns <span class="token operator"><span class="token operator">=</span></span> <span class="token annotation punctuation"><span class="token annotation punctuation">@JoinColumn</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"user_id"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Enumerated</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">EnumType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>STRING<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Set</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Role</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> roles<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">//Геттеры, сеттеры, toString(), equals(), hashcode(), имплементация UserDetails</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Ролі користувача використовуються для регулювання доступу в Spring Security. Наш додаток буде використовувати лише одну роль: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">enum</span></span> <span class="token class-name"><span class="token class-name">Role</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">GrantedAuthority</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  USER<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">getAuthority</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token function"><span class="token function">name</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Створимо клас нотатки з id, заголовком нотатки, тілом нотатки та id користувача, якому вона належить: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Entity</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Table</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name <span class="token operator"><span class="token operator">=</span></span> <span class="token string"><span class="token string">"note"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">Note</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Id</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@GeneratedValue</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>strategy <span class="token operator"><span class="token operator">=</span></span> <span class="token class-name"><span class="token class-name">GenerationType</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>AUTO<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> id<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> title<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">String</span></span> note<span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Long</span></span> userId<span class="token punctuation"><span class="token punctuation">;</span></span>

    <span class="token comment"><span class="token comment">//Геттеры, сеттеры, toString(), equals(), hashcode()</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3 id="Репозитории">Репозиторії</h3>Для збереження сутностей у базі даних нам знадобляться репозиторії, які зроблять усю брудну роботу за нас. Створимо пакет <code class=" language-none">repos</code>, у ньому створимо інтерфейси <code class=" language-none">UserRepo</code>, <code class=" language-none">NoteRepo</code>успадковані від інтерфейсу <code class=" language-none">JpaRepository&lt;Entity, Id&gt;</code>. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Repository</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">UserRepo</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">JpaRepository</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Long</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span><span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@Repository</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">interface</span></span> <span class="token class-name"><span class="token class-name">NoteRepo</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">JpaRepository</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Long</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> <span class="token function"><span class="token function">findByUserId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Long</span></span> userId<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3 id="Контроллеры">Контролери</h3>У нашому сервісі нотаток будуть наступні сторінки: 
<ul>
 <li>Головна;</li>
 <li>Реєстрація;</li>
 <li>Вхід;</li>
 <li>Список нотаток користувача.</li>
</ul>До списку нотаток має бути доступ лише авторизований користувач. Інші сторінки є загальнодоступними. Створимо пакет <code class=" language-none">controllers</code>, у ньому клас <code class=" language-none">IndexController</code>, що містить звичайний get-mapping на головній сторінці. Клас <code class=" language-none">RegistrationController</code>відповідає за реєстрацію користувача. Post-mapping приймає дані з форми, зберігає користувача базу даних і переадресаовує на сторінку входу. <code class=" language-none">PasswordEncoder</code>буде описано пізніше. Він використовується для шифрування паролів. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Controller</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">RegistrationController</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">UserRepo</span></span> userRepo<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">PasswordEncoder</span></span> passwordEncoder<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/registration"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">registration</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"registration"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@PostMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/registration"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">addUser</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> name<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> username<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> password<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">User</span></span> user <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>name<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>username<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setPassword</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>passwordEncoder<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>password<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setActive</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setRoles</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">singleton</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Role</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>USER<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     userRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"redirect:/login"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Контролер, який відповідає за сторінку списку нотаток, поки що містить спрощений функціонал, який ускладниться після впровадження Spring Security. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Controller</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">NoteController</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">NoteRepo</span></span> noteRepo<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/notes"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">notes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Model</span></span> model<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> notes <span class="token operator"><span class="token operator">=</span></span> noteRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addAttribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"notes"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> notes<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"notes"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@PostMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/addnote"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">addNote</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> title<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> note<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">Note</span></span> newNote <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     newNote<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setTitle</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>title<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     newNote<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setNote</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>note<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     noteRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>newNote<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"redirect:/notes"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Для сторінки входу ми не прописуватимемо контролер, тому що вона задіяна в Spring Security. Натомість нам знадобиться спеціальна конфігурація. Звично створимо черговий пакет, назвемо його <code class=" language-none">config</code>, помістимо туди клас <code class=" language-none">MvcConfig</code>. Коли ми напишемо конфігурацію Spring Security, вона знатиме, яку сторінку ми маємо на увазі під час використання "/login". 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Configuration</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">MvcConfig</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">WebMvcConfigurer</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">addViewControllers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">ViewControllerRegistry</span></span> registry<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addViewController</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/login"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setViewName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"login"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     registry<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setOrder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Ordered</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>HIGHEST_PRECEDENCE<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h3 id="Страницы">Сторінки</h3>Для створення сторінок я використовую <a href="http://mustache.github.io/" target="_blank" rel="nofollow">шаблонизатор Mustache</a> . Ви можете впровадити й інший, не важливо. Для мета-інформації, яка використовується на всіх сторінках, створено файл meta.mustache. У ньому ж підключено Bootstrap, щоб сторінки нашого проекту виглядали симпатичнішими. Сторінки створюються в директорії "src/main/resources/templates". Файли мають розширення mustache. Розміщення html-коду безпосередньо в статті зробить її занадто великою, тому <a href="https://github.com/Dzeru/spring-login-form-and-oauth2-tutorial/tree/master/src/main/resources/templates" target="_blank" rel="nofollow">посилання на папку з шаблонами в репозиторії проекту на GitHub</a> . 
<h2 id="Настройка-Spring-Security-для-классического-входа">Налаштування Spring Security для класичного входу</h2>Spring Security допомагає нам захищати програму та її ресурси від несанкціонованого доступу. Ми створимо лаконічну робочу конфігурацію в класі <code class=" language-none">SecurityConfig</code>, успадкований від <code class=" language-none">WebSecurityConfigurerAdapter</code>, який помістимо в пакет <code class=" language-none">config</code>. Позначимо його інструкцією @EnableWebSecurity, яка включить підтримку Spring Security, і інструкцією @Configuration, яка показує, що цей клас містить певну конфігурацію. <strong>Примітка:</strong> в автоматично конфігурованому pom.xml стояла версія батьківського компонента Spring Boot 2.1.4.RELEASE, що заважало впровадити Security усталеним способом. Щоб уникнути конфліктів у проекті, рекомендується змінити версію на 2.0.1.RELEASE. 
<h3 id="Основная-конфигурация-SecurityConfig">Основна конфігурація SecurityConfig</h3>Наша конфігурація вмітиме: 
<ol>
 <li>
  <p>Шифрувати паролі за допомогою <code class=" language-none">BCryptPasswordEncoder</code>:</p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">PasswordEncoder</span></span> passwordEncoder<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Bean</span></span>
<span class="token class-name"><span class="token class-name">PasswordEncoder</span></span> <span class="token function"><span class="token function">passwordEncoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">PasswordEncoder</span></span> passwordEncoder <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> passwordEncoder<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre></li>
 <li>
  <p>Здійснювати вхід за спеціально написаним провайдером аутентифікації:</p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">AuthProvider</span></span> authProvider<span class="token punctuation"><span class="token punctuation">;</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">configure</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">AuthenticationManagerBuilder</span></span> auth<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  auth<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">authenticationProvider</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>authProvider<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre></li>
 <li>
  <p>Дозволяє доступ анонімним користувачам до головної сторінки, сторінок реєстрації та входу. Всі інші запити повинні виконуватися користувачами, що увійшли до системи. Сторінкою входу призначимо раніше описану "/login". При успішному вході користувач потрапить на сторінку зі списком нотаток, при помилці залишиться на сторінці входу. У разі успішного виходу користувач потрапить на головну сторінку.</p>
  <pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">protected</span></span> <span class="token keyword"><span class="token keyword">void</span></span> <span class="token function"><span class="token function">configure</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">HttpSecurity</span></span> http<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">Exception</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  http
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">authorizeRequests</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">antMatchers</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/resources/**"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"/"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"/login**"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token string"><span class="token string">"/registration"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">permitAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">anyRequest</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">authenticated</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">and</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">formLogin</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">loginPage</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/login"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">defaultSuccessUrl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/notes"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">failureUrl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/login?error"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">permitAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">and</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">logout</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">logoutSuccessUrl</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">permitAll</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre></li>
</ol>
<h3 id="Кастомный-вход-пользователя">Кастомний вхід користувача</h3>Самостійно написаний <code class=" language-none">AuthProvider</code>дозволить користувачеві входити не лише по email, а й на ім'я користувача. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Component</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">AuthProvider</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">AuthenticationProvider</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">UserService</span></span> userService<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">PasswordEncoder</span></span> passwordEncoder<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">Authentication</span></span> <span class="token function"><span class="token function">authenticate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Authentication</span></span> authentication<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">AuthenticationException</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">String</span></span> username <span class="token operator"><span class="token operator">=</span></span> authentication<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token class-name"><span class="token class-name">String</span></span> password <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> authentication<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getCredentials</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token class-name"><span class="token class-name">User</span></span> user <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> userService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">loadUserByUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>username<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span> <span class="token operator"><span class="token operator">&amp;&amp;</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>username<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token operator"><span class="token operator">||</span></span> user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">equals</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>username<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
     <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">!</span></span>passwordEncoder<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">matches</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>password<span class="token punctuation"><span class="token punctuation">,</span></span> user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getPassword</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
        <span class="token punctuation"><span class="token punctuation">{</span></span>
           <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BadCredentialsException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Wrong password"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        <span class="token punctuation"><span class="token punctuation">}</span></span>

        <span class="token class-name"><span class="token class-name">Collection</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token operator"><span class="token operator">?</span></span> <span class="token keyword"><span class="token keyword">extends</span></span> <span class="token class-name"><span class="token class-name">GrantedAuthority</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> authorities <span class="token operator"><span class="token operator">=</span></span> user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getAuthorities</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

        <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">UsernamePasswordAuthenticationToken</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">,</span></span> password<span class="token punctuation"><span class="token punctuation">,</span></span> authorities<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token punctuation"><span class="token punctuation">}</span></span>
     <span class="token keyword"><span class="token keyword">else</span></span>
        <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">BadCredentialsException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"Username not found"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>

  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">boolean</span></span> <span class="token function"><span class="token function">supports</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Class</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token operator"><span class="token operator">?</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> arg<span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Як ви могли помітити, за підвантаження користувача відповідає клас <code class=" language-none">UserService</code>, що лежить у пакеті <code class=" language-none">services</code>. У нашому випадку він шукає користувача не тільки по полю <code class=" language-none">username</code>, як вбудована реалізація, але ще й по імені користувача, імені Google облікового запису та email Google облікового запису. Останні два способи стануть у нагоді нам при реалізації входу через OAuth2. Тут клас наведено у скороченому варіанті. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Service</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token keyword"><span class="token keyword">class</span></span> <span class="token class-name"><span class="token class-name">UserService</span></span> <span class="token keyword"><span class="token keyword">implements</span></span> <span class="token class-name"><span class="token class-name">UserDetailsService</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
  <span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">UserRepo</span></span> userRepo<span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
  <span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">UserDetails</span></span> <span class="token function"><span class="token function">loadUserByUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> username<span class="token punctuation"><span class="token punctuation">)</span></span> <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">UsernameNotFoundException</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">User</span></span> userFindByUsername <span class="token operator"><span class="token operator">=</span></span> userRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findByUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>username<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token comment"><span class="token comment">//Остальные поиски</span></span>

     <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>userFindByUsername <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
     <span class="token punctuation"><span class="token punctuation">{</span></span>
        <span class="token keyword"><span class="token keyword">return</span></span> userFindByUsername<span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token punctuation"><span class="token punctuation">}</span></span>
     <span class="token comment"><span class="token comment">//Остальные проверки</span></span>
     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Примітка:</strong> не забудьте прописати потрібні методи у <code class=" language-none">UserRepo</code>! 
<h3 id="Усовершенствуем-контроллер">Удосконалимо контролер</h3>Ми настроїли Spring Security. Саме час скористатися цим у контролері нотаток. Тепер кожен mapping прийматиме додатковий параметр Principal, за яким намагатиметься знайти користувача. Чому не можна безпосередньо впровадити клас <code class=" language-none">User</code>? Тоді станеться конфлікт через розбіжність типів користувачів, коли ми напишемо вхід через соціальні мережі. Ми заздалегідь забезпечуємо необхідну гнучкість. Тепер наш код контролера нотаток виглядає так: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/notes"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">notes</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Principal</span></span> principal<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Model</span></span> model<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">User</span></span> user <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> userService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">loadUserByUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>principal<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token class-name"><span class="token class-name">List</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> notes <span class="token operator"><span class="token operator">=</span></span> noteRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findByUserId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addAttribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"notes"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> notes<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  model<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addAttribute</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"user"</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"notes"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token annotation punctuation"><span class="token annotation punctuation">@PostMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/addnote"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">addNote</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Principal</span></span> principal<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> title<span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">String</span></span> note<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">User</span></span> user <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> userService<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">loadUserByUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>principal<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token class-name"><span class="token class-name">Note</span></span> newNote <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">Note</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  newNote<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setTitle</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>title<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  newNote<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setNote</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>note<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  newNote<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUserId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

  noteRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>newNote<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"redirect:/notes"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre><strong>Примітка:</strong> у проекті за замовчуванням включений захист <a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B6%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%D0%B0%D1%8F_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D0%BB%D0%BA%D0%B0_%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0" target="_blank" rel="nofollow">CSRF</a> , тому або відключіть його для себе (http.csrf().disable()), або не забувайте, як автор статті, додавати у всі post-запити приховане поле з csrf-токеном. 
<h3 id="Запуск">Запуск</h3>Пробуємо запустити проект. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="c41bacef-d4a5-494a-8bec-a2fcf444b7ca" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 в Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/c41bacef-d4a5-494a-8bec-a2fcf444b7ca/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="2f2ab9ff-87b2-438f-b0e6-555dac4a684e" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/2f2ab9ff-87b2-438f-b0e6-555dac4a684e/1024.jpeg" style="width: 1024px;">
 </div>
</div>Бачимо, що новий користувач з'явився у базі даних. Пароль зашифровано. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="dc4aa875-1d86-433d-93ad-b535b53f7c37" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/dc4aa875-1d86-433d-93ad-b535b53f7c37/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="ffc5ea74-5617-44ed-a1b4-4bed49688143" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/ffc5ea74-5617-44ed-a1b4-4bed49688143/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1347d26b-8ff7-4f4b-8a4d-7127408b3dc0" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 в Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/1347d26b-8ff7-4f4b-8a4d-7127408b3dc0/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="bc51f528-4a87-4109-a19c-b5a7efd4c559" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 в Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/bc51f528-4a87-4109-a19c-b5a7efd4c559/1024.jpeg" style="width: 1024px;">
 </div>
</div> Нотатки збереглися до бази даних. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="36a0e46f-8935-4cbd-a5f9-4aeca8d48b87" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 7" src="https://cdn.javarush.com/images/article/36a0e46f-8935-4cbd-a5f9-4aeca8d48b87/1024.jpeg" style="width: 1024px;">
 </div>
</div>Бачимо, що проект успішно запускається та працює. Для повного щастя нам не вистачає лише можливості входу через соціальні мережі. Що ж, приступимо! 
<h2 id="Настройка-OAuth2-на-примере-Google-в-Spring-Security">Налаштування OAuth2 на прикладі Google у Spring Security<a></a></h2><a>При впровадженні OAuth2 я спиралася на </a><a href="https://spring.io/guides/tutorials/spring-boot-oauth2/" target="_blank" rel="nofollow">цей офіційний туторіал від Spring</a> . Для підтримки OAuth2 додамо до pom.xml наступну бібліотеку: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>dependency<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>
  <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>groupId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>org<span class="token punctuation"><span class="token punctuation">.</span></span>springframework<span class="token punctuation"><span class="token punctuation">.</span></span>security<span class="token punctuation"><span class="token punctuation">.</span></span>oauth<span class="token punctuation"><span class="token punctuation">.</span></span>boot<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>groupId<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>artifactId<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span>spring<span class="token operator"><span class="token operator">-</span></span>security<span class="token operator"><span class="token operator">-</span></span>oauth2<span class="token operator"><span class="token operator">-</span></span>autoconfigure<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>artifactId<span class="token operator"><span class="token operator">&gt;</span></span>
  <span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span>version<span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span><span class="token number"><span class="token number">2.0</span></span><span class="token number"><span class="token number">.0</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>RELEASE<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>version<span class="token operator"><span class="token operator">&gt;</span></span>
<span class="token operator"><span class="token operator">&lt;</span></span><span class="token operator"><span class="token operator">/</span></span>dependency<span class="token operator"><span class="token operator">&gt;</span></span></code></pre> Модифікуємо нашу конфігурацію Spring Security у класі <code class=" language-none">SecurityConfig</code>. Для початку додамо інструкцію @EnableOAuth2Client. Вона автоматично підтягне необхідне логіну через соцмережі. 
<h3 id="Конфигурация-фильтра-и-application-properties">Конфігурація фільтра та application.properties</h3>Впровадимо OAuth2ClientContext ін'єкції, щоб використовувати її в нашій конфігурації безпеки. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Autowired</span></span>
<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">OAuth2ClientContext</span></span> oAuth2ClientContext<span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> OAuth2ClientContext використовується при створенні фільтра, який перевіряє запит користувача на вхід через соцмережу. Фільтр доступний завдяки анотації @EnableOAuth2Client. Все, що нам потрібно викликати його в правильному порядку, <strong>до</strong> основного фільтра Spring Security. Тільки в такому випадку ми зможемо зловити перенаправлення у процесі входу з OAuth2. Для цього використовуємо <code class=" language-none">FilterRegistrationBean</code>, у якому виставляємо пріоритет нашого фільтра на -100. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Bean</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">FilterRegistrationBean</span></span> <span class="token function"><span class="token function">oAuth2ClientFilterRegistration</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">OAuth2ClientContextFilter</span></span> oAuth2ClientContextFilter<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">FilterRegistrationBean</span></span> registration <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">FilterRegistrationBean</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  registration<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setFilter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>oAuth2ClientContextFilter<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  registration<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setOrder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token operator"><span class="token operator">-</span></span><span class="token number"><span class="token number">100</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> registration<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span>

<span class="token keyword"><span class="token keyword">private</span></span> <span class="token class-name"><span class="token class-name">Filter</span></span> <span class="token function"><span class="token function">ssoFilter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">OAuth2ClientAuthenticationProcessingFilter</span></span> googleFilter <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">OAuth2ClientAuthenticationProcessingFilter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/login/google"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token class-name"><span class="token class-name">OAuth2RestTemplate</span></span> googleTemplate <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">OAuth2RestTemplate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">google</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> oAuth2ClientContext<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  googleFilter<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setRestTemplate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleTemplate<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token class-name"><span class="token class-name">CustomUserInfoTokenServices</span></span> tokenServices <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">CustomUserInfoTokenServices</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">googleResource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getUserInfoUri</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token function"><span class="token function">google</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">getClientId</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  tokenServices<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setRestTemplate</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleTemplate<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  googleFilter<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setTokenServices</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>tokenServices<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  tokenServices<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUserRepo</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>userRepo<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  tokenServices<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setPasswordEncoder</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>passwordEncoder<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> googleFilter<span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Також необхідно додати новий фільтр до функції configure(HttpSecurity http): 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class="  language-java">http<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">addFilterBefore</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token function"><span class="token function">ssoFilter</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">UsernamePasswordAuthenticationFilter</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token keyword"><span class="token keyword">class</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span></code></pre> Фільтр також необхідно знати про реєстрацію клієнта через Google. Анотація @ConfigurationProperties показує, які властивості конфігурації слід звернути увагу на application.properties. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Bean</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@ConfigurationProperties</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"google.client"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">AuthorizationCodeResourceDetails</span></span> <span class="token function"><span class="token function">google</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">AuthorizationCodeResourceDetails</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Щоб завершити аутентифікацію, потрібно вказати кінцеву точку інформації користувача Google: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Bean</span></span>
<span class="token annotation punctuation"><span class="token annotation punctuation">@ConfigurationProperties</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"google.resource"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">ResourceServerProperties</span></span> <span class="token function"><span class="token function">googleResource</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">ResourceServerProperties</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> Зареєструвавши нашу програму в <a href="https://console.cloud.google.com/" target="_blank" rel="nofollow">Google Cloud Platform</a> , до application.properties додамо властивості з відповідними префіксами: 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java">google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>clientId<span class="token operator"><span class="token operator">=</span></span>yourClientId
google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>clientSecret<span class="token operator"><span class="token operator">=</span></span>yourClientSecret
google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>accessTokenUri<span class="token operator"><span class="token operator">=</span></span>https<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>www<span class="token punctuation"><span class="token punctuation">.</span></span>googleapis<span class="token punctuation"><span class="token punctuation">.</span></span>com<span class="token operator"><span class="token operator">/</span></span>oauth2<span class="token operator"><span class="token operator">/</span></span>v4<span class="token operator"><span class="token operator">/</span></span>token
google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>userAuthorizationUri<span class="token operator"><span class="token operator">=</span></span>https<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>accounts<span class="token punctuation"><span class="token punctuation">.</span></span>google<span class="token punctuation"><span class="token punctuation">.</span></span>com<span class="token operator"><span class="token operator">/</span></span>o<span class="token operator"><span class="token operator">/</span></span>oauth2<span class="token operator"><span class="token operator">/</span></span>v2<span class="token operator"><span class="token operator">/</span></span>auth
google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>clientAuthenticationScheme<span class="token operator"><span class="token operator">=</span></span>form
google<span class="token punctuation"><span class="token punctuation">.</span></span>client<span class="token punctuation"><span class="token punctuation">.</span></span>scope<span class="token operator"><span class="token operator">=</span></span>openid<span class="token punctuation"><span class="token punctuation">,</span></span>email<span class="token punctuation"><span class="token punctuation">,</span></span>profile
google<span class="token punctuation"><span class="token punctuation">.</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span>userInfoUri<span class="token operator"><span class="token operator">=</span></span>https<span class="token operator"><span class="token operator">:</span></span><span class="token operator"><span class="token operator">/</span></span><span class="token operator"><span class="token operator">/</span></span>www<span class="token punctuation"><span class="token punctuation">.</span></span>googleapis<span class="token punctuation"><span class="token punctuation">.</span></span>com<span class="token operator"><span class="token operator">/</span></span>oauth2<span class="token operator"><span class="token operator">/</span></span>v3<span class="token operator"><span class="token operator">/</span></span>userinfo
google<span class="token punctuation"><span class="token punctuation">.</span></span>resource<span class="token punctuation"><span class="token punctuation">.</span></span>preferTokenInfo<span class="token operator"><span class="token operator">=</span></span><span class="token boolean"><span class="token boolean">true</span></span></code></pre>
<h3 id="Основные-моменты-регистрации-програми-в-Google-Cloud-Platform">Основні моменти реєстрації програми <a href="https://console.cloud.google.com/" target="_blank" rel="nofollow">Google Cloud Platform</a></h3>Шлях: API та сервіси -&gt; Облікові дані Вікно запиту доступу OAuth: 
<ul>
 <li><em>Назва програми:</em> Spring login form and OAuth2 tutorial</li>
 <li><em>Адреса електронної пошти служби підтримки:</em> ваш email</li>
 <li><em>Область дії для API Google:</em> email, profile, openid</li>
 <li><em>Авторизовані домени:</em> me.org</li>
 <li><em>Посилання на головну сторінку програми:</em> http://me.org:8080</li>
 <li><em>Посилання на політику конфіденційності програми:</em> http://me.org:8080</li>
 <li><em>Посилання на умови використання програми:</em> http://me.org:8080</li>
</ul>Облікові дані: 
<ul>
 <li><em>Тип:</em> Веб-додаток</li>
 <li><em>Назва:</em> Spring login form and OAuth2 tutorial</li>
 <li><em>Дозволені джерела JavaScript:</em> http://me.org, http://me.org:8080</li>
 <li><em>Дозволені URI перенаправлення:</em> http://me.org:8080/login, http://me.org:8080/login/google</li>
</ul><strong>Примітка:</strong> оскільки з адресаою localhost:8080 Google працювати не хоче, внесіть у файл C:\Windows\System32\drivers\etc\hosts в кінці рядок "127.0.0.1 me.org" або подібний до неї. Головне, щоб домен був у класичному вигляді. 
<h3 id="CustomUserInfoTokenServices">CustomUserInfoTokenServices</h3>Ви помітабо слово Custom у функції-описі фільтра? Клас <code class=" language-none">CustomUserInfoTokenServices</code>. Так, ми створимо свій клас з блекджеком та можливістю зберегти користувача в БД! За допомогою клавіш Ctrl-N в IntelliJ IDEA можна знайти і подивитися, як реалізований <code class=" language-none">UserInfoTokenServices</code>, що використовується за замовчуванням. Скопіюємо його код у свіжостворений клас <code class=" language-none">CustomUserInfoTokenServices</code>. Більшість можна залишити без змін. Перш, ніж змінювати логіку функцій, допишемо як приватні поля класу <code class=" language-none">UserRepo</code>і<code class=" language-none">PasswordEncoder</code>. Створимо їм сетери. Внесемо до класу SecurityConfig @Autowired UserRepo userRepo. Дивимося, як зникає покажчик на помилку у методі створення фільтра, радіємо. Чому не можна було застосувати @Autowired безпосередньо у CustomUserInfoTokenServices? Тому що цей клас не підтягне залежність, тому що сам не помічений будь-якою інструкцією Spring, до того ж його конструктор створюється явно при оголошенні фільтра. Відповідно механізм DI Spring про нього не знає. Якщо ми анотуємо @Autowired що-небудь у цьому класі, при використанні отримаємо NullPointerException. А ось через явні сетери все дуже працює. Після застосування необхідних компонентів основним об'єктом інтересу стає функція loadAuthentication, у якій вилучається Map&lt;String, Object&gt; з інформацією користувача. Саме в ній у своєму і цьому проекті я реалізувала збереження в базу даних користувача, що увійшов через соцмережу. Так як в якості провайдера OAuth2 ми використовуємо Google обліковий запис, то перевіряємо, чи містить map характерне для Google поле "sub". Якщо воно є, значить, інформація про користувача дійшла правильно. Створюємо нового користувача та зберігаємо його до бази даних. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@Override</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">OAuth2Authentication</span></span> <span class="token function"><span class="token function">loadAuthentication</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span> accessToken<span class="token punctuation"><span class="token punctuation">)</span></span>
     <span class="token keyword"><span class="token keyword">throws</span></span> <span class="token class-name"><span class="token class-name">AuthenticationException</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">InvalidTokenException</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token class-name"><span class="token class-name">Map</span></span><span class="token generics"><span class="token punctuation"></span><span class="token generics"><span class="token punctuation"><span class="token punctuation">&lt;</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">,</span></span> <span class="token class-name"><span class="token class-name">Object</span></span><span class="token punctuation"><span class="token punctuation">&gt;</span></span></span><span class="token punctuation"></span></span> map <span class="token operator"><span class="token operator">=</span></span> <span class="token function"><span class="token function">getMap</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>userInfoEndpointUrl<span class="token punctuation"><span class="token punctuation">,</span></span> accessToken<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

  <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>map<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">containsKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"sub"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token class-name"><span class="token class-name">String</span></span> googleName <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> map<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"name"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token class-name"><span class="token class-name">String</span></span> googleUsername <span class="token operator"><span class="token operator">=</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">String</span></span><span class="token punctuation"><span class="token punctuation">)</span></span> map<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"email"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token class-name"><span class="token class-name">User</span></span> user <span class="token operator"><span class="token operator">=</span></span> userRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">findByGoogleUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleUsername<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user <span class="token operator"><span class="token operator">==</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
     <span class="token punctuation"><span class="token punctuation">{</span></span>
        user <span class="token operator"><span class="token operator">=</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">User</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setActive</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token boolean"><span class="token boolean">true</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
        user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setRoles</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Collections</span></span><span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">singleton</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Role</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>USER<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token punctuation"><span class="token punctuation">}</span></span>

     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleName<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleUsername<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setGoogleName</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleName<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setGoogleUsername</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>googleUsername<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     user<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">setPassword</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>passwordEncoder<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">encode</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"oauth2user"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>

     userRepo<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">save</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>user<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>

  <span class="token keyword"><span class="token keyword">if</span></span> <span class="token punctuation"><span class="token punctuation">(</span></span>map<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">containsKey</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"error"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token keyword"><span class="token keyword">this</span></span><span class="token punctuation"><span class="token punctuation">.</span></span>logger<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">debug</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"userinfo returned error: "</span></span> <span class="token operator"><span class="token operator">+</span></span> map<span class="token punctuation"><span class="token punctuation">.</span></span><span class="token function"><span class="token function">get</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"error"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
     <span class="token keyword"><span class="token keyword">throw</span></span> <span class="token keyword"><span class="token keyword">new</span></span> <span class="token class-name"><span class="token class-name">InvalidTokenException</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>accessToken<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token function"><span class="token function">extractAuthentication</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>map<span class="token punctuation"><span class="token punctuation">)</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre> При використанні кількох провайдерів можна вказувати різні варіанти в одному CustomUserInfoTokenServices, і прописувати різні класи подібних сервісів у методі оголошення фільтра. 
<div class="email-subscription">
 <iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no" data-savepage-key="0-2"></iframe>
</div> Тепер як Principal у нас може виступати і User, і OAuth2Authentication. Так як ми завчасно врахували в UserService підвантаження користувача через дані Google, програма буде працювати для обох видів користувачів. Модифікуємо контролер головної сторінки проекту, щоб він перенаправляв користувачів, що ввійшли за допомогою OAuth2 на сторінку нотаток. 
<pre class=" line-numbers  language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class="  language-java"><span class="token annotation punctuation"><span class="token annotation punctuation">@GetMapping</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token string"><span class="token string">"/"</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token keyword"><span class="token keyword">public</span></span> <span class="token class-name"><span class="token class-name">String</span></span> <span class="token function"><span class="token function">index</span></span><span class="token punctuation"><span class="token punctuation">(</span></span><span class="token class-name"><span class="token class-name">Principal</span></span> principal<span class="token punctuation"><span class="token punctuation">)</span></span>
<span class="token punctuation"><span class="token punctuation">{</span></span>
  <span class="token keyword"><span class="token keyword">if</span></span><span class="token punctuation"><span class="token punctuation">(</span></span>principal <span class="token operator"><span class="token operator">!=</span></span> <span class="token keyword"><span class="token keyword">null</span></span><span class="token punctuation"><span class="token punctuation">)</span></span>
  <span class="token punctuation"><span class="token punctuation">{</span></span>
     <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"redirect:/notes"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
  <span class="token punctuation"><span class="token punctuation">}</span></span>
  <span class="token keyword"><span class="token keyword">return</span></span> <span class="token string"><span class="token string">"index"</span></span><span class="token punctuation"><span class="token punctuation">;</span></span>
<span class="token punctuation"><span class="token punctuation">}</span></span></code></pre>
<h2 id="Разомвый-запуск-проекта">Підсумковий запуск проекту</h2>Після невеликих косметичних змін та додавання кнопки виходу проводимо підсумковий запуск проекту. 
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="1d5f58a8-ab2a-48c6-812a-4466ebd32299" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/1d5f58a8-ab2a-48c6-812a-4466ebd32299/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f8f4a146-f129-4ebc-bcab-ec25bb081e87" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток." src="https://cdn.javarush.com/images/article/f8f4a146-f129-4ebc-bcab-ec25bb081e87/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="d752dcaf-375e-4424-a051-9d70b241634d" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 10" src="https://cdn.javarush.com/images/article/d752dcaf-375e-4424-a051-9d70b241634d/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="bd9df032-a3ed-4440-b89a-319d00c22585" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 11" src="https://cdn.javarush.com/images/article/bd9df032-a3ed-4440-b89a-319d00c22585/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="f1e254ca-918b-4380-a4b3-3ed012c704c3" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 12" src="https://cdn.javarush.com/images/article/f1e254ca-918b-4380-a4b3-3ed012c704c3/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="dc16291a-efed-48c8-a186-54b9cd38f33f" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 13" src="https://cdn.javarush.com/images/article/dc16291a-efed-48c8-a186-54b9cd38f33f/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="09fb6590-e627-4075-a278-742f4c9c80c7" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 14" src="https://cdn.javarush.com/images/article/09fb6590-e627-4075-a278-742f4c9c80c7/1024.jpeg" style="width: 1024px;">
 </div>
</div>
<div class="row justify-content-center jr-image-wrap">
 <div class="col-12 col-sm-10 col-md-8">
  <img data-id="01828301-c319-4cbe-9bd8-f2f0775da686" data-max-width="1024" alt="Дружимо звичайний вхід через email і OAuth2 у Spring Security на прикладі сервісу нотаток - 15" src="https://cdn.javarush.com/images/article/01828301-c319-4cbe-9bd8-f2f0775da686/1024.jpeg" style="width: 1024px;">
 </div>
</div>Користувач успішно входить і через звичайну форму, і через обліковий запис Google. Цього ми й досягали! Сподіваюся, ця стаття прояснила певні моменти у створенні веб-застосунку, його захисті за допомогою Spring Security та комбінуванні різних способів входу. З повним кодом проекту ви можете