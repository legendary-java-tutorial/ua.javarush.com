Додаємо можливість роботи адміну та статистику для нього - "Java-проект від А до Я"
<p>----------------------------------------</p>
Всім привіт, дорогі друзі. Отже, бот вже працює і надсилає повідомлення про нові статті. Якщо ви ще не використовуєте його, ось посилання: . Ну а сьогодні ми поговоримо про додавання команд, які працюють лише для адмінів. Одна з таких коман
<p>----------------------------------------</p>
Всім привіт, дорогі друзі. Отже, бот вже працює і надсилає повідомлення про нові статті. Якщо ви ще не використовуєте його, ось посилання: <a href="https://t.me/codegym_community_bot" rel="nofollow" target="_blank">Javarush Telegram Bot</a> . Ну а сьогодні ми поговоримо про додавання команд, які працюють лише для адмінів. Одна з таких команд – статистика та дошка допомоги. Навіщо це потрібно? На даний момент цікавіше описати роботу з інструкціями в рамках цього завдання, ніж реальну необхідність цього. <img data-max-width="800" data-id="235b6c4b-66a2-4688-bf5c-7d312dd2ca44" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього - 1" src="https://cdn.javarush.com/images/article/235b6c4b-66a2-4688-bf5c-7d312dd2ca44/800.jpeg" style="width: 800px;">Ну а якщо ми йдемо в команду статистики, то можна її розширити і зробити більш інформативною. Після MVP можна буде повернути статистику для авторів, наприклад. Але про це вже потім…)
<h2>Розбираємося з додаванням адмінів та команд для них</h2>Починаємо нашу роботу з того, що оновлюємо main гілку та її основі створюємо нову STEP_9_JRTB-10. Щоб розібратися, яка команда належить до адмінів, а яка до всіх, потрібно промаркувати команду. Для цього створимо інструкцію. Що це означає? Такого ми ще не робабо. Це можна вибрати під час створення класу в IDEA. Зараз покажу. У пакеті command створимо новий пакет <span class="text-bold">annotation</span> і в ньому – анотацію AdminCommand: <img data-max-width="512" data-id="c13cb07a-b4d1-4944-8a97-49f150c46288" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 2" src="https://cdn.javarush.com/images/article/c13cb07a-b4d1-4944-8a97-49f150c46288/512.jpeg" style="width: 512px;">Сама анотація буде такою: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">Command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">;</span>

<span class="token comment">/**
* Mark if {@link Command} can be viewed only by admins.
*/</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AdminCommand</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre> Тут нам більше нічого не потрібно. Далі додаємо її нашій команді StatCommand: <img data-max-width="1080" data-id="b74fd470-ed42-4a2b-b8ed-0a48e13ff91d" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 3" src="https://cdn.javarush.com/images/article/b74fd470-ed42-4a2b-b8ed-0a48e13ff91d/1080.jpeg" style="width: 1080px;">Тепер все має заробити... Чи ні? Ні, звичайно)) Потрібно навчити наш CommandContainer правильно видавати результат. Для цього оновимо метод <span class="code">retrieveCommand</span> , який видає команду для запуску в залежності від того, що йому передають. Як ідентифікатор адміна будемо використовувати його username у Телеграмі. Він унікальний і легше читаємо, ніж chat_id. Як його одержати? Він знаходиться в об'єкті Update, який надходить із повідомленням: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre> Підсумовуючи все сказане вище, оновимо метод <span class="code">CommandContainer#retrieveCommand</span> : 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token class-name">Command</span> <span class="token function">retrieveCommand</span><span class="token punctuation">(</span><span class="token class-name">String</span> commandIdentifier<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Command</span> orDefault <span class="token operator">=</span> commandMap<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>commandIdentifier<span class="token punctuation">,</span> unknownCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAdminCommand</span><span class="token punctuation">(</span>orDefault<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>admins<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> orDefault<span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> unknownCommand<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> orDefault<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isAdminCommand</span><span class="token punctuation">(</span><span class="token class-name">Command</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">nonNull</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">AdminCommand</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Як видно тут, я додав метод <span class="code">isAdminCommand</span> , який перевіряє, чи є анотація AdminCommand в команді, що надається. І якщо це команда, призначена тільки для адмінів, ми перевіряємо, чи є цей username у нас в колекції доступних адмінів. <em>До речі, ось він, ОВП, у всій красі: ми просто передаємо інтерфейс, який може бути будь-якою реалізацією. Але передати можемо лише клас, який реалізував інтерфейс <span class="text-bold">Command</span> .</em> І начебто все зрозуміло, крім одного: звідки взялися адміни? Зараз покажу. Поки що я хочу передавати адмінів як змінну оточення, щоб її можна було легко налаштовувати. У цій змінній буде рядок, в якому через кому вказані всі username телеграм користувачів, які будуть адмінами. Для цього додамо до application.properties: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java">bot<span class="token punctuation">.</span>admins<span class="token operator">:</span> robeskman<span class="token punctuation">,</span>romankh3</code></pre> У CommandContainer у конструкторі передамо колекцію адмінів та проініціалізуємо її: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommandContainer</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Command</span><span class="token punctuation">&gt;</span></span> commandMap<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Command</span> unknownCommand<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> admins<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">CommandContainer</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">,</span> <span class="token class-name">TelegramUserService</span> telegramUserService<span class="token punctuation">,</span>
                           <span class="token class-name">CodeGymGroupClient</span> codeGymGroupClient<span class="token punctuation">,</span> <span class="token class-name">GroupSubService</span> groupSubService<span class="token punctuation">,</span>
                           <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> admins<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">this</span><span class="token punctuation">.</span>admins <span class="token operator">=</span> admins<span class="token punctuation">;</span></code></pre> А вже в CodeGymTelegramBot буде вся магія з отримання колекції з рядка в пертях: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token class-name">JavarushTelegramBot</span><span class="token punctuation">(</span><span class="token class-name">TelegramUserService</span> telegramUserService<span class="token punctuation">,</span> <span class="token class-name">CodeGymGroupClient</span> groupClient<span class="token punctuation">,</span> <span class="token class-name">GroupSubService</span> groupSubService<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{'${bot.admins}'.split(',')}"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> admins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>commandContainer <span class="token operator">=</span>
           <span class="token keyword">new</span> <span class="token class-name">CommandContainer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SendBotMessageServiceImpl</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   telegramUserService<span class="token punctuation">,</span> groupClient<span class="token punctuation">,</span> groupSubService<span class="token punctuation">,</span> admins<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> Як видно з конструктора вище, знову використовуємо інструкцію <span class="text-bold">Value</span> , в яку передаємо логіку створення колекції. І все, таким чином, додавання адміну закінчилося. Тепер, коли адмін не захоче отримати дані зі статистики бота, він отримає таку відповідь: <em>Не розумію тебе 😟, напиши /help щоб дізнатися що я розумію. </em> Таким чином, ми розмежували ролі для команд бота.
<h2>Додаємо команду help для адмінів</h2>Далі логічно було б створити окрему команду <span class="text-bold">help</span> для адмінів. У майбутньому ця частина може значно зрости. Додаємо значення адмінського <span class="text-bold">help</span> в CommandName: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token function">ADMIN_HELP</span><span class="token punctuation">(</span><span class="token string">"/ahelp"</span><span class="token punctuation">)</span></code></pre> Створюємо клас <span class="code">AdminHelpCommand</span> у пакеті command: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SendBotMessageService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>telegram<span class="token punctuation">.</span>telegrambots<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>api<span class="token punctuation">.</span>objects<span class="token punctuation">.</span></span><span class="token class-name">Update</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandName</span><span class="token punctuation">.</span>STAT<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">String</span><span class="token punctuation">.</span>format<span class="token punctuation">;</span>

<span class="token comment">/**
* Admin Help {@link Command}.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminHelpCommand</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ADMIN_HELP_MESSAGE <span class="token operator">=</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"✨&lt;b&gt;Доступные команды админа&lt;/b&gt;✨\n\n"</span>
                   <span class="token operator">+</span> <span class="token string">"&lt;b&gt;Получить статистику&lt;/b&gt;\n"</span>
                   <span class="token operator">+</span> <span class="token string">"%s - статистика бота\n"</span><span class="token punctuation">,</span>
           STAT<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">AdminHelpCommand</span><span class="token punctuation">(</span><span class="token class-name">SendBotMessageService</span> sendBotMessageService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sendBotMessageService <span class="token operator">=</span> sendBotMessageService<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Update</span> update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       sendBotMessageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>update<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ADMIN_HELP_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Поки що він дуже простий. У майбутньому може цілком непогано розростися. Для цієї команди — тест із нашого шаблону: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DisplayName</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">AdminHelpCommand</span><span class="token punctuation">.</span>ADMIN_HELP_MESSAGE<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>codegymcommunity<span class="token punctuation">.</span>jrtb<span class="token punctuation">.</span>command<span class="token punctuation">.</span></span><span class="token class-name">CommandName</span><span class="token punctuation">.</span>ADMIN_HELP<span class="token punctuation">;</span>

<span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">"Unit-level testing for AdminHelpCommand"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminHelpCommandTest</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCommandTest</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token class-name">String</span> <span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> ADMIN_HELP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token class-name">String</span> <span class="token function">getCommandMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> ADMIN_HELP_MESSAGE<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token class-name">Command</span> <span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AdminHelpCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> Зрозуміло, команду потрібно додати CommandContainer в нашу карту: 
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ADMIN_HELP<span class="token punctuation">.</span><span class="token function">getCommandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AdminHelpCommand</span><span class="token punctuation">(</span>sendBotMessageService<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h2>Додаємо опис команд у бота</h2>Телеграм-боти мають ще цікаву особливість: можна додати значення та опис команд, які він приймає, щоб користувачеві було легше використовувати команди. Як це виглядає? За прикладом підемо до <span class="text-bold">BotFather</span> — найголовнішого робота Телеграма. Якщо почати писати повідомлення зі слєша /, бот запропонує варіанти: <img data-max-width="800" data-id="bcda02ed-cbef-4e57-b9e8-4222402b2eaf" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 4" src="https://cdn.javarush.com/images/article/bcda02ed-cbef-4e57-b9e8-4222402b2eaf/800.jpeg" style="width: 800px;">І якщо продовжити писати, він відфільтрує та покаже релевантні варіанти:<img data-max-width="800" data-id="f071a107-2f2b-41e3-b73b-06a6b4dab9c5" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 5" src="https://cdn.javarush.com/images/article/f071a107-2f2b-41e3-b73b-06a6b4dab9c5/800.jpeg" style="width: 800px;">Класний функціонал, так? От я таке саме хочу зробити і в нас. Я робитиму так, як вмію — через додаток Телеграма. Я знаю, що це можна зробити програмно. Але я не вмію. У рамках цієї серії статей це не потрібно. Якщо хтось уміє це робити — пишіть мені, додаватимемо. Я із задоволенням прийму будь-яку допомогу в цьому. Я якось читав, що це можна зробити через патерн команда, яка у нас працює. Зараз я покажу, як я це вмію: нам потрібно знайти у Телеграмі BotFather, вибрати в нього бота, якого хочемо налаштувати. Далі вибрати редагування робота і секцію для команди. Зараз я покажу все на прикладі мого тестового робота для Javarush. У BotFather пишемо команду: <span class="text-bold">/mybots</span><img data-max-width="1080" data-id="3cd3fc40-e6f3-449b-bf43-0a22ab05c35d" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 6" src="https://cdn.javarush.com/images/article/3cd3fc40-e6f3-449b-bf43-0a22ab05c35d/1080.jpeg" style="width: 1080px;"> Далі вибираємо потрібного нам бота, в моєму випадку це буде test_codegym_community_bot:<img data-max-width="512" data-id="5a8fad3c-8fe5-4ed8-8bef-4bfeb98f3ac0" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 7" src="https://cdn.javarush.com/images/article/5a8fad3c-8fe5-4ed8-8bef-4bfeb98f3ac0/512.jpeg" style="width: 512px;">Як видно з переліку кнопок тут можна і подивитися токен, і видалити бота, і передати його комусь іншому. Нас цікавить редагування бота, тому вибираємо <span class="text-bold">Edit Bot</span> : <img data-max-width="512" data-id="353fe32e-df81-4d8d-978b-45bc74860e52" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 8" src="https://cdn.javarush.com/images/article/353fe32e-df81-4d8d-978b-45bc74860e52/512.jpeg" style="width: 512px;">І тут вибираємо <span class="text-bold">Edit Commands</span> : <img data-max-width="512" data-id="28d553f2-5e45-445f-a503-908b206a73db" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 9" src="https://cdn.javarush.com/images/article/28d553f2-5e45-445f-a503-908b206a73db/512.jpeg" style="width: 512px;">Нам потрібно просто надати у конкретному форматі повідомлення, і воно буде записано як команди. Або якщо хочемо прибрати їх усі, написати /empty. Для цієї справи створимо в корені проекту файл <span class="text-bold">SET_UP_COMMANDS_BOT_FATHER</span> , в якому напишу всі наші команди, щоб легко відновити або оновити в разі чого. <span class="text-bold">SET_UP_COMMANDS_BOT_FATHER:</span>
<div class="terminal">
 start - почати/відновити роботу з ботом stop - призупинити роботу з ботом addGroupSub - підписатися на групу статей deleteGroupSub - відписатися від групи статей listGroupSub - список груп, на які підписано
</div> Зрозуміло, що адмінські команди ми не виносимо сюди. Про них мають знати лише адміни. Беремо це повідомлення та передаємо його BotFather: <img data-max-width="512" data-id="212e7ff0-3976-4b59-9950-15bf244ccec3" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 10" src="https://cdn.javarush.com/images/article/212e7ff0-3976-4b59-9950-15bf244ccec3/512.jpeg" style="width: 512px;">Як це зазвичай водиться, з першого разу не вийшло. Після декількох хвабон роздумів, передав усі команди в нижньому регістрі, а не в CamelCase, як було до цього, і все пройшло успішно. Оновлюємо у нашому файлі: <span class="text-bold">SET_UP_COMMANDS_BOT_FATHER:</span>
<div class="terminal">
 start - почати/відновити роботу з ботом stop - призупинити роботу з ботом addgroupsub - підписатися на групу статей deletegroupsub - відписатися від групи статей listgroupsub - список груп, на які підписано help - отримати допомогу в роботі зі мною
</div> Тепер можна піти в нашого бота і посморіти, чи підтяглося підвантаження команд автоматично: <img data-max-width="512" data-id="d15fca37-1664-43fc-9673-b1d15a1f97a1" alt="&quot;Java-проект від А до Я&quot;: Додаємо можливість роботи адміну та статистику для нього.  Частина 1 - 11" src="https://cdn.javarush.com/images/article/d15fca37-1664-43fc-9673-b1d15a1f97a1/512.jpeg" style="width: 512px;">Подивіться, яка тепер краса! Хотів у рамках цієї статті ще й розширити функціонал статистики, але матеріал і так вийшов об'ємним і за змістом, і за змістом. Тому перенесемо це наступного разу. Тобто завдання JRTB-10 зроблено не повністю: ми його доробимо в рамках наступної статті. Водночас усі зміни, які вже є, я додам до основного робота. <em>Бажаєте підтримати автора, але не знаєте як? Це дуже просто – підписуйтесь на мій <a href="https://t.me/romankh3" rel="nofollow" target="_blank">ТГ-канал</a> , на мій <a href="https://github.com/romankh3" rel="nofollow" target="_blank">GitHub аккаунт</a> і пишіть тут у статтях свою думку про них. Цей зворотний зв'язок для мене важливий, так я розумію, що їх читають і ними цікавляться.</em>
<h2>Висновки</h2>Підсумуємо те, що ми сьогодні пройшли:
<ol>
 <li>Обговорабо, як додавати власну інструкцію, як її можна використовувати як маркер для розмежування ролей у командах. До речі, так можна було зробити і за допомогою інтерфейсу. Так само створабо б інтерфейс-маркер і потім перевіряли б, чи реалізує цей інтерфейс ні об'єкт, який приходить.</li>
 <li>Додали Help команду для адмінів. Як на мене — також важлива частина розвитку цього бота.</li>
 <li>Обговорабо, як додати опис та сплив команд при написанні їх у боті. Цікава фіча, напевно, варто було її додати.</li>
</ol>На основі цієї статті створив <a href="https://github.com/codegymcommunity/codegym-telegrambot/pull/26/files" rel="nofollow" target="_blank">пулл-реквест</a> , можна переглянути його деталі. Всім дякую за увагу, з вас як завжди: <s>лайк - передплата - дзвіночок</s> , зірку нашому проекту, коментар та оцінити статтю! До зустрічі у наступній статті!<a href="https://codegym.cc/login/signup" target="_blank"><img id="click_banner1_articles" data-max-width="1080" data-id="5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628" alt="&quot;Java-проект від А до Я&quot;: Додаємо Spring Scheduler - 2" src="https://cdn.javarush.com/images/article/5736eb4b-2b1c-4ab6-b4cc-b9e2d1cef628/1080.jpeg" style="width: 1080px;"></a>
<h4><a href="https://codegym.cc/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всіх матеріалів серії на початку цієї статті.</a></h4>