Особливості NoSQL баз даних
<p>----------------------------------------</p>
Слабкі властивості ACID.
Розподілені системи без спільно використовуваних ресурсів (share nothing).
NoSQL бази в основному оупенсорсні і створені в 21 столітті.
<p>----------------------------------------</p>
<h2>3.1. Слабкі ACID властивості</h2>

<p>Довгий час консистентність (consistency) даних була “священною коровою” для архітекторів та розробників. Усі реляційні бази забезпечували той чи інший рівень ізоляції - або за рахунок блокувань при зміні та блокуючого читання, або за рахунок undo-логів. З приходом величезних масивів інформації та розподілених систем стало зрозуміло, що забезпечити для них транзакційність набору операцій з одного боку та отримати високу доступність та швидкий час відгуку з іншого неможливо. </p>

<p>Більше того, навіть оновлення одного запису не гарантує, що будь-який інший користувач моментально побачить зміни в системі, адже зміна може статися, наприклад, у майстер-ноді, а репліка асинхронно скопіюється на слейв-ноду, з якою працює інший користувач . У такому разі він побачить результат через якийсь проміжок часу. Це називається eventual consistency і це те, на що йдуть зараз усі найбільші інтернет-компанії світу, включаючи Facebook та Amazon. Останні з гордістю заявляють, що максимальний інтервал, протягом якого може бачити неконсистентні дані становлять не більше секунди. Приклад такої ситуації показано на малюнку: </p>

<img data-max-width="800" data-id="aafb29ae-d75b-40a2-8126-0ef9a29a58d8" src="https://cdn.javarush.com/images/article/aafb29ae-d75b-40a2 -0ef9a29a58d8/original.jpeg" alt="">
 
<p>Логічне питання, яке постає в такій ситуації — а що робити системам, які класично пред'являють високі вимоги до атомарності-консистентності операцій і водночас потребують швидких розподілених кластерів — фінансових, інтернет-магазинів тощо? Практика показує, що ці вимоги вже давно неактуальні: ось що сказав один розробник фінансової банківської системи: “Якби ми дійсно чекали завершення кожної транзакції у світовій мережі ATM (банкоматів), транзакції займали б стільки часу, що клієнти втікали б геть. Що відбувається, якщо ти і твій партнер винаймаєте гроші одночасно і перевищуєте ліміт? — Ви обидва отримаєте гроші, а ми виправимо це пізніше.” </p>

<p>Інший приклад - бронювання готелів, показаний на зображенні. Онлайн-магазини, чия політика роботи з даними передбачає eventual consistency, зобов'язані передбачити заходи на випадок таких ситуацій (автоматичне вирішення конфліктів, відкат операції, оновлення з іншими даними). На практиці готелі завжди намагаються тримати пул вільних номерів на непередбачений випадок і це може стати вирішенням спірної ситуації. </p>

<p>Насправді слабкі ACID властивості не означають, що їх немає взагалі. У більшості випадків додаток, що працює з реляційною базою даних, використовує транзакцію зміни логічно пов'язаних об'єктів (замовлення — позиції замовлення), що необхідно, оскільки це різні таблиці. При правильному проектуванні моделі даних у NoSQL базі (агрегат являє собою замовлення разом з переліком пунктів замовлення) можна досягти такого самого рівня ізоляції при зміні одного запису, що і в реляційній базі даних.</p>
 
<h2>3.2. Розподілені системи без спільно використовуваних ресурсів (share nothing)</h2>

<p>Знову ж таки, це не стосується граф баз даних, чия структура за визначенням погано розноситься віддаленими нодами. </p>

<p>Це, мабуть, головний лейтмотив розвитку NoSQL баз. З лавиноподібним зростанням інформації у світі та необхідності її обробляти за розумний час постала проблема вертикальної масштабованості — зростання швидкості процесора зупинилося на 3.5 ГГц, швидкість читання з диска також зростає тихими темпами, плюс ціна потужного сервера завжди більша за сумарну ціну кількох простих серверів. У цій ситуації звичайні реляційні бази, навіть кластеризовані на масиві дисків, не здатні вирішити проблему швидкості, масштабованості та пропускної спроможності. </p>

<p>Єдиний вихід із ситуації — горизонтальне масштабування, коли кілька незалежних серверів з'єднуються швидкою мережею і кожен володіє/обробляє лише частину даних та/або лише частину запитів на читання-оновлення. У такій архітектурі підвищення потужності сховища (ємності, часу відгуку, пропускної спроможності) необхідно лише додати новий сервер в кластер — і все. Процедурами шардингу, реплікації, забезпеченням відмовостійкості (результат буде отримано навіть якщо один або кілька серверів перестали відповідати), перерозподіл даних у разі додавання ноди займається сама NoSQL база. </p>

<p>Стисло представлю основні властивості розподілених NoSQL баз: </p>

<p>Реплікація — копіювання даних на інші сайти під час оновлення. Дозволяє як досягти більшої масштабованості, так і підвищити доступність і збереження даних. Прийнято поділяти на два види: </p>

<strong>master-slave</strong>:

<img data-max-width="800" data-id="08385628-438a-45e6-8b39-19fb88ab935f" src="https://cdn.javarush.com/images/article/08385628-438a-45e -19fb88ab935f/original.jpeg" alt="">
 
та <strong>peer-to-peer</strong>:

<img data-max-width="800" data-id="09b9c452-ecf2-4bc3-9523-bc89de97a7cd" src="https://cdn.javarush.com/images/article/09b9c452-ecf2-4bc3- -bc89de97a7cd/original.jpeg" alt="">
 
<p>Перший тип передбачає хорошу масштабованість на читання (може відбуватися з будь-якого вузла), але запис, що не масштабується (тільки в майстер вузол). Також є тонкощі із забезпеченням постійної доступності (у разі падіння майстра або вручну, або автоматично на його місце призначається один з вузлів, що залишилися). Для другого типу реплікації передбачається, що це вузли рівні й можуть обслуговувати як запити читання, і запис. </p>

<p><strong>Шардинг</strong> — розділення даних по сайтам: </p>

<img data-max-width="800" data-id="dc3ce42c-bd1d-4433-abbb-d56fa573baf1" src="https://cdn.javarush.com/images/article/dc3ce42c-bd1d-4433-abbb -d56fa573baf1/original.jpeg" alt="">
 
<p><strong>Шардинг</strong> часто використовувався як “милиця” до реляційних баз даних з метою збільшення швидкості та пропускної спроможності: додаток користувача партикувало дані по кількох незалежних баз даних і при запиті відповідних даних користувачем звертався до конкретної бази. У NoSQL базах даних шардинг, як і реплікація, виробляються автоматично самою базою і додаток користувача відокремлено від цих складних механізмів.</p>
 
<h2>3.3. NoSQL бази в основному оупенсорсні і створені в 21 столітті</h2>

<p>Саме за другою ознакою Садаладж і Фаулер не класифікували об'єктні бази даних як NoSQL (хоча http://nosql-database.org/ включає їх до загального списку), оскільки вони були створені ще в 90-х і так і не здобули великої популярності. </p>

<p>NoSQL рух набирає популярності гігантськими темпами. Однак це не означає, що реляційні бази даних стають рудиментом чи архаїчним. Швидше за все, вони будуть використовуватися і використовуватися, як і раніше, активно, але все більше в симбіозі з ними будуть виступати NoSQL бази. Ми вступаємо в епоху polyglot persistence - епоху, коли для різних потреб використовуються різні сховища даних. Тепер немає монополізму реляційних баз даних як безальтернативного джерела даних. Все частіше архітектори вибирають сховище, виходячи з природи самих даних і того, як ми ними хочемо маніпулювати, які обсяги інформації очікуються. І тому все стає лише цікавішим. </p>

<p>Нижче ми спробуємо розібратися в роботі розподіленої бази даних на прикладі NoSQL СУБД Cassandra…</p>