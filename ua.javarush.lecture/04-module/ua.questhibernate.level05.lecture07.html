Бекап даних
<p>----------------------------------------</p>
Необхідність бекапу бази даних
Створення бекапу бази даних
Створення бекапу схеми таблиць
Створення бекапу даних
Розгортання бекапу
<p>----------------------------------------</p>
<h2>8.1 Необхідність бекапу бази даних</h2>
<p>Ти навчився створювати схеми баз даних, таблиці, переглядати їх. Також заповнювати ці таблиці даними та змінювати їх. Тепер тобі потрібно навчитися найголовнішого – робити бекапи.</p>
<p>Базу даних дуже легко зламати. Справа в тому, що база даних зазвичай перебуває у стані постійних змін: у неї постійно щось зберігається та додається.</p>
<p>Ось уяви, що у тебе в браузері відкрита вкладка і ти не хочеш, щоб інформація в ній загубилася. Погодься, що якщо ти просто вирішиш ніколи її не закривати, то це буде не найкращий варіант. Адже браузер може зависнути, його можна закрити випадково, може пропасти світло або згоріти комп'ютер. Windows може встановити черговий апдейт, та мало що.</p>
<p>Так ось, твоя база даних – це така сама вкладка. І це лише справа часу, коли при черговому записі на диск щось піде не так. Тому тобі обов'язково треба навчитися робити бекапи.</p>
<p>Робити бекапи – це як чистити зуби, у нормальних компаній щоночі робиться бекап вмісту кожної бази даних. Оскільки жорсткі диски теж можуть виходити з ладу і в датацентрах бувають пожежі, то бекапи зазвичай зберігаються в 2-3 копіях в датацентрах в різних частинах світу.</p>
<p>Є кілька підходів до створення бекапу.</p>
<p><strong>Бекап файлів. </strong>Бо всі <span class="text-green">дані бази даних зберігаються на диску у вигляді набору файлів</span>, то найпростіший спосіб - це просто скопіювати ці файли кудись. Або спочатку заархівувати в один архів, а потім кудись скопіювати.</p>
<p>Це найшвидший спосіб зробити бекап, але він вимагає, щоб файли не змінювалися під час їхнього копіювання/архівування. Базу потрібно заморозити під час створення копії, інакше копія буде кривою. Адже може бути ситуація, що частина нових даних записалася в базу, а частина ще немає.</p>
<p><strong>Бекап у вигляді SQL-запитів</strong>. Як ти вже знаєш, додавання та зміна даних у базі SQL-сервера завжди представляє у вигляді SQL-запитів. Отже, можна попросити SQL-сервер, щоб він зберіг вміст певної таблиці або таблиць у файл у вигляді SQL-запитів.</p>
<p>Цей спосіб повільніший, ніж попередній, зате з його допомогою можна переносити дані між SQL-серверами різних виробників.</p>
<p>Крім того, не всі дані завжди потрібно зберігати. Часто у тебе в таблицях є купа службової чи застарілої інформації і можна вказати SQL-серверу, щоб він її не зберігав.</p>
<p>Також для таблиць, які зберігають якісь події з прив'язкою до часу, ти можеш просто робити вибірку таких подій за останню добу та зберігати лише їх.</p>
<p><strong>Різні утиліти</strong>. Компанії готові платити купу грошей, щоб отримати гарантію, що їхні дані залишаться в цілісності та безпеці. Тому різні ІТ-компанії почали пропонувати рішення на всі випадки життя. Наприклад, є програми, які можуть робити бекап-бази у вигляді файлів і не вимагають, щоб ці файли не змінювалися.</p>
<p>Наприклад, можна встановити спеціальні драйвери в операційну систему та відстежувати, коли, що і де змінювалося.</p>
<h2>8.2 Створення бекапу бази даних</h2>
<p>Workbench чудово вміє робити експорт та імпорт даних із баз з якими працює. Для цього тобі потрібно лише натиснути пункт меню: <code>Server-&gt; Data Export</code>. І ти побачиш приблизно таку картинку:</p>
<img data-max-width="800" data-id="077c35fe-8e3b-4123-bd1b-05da4e18f8be" src="https://cdn.javarush.com/images/article/077c35fe-8e3b-4123-bd -05da4e18f8be/800.jpeg" alt="">
<p>А тепер додамо трохи пояснень:</p>
<img data-max-width="800" data-id="f07330e8-96f1-4693-a8e5-099ccb2b63ef" src="https://cdn.javarush.com/images/article/f07330e8-96f1-4693 -099ccb2b63ef/800.jpeg" alt="">
<p>Порядок такий:</p>
<ol>
<li>Спочатку вибираємо схему, або схеми, які експортуватиме.</li>
<li>Потім праворуч вказуємо таблиці для бекапу.</li>
<li>Далі ми маємо вибрати, що саме ми експортуватимемо:</li>
<ul>
<li>тільки дані;</li>
<li>тільки структуру (таблиці буде, але порожні);</li>
<li>дані та структуру.</li>
</ul>
<li>Вибираємо як дані зберегти:</li>
<ul>
<li>один файл для кожної таблиці;</li>
<li>один файл для всіх таблиць.</li>
</ul>
<li>Також можеш додати код створення схеми на початок файлу. Це зручно при перенесенні даних між різними СУБД.</li>
</ol>
<h2>8.3 Створення бекапу схеми таблиць</h2>
<p>Давайте створимо бекап тільки схеми, без даних.</p>
<p>Я вибрав Dump Structure Only і натиснув Start Export.</p>
<img data-max-width="512" data-id="bfb02fee-e4b1-46d2-8292-b1d796969d0c" src="https://cdn.javarush.com/images/article/bfb02fee-e4b1-42d -b1d796969d0c/512.jpeg" alt="">
<p>І ось що я знайшов у файлі, який зробив Workbench.</p>
<pre class='language-java line-numbers'><code>
<span class="token comment">--
-- Table structure for table `user`
--</span>
 
DROP TABLE IF EXISTS `user`;
/*!40101 SET @saved_cs_client = @character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user` (
  `id` int(11) NOT NULL,
  `name` varchar(100) DEFAULT NULL,
  `level` int(11) DEFAULT NULL,
  `created_date` date NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
</code></pre>
<p>Все вірно, це і є схема наших таблиць, якщо так можна сказати про одну єдину таблицю.</p>
<h2>8.4 Створення бекапу даних</h2>
<p>А тепер давай зробимо бекап лише даних, але без структури схеми.</p>
<p>Оберемо Dump Data Only і подивимося, що нам віддадуть:</p>
<img data-max-width="512" data-id="23ac2770-c70f-4e18-b60b-2b9438d7bb83" src="https://cdn.javarush.com/images/article/23ac2770-c70f-4e18- -2b9438d7bb83/512.jpeg" alt="">
<p>І ось що я знайшов у файлі, який зробив Workbench.</p>
<pre class='language-java line-numbers'><code>
<span class="token comment">--
-- Dumping data for table `user`
--</span>
 
LOCK TABLES `user` WRITE;
/*!40000 ALTER TABLE `user` DISABLE KEYS */;
INSERT INTO `user` VALUES
 (1, 'Іванов Іван',40,'2022-05-11'),
 (2, "Петрів Нікола", 1, "2021-05-01"),
 (3, "Сідроов Віталій", 8, "2022-05-12");
/*!40000 ALTER TABLE `user` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
</code></pre>
<p>Так, дуже схоже на правду. Також ми бачимо спеціальний код, який лочить таблицю user. Це зроблено для того, щоб ти міг просто виконувати цей SQL-скрипт: у ньому містяться всі інструкції, які дозволять будь-якому SQL-серверу правильно відновити дані.</p>
<h2>8.5 Розгортання бекапу</h2>
<p>І нарешті останнє – це відновлення бази даних із бекапу. Ця дія дуже проста, але корисна.</p>
<p>Допустимо, я хочу, щоб у всіх моїх студентів була певна база даних, щоб ви могли на ній вчитися писати запити. Тоді я просто дам вам посилання на файл, який ви локально у себе розгорнете і все.</p>
<p>І навіть якщо ви випадково видалите якісь дані, таблиці, або навіть усю схему, її завжди можна буде відновити з бекапу.</p>
<p>Для того щоб зробити Import даних потрібно в меню клацнути на пункт <code>Server-&gt; Data Import</code>. Тоді ви побачите таку картинку:</p>
<img data-max-width="800" data-id="690e1ce0-5b31-4807-8172-06c5ba1d4459" src="https://cdn.javarush.com/images/article/690e1ce0-5b31-4807- -06c5ba1d4459/800.jpeg" alt="">
<p>Як і у випадку з експортом, спочатку вам пропонують вибрати джерело даних: група файлів або всі дані одним файлом.</p>
<p>Потім потрібно вибрати схему, в яку будуть заливатись зазначені дані. Ви можете вибрати як існуючу схему, так і створити нову.</p>
<p><strong>Важливо!</strong> Якщо ваш бекап містить не тільки дані, а й опис структури таблиць, то таблиці будуть перестворені (якщо такі вже є в цільовій схемі).</p>