Основні завдання під час проектування баз даних
<p>----------------------------------------</p>
Забезпечення зберігання у БД всієї необхідної інформації
Забезпечення можливості отримання даних за всіма необхідними запитами
Скорочення надмірності та дублювання даних
Забезпечення цілісності бази даних
Оптимізація швидкості доступу до даних
<p>----------------------------------------</p>
<h2>1.1 Вступ</h2>
<p>Проектування бази даних чимось схоже на створення архітектури Java-проекту. Ви можете помістити всі дані в пару таблиць, а можете побудувати красиву структуру даних зі схем та десятків таблиць. </p>
<p>Ось які завдання зазвичай стоять перед розробником під час проектування бази даних: </p>
<ol>
<li>Забезпечення зберігання у БД всієї необхідної інформації.</li>
<li>Забезпечення можливості отримання даних за всіма необхідними запитами.</li>
<li>Скорочення надмірності та дублювання даних.</li>
<li>Забезпечення цілісності бази даних</li>
<li>Оптимізація швидкості доступу до даних</li>
</ol>
<p>Головне пам'ятаєте, не можна створити ідеальну структуру бази даних, т.к. вона, як і ваш код, теж постійно змінюватиметься. При проектуванні структури бази даних потрібно пам'ятати три речі:</p>
<ol>
<li>Структура має бути досить гарною. </li>
<li>У всьому має бути логіка, зрозуміла іншим людям. </li>
<li>Завчасна оптимізація – корінь усіх зол. </li>
</ol>
<p><strong>Не потрібно</strong> робити найкращу у світі структуру бази даних. Вона все одно змінюватиметься. Ваше завдання стежити за тим, щоб після 20 змін структури вашої бази в ній було досить просто розібратися. </p>
<p>Швидше за все, в перші роки вашої роботи ніхто не довірить вам спроектувати базу з нуля. Ви вносите зміни до вже існуючої схеми. Вам потрібно постаратися зрозуміти на основі яких принципів вона влаштована і <strong>дотримуватися їх</strong>. Зі своїм статутом у чужий монастир не лізуть.
</p>
<p><strong>Не оптимізуйте базу даних</strong>, поки це не потрібно. Якщо в таблиці всього кілька сотень рядків, то швидше за все СУБД триматиме її в пам'яті і кешуватиме запити до неї.
</p>
<p>З іншого боку, ви повинні вміти прискорити роботу важливих запитів у десятки, а то й сотні разів. І добре вам знати, як це робиться. Як там кажуть у виші на першому курсі? «Забудьте все, чого вас навчали у школі…»
</p>
<p>Якщо ви знаєте, що таке нормалізація баз даних, то поспішаю вас порадувати, у своїй роботі ви швидше за все займатиметеся <strong>де-нормалізацією</strong>. Для заказників проекту немає нічого важливішого за швидкість роботи бази даних. І якщо для того, щоб прискорити вибірку даних з бази, потрібно об'єднати 200(!) таблиць в одну (з жахливою надмірністю), вам доведеться це зробити.</p>
<h2>1.2 Проектування бібліотеки</h2>
<p>Давайте, щоб трохи поринути у предметну область, поміркуємо над проектуванням бази даних на такому простому прикладі, як робота звичайної книжкової бібліотеки.</p>
<p>Основне завдання будь-якої бібліотеки – обробка книжкового фонду. Неважко виділити три основні групи користувачів системи: <strong>читач, бібліотекар, адміністратор</strong>. Діяльність кожного їх показана на діаграмі варіантів використання. </p>
<img data-max-width="512" data-id="5c1ceca8-4c3a-47e2-81ce-cf458cfb1dad" src="https://cdn.javarush.com/images/article/5c1ceca8-4c3a-47e2-81ce -cf458cfb1dad/512.jpeg" alt="">
<p>Вже зараз можна виділити деякі сутності та відносини майбутньої бази даних:</p>
<img data-max-width="800" data-id="3b8a6e54-4dcb-48a9-afe9-dd588efe8906" src="https://cdn.javarush.com/images/article/3b8a6e54-4dcb-48a9-afe -dd588efe8906/800.jpeg" alt="">
<p>При такому підході не зрозуміло, як саме зв'язати читача з книгою (у читача не проставлена арність щодо «видача/прийом». Якщо книга має кілька екземплярів — то вона може бути видана декільком читачам. Навіть якщо під книгою розуміти один екземпляр — при збереженні в таблиці книг поточного читача призведе до неможливості отримання інформації про те, хто (і скільки разів) брав цю книгу раніше.</p>
<p>Рішенням може бути <strong>запровадження додаткової сутності</strong> — картки про видачу книги. При видачі книги читачеві заводиться картка, а під час здачі книги — до неї ставиться відповідна позначка. За допомогою цих карток визначаються заборгованості кожного користувача та обчислюється статистика використання книг.
При бронюванні літератури читачем також заводиться картка, якщо заброньована література не взята читачем у визначений термін — картка знищується. Існує обмеження кількості книг, які може забронювати читач. </p>
<p>При підборі літератури користувач переглядає каталог літератури з можливістю фільтрації результатів пошуку за автором, назвою, роком видання.</p>
<p>Є можливість розрахунку статистики за всіма книгами бібліотеки, при цьому кількість виданих екземплярів книги за заданий період часу. Також можна задати мінімальну кількість екземплярів книг, для яких виконується розрахунок. На підставі цієї статистики проводиться списання книг, що не використовуються, з бібліотеки.</p>
<p>Можна виділити такі основні сутності предметної області: </p>
<ul>
<li><strong>користувач</strong> (бібліотекарі та адміністратори);</li>
<li><strong>читач; </strong></li>
<li><strong>читальний зал;</strong></li>
<li><strong>книга; </strong></li>
<li><strong>картка видачі книги;</strong></li>
<li><strong>картка бронювання книги.</strong></li>
</ul>
<p>Допрацьована ER-діаграма бази даних наведена на малюнку.</p>
<img data-max-width="800" data-id="911e9c95-c3bb-467c-8a86-8c6a4e487b98" src="https://cdn.javarush.com/images/article/911e9c95-c3bb-867c -8c6a4e487b98/800.jpeg" alt="">
<p>Відповідно до прецедентів, показаних на малюнку 1, база даних повинна реалізовувати наступні запити (не повний перелік): </p>
<ul>
<li>відобразити книги, що відповідають заданим умовам; </li>
<li>відобразити користувачів, які мають незакриті вчасно картки видачі книг (бібліотекар шукає боржників);</li>
<li>відобразити всі книги, що відповідають незакритим вчасно карткам видачі книг заданого користувача (користувач прийшов до бібліотеки за новими книгами — треба подивитися, чи є він боржником і повідомити його про це); </li>
<li>видалити всі картки бронювання, створені більш ніж N секунд тому; </li>
<li>відобразити всі книги, що відповідають незакритим карткам бронювання книг заданого користувача (читач замовив книги та прийшов до бібліотеки за ними — бібліотекарю треба отримати цей список, щоб видати).
</li>
</ul>
<h2>1.3 Формування схеми даних</h2>
Для формування схеми даних необхідно спочатку доповнити ER-діаграму реквізитами сутностей (уточнити її). Іноді, при цьому, вдається знайти помилки побудови ER-діаграми — у цьому завданні було виявлено, що книгу необхідно «якось» пов'язати із залом бібліотеки.
</p>
<p>Зробити це можна, помістивши в книгу реквізит «номер залу», проте за такого підходу одну й ту саму книгу доведеться описувати в базі кілька разів (якщо вона зустрічається у різних залах). Більш правильний підхід полягає у запровадження додаткової сутності «розміщення книги». На малюнку показана ER-діаграма з доданою сутністю та реквізитами. </p>
<img data-max-width="1024" data-id="dce386c9-1721-4c73-b71f-fae67df02985" src="https://cdn.javarush.com/images/article/dce386c9-1721-4c73 -fae67df02985/1024.jpeg" alt="">
<p>Наведена ER-діаграма відображає основні таблиці, зв'язки та атрибути, на її основі можна побудувати модель БД. На ER-діаграми немає стандарту, але є низка нотацій (Чена, IDEFIX, Мартіна тощо), але на модель предметної області не вдалося знайти ні стандарту, ні нотацій. Однак, у ході побудови такої діаграми обов'язково виділяються ключові поля (зовнішні та внутрішні), іноді індекси та типи даних. </p>
<p>При цьому на наступній схемі: </p>
<ul>
<li>для зв'язків використовується нотація Мартіна («вороньі лапки»);</li>
<li>таблиці зображені прямокутниками, розділеними на 3 секції: </li>
<ul>
<li>ім'я таблиці;</li>
<li>внутрішні ключі (позначаються маркером); </li>
Інші поля, при цьому обов'язкові позначаються маркером. </li>
</ul>
<p><img data-max-width="800" data-id="be301feb-d3ec-48e3-8eb1-a5a7de7a353a" src="https://cdn.javarush.com/images/article/be301feb-d3ec- 48e3-8eb1-a5a7de7a353a/800.jpeg" alt=""></p>
</ul>
<p>Під час розробки цієї моделі виникало бажання об'єднати таблицю адміністраторів з таблицею бібліотекарів — додати таблицю users, проте: </p>
<ul>
<li>адміністратор не пов'язаний із конкретним залом (довелося б заповнювати відповідне поле null-значеннями);</li>
<li>ймовірно, це ускладнило б розподіл прав доступу — зараз доступ до таблиці administrators має лише адміністратор бази даних (працюючий через спеціальну панель СУБД і не має облікового запису в системі, що розробляється). Однак при з'єднанні таблиць запити користувача вимагали б доступу до нової таблиці.</li>
</ul>
<p>При побудові цієї діаграми було знайдено та виправлено недолік ER-діаграми — додано таблицю <code>librarians_rooms</code>, що об'єднує бібліотекарів та зали. Це потрібно, оскільки один бібліотекар може працювати в кількох залах, але кілька бібліотекарів можуть працювати в тому самому залі. </p>
<p>При проектуванні баз даних ви повинні вміти міркувати хоча б так, як у наведеному вище прикладі. Якщо ви вважаєте, що у вас це вийшло – ходімо далі: ще більше теорії.</p>
