<h2>Методи newBuilder(), build()</h2>
<p>Клас <span class="code"><span class="text-green">HttpRequеst</span></span> використовується для опису http-request, що легко зрозуміти з його назви. Цей об'єкт сам собою нічого не робить, він тільки містить різноманітну інформацію з приводу http-запиту. Тому, як ти вже напевно здогадуєшся, для його створення теж використовується шаблон Builder.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name"></span><span class="text-red"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name"><span class="text-red">HttpRequest</span></span><span class="token punctuation">.</span><span class="token function"><span class="text-green">newBuilder</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation"></span><span class="text-neon"><span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
	<span class="token punctuation"></span><span class="text-neon"><span class="token punctuation">.</span><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
	<span class="token punctuation"></span><span class="text-neon"><span class="token punctuation">.</span><span class="token function">methodN</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
    <span class="token punctuation">.</span><span class="token function"><span class="text-green">build</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>Де між викликами методів <span class="code text-orange">newBuilder()</span> та <span class="code text-orange">build()</span> потрібно викликати всі методи для конструювання об'єкта<mark class="green">HttpRequest</mark>.</p>
<p>Приклад найпростішого запиту виглядає так:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpClient</span> <span class="text-green">client</span> <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">newHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HttpRequest</span> <span class="text-red">request</span> <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="text-green">“http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>codegym<span class="token punctuation">.</span>cc”</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HttpResponse</span> <span class="text-neon">response</span> <span class="token operator">=</span> <span class="text-green">client</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="text-red">request</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandlers</span><span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Всі методи класу <span class="code"><span class="text-green">HttpRequest</span></span> ти можеш знайти за посиланням <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.net.http/java/net/http/HttpRequest.html" target="_blank">в офіційній документації</a> .</p>
<p>А далі ми розберемо найпопулярніші з них.</p>
<h2>Метод uri()</h2>
<p>За допомогою методу <span class="code text-orange">uri()</span> можна задати URI (або URL), до якого буде надіслано http-запит. Приклад:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function"></span><span class="text-green"><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
    <span class="token punctuation">.</span><span class="token function"><span class="text-red">uri</span></span><span class="token punctuation">(</span> <span class="text-neon">URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>“http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>codegym<span class="token punctuation">.</span>cc”<span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function"><span class="text-green">build</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>До речі, можна записати цей код ще трохи коротше, передавши URI прямо метод <span class="code text-orange">newBuilder()</span> :</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function"><span class="text-green">newBuilder</span></span><span class="token punctuation">(</span> <span class="text-neon">URI<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>“http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>codegym<span class="token punctuation">.</span>cc”<span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function"><span class="text-green">build</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><span class="text-red"><span class="text-bold">Важливо! </span></span>URI можна створити двома способами:</p>
<ul>
 <li><span class="code text-orange">new URI(String)</span></li>
 <li><span class="code text-orange">URI.create(String)</span></li>
</ul>
<p>Другий спосіб кращий. Перший спосіб, на жаль, не дуже хороший, тому конструктор URI оголошений так <span class="code">public URI(String str) throws URISyntaxException</span> , а <span class="text-red"><span class="text-bold">URISyntaxException</span></span> - це checked-виняток.</p>
<h2>Методи GET(), POST(), PUT(), DELETE()</h2>
<p>Задати http-метод запиту можна за допомогою методів:</p>
<ul>
 <li><span class="code text-orange">GET()</span></li>
 <li><span class="code text-orange">POST()</span></li>
 <li><span class="code text-orange">PUT()</span></li>
 <li><span class="code text-orange">DELETE()</span></li>
</ul>
<p>Ось як виглядатиме простий GET-запит:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string"><span class="text-green">"https://codegym.cc"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation"></span><span class="text-red"><span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Метод version()</h2>
<p>Також можна задати версію протоколу HTTP. Їх лише 2 варіанти:</p>
<ul>
 <li>HttpClient.Version.HTTP_1_1</li>
 <li>HttpClient.Version.HTTP_2</li>
</ul>
<p>Допустимо, ти хочеш створити запит за протоколом HTTP/2, тоді тобі потрібно буде написати:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string"><span class="text-green">"https://codegym.cc"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation"></span><span class="text-red"><span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span> <span class="token class-name">HttpClient<span class="token punctuation">.</span>Version</span><span class="token punctuation">.</span>HTTP_2 <span class="token punctuation">)</span></span><span class="token punctuation"></span>
   <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Дуже просто, чи не так? :)</p>
<h2>Метод timeout()</h2>
<p>Також можна вказати час виконання запиту. Якщо воно пройде, а запит так і не буде виконано, викинеться виняток <span class="text-red"><span class="text-bold">HttpTimeoutException</span></span> .</p>
<p>Саме час задається за допомогою об'єкта<mark class="green">Duration</mark>з Java DateTime API. Приклад:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string"><span class="text-green">"https://codegym.cc"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation"></span><span class="text-red"><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> SECONDS<span class="token punctuation">)</span> <span class="token punctuation">)</span></span><span class="token punctuation"></span>
   <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Наявність цього методу показує, що класи <span class="code"><span class="text-green">HttpClient</span></span> та <span class="code"><span class="text-green">HttpRequest</span></span> можуть вирішувати найрізноманітніші завдання. Уяви, що ти виконуєш запит, а щось трапилося з мережею і він тривав 30 секунд. Набагато корисніше відразу отримати виняток і правильно на нього зреагувати.</p>
<h2>Метод header()</h2>
<p>Також до будь-якого запиту можна додати скільки завгодно заголовків. І зробити це так само просто, як і все інше. Для цього є спеціальний метод <span class="code text-orange">header()</span> . Приклад:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string"><span class="text-green">"https://codegym.cc"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation"></span><span class="text-red"><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
   <span class="token punctuation"></span><span class="text-red"><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"name2"</span><span class="token punctuation">,</span> <span class="token string">"value2"</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
   <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Є ще один альтернативний спосіб задати одразу багато заголовків. Може стати в нагоді, якщо, ти, припустимо, перетворив список заголовків на масив:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string"><span class="text-green">"https://codegym.cc"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"></span><span class="text-red"><span class="token function">headers</span><span class="token punctuation">(</span><span class="token string">"name1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">,</span> <span class="token string">"name2"</span><span class="token punctuation">,</span> <span class="token string">"value2"</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
   <span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Все просто просто.</p>