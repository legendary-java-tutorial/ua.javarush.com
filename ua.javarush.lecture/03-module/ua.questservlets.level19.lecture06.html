<h2>Executor</h2><img data-max-width="800" data-id="83e7f607-1195-4d00-a2b8-f790515dc1a9" alt="" src="https://cdn.javarush.com/images/article/83e7f607-1195-4d00-a2b8-f790515dc1a9/800.jpeg" style="width: 800px;">
<p><span class="text-neon"><span class="text-bold"><em>Executor</em></span></span> – базовий інтерфейс для класів, що реалізує запуск<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> завдань. Тим самим забезпечується допомога з додаванням завдання та способом її запуску.</p>
<p><span class="text-neon"><span class="text-bold"><em>ExecutorService</em></span></span> - інтерфейс, що розширює властивості<span class="text-neon"><span class="text-bold"><em> Executor</em></span></span> і який описує сервіс для запуску<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> або<span class="text-neon"><span class="text-bold"><em> Callable</em></span></span> задач. Методи submit на вхід приймають завдання у вигляді<span class="text-neon"><span class="text-bold"><em> Callable</em></span></span> або<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> , а як значення, що повертається йде Future, через який ти можеш отримати результат.</p>
<p>Метод <span class="code text-orange">введеннявсіх</span> відповідає за виконання завдань з поверненням списку завдань зі своїм статусом і результатами завершення.</p>
<p>Метод <span class="code text-orange">invokeAny</span> відповідає за виконання завдань з поверненням результату успішно виконаної задачі (тобто без створення винятку), якщо такі є.</p>
<p><span class="text-neon"><span class="text-bold"><em>ScheduledExecutorService</em></span></span> - цей інтерфейс додає можливість запускати відкладені завдання з певною затримкою або певним періодом.</p>
<p><span class="code"><span class="text-green">AbstractExecutorService</span></span> - абстрактний клас для побудови<span class="text-neon"><span class="text-bold"><em> ExecutorService</em></span></span> 'a. Усередині є імплементація методів<span class="code text-orange"> submit</span> ,<span class="code text-orange"> invokeAll</span> ,<span class="code text-orange"> invokeAny</span> . Від цього класу успадковуються<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> ,<span class="text-green"><span class="text-bold"><em> ScheduledThreadPoolExecutor</em></span></span> та<span class="text-green"><span class="text-bold"><em> ForkJoinPool</em></span></span> .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">ScheduledExecutorService</span> scheduledExecutorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   scheduledExecutorService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
   scheduledExecutorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2>ThreadPoolExecutor</h2><img data-max-width="800" data-id="2b86fe3b-e258-4219-8c32-7d3ba93670ea" alt="" src="https://cdn.javarush.com/images/article/2b86fe3b-e258-4219-8c32-7d3ba93670ea/800.jpeg" style="width: 800px;">
<p><span class="code"><span class="text-green">Executors</span></span> - клас-фабрика для створення<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> ,<span class="text-green"><span class="text-bold"><em> ScheduledThreadPoolExecutor</em></span></span> . Якщо потрібно створити один із цих пулів, то ця фабрика саме те, що потрібно. Містяться різні адаптери Runnable-Callable, PrivilegedAction-Callable, PrivilegedExceptionAction-Callable та інші. Має статичні методи для створення різних<span class="text-green"><span class="text-bold"><em> ThreadPool</em></span></span> .</p>
<p><span class="text-green"><span class="text-bold"><em>ThreadPoolExecutor</em></span></span> - реалізує інтерфейси<span class="text-neon"><span class="text-bold"><em> Executor</em></span></span> і<span class="text-neon"><span class="text-bold"><em> ExecutorService</em></span></span> і поділяє створення задачі та її виконання. Нам необхідно реалізувати об'єкти<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> та відправити їх виконавцю, а<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> відповідає за їх виконання, створення екземплярів та роботу з потоками.</p>
<p><span class="text-green"><span class="text-bold"><em>ScheduledThreadPoolExecutor</em></span></span> - на додаток до методів<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> створює пул потоків, який може планувати виконання команд після заданої затримки або для періодичного виконання.</p>
<p><mark class="green">ThreadFactory</mark>— це об'єкт, який створює нові потоки на вимогу. Нам необхідно передати екземпляр метод <span class="code text-orange">Executors.newSingleThreadExecutor(ThreadFactory threadFactory)</span> .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"MyThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>MAX_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> thread<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><span class="text-neon"><span class="text-bold"><em>RejectedExecutionHandler</em></span></span> — дозволяє визначити обробник для завдань, які з якихось причин не можуть бути виконані через<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> . Таке відбувається, коли немає вільних потоків чи сервіс вимикається чи вимкнений (shutdown).</p>
<p>Декілька стандартних імплементацій знаходяться в класі <span class="code"><span class="text-green">ThreadPoolExecutor</span></span> :</p>
<ul>
 <li>CallerRunsPolicy - запускає завдання в потоці, що викликає;</li>
 <li>AbortPolicy - кидає ексепшен;</li>
 <li>DiscardPolicy - ігнорує завдання;</li>
 <li>DiscardOldestPolicy - видаляє найстаріше незапущене завдання з черги, потім намагається додати нове завдання ще раз.</li>
</ul>
<h2>Completion Service</h2><img data-max-width="512" data-id="52be544f-17a5-406c-9f5f-9864056f87a8" alt="" src="https://cdn.javarush.com/images/article/52be544f-17a5-406c-9f5f-9864056f87a8/512.jpeg" style="width: 512px;">
<p><span class="text-neon"><span class="text-bold"><em>CompletionService</em></span></span> - інтерфейс сервісу з розв'язкою запуску асинхронних завдань та отриманням результатів. Для додавання задач є метод<span class="code text-orange">submit</span>, а для отримання результатів вже завершених задач використовується метод блокування<span class="code text-orange">і</span>неблокуючий<span class="code text-orange">poll</span>.</p>
<p><span class="code"><span class="text-green">ExecutorCompletionService</span></span> — це обгортка над будь-яким класом, який реалізує інтерфейс<span class="text-neon"><span class="text-bold"><em> Executor</em></span></span> , наприклад,<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> або<span class="text-green"><span class="text-bold"><em> ForkJoinPool</em></span></span> . Використовується, коли потрібно абстрагуватися від способу запуску завдань та контролю за їх виконанням.</p>
<p>Якщо є завершені завдання, витягуємо їх. Якщо завдань немає, то висимо в таке, поки щось завершиться. В основі сервісу використовується LinkedBlockingQueue, але ти можеш передати будь-яку реалізацію BlockingQueue.</p>