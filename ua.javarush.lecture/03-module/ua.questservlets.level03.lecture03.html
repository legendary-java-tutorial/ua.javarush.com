<h2>4.1 @Disabled</h2>
<p>Тепер розберемо кілька дуже корисних та популярних анотацій фреймворку JUnit. Перша інструкція дозволяє вимкнути певний тест, щоб JUnit його не викликав. Вона потрібна у випадках, якщо ти помітиш, що тест працює неправильно, або зміниш код і тест випадково зламається.</p>
<p>Як я писав раніше, 99% тестів ніхто не підтримує, тому всі вони рано чи пізно виявляються відключеними. Тому ця інструкція перша у списку корисних.</p>
<p>Розглянемо її приклад:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Disabled</span><span class="token punctuation">(</span><span class="token string">"Тест тимчасово вимкнено. Правда, правда"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Test</span></span><span class="token annotation punctuation"></span>
    <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>У прикладі вище метод <code>testOnDev()</code>не викликатиметься. До речі, анотацію <code>@Disabled</code>можна написати одразу перед оголошенням класу, тоді всі його методи будуть проігноровані.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Disabled</span><span class="token punctuation">(</span><span class="token string">"Тимчасово відключабо тест, полагодимо до травня 2001 року"</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>4.2 @Nested</h2>
<p>JUnit дозволяє викликати тестові методи вкладених класів. Мається на увазі вкладені тестові класи. Не факт, що ти часто стикатимешся з ними, але ймовірність така є, тому потрібно розуміти, що це таке.</p>
<p>Щоб викликати методи вкладеного класу перед оголошенням, потрібно написати інструкцію <code>@Nested</code>. Приклад:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Nested</span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevStagingEnvironment</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
        <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Nested</span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductionEnvironment</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
        <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Докладніше можна почитати в офіційній <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested" target="_blank">документації</a> .</p>
<h2>4.3 @ExtendWith</h2>
<p>Інша корисна інструкція - <code>@ExtendWith</code>. Швидше за все ти зустрічатимеш її дуже часто, тож розглянемо її докладніше.</p>
<p>JUnit - це потужний фреймворк, який дозволяє писати різні плагіни (розширення) для гнучкого налаштування своєї роботи. Деякі розширення можуть збирати статистику про тести, інші - емулювати файлову систему в пам'яті, треті - емулювати роботу всередині веб-сервера і так далі.</p>
<p>Якщо твій код працює всередині якогось фреймворку (наприклад Spring), <span class="text-user">то майже завжди цей фреймворк керує створенням та налаштуванням об'єктів твого коду</span> . Тому без спеціального тестового плагіна не обійтись. Приклади:</p>
<p><strong>Приклад 1.</strong> Розширення <code>WebServerExtension</code>передає в тестовий метод <code>URL</code>для коректної роботи.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Test</span>
<span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">WebServerExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">void</span> <span class="token function">getProductList</span><span class="token punctuation">(</span><span class="token annotation punctuation"><span class="text-green">@WebServerUrl</span></span> <span class="token class-name">String</span> serverUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Use WebClient to connect to web server using serverUrl and verify response</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serverUrl <span class="token operator">+</span> <span class="token string">"/products"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResponseStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Ось так зазвичай починаються тести для тестування коду, який працює з фреймворком Spring:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-red"><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">SpringExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token annotation punctuation"></span><span class="text-red"><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">class</span> <span class="token class-name">TestServiceTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token class-name">TestService</span> service<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertNotNull</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Test succeeds</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code class="text-red">SpringExtension</code>створює тестовий варіант фреймворку Spring, а <code class="text-red">MockitoExtention</code>дозволяє створювати фейкові об'єкти. Фейкові об'єкти — тема дуже цікава, ми обов'язково її торкнемося, але трохи пізніше.</p>
<h2>4.4 @Timeout</h2>
<p>Закінчимо цю лекцію невеликою та цікавою анотацією <code>@Timeout</code>. Вона дозволяє задати час виконання тесту. Якщо виконання тесту зайняло більше часу, ніж зазначено в інструкції, він вважається проваленим.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">class</span> <span class="token class-name">TimeoutDemo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Timeout</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> unit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span></span><span class="token punctuation"></span>
    <span class="token keyword">void</span> <span class="token function">failsIfExecutionTimeExceeds100Milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// тест впаде, якщо займе понад 100 мілісекунд</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>На цьому закінчимо нашу лекцію.</p>