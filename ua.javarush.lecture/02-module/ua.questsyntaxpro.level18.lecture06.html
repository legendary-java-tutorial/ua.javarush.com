<h2>1. Збір елементів</h2>
<p>І нарешті ми дійшли до найцікавішого методу в класі <code>Stream</code>— методу <code>collect()</code>. Він використовується для того, щоб перейти від потоків до звичних колекцій - <code>List&lt;T&gt;</code>, <code>Set&lt;T&gt;</code>, <code>Map&lt;T, R&gt;</code>та іншим.</p>
<p>У спосіб <code>collect()</code>необхідно передати особливий об'єкт — <code>collector</code>. Цей об'єкт вираховує всі дані з потоку, перетворює їх до певної колекції та повертає її. А за ним цю ж колекцію повертає і сам метод collect.</p>
<p>Все це зроблено досить хитро: об'єкт <code>collector</code>має тип <code>Collector&lt;T, A, R&gt;</code>– у нього аж три типи-параметри. Останній тип <code>R</code>— це і є тип начебто <code>List&lt;T&gt;</code>. Тому компілятор може за цим типом підставити правильний тип результату самого методу <code>collect()</code>.</p>
<p>Сподіваюся, ви не дуже заплуталися. У будь-якому випадку самому створювати об'єкти типу Collector вам не потрібно. Достатньо просто скористатися вже готовими об'єктами, які повертають статичні методи класу <code>Collectors</code>.</p>
<p><strong>Клас Collectors</strong></p>
<p>Клас <code>Collectors</code>має кілька статичних методів, які повертають готові об'єкти-колектори на всі випадки життя. Їх кілька десятків, але ми розглянемо найголовніші:</p>
<div class="table-container">
 <table>
  <tbody>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Об'єкт, який перетворює потік на список<code>List&lt;T&gt;</code></td>
   </tr>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Об'єкт, який перетворює потік на безліч<code>Set&lt;T&gt;</code></td>
   </tr>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Об'єкт, який перетворює потік на меп<code>Map&lt;K, V&gt;</code></td>
   </tr>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Склеює елементи потоку в один рядок</td>
   </tr>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">mapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Перетворює елементи потоку в<code>Map&lt;K, V&gt;</code></td>
   </tr>
   <tr>
    <td>
     <pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></td>
    <td>Групує елементи, повертає<code>Map &lt;K, V&gt;</code></td>
   </tr>
  </tbody>
 </table>
</div>
<hr>
<h2>2. Перетворення потоку на список</h2>
<p>Ось як виглядає типова робота з потоком та перетворення результату роботи на список</p>
<pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> <span class="text-green">list</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="text-neon">Collections</span></span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="text-green">list</span><span class="token punctuation">,</span> <span class="token string">"Вітання"</span><span class="token punctuation">,</span> <span class="token string">"як"</span><span class="token punctuation">,</span> <span class="token string">"дела?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="text-green">list</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">stream</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">filter</span></span><span class="token punctuation">(</span> <span class="text-viola">s <span class="token operator">-&gt;</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isUpperCase</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">collect</span></span><span class="token punctuation">(</span> <span class="token class-name"></span><span class="text-orange"><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ми отримали потік у колекції, потім у нього отримали новий потік, відфільтрувавши лише рядки, перший символ яких є великим. Потім усі дані з останнього потоку зібрали до колекції та повернули її.</p>
<hr>
<hr>
<h2>3. Перетворення потоку на безліч</h2>
<p>Ось як виглядає типова робота з потоком і перетворення результату роботи на безліч</p>
<pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> <span class="text-green">list</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="text-neon">Collections</span></span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="text-green">list</span><span class="token punctuation">,</span> <span class="token string">"Вітання"</span><span class="token punctuation">,</span> <span class="token string">"як"</span><span class="token punctuation">,</span> <span class="token string">"дела?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="text-green">list</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">stream</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">filter</span></span><span class="token punctuation">(</span> <span class="text-viola">s <span class="token operator">-&gt;</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isUpperCase</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">collect</span></span><span class="token punctuation">(</span> <span class="token class-name"></span><span class="text-orange"><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Все дуже схоже на код перетворення потоку в <code>List</code>, тільки використовується інший об'єкт-колектор, який повертає метод<code><span class="text-orange">toSet();</span></code></p>
<hr>
<hr>
<h2>4. Перетворення потоку на меп</h2>
<p>А ось перетворити потік на меп трохи складніше. Адже кожен об'єкт Map складається з двох елементів – ключа та значення. Нам потрібно придумати, як елемент потоку ми визначатимемо ключ, а як — значення.</p>
<p>приклад.</p>
<pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> <span class="text-green">list</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="text-neon">Collections</span></span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="text-green">list</span><span class="token punctuation">,</span> <span class="token string">"a=2"</span><span class="token punctuation">,</span> <span class="token string">"b=3"</span><span class="token punctuation">,</span> <span class="token string">"c=4"</span><span class="token punctuation">,</span> <span class="token string">"d==3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="text-green">list</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">stream</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">map</span></span><span class="token punctuation">(</span> <span class="text-viola">e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">filter</span></span><span class="token punctuation">(</span> <span class="text-user">e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span> </span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function"><span class="text-red">collect</span></span><span class="token punctuation">(</span> <span class="token class-name"></span><span class="text-green"><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span></span><span class="token function"></span><span class="token punctuation">(</span><span class="text-user">e <span class="token operator">-&gt;</span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><span class="token punctuation"></span><span class="token punctuation">,</span> <span class="text-viola">e <span class="token operator">-&gt;</span> e<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span><span class="token punctuation"></span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Розберемо, що тут відбувається.</p>
<p>У першому рядку <code>map(...)</code>ми перетворюємо кожен рядок на масив рядків. Використовуючи метод split, ми ділимо кожен рядок на дві частини за символом "рівно".</p>
<p>У другому рядку - метод <code>filter()</code>- ми пропускаємо через фільтр тільки ті елементи-масиви, які містять рівно два елементи. Елемент <code>d == 3</code>був розбитий на масив із трьох елементів, і фільтр не пройде.</p>
<p>І нарешті, в останньому рядку ми перетворюємо потік на <code>Map&lt;String, String&gt;</code>. У метод <code>toMap()</code>передаються дві функції. Для кожного елемента потоку <span class="text-user">перша функція повинна повернути ключ</span> , а <span class="text-viola">друга - значення</span> .</p>
<p>У нас як ключ буде перший елемент масиву ("a", "b", "c"), а як значення - другий елемент масиву: "2", "3", "4".</p>
<hr>
<hr>
<h2>5. Перетворення потоку на рядок</h2>
<p>Ще один цікавий об'єкт-колектор - це <code><span class="text-viola">Collectors.joining()</span></code>. Він перетворює всі елементи потоку до типу <code>String</code>і склеює в один рядок. приклад</p>
<pre class=" language-java" tabindex="0"><code class=" language-java"><span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span> <span class="text-green">list</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="text-neon">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="text-orange">String</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="text-neon">Collections</span></span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="text-green">list</span><span class="token punctuation">,</span> <span class="token string">"a=2"</span><span class="token punctuation">,</span> <span class="token string">"b=3"</span><span class="token punctuation">,</span> <span class="token string">"c=4"</span><span class="token punctuation">,</span> <span class="token string">"d==3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> <span class="text-user">result</span> <span class="token operator">=</span> <span class="text-green">list</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">stream</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">collect</span></span><span class="token punctuation">(</span> <span class="token class-name"></span><span class="text-viola"><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span></span><span class="token function"></span><span class="token punctuation">(</span><span class="token string"><span class="text-viola">", "</span></span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<hr>