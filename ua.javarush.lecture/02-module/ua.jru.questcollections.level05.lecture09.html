<p>— Ну, і насамкінець ще одна маленька лекція з Generic.</p>
<p>Зараз я тобі розповім, як оминати «стирання типів» (Type erasure).</p>
<p><span class="text-user">- Ага. Мені також хочеться це знати.</span></p>
<p>— Як ти вже напевно знаєш, Java має тип Class, який використовується, щоб зберігати посилання на об'єкт класу. Приклади:</p>
<div class="code-heading">
 Приклади
</div>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></code></pre>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></code></pre>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span></span><code class=" language-java"><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token string"><span class="text-viola">"abc"</span></span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><span class="text-user">- Ага.</span></p>
<p>Але чого ти, напевно, не знаєш, так це того, що є ще один клас Class, який є Generic'ом. І&nbsp; <span class="text-viola">змінні цього Generic Class'а можуть зберігати лише посилання тип, який був типом-параметром. </span>&nbsp;Приклади:</p>
<div class="code-heading">
 Приклади
</div>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name"></span><span class="text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz1 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span> <span class="token comment">//все отлично работает</span>
<span class="token class-name"></span><span class="text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz2 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span> <span class="token comment"><span class="text-red">//ошибка компиляции.</span></span></code></pre>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name"></span><span class="text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span> <span class="token comment">//все отлично работает</span>
<span class="token class-name"></span><span class="text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz2 <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span> <span class="token comment"><span class="text-red">//ошибка компиляции.</span></span></code></pre>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name"></span><span class="dblue_text text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz1 <span class="token operator">=</span> <span class="token string"><span class="violet_text text-viola">"abc"</span></span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"><span class="grey_text">//все отлично работает</span></span>
<span class="token class-name"></span><span class="dblue_text text-user"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span></span><span class="token generics"><span class="token punctuation"></span></span> clazz2 <span class="token operator">=</span> <span class="token string"><span class="violet_text text-viola">"abc"</span></span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"><span class="red_text text-red">//ошибка компиляции.</span></span></code></pre>
<p><span class="text-user">— А чому так працює?</span></p>
<p>— Справа в тому, що значення поля class типу Integer (тобто Integer.class) – це насправді об'єкт типу Class&lt;Integer&gt;.</p>
<p>Але давай ходімо далі.</p>
<p>Так ось, користуючись тим фактом, що Class&lt;T&gt; - це Generic, і тим, що змінна його типу може зберігати значення тільки типу T, можна зробити таку хитру комбінацію:</p>
<div class="code-heading">
 приклад
</div>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">class</span> <span class="token class-name">Zoo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="red_text text-red"><b>T</b></span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
 <span class="token class-name"><span class="text-red">Class</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="red_text text-red"><b>T</b></span></span><span class="token punctuation">&gt;</span></span> <span class="text-red">clazz</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="text-user">ArrayList</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="red_text text-red"><b>T</b></span></span><span class="token punctuation">&gt;</span></span> <span class="text-user">animals</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"></span><span class="text-user"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="red_text text-red"><b>T</b></span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation"></span>

 <span class="token class-name">Zoo</span><span class="token punctuation">(</span><span class="token class-name"><span class="text-red">Class</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="red_text text-red"><b>T</b></span></span><span class="token punctuation">&gt;</span></span> <span class="text-corporate">clazz</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="text-red">clazz</span> <span class="token operator">=</span> <span class="text-corporate">clazz</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token class-name"><strong><span class="text-red">T</span></strong></span> <span class="token function">createNewAnimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
  <span class="token class-name"><span class="text-red"><strong>T</strong></span></span> <span class="text-green">animal</span> <span class="token operator">=</span> <span class="text-red">clazz</span><span class="token punctuation">.</span><span class="token function"><strong>newInstance</strong></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="text-user">animals</span><span class="token punctuation">.</span><span class="token function"><strong>add</strong></span><span class="token punctuation">(</span><span class="text-green">animal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword"><strong>return</strong></span> <span class="text-green">animal</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<div class="code-heading">
 Як це використовувати
</div>
<pre class="line-numbers  language-java" data-line="" data-start="" tabindex="0" style="counter-reset: linenumber 0 NaN 0;"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name"><span class="text-user">Zoo</span></span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="green_text text-green">Tiger</span></span><span class="token punctuation">&gt;</span></span> <span class="text-user">zoo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Zoo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="green_text text-green">Tiger</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name"><span class="text-green">Tiger</span></span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"><span class="text-red">// вот тут передается тип!</span></span>
<span class="token class-name"></span><span class="text-green"><span class="token class-name">Tiger</span> tiger</span> <span class="token operator">=</span> <span class="text-user">zoo</span><span class="token punctuation">.</span><span class="token function"><strong>createNewAnimal</strong></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><span class="text-corporate">Це не мегахитра комбінація - ми просто передаємо посилання на потрібний тип. Але якби ми просто користувалися Class замість Class&lt;T&gt;, то хтось міг помилково передати туди два різні типи – один як параметр T, інший – у конструктор.</span></p>
<p><span class="text-user">- Ага. Розумію. Нічого надприродного не сталося і страшного також. Посилання на тип є, користуватися ним можна, працює і добре.</span></p>
<p>— Ось, чую слова «не хлопчика, а чоловіка!» Працює і добре – це найоптимальніший варіант.</p>
<p>Дуже багато всього можна було б переробити в Java, але потрібно зберігати сумісність зі старим кодом.</p>
<p>Саме десятки тисяч популярних налагоджених бібліотек – це сьогодні найвагоміший аргумент на користь Java. Отже, зберігаючи зворотну сумісність, Java залишається найпопулярнішою мовою, і тому може впроваджувати радикальні нововведення.</p>
<p><span class="text-user">- А я зроблю свою Java з блекджеком і …</span></p>
<p>— Гаразд, я вже втомився за день. Давай до побачення.</p>
<p><span class="text-user">— До побачення, Ріша, і дякую за такий цікавий урок.</span></p>